(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[100],{16464:(e,a,t)=>{Promise.resolve().then(t.bind(t,81817))},81817:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>A});var r=t(95155),s=t(12115),o=t(6829),l=t(76408),i=t(60760),n=t(25014),c=t(26428),d=t.n(c);t(62739);var h=t(15385);let x=e=>{let a=new Uint8Array([...atob(e)].map(e=>e.charCodeAt(0)));return new TextDecoder().decode(a)},m=async e=>{let a=new Uint8Array(await e.arrayBuffer()),t=d()(a).filter(e=>"tEXt"===e.name).map(e=>h.decode(e.data)),r=t.find(e=>"ccv3"===e.keyword.toLowerCase()),s=t.find(e=>"chara"===e.keyword.toLowerCase()),o=(null==r?void 0:r.text)||(null==s?void 0:s.text);if(!o)throw Error("No PNG metadata found.");return x(o)},u=async e=>{if(!e.name.toLowerCase().endsWith(".png"))throw Error("Unsupported format");return m(e)};var p=t(18564),f=t(93362),g=t(73153),b=t(5618),v=t(51368);async function w(e){if(!e||!e.name.toLowerCase().endsWith(".png"))throw Error("Unsupported or missing file.");try{var a,t,r,s,o,l,i,n;let c=await u(e),d=JSON.parse(c),h="char_".concat(Date.now()),x="".concat(h,".png");if((null===(t=d.data)||void 0===t?void 0:null===(a=t.character_book)||void 0===a?void 0:a.entries)&&await g.K.updateWorldBook(h,d.data.character_book.entries),null===(s=d.data)||void 0===s?void 0:null===(r=s.extensions)||void 0===r?void 0:r.regex_scripts){let e=d.data.extensions.regex_scripts;if(Array.isArray(e))e.forEach(e=>{e.scriptKey||(e.scriptKey="script_".concat((0,v.A)()))}),await b.x.updateRegexScripts(h,e);else if("object"==typeof e){let a=Object.values(e).filter(e=>e&&"object"==typeof e);a.length>0&&(a.forEach(e=>{e.scriptKey||(e.scriptKey="script_".concat((0,v.A)()))}),await b.x.updateRegexScripts(h,a))}}return await p.Q.createCharacter(h,d,x),await (0,f.aU)(x,e),{success:!0,characterId:h,characterData:d,imagePath:x,hasWorldBook:!!(null===(l=d.data)||void 0===l?void 0:null===(o=l.character_book)||void 0===o?void 0:o.entries),hasRegexScripts:!!(null===(n=d.data)||void 0===n?void 0:null===(i=n.extensions)||void 0===i?void 0:i.regex_scripts)}}catch(e){throw console.error("Failed to parse character data:",e),Error("Failed to parse character data: ".concat(e.message))}}function j(e){let{isOpen:a,onClose:t,onImport:c}=e,{t:d,fontClass:h,serifFontClass:x}=(0,o.ok)(),[m,u]=(0,s.useState)(!1),[p,f]=(0,s.useState)(null),[g,b]=(0,s.useState)(!1),[v,j]=(0,s.useState)(""),y=(0,s.useRef)(null),N=async()=>{if(!p){j(d("importCharacterModal.noFileSelected"));return}b(!0),j("");try{if(new FormData().append("file",p),!(await w(p)).success)throw Error(d("importCharacterModal.uploadFailed"));c(),t()}catch(e){console.error("Error uploading character:",e),j("string"==typeof e?e:d("importCharacterModal.uploadFailed"))}finally{b(!1)}},k=()=>{f(null),j(""),y.current&&(y.current.value="")},C=()=>{k(),t()};return a?(0,r.jsx)(i.N,{children:a&&(0,r.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[(0,r.jsx)(l.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 backdrop-blur-sm bg-opacity-50",onClick:C}),(0,r.jsx)(l.P.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},transition:{type:"spring",damping:25,stiffness:300},className:"bg-[#1e1c1b] bg-opacity-75 border border-[#534741] rounded-lg shadow-xl w-full max-w-md relative z-10 overflow-hidden fantasy-bg backdrop-filter backdrop-blur-sm",children:(0,r.jsxs)("div",{className:"p-6",children:[(0,r.jsx)("h2",{className:"text-xl text-[#eae6db] mb-4 ".concat(x),children:d("importCharacterModal.title")}),(0,r.jsx)("p",{className:"text-[#c0a480] mb-6 text-sm ".concat(h),children:d("importCharacterModal.description")}),(0,r.jsxs)("div",{className:"border-2 border-dashed rounded-lg p-8 mb-4 text-center transition-colors duration-300 ".concat(m?"border-[#f9c86d] bg-[#252220]":"border-[#534741] hover:border-[#a18d6f]"),onDragOver:e=>{e.preventDefault(),u(!0)},onDragLeave:e=>{e.preventDefault(),u(!1)},onDrop:e=>{if(e.preventDefault(),u(!1),e.dataTransfer.files&&e.dataTransfer.files.length>0){let a=e.dataTransfer.files[0];"image/png"===a.type?(f(a),j("")):j(d("importCharacterModal.pngOnly"))}},onClick:()=>{var e;return null===(e=y.current)||void 0===e?void 0:e.click()},children:[(0,r.jsx)("input",{type:"file",ref:y,className:"hidden",accept:"image/png",onChange:e=>{if(e.target.files&&e.target.files.length>0){let a=e.target.files[0];"image/png"===a.type?(f(a),j("")):j(d("importCharacterModal.pngOnly"))}}}),(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center",children:[(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-12 h-12 mb-3 ".concat(p?"text-[#f9c86d]":"text-[#a18d6f]"),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),p?(0,r.jsxs)("div",{className:"text-[#eae6db] ".concat(h),children:[(0,r.jsx)("p",{className:"font-medium",children:p.name}),(0,r.jsxs)("p",{className:"text-xs text-[#a18d6f] mt-1",children:[(p.size/1024).toFixed(1)," KB"]})]}):(0,r.jsxs)("div",{className:"text-[#a18d6f] ".concat(h),children:[(0,r.jsx)("p",{children:d("importCharacterModal.dragOrClick")}),(0,r.jsx)("p",{className:"text-xs mt-1",children:d("importCharacterModal.pngFormat")})]})]})]}),v&&(0,r.jsx)("div",{className:"text-[#e57373] text-sm mb-4 text-center",children:v}),(0,r.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,r.jsx)("button",{onClick:C,className:"px-4 py-2 text-[#c0a480] hover:text-[#ffd475] transition-colors ".concat(h),children:d("common.cancel")}),(0,r.jsx)("button",{onClick:e=>{(0,n.Mh)("ImportCharacterModal","导入角色"),N()},className:"px-4 py-2 bg-[#252220] hover:bg-[#3a2a2a] border border-[#534741] rounded-md text-[#f9c86d] transition-colors ".concat(h," ").concat(!p||g?"opacity-50 cursor-not-allowed":""),children:g?(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("div",{className:"w-4 h-4 mr-2 rounded-full border-2 border-t-[#f9c86d] border-r-[#c0a480] border-b-[#a18d6f] border-l-transparent animate-spin"}),d("importCharacterModal.uploading")]}):d("importCharacterModal.import")})]})]})})]})}):null}async function y(e,a){try{if(!await p.Q.getCharacterById(e))throw Error("Character not found");let t=await p.Q.updateCharacter(e,a);if(!t)throw Error("Failed to update character");return{success:!0,character:t}}catch(e){throw console.error("Failed to update character:",e),Error("Failed to update character: ".concat(e.message))}}var N=t(57987);let k=e=>{let{isOpen:a,onClose:t,characterId:c,characterData:d,onSave:h}=e,{t:x,fontClass:m,serifFontClass:u}=(0,o.ok)(),[p,f]=(0,s.useState)(""),[g,b]=(0,s.useState)(""),[v,w]=(0,s.useState)(""),[j,k]=(0,s.useState)(""),[C,_]=(0,s.useState)(""),[M,P]=(0,s.useState)(!1),[S,L]=(0,s.useState)("");(0,s.useEffect)(()=>{a&&d&&(f(d.name||""),b(d.personality||""),w(d.scenario||""),k(d.first_mes||""),_(d.creatorcomment||""),L(""))},[a,d]);let E=async e=>{e.preventDefault(),P(!0),L("");try{if(!(await y(c,{name:p,personality:g,scenario:v,first_mes:j,creatorcomment:C})).success)throw Error("Failed to update character");h(),t()}catch(e){L(e.message||"An error occurred")}finally{P(!1)}};return(0,r.jsx)(i.N,{children:a&&(0,r.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[(0,r.jsx)(l.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 backdrop-blur-sm",onClick:t}),(0,r.jsxs)(l.P.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},transition:{type:"spring",damping:20,stiffness:300},className:"relative w-full max-w-4xl bg-[#1a1816] border border-[#534741] rounded-lg shadow-xl z-10 overflow-hidden",children:[(0,r.jsx)("div",{className:"absolute top-2 right-2 z-20",children:(0,r.jsx)("button",{onClick:e=>{(0,n.Mh)("EditCharacterModal","关闭编辑角色"),t()},className:"text-[#a18d6f] hover:text-[#eae6db] transition-colors bg-[#1a1816] rounded-full p-1",children:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})}),S&&(0,r.jsx)("div",{className:"mb-4 p-3 bg-red-900/30 border border-red-800 rounded text-red-200 text-sm",children:S}),(0,r.jsxs)("div",{className:"flex flex-col md:flex-row",children:[(0,r.jsx)("div",{className:"md:w-2/5 lg:w-1/3 relative",children:(0,r.jsxs)("div",{className:"h-full",children:[d.avatar_path?(0,r.jsx)(N.H,{avatarPath:d.avatar_path}):(0,r.jsx)("div",{className:"w-full h-full min-h-[500px] flex items-center justify-center bg-[#252220]",children:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-32 w-32 text-[#534741]",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})}),(0,r.jsx)("div",{className:"absolute bottom-4 w-full text-center text-[#eae6db] ".concat(u," text-xl magical-text"),children:p||d.name})]})}),(0,r.jsxs)("div",{className:"md:w-3/5 lg:w-2/3 bg-[#1a1816] p-6",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold text-[#eae6db] magical-text mb-6 ".concat(u),children:x("editCharacterModal.title")}),S&&(0,r.jsx)("div",{className:"mb-4 p-3 bg-red-900/30 border border-red-800 rounded text-red-200 text-sm",children:S}),(0,r.jsxs)("form",{onSubmit:E,className:"max-h-[70vh] overflow-y-auto pr-2 space-y-5",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"character-name",className:"block text-sm font-medium text-[#c0a480] mb-2 ".concat(m),children:x("editCharacterModal.name")}),(0,r.jsx)("input",{type:"text",id:"character-name",value:p,onChange:e=>f(e.target.value),className:"w-full bg-[#252220] border border-[#534741] rounded p-3 text-[#eae6db] focus:outline-none focus:ring-1 focus:ring-[#c0a480] ".concat(m),required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"character-personality",className:"block text-sm font-medium text-[#c0a480] mb-2 ".concat(m),children:x("editCharacterModal.personality")}),(0,r.jsx)("textarea",{id:"character-personality",value:g,onChange:e=>b(e.target.value),rows:3,className:"w-full bg-[#252220] border border-[#534741] rounded p-3 text-[#eae6db] focus:outline-none focus:ring-1 focus:ring-[#c0a480] ".concat(m)})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"character-scenario",className:"block text-sm font-medium text-[#c0a480] mb-2 ".concat(m),children:x("editCharacterModal.scenario")}),(0,r.jsx)("textarea",{id:"character-scenario",value:v,onChange:e=>w(e.target.value),rows:3,className:"w-full bg-[#252220] border border-[#534741] rounded p-3 text-[#eae6db] focus:outline-none focus:ring-1 focus:ring-[#c0a480] ".concat(m)})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"character-first-message",className:"block text-sm font-medium text-[#c0a480] mb-2 ".concat(m),children:x("editCharacterModal.firstMessage")}),(0,r.jsx)("textarea",{id:"character-first-message",value:j,onChange:e=>k(e.target.value),rows:3,className:"w-full bg-[#252220] border border-[#534741] rounded p-3 text-[#eae6db] focus:outline-none focus:ring-1 focus:ring-[#c0a480] ".concat(m)})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"character-creator-comment",className:"block text-sm font-medium text-[#c0a480] mb-2 ".concat(m),children:x("editCharacterModal.creatorComment")}),(0,r.jsx)("textarea",{id:"character-creator-comment",value:C,onChange:e=>_(e.target.value),rows:3,className:"w-full bg-[#252220] border border-[#534741] rounded p-3 text-[#eae6db] focus:outline-none focus:ring-1 focus:ring-[#c0a480] ".concat(m)})]}),(0,r.jsxs)("div",{className:"flex justify-end space-x-4 pt-4",children:[(0,r.jsx)("button",{type:"button",onClick:e=>{(0,n.Mh)("EditCharacterModal","关闭编辑角色"),t()},className:"text-[#8a8a8a] hover:text-[#f4e8c1] transition-colors duration-300 ".concat(u),children:x("editCharacterModal.cancel")}),(0,r.jsx)("button",{type:"submit",disabled:M,onClick:e=>{(0,n.Mh)("EditCharacterModal","保存编辑角色"),t()},className:"text-amber-400 hover:text-amber-300 transition-colors duration-300 ".concat(u),children:M?(0,r.jsx)("div",{className:"h-5 w-5 border-2 border-[#1a1816] border-t-transparent rounded-full animate-spin"}):x("editCharacterModal.save")})]})]})]})]})]})]})})},C="https://raw.githubusercontent.com/Narratium/Character-Card/main/";function _(e){let{isOpen:a,onClose:t,onImport:i}=e,{t:n,fontClass:c,serifFontClass:d}=(0,o.ok)(),[h,x]=(0,s.useState)([]),[m,u]=(0,s.useState)(!1),[p,f]=(0,s.useState)(null),[g,b]=(0,s.useState)(null);(0,s.useEffect)(()=>{a&&(u(!0),b(null),fetch("https://api.github.com/repos/Narratium/Character-Card/contents").then(e=>e.json()).then(e=>{Array.isArray(e)?x(e.filter(e=>e.name.endsWith(".png"))):b(n("downloadModal.fetchError"))}).catch(()=>b(n("downloadModal.fetchError"))).finally(()=>u(!1)))},[a]);let v=async e=>{f(e.name),b(null);try{let a=await fetch(e.download_url||C+e.name);if(!a.ok)throw Error(n("downloadModal.downloadFailed"));let r=await a.blob(),s=new File([r],e.name,{type:r.type});await w(s),i(),t()}catch(e){b(e.message||n("downloadModal.importFailed"))}finally{f(null)}},j=e=>{let a=e.replace(/\.png$/,""),t=a.split(/--/);return 2!==t.length?{displayName:a,author:n("downloadModal.unknownAuthor")}:{displayName:t[0].trim(),author:t[1].trim().length>5?t[1].trim().substring(0,5):t[1].trim()}};return a?(0,r.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[(0,r.jsx)(l.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 backdrop-blur-sm bg-opacity-50",onClick:t}),(0,r.jsxs)(l.P.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},className:"bg-[#1a1714] rounded-lg shadow-lg p-6 w-full max-w-2xl relative z-10",children:[(0,r.jsx)("button",{className:"absolute top-2 right-2 text-[#c0a480] hover:text-[#ffd475]",onClick:t,children:"\xd7"}),(0,r.jsx)("h2",{className:"text-xl mb-4 text-[#eae6db] font-bold ".concat(d),children:n("downloadModal.title")}),m?(0,r.jsx)("div",{className:"text-[#c0a480] py-8 text-center ".concat(c),children:n("downloadModal.loading")}):g?(0,r.jsx)("div",{className:"text-red-400 py-8 text-center ".concat(c),children:g}):(0,r.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 max-h-96 overflow-y-auto",children:h.map(e=>{let{displayName:a,author:t}=j(e.name);return(0,r.jsxs)("div",{className:"bg-[#252220] rounded-lg p-3 flex flex-col items-center",children:[(0,r.jsx)("img",{src:C+e.name,alt:e.name,className:"w-32 h-32 object-cover rounded mb-2 border border-[#534741]"}),(0,r.jsx)("div",{className:"text-[#eae6db] text-sm mb-1 line-clamp-1 ".concat(c),children:a}),(0,r.jsxs)("div",{className:"text-[#c0a480] text-xs mb-2 ".concat(c),children:[n("downloadModal.by")," ",t]}),(0,r.jsx)("button",{disabled:!!p,className:"px-2 py-0.5 text-xs rounded bg-[#e0cfa0] text-[#534741] hover:bg-[#ffd475] border border-[#c0a480] ".concat(c," shadow-sm transition-all duration-150 ").concat(p===e.name?"opacity-60 cursor-wait":""),style:{minWidth:0,minHeight:0,lineHeight:"1.1",fontWeight:500,letterSpacing:"0.01em"},onClick:()=>v(e),children:p===e.name?n("downloadModal.importing"):n("downloadModal.downloadAndImport")})]},e.name)})})]})]}):null}var M=t(6874),P=t.n(M),S=t(15366);let L=e=>{let{characters:a,onEditClick:t,onDeleteClick:s}=e,{t:i,fontClass:c,serifFontClass:d}=(0,o.ok)();return(0,r.jsx)(l.P.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.5,staggerChildren:.1},className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:a.map((e,a)=>(0,r.jsx)(l.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.05*a},className:"scale-[0.85]",children:(0,r.jsx)(S.A,{tiltMaxAngleX:-15,tiltMaxAngleY:-15,glareEnable:!0,glareMaxOpacity:.1,glareColor:"#ffffff",glarePosition:"all",glareBorderRadius:"8px",scale:1.02,transitionSpeed:2e3,className:"h-full",children:(0,r.jsxs)("div",{className:"relative session-card h-full transition-all duration-300",children:[(0,r.jsxs)("div",{className:"absolute top-2 right-2 flex space-x-1 z-10",children:[(0,r.jsx)(P(),{href:"/character?id=".concat(e.id),onClick:e=>e.stopPropagation(),className:"p-1.5 bg-[#252220] hover:bg-[#3a2a2a] rounded-full text-[#c0a480] hover:text-[#ffd475] transition-colors",title:i("characterCardsPage.chat"),"aria-label":i("characterCardsPage.chat"),children:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"text-[#c0a480] hover:text-[#ffd475] transition-colors",children:(0,r.jsx)("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"})})}),(0,r.jsx)("button",{onClick:a=>{(0,n.Mh)("edit_character_btn","编辑角色"),t(e,a)},className:"p-1.5 bg-[#252220] hover:bg-[#3a2a2a] rounded-full text-[#c0a480] hover:text-[#ffd475] transition-colors",title:i("characterCardsPage.edit"),"aria-label":i("characterCardsPage.edit"),children:(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,r.jsx)("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),(0,r.jsx)("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]})}),(0,r.jsx)("button",{onClick:a=>{(0,n.Mh)("delete_character_btn","删除角色"),a.stopPropagation(),s(e.id)},className:"p-1.5 bg-[#252220] hover:bg-[#3a2a2a] rounded-full text-[#c0a480] hover:text-[#ffd475] transition-colors",title:i("characterCardsPage.delete"),"aria-label":i("characterCardsPage.delete"),children:(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,r.jsx)("polyline",{points:"3 6 5 6 21 6"}),(0,r.jsx)("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})]})})]}),(0,r.jsxs)(P(),{href:"/character?id=".concat(e.id),className:"block h-full flex flex-col",children:[(0,r.jsx)("div",{className:"relative w-full overflow-hidden rounded aspect-[4/5]",children:e.avatar_path?(0,r.jsx)(N.H,{avatarPath:e.avatar_path}):(0,r.jsx)("div",{className:"w-full h-full flex items-center justify-center bg-[#252220]",children:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-24 w-24 text-[#534741]",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})})}),(0,r.jsxs)("div",{className:"p-4",children:[(0,r.jsx)("h2",{className:"text-lg text-[#eae6db] line-clamp-1 magical-text ".concat(d),children:e.name}),(0,r.jsxs)("div",{className:"text-xs text-[#a18d6f] mt-2 italic ".concat(c),children:[(0,r.jsx)("span",{className:"inline-block mr-1 opacity-70",children:"✨"}),(0,r.jsx)("span",{className:"line-clamp-2",children:e.personality})]})]})]})]})})},e.id))})};var E=t(11518),z=t.n(E);let F=e=>{let{characters:a,onEditClick:t,onDeleteClick:i}=e,{t:c,fontClass:d,serifFontClass:h}=(0,o.ok)(),[x,m]=(0,s.useState)(0),[u,p]=(0,s.useState)(!1),f=Math.min(a.length,8),g=f>0?360/f:120,b=f<=3?30:Math.max(25,30-(f-3)*2),v=()=>{u||(p(!0),m(e=>(e+1)%f),setTimeout(()=>p(!1),800))},w=()=>{u||(p(!0),m(e=>(e-1+f)%f),setTimeout(()=>p(!1),800))};return(0,r.jsxs)("div",{style:{perspective:"1500px"},className:"jsx-c6808190e76842f7 relative w-full h-[70vh] max-h-[600px] my-12 pt-40 flex items-center justify-center",children:[(0,r.jsx)("div",{style:{transformOrigin:"center center 0px",transformStyle:"preserve-3d",transform:"translateZ(-".concat(b,"vw)")},className:"jsx-c6808190e76842f7 w-full h-full absolute transform-style-preserve-3d",children:a.slice(0,f).map((e,a)=>{let s,o,m,p;let j=(a-x+f)%f,y=j*g,k=0===j,C=!k&&!(y>90&&y<270);return k?(s=1,o="none",m="0 8px 25px rgba(0, 0, 0, 0.4)",p=1):C?(s=.7,o="none",m="0 4px 15px rgba(0, 0, 0, 0.2)",p=.9):(s=.4,o="none",m="0 2px 10px rgba(0, 0, 0, 0.1)",p=.8),(0,r.jsx)(l.P.div,{className:"absolute w-full h-full flex items-center justify-center",style:{transform:"rotateY(".concat(y,"deg) translateZ(").concat(b,"vw) scale(").concat(p,")"),transformOrigin:"center center",maxWidth:"280px",maxHeight:"350px",width:"40vw",height:"50vw",left:"calc(50% - 10vw)",top:"calc(50% - 15vw)",boxShadow:m,opacity:s,filter:o,borderRadius:"8px",transition:u?"all 0.8s cubic-bezier(0.77, 0, 0.175, 1)":"opacity 0.3s ease, filter 0.3s ease, box-shadow 0.3s ease"},children:(0,r.jsxs)("div",{className:"jsx-c6808190e76842f7 relative session-card h-full w-full transition-all duration-300 overflow-hidden rounded",children:[(0,r.jsxs)("div",{className:"jsx-c6808190e76842f7 absolute top-2 right-2 flex space-x-1 z-10",children:[(0,r.jsx)(P(),{href:"/character?id=".concat(e.id),onClick:e=>e.stopPropagation(),className:"p-1.5 bg-[#252220] hover:bg-[#3a2a2a] rounded-full text-[#c0a480] hover:text-[#ffd475] transition-colors",title:c("characterCardsPage.chat"),"aria-label":c("characterCardsPage.chat"),children:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"jsx-c6808190e76842f7 text-[#c0a480] hover:text-[#ffd475] transition-colors",children:(0,r.jsx)("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",className:"jsx-c6808190e76842f7"})})}),(0,r.jsx)("button",{onClick:a=>{(0,n.Mh)("edit_character_btn","编辑角色"),t(e,a)},title:c("characterCardsPage.edit"),"aria-label":c("characterCardsPage.edit"),className:"jsx-c6808190e76842f7 p-1.5 bg-[#252220] hover:bg-[#3a2a2a] rounded-full text-[#c0a480] hover:text-[#ffd475] transition-colors",children:(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"jsx-c6808190e76842f7",children:[(0,r.jsx)("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",className:"jsx-c6808190e76842f7"}),(0,r.jsx)("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z",className:"jsx-c6808190e76842f7"})]})}),(0,r.jsx)("button",{onClick:a=>{(0,n.Mh)("delete_character_btn","删除角色"),a.stopPropagation(),i(e.id)},title:c("characterCardsPage.delete"),"aria-label":c("characterCardsPage.delete"),className:"jsx-c6808190e76842f7 p-1.5 bg-[#252220] hover:bg-[#3a2a2a] rounded-full text-[#c0a480] hover:text-[#ffd475] transition-colors",children:(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"jsx-c6808190e76842f7",children:[(0,r.jsx)("polyline",{points:"3 6 5 6 21 6",className:"jsx-c6808190e76842f7"}),(0,r.jsx)("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",className:"jsx-c6808190e76842f7"})]})})]}),(0,r.jsxs)(P(),{href:"/character?id=".concat(e.id),className:"block h-full flex flex-col",children:[(0,r.jsx)("div",{className:"jsx-c6808190e76842f7 relative w-full overflow-hidden rounded aspect-[4/5]",children:e.avatar_path?(0,r.jsx)(N.H,{avatarPath:e.avatar_path}):(0,r.jsx)("div",{className:"jsx-c6808190e76842f7 w-full h-full flex items-center justify-center bg-[#252220]",children:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",className:"jsx-c6808190e76842f7 h-24 w-24 text-[#534741]",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z",className:"jsx-c6808190e76842f7"})})})}),(0,r.jsxs)("div",{className:"jsx-c6808190e76842f7 p-4 relative",children:[(0,r.jsx)("h2",{className:"jsx-c6808190e76842f7 "+"text-lg text-[#eae6db] line-clamp-1 magical-text ".concat(h),children:e.name}),(0,r.jsxs)("div",{className:"jsx-c6808190e76842f7 "+"text-xs text-[#a18d6f] mt-2 italic ".concat(d),children:[(0,r.jsx)("span",{className:"jsx-c6808190e76842f7 inline-block mr-1 opacity-70",children:"✨"}),(0,r.jsx)("span",{className:"jsx-c6808190e76842f7 line-clamp-2",children:e.personality})]}),k&&f>1&&(0,r.jsxs)("div",{className:"jsx-c6808190e76842f7 absolute bottom-2 left-1/2 transform -translate-x-1/2 flex space-x-2 z-30",children:[(0,r.jsx)("button",{onClick:e=>{e.preventDefault(),e.stopPropagation(),v()},disabled:u,"aria-label":"向左旋转",className:"jsx-c6808190e76842f7 p-2 bg-[#252220]/90 hover:bg-[#3a2a2a]/95 rounded-full text-[#c0a480] hover:text-[#ffd475] transition-all duration-300 backdrop-blur-sm border border-[#3a2a2a]/50 disabled:opacity-50 disabled:cursor-not-allowed shadow-lg",children:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"jsx-c6808190e76842f7",children:(0,r.jsx)("polyline",{points:"15 18 9 12 15 6",className:"jsx-c6808190e76842f7"})})}),(0,r.jsx)("button",{onClick:e=>{e.preventDefault(),e.stopPropagation(),w()},disabled:u,"aria-label":"向右旋转",className:"jsx-c6808190e76842f7 p-2 bg-[#252220]/90 hover:bg-[#3a2a2a]/95 rounded-full text-[#c0a480] hover:text-[#ffd475] transition-all duration-300 backdrop-blur-sm border border-[#3a2a2a]/50 disabled:opacity-50 disabled:cursor-not-allowed shadow-lg",children:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"jsx-c6808190e76842f7",children:(0,r.jsx)("polyline",{points:"9 6 15 12 9 18",className:"jsx-c6808190e76842f7"})})})]})]})]})]})},e.id)})}),(0,r.jsx)(z(),{id:"c6808190e76842f7",children:".transform-style-preserve-3d.jsx-c6808190e76842f7{-webkit-transform-style:preserve-3d;-moz-transform-style:preserve-3d;transform-style:preserve-3d}"})]})};var B=t(37196);async function W(e,a){try{return[...await p.Q.getAllCharacters()].reverse().map(t=>{var r,s,o,l,i,n,c;let d={id:t.id,name:(null===(r=t.data.data)||void 0===r?void 0:r.name)||t.data.name,description:(null===(s=t.data.data)||void 0===s?void 0:s.description)||t.data.description,personality:(null===(o=t.data.data)||void 0===o?void 0:o.personality)||t.data.personality,scenario:(null===(l=t.data.data)||void 0===l?void 0:l.scenario)||t.data.scenario,first_mes:(null===(i=t.data.data)||void 0===i?void 0:i.first_mes)||t.data.first_mes,mes_example:(null===(n=t.data.data)||void 0===n?void 0:n.mes_example)||t.data.mes_example,creatorcomment:t.data.creatorcomment||(null===(c=t.data.data)||void 0===c?void 0:c.creator_notes),created_at:t.created_at,updated_at:t.updated_at,avatar_path:t.imagePath};return(0,B._)(d,e,a)})}catch(e){throw console.error("Failed to get characters:",e),Error("Failed to get characters: ".concat(e.message))}}var D=t(18324);async function H(e){try{if(!e)return{error:"Character ID is required"};let a=await p.Q.getCharacterById(e);if(!a)return{error:"Character not found"};if(!await p.Q.deleteCharacter(e))return{error:"Failed to delete character"};await D.x.deleteDialogueTree(e);try{let a=await g.K.getWorldBooks();a[e]&&delete a[e],a["".concat(e,"_settings")]&&delete a["".concat(e,"_settings")],await g.K.saveWorldBooks(a)}catch(e){console.warn("Failed to delete world book:",e)}try{let a=await b.x.getRegexScriptStore();a[e]&&delete a[e],a["".concat(e,"_settings")]&&delete a["".concat(e,"_settings")],await b.x.saveRegexScriptStore(a)}catch(e){console.warn("Failed to delete regex scripts:",e)}let t=a.imagePath;if(t)try{await (0,f.j$)(t)}catch(e){console.warn("Failed to delete avatar blob:",e)}return{success:!0}}catch(e){return console.error("Failed to delete character:",e),{error:"Failed to delete character: ".concat(e.message)}}}function A(){let{t:e,fontClass:a,serifFontClass:t}=(0,o.ok)(),[i,c]=(0,s.useState)([]),[d,h]=(0,s.useState)(!0),[x,m]=(0,s.useState)(!1),[u,p]=(0,s.useState)(!1),[f,g]=(0,s.useState)(!1),[b,v]=(0,s.useState)(null),[w,y]=(0,s.useState)("grid"),[N,C]=(0,s.useState)(!1),[M,P]=(0,s.useState)(!1);(0,s.useEffect)(()=>{let e=localStorage.getItem("characterCardsViewMode");("grid"===e||"carousel"===e)&&y(e)},[]),(0,s.useEffect)(()=>{C(!0);let e=new Image,a=new Image;e.src="/background_yellow.png",a.src="/background_red.png",Promise.all([new Promise(a=>e.onload=a),new Promise(e=>a.onload=e)]).then(()=>{P(!0)})},[]);let S=async()=>{h(!0);let e=localStorage.getItem("username")||"",a=localStorage.getItem("language")||"zh";try{let t=await W(a,e);if(!t){c([]);return}c(t)}catch(e){console.error("Error fetching characters:",e),c([])}finally{h(!1)}},E=async a=>{h(!0);try{if(!(await H(a)).success)throw Error(e("characterCardsPage.deleteFailed"));S()}catch(e){console.error("Error deleting character:",e),h(!1)}},z=(e,a)=>{a.stopPropagation(),v(e),p(!0)};return((0,s.useEffect)(()=>{S()},[]),N)?(0,r.jsxs)("div",{className:"h-full w-full overflow-hidden login-fantasy-bg relative",children:[(0,r.jsx)("div",{className:"absolute inset-0 z-0 opacity-35 transition-opacity duration-500 ".concat(M?"opacity-35":"opacity-0"),style:{backgroundImage:"url('/background_yellow.png')",backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"}}),(0,r.jsx)("div",{className:"absolute inset-0 z-1 opacity-45 transition-opacity duration-500 ".concat(M?"opacity-45":"opacity-0"),style:{backgroundImage:"url('/background_red.png')",backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",mixBlendMode:"multiply"}}),(0,r.jsx)("div",{className:"h-full w-full overflow-y-auto",children:(0,r.jsxs)("div",{className:"flex flex-col items-center justify-start w-full py-8",children:[(0,r.jsxs)("div",{className:"w-full max-w-4xl relative z-10 px-4",children:[(0,r.jsxs)(l.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"flex justify-between items-center mb-8",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("h1",{className:"text-2xl magical-login-text ".concat(t),children:e("sidebar.characterCards")}),(0,r.jsx)(l.P.button,{className:"portal-button text-[#c0a480] hover:text-[#ffd475] p-2 border border-[#534741] rounded-lg cursor-pointer ".concat(a," translate-y-[1px]"),whileHover:{scale:1.05},transition:{type:"spring",stiffness:400,damping:10},onClick:()=>{(0,n.Mh)("view_mode_btn","切换视图模式");let e="grid"===w?"carousel":"grid";y(e),localStorage.setItem("characterCardsViewMode",e)},children:"grid"===w?(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,r.jsx)("rect",{x:"3",y:"3",width:"7",height:"7"}),(0,r.jsx)("rect",{x:"14",y:"3",width:"7",height:"7"}),(0,r.jsx)("rect",{x:"14",y:"14",width:"7",height:"7"}),(0,r.jsx)("rect",{x:"3",y:"14",width:"7",height:"7"})]}):(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,r.jsx)("circle",{cx:"12",cy:"12",r:"10"}),(0,r.jsx)("polygon",{points:"16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88 16.24 7.76"})]})})]}),(0,r.jsxs)("div",{className:"flex gap-3",children:[(0,r.jsx)(l.P.div,{className:"portal-button relative overflow-hidden px-4 py-2 rounded-lg cursor-pointer ".concat(a,"\n                    bg-gradient-to-b from-[#2a231c] to-[#1a1510]\n                    border border-[#534741]\n                    shadow-[0_0_15px_rgba(192,164,128,0.1)]\n                    hover:shadow-[0_0_20px_rgba(192,164,128,0.2)]\n                    before:absolute before:inset-0 before:bg-gradient-to-r before:from-transparent before:via-[rgba(192,164,128,0.1)] before:to-transparent\n                    before:translate-x-[-100%] hover:before:translate-x-[100%] before:transition-transform before:duration-700\n                    group"),whileHover:{scale:1.01,boxShadow:"0 0 25px rgba(192,164,128,0.3)"},whileTap:{scale:.98},transition:{type:"spring",stiffness:400,damping:10},onClick:()=>m(!0),children:(0,r.jsx)("span",{className:"relative z-10 text-[#c0a480] group-hover:text-[#ffd475] transition-colors duration-300",children:e("characterCardsPage.importCharacter")})}),(0,r.jsx)(l.P.div,{className:"portal-button relative overflow-hidden px-4 py-2 rounded-lg cursor-pointer ".concat(a,"\n                    bg-gradient-to-b from-[#2a231c] to-[#1a1510]\n                    border border-[#534741]\n                    shadow-[0_0_15px_rgba(192,164,128,0.1)]\n                    hover:shadow-[0_0_20px_rgba(192,164,128,0.2)]\n                    before:absolute before:inset-0 before:bg-gradient-to-r before:from-transparent before:via-[rgba(192,164,128,0.1)] before:to-transparent\n                    before:translate-x-[-100%] hover:before:translate-x-[100%] before:transition-transform before:duration-700\n                    group"),whileHover:{scale:1.01,boxShadow:"0 0 25px rgba(192,164,128,0.3)"},whileTap:{scale:.98},transition:{type:"spring",stiffness:400,damping:10},onClick:()=>g(!0),children:(0,r.jsx)("span",{className:"relative z-10 text-[#c0a480] group-hover:text-[#ffd475] transition-colors duration-300",children:e("characterCardsPage.downloadCharacter")})})]})]}),d?(0,r.jsx)(l.P.div,{initial:{opacity:0},animate:{opacity:1},className:"flex justify-center items-center h-64",children:(0,r.jsxs)("div",{className:"relative w-16 h-16",children:[(0,r.jsx)("div",{className:"absolute inset-0 rounded-full border-2 border-t-[#f9c86d] border-r-[#c0a480] border-b-[#a18d6f] border-l-transparent animate-spin"}),(0,r.jsx)("div",{className:"absolute inset-2 rounded-full border-2 border-t-[#a18d6f] border-r-[#f9c86d] border-b-[#c0a480] border-l-transparent animate-spin-slow"}),(0,r.jsx)("div",{className:"absolute w-full text-center top-20 text-[#c0a480] ".concat(a),children:e("characterCardsPage.loading")})]})}):0===i.length?(0,r.jsxs)(l.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"session-card p-8 text-center",children:[(0,r.jsx)("div",{className:"mb-6 opacity-60",children:(0,r.jsx)("svg",{className:"mx-auto",width:"64",height:"64",viewBox:"0 0 64 64",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,r.jsx)("path",{d:"M32 0L38 20H60L42 32L48 52L32 40L16 52L22 32L4 20H26L32 0Z",fill:"#f9c86d",fillOpacity:"0.3"})})}),(0,r.jsx)("p",{className:"text-[#eae6db] mb-6 ".concat(t),children:e("characterCardsPage.noCharacters")}),(0,r.jsx)(l.P.div,{className:"portal-button inline-block text-[#c0a480] hover:text-[#ffd475] px-5 py-2 border border-[#534741] rounded-lg cursor-pointer ".concat(a),whileHover:{scale:1.05},transition:{type:"spring",stiffness:400,damping:10},onClick:()=>m(!0),children:e("characterCardsPage.importFirstCharacter")})]}):"grid"===w?(0,r.jsx)(L,{characters:i,onEditClick:z,onDeleteClick:E}):(0,r.jsx)(F,{characters:i,onEditClick:z,onDeleteClick:E})]}),(0,r.jsx)(j,{isOpen:x,onClose:()=>m(!1),onImport:S}),(0,r.jsx)(_,{isOpen:f,onClose:()=>g(!1),onImport:S}),b&&(0,r.jsx)(k,{isOpen:u,onClose:()=>p(!1),characterId:b.id,characterData:{name:b.name,personality:b.personality,scenario:b.scenario,first_mes:b.first_mes,creatorcomment:b.creatorcomment,avatar_path:b.avatar_path},onSave:()=>{S(),p(!1),v(null)}})]})})]}):null}}},e=>{var a=a=>e(e.s=a);e.O(0,[408,874,613,963,829,57,441,684,358],()=>a(16464)),_N_E=e.O()}]);