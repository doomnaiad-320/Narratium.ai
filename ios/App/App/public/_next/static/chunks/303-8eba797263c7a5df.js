(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[303],{913:(e,t,r)=>{"use strict";r.d(t,{U:()=>a.UD});var a=r(82591)},1192:(e,t,r)=>{"use strict";let a=r(89377);e.exports=(e,t)=>{let r=a(e,t);return r&&r.prerelease.length?r.prerelease:null}},1995:(e,t,r)=>{"use strict";r.d(t,{YN:()=>a.YN,jY:()=>a.jY,kI:()=>i.k,zZ:()=>a.zZ});var a=r(99643),i=(r(92173),r(27123));a.YN,r(87150),a.YN,r(71150),a.fJ},3204:(e,t,r)=>{"use strict";r.d(t,{A:()=>i});let a=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i,i=function(e){return"string"==typeof e&&a.test(e)}},3479:(e,t,r)=>{"use strict";r.d(t,{Kj:()=>a.Kj,gk:()=>a.gk,q7:()=>a.q7});var a=r(3666)},3666:(e,t,r)=>{"use strict";r.d(t,{Kj:()=>a.Kj,Ls:()=>s,gk:()=>i.gk,q7:()=>n.q});var a=r(25795),i=r(86951);r(47415);var n=r(46725);let s="0.3.33"},4071:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r){let a=0,i=e.length;for(;i>0;){let n=i/2|0,s=a+n;0>=r(e[s],t)?(a=++s,i-=n+1):i=n}return a}},4397:(e,t,r)=>{"use strict";let a;r.d(t,{Az:()=>h,VS:()=>d,_$:()=>c});var i=r(49509);let n=()=>"undefined"!=typeof window&&void 0!==window.document,s=()=>"object"==typeof globalThis&&globalThis.constructor&&"DedicatedWorkerGlobalScope"===globalThis.constructor.name,o=()=>"undefined"!=typeof window&&"nodejs"===window.name||"undefined"!=typeof navigator&&navigator.userAgent.includes("jsdom"),l=()=>"undefined"!=typeof Deno,u=()=>void 0!==i&&void 0!==i.versions&&void 0!==i.versions.node&&!l(),c=()=>{let e;return n()?"browser":u()?"node":s()?"webworker":o()?"jsdom":l()?"deno":"other"};function d(){return void 0===a&&(a={library:"langchain-js",runtime:c()}),a}function h(e){try{if(void 0!==i)return i.env?.[e];if(l())return Deno?.env.get(e);return}catch(e){return}}},4911:(e,t,r)=>{"use strict";r.d(t,{hU:()=>c.hU,oG:()=>n,_6:()=>u});var a=r(14654),i=r(59305);i.k,i.k;class n extends i.k{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","output_parsers","string"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}static lc_name(){return"StrOutputParser"}parse(e){return Promise.resolve(e)}getFormatInstructions(){return""}_textContentToString(e){return e.text}_imageUrlContentToString(e){throw Error('Cannot coerce a multimodal "image_url" message part into a string.')}_messageContentComplexToString(e){switch(e.type){case"text":case"text_delta":if("text"in e)return this._textContentToString(e);break;case"image_url":if("image_url"in e)return this._imageUrlContentToString(e);break;default:throw Error(`Cannot coerce "${e.type}" message part into a string.`)}throw Error(`Invalid content type: ${e.type}`)}_baseMessageContentToString(e){return e.reduce((e,t)=>e+this._messageContentComplexToString(t),"")}}var s=r(71153),o=r(34497),l=r(11014);class u extends a.mJ{static lc_name(){return"StructuredOutputParser"}toJSON(){return this.toJSONNotImplemented()}constructor(e){super(e),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","structured"]})}static fromZodSchema(e){return new this(e)}static fromNamesAndDescriptions(e){return new this(s.z.object(Object.fromEntries(Object.entries(e).map(([e,t])=>[e,s.z.string().describe(t)]))))}getFormatInstructions(){return`You must format your output as a JSON value that adheres to a given "JSON Schema" instance.

"JSON Schema" is a declarative language that allows you to annotate and validate JSON documents.

For example, the example "JSON Schema" instance {{"properties": {{"foo": {{"description": "a list of test words", "type": "array", "items": {{"type": "string"}}}}}}, "required": ["foo"]}}
would match an object with one required property, "foo". The "type" property specifies "foo" must be an "array", and the "description" property semantically describes it as "a list of test words". The items within "foo" must be strings.
Thus, the object {{"foo": ["bar", "baz"]}} is a well-formatted instance of this example "JSON Schema". The object {{"properties": {{"foo": ["bar", "baz"]}}}} is not well-formatted.

Your output will be parsed and type-checked according to the provided schema instance, so make sure all fields in your output match the schema exactly and there are no trailing commas!

Here is the JSON Schema instance your output must adhere to. Include the enclosing markdown codeblock:
\`\`\`json
${JSON.stringify((0,l.PF)(this.schema))}
\`\`\`
`}async parse(e){try{let t=(e.includes("```")?e.trim().split(/```(?:json)?/)[1]:e.trim()).replace(/"([^"\\]*(\\.[^"\\]*)*)"/g,(e,t)=>{let r=t.replace(/\n/g,"\\n");return`"${r}"`}).replace(/\n/g,"");return await (0,o.hZ)(this.schema,JSON.parse(t))}catch(t){throw new a.CC(`Failed to parse. Text: "${e}". Error: ${t}`,e)}}}a.mJ;var c=r(4929);r(913);let d=function(){let e={};e.parser=function(e,t){return new r(e,t)},e.SAXParser=r,e.SAXStream=l,e.createStream=function(e,t){return new l(e,t)},e.MAX_BUFFER_LENGTH=65536;let t=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];function r(a,i){if(!(this instanceof r))return new r(a,i);(function(e){for(var r=0,a=t.length;r<a;r++)e[t[r]]=""})(this),this.q=this.c="",this.bufferCheckPosition=e.MAX_BUFFER_LENGTH,this.opt=i||{},this.opt.lowercase=this.opt.lowercase||this.opt.lowercasetags,this.looseCase=this.opt.lowercase?"toLowerCase":"toUpperCase",this.tags=[],this.closed=this.closedRoot=this.sawRoot=!1,this.tag=this.error=null,this.strict=!!a,this.noscript=!!(a||this.opt.noscript),this.state=_.BEGIN,this.strictEntities=this.opt.strictEntities,this.ENTITIES=this.strictEntities?Object.create(e.XML_ENTITIES):Object.create(e.ENTITIES),this.attribList=[],this.opt.xmlns&&(this.ns=Object.create(d)),this.trackPosition=!1!==this.opt.position,this.trackPosition&&(this.position=this.line=this.column=0),w(this,"onready")}e.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","opentagstart","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"],Object.create||(Object.create=function(e){function t(){}return t.prototype=e,new t}),Object.keys||(Object.keys=function(e){var t=[];for(var r in e)e.hasOwnProperty(r)&&t.push(r);return t}),r.prototype={end:function(){x(this)},write:function(r){if(this.error)throw this.error;if(this.closed)return E(this,"Cannot write after close. Assign an onready handler.");if(null===r)return x(this);"object"==typeof r&&(r=r.toString());for(var a=0,i="";i=R(r,a++),this.c=i,i;)switch(this.trackPosition&&(this.position++,"\n"===i?(this.line++,this.column=0):this.column++),this.state){case _.BEGIN:if(this.state=_.BEGIN_WHITESPACE,"\uFEFF"===i)continue;$(this,i);continue;case _.BEGIN_WHITESPACE:$(this,i);continue;case _.TEXT:if(this.sawRoot&&!this.closedRoot){for(var n=a-1;i&&"<"!==i&&"&"!==i;)(i=R(r,a++))&&this.trackPosition&&(this.position++,"\n"===i?(this.line++,this.column=0):this.column++);this.textNode+=r.substring(n,a-1)}"<"!==i||this.sawRoot&&this.closedRoot&&!this.strict?(g(i)||this.sawRoot&&!this.closedRoot||S(this,"Text data outside of root node."),"&"===i?this.state=_.TEXT_ENTITY:this.textNode+=i):(this.state=_.OPEN_WAKA,this.startTagPosition=this.position);continue;case _.SCRIPT:"<"===i?this.state=_.SCRIPT_ENDING:this.script+=i;continue;case _.SCRIPT_ENDING:"/"===i?this.state=_.CLOSE_TAG:(this.script+="<"+i,this.state=_.SCRIPT);continue;case _.OPEN_WAKA:"!"===i?(this.state=_.SGML_DECL,this.sgmlDecl=""):g(i)||(b(h,i)?(this.state=_.OPEN_TAG,this.tagName=i):"/"===i?(this.state=_.CLOSE_TAG,this.tagName=""):"?"===i?(this.state=_.PROC_INST,this.procInstName=this.procInstBody=""):(S(this,"Unencoded <"),this.startTagPosition+1<this.position&&(i=Array(this.position-this.startTagPosition).join(" ")+i),this.textNode+="<"+i,this.state=_.TEXT));continue;case _.SGML_DECL:"[CDATA["===(this.sgmlDecl+i).toUpperCase()?(O(this,"onopencdata"),this.state=_.CDATA,this.sgmlDecl="",this.cdata=""):this.sgmlDecl+i==="--"?(this.state=_.COMMENT,this.comment="",this.sgmlDecl=""):"DOCTYPE"===(this.sgmlDecl+i).toUpperCase()?(this.state=_.DOCTYPE,(this.doctype||this.sawRoot)&&S(this,"Inappropriately located doctype declaration"),this.doctype="",this.sgmlDecl=""):">"===i?(O(this,"onsgmldeclaration",this.sgmlDecl),this.sgmlDecl="",this.state=_.TEXT):(y(i)&&(this.state=_.SGML_DECL_QUOTED),this.sgmlDecl+=i);continue;case _.SGML_DECL_QUOTED:i===this.q&&(this.state=_.SGML_DECL,this.q=""),this.sgmlDecl+=i;continue;case _.DOCTYPE:">"===i?(this.state=_.TEXT,O(this,"ondoctype",this.doctype),this.doctype=!0):(this.doctype+=i,"["===i?this.state=_.DOCTYPE_DTD:y(i)&&(this.state=_.DOCTYPE_QUOTED,this.q=i));continue;case _.DOCTYPE_QUOTED:this.doctype+=i,i===this.q&&(this.q="",this.state=_.DOCTYPE);continue;case _.DOCTYPE_DTD:this.doctype+=i,"]"===i?this.state=_.DOCTYPE:y(i)&&(this.state=_.DOCTYPE_DTD_QUOTED,this.q=i);continue;case _.DOCTYPE_DTD_QUOTED:this.doctype+=i,i===this.q&&(this.state=_.DOCTYPE_DTD,this.q="");continue;case _.COMMENT:"-"===i?this.state=_.COMMENT_ENDING:this.comment+=i;continue;case _.COMMENT_ENDING:"-"===i?(this.state=_.COMMENT_ENDED,this.comment=k(this.opt,this.comment),this.comment&&O(this,"oncomment",this.comment),this.comment=""):(this.comment+="-"+i,this.state=_.COMMENT);continue;case _.COMMENT_ENDED:">"!==i?(S(this,"Malformed comment"),this.comment+="--"+i,this.state=_.COMMENT):this.state=_.TEXT;continue;case _.CDATA:"]"===i?this.state=_.CDATA_ENDING:this.cdata+=i;continue;case _.CDATA_ENDING:"]"===i?this.state=_.CDATA_ENDING_2:(this.cdata+="]"+i,this.state=_.CDATA);continue;case _.CDATA_ENDING_2:">"===i?(this.cdata&&O(this,"oncdata",this.cdata),O(this,"onclosecdata"),this.cdata="",this.state=_.TEXT):"]"===i?this.cdata+="]":(this.cdata+="]]"+i,this.state=_.CDATA);continue;case _.PROC_INST:"?"===i?this.state=_.PROC_INST_ENDING:g(i)?this.state=_.PROC_INST_BODY:this.procInstName+=i;continue;case _.PROC_INST_BODY:!this.procInstBody&&g(i)||("?"===i?this.state=_.PROC_INST_ENDING:this.procInstBody+=i);continue;case _.PROC_INST_ENDING:">"===i?(O(this,"onprocessinginstruction",{name:this.procInstName,body:this.procInstBody}),this.procInstName=this.procInstBody="",this.state=_.TEXT):(this.procInstBody+="?"+i,this.state=_.PROC_INST_BODY);continue;case _.OPEN_TAG:b(p,i)?this.tagName+=i:(!function(e){e.strict||(e.tagName=e.tagName[e.looseCase]());var t=e.tags[e.tags.length-1]||e,r=e.tag={name:e.tagName,attributes:{}};e.opt.xmlns&&(r.ns=t.ns),e.attribList.length=0,O(e,"onopentagstart",r)}(this),">"===i?T(this):"/"===i?this.state=_.OPEN_TAG_SLASH:(g(i)||S(this,"Invalid character in tag name"),this.state=_.ATTRIB));continue;case _.OPEN_TAG_SLASH:">"===i?(T(this,!0),j(this)):(S(this,"Forward-slash in opening tag not followed by >"),this.state=_.ATTRIB);continue;case _.ATTRIB:g(i)||(">"===i?T(this):"/"===i?this.state=_.OPEN_TAG_SLASH:b(h,i)?(this.attribName=i,this.attribValue="",this.state=_.ATTRIB_NAME):S(this,"Invalid attribute name"));continue;case _.ATTRIB_NAME:"="===i?this.state=_.ATTRIB_VALUE:">"===i?(S(this,"Attribute without value"),this.attribValue=this.attribName,A(this),T(this)):g(i)?this.state=_.ATTRIB_NAME_SAW_WHITE:b(p,i)?this.attribName+=i:S(this,"Invalid attribute name");continue;case _.ATTRIB_NAME_SAW_WHITE:"="===i?this.state=_.ATTRIB_VALUE:g(i)||(S(this,"Attribute without value"),this.tag.attributes[this.attribName]="",this.attribValue="",O(this,"onattribute",{name:this.attribName,value:""}),this.attribName="",">"===i?T(this):b(h,i)?(this.attribName=i,this.state=_.ATTRIB_NAME):(S(this,"Invalid attribute name"),this.state=_.ATTRIB));continue;case _.ATTRIB_VALUE:g(i)||(y(i)?(this.q=i,this.state=_.ATTRIB_VALUE_QUOTED):(S(this,"Unquoted attribute value"),this.state=_.ATTRIB_VALUE_UNQUOTED,this.attribValue=i));continue;case _.ATTRIB_VALUE_QUOTED:if(i!==this.q){"&"===i?this.state=_.ATTRIB_VALUE_ENTITY_Q:this.attribValue+=i;continue}A(this),this.q="",this.state=_.ATTRIB_VALUE_CLOSED;continue;case _.ATTRIB_VALUE_CLOSED:g(i)?this.state=_.ATTRIB:">"===i?T(this):"/"===i?this.state=_.OPEN_TAG_SLASH:b(h,i)?(S(this,"No whitespace between attributes"),this.attribName=i,this.attribValue="",this.state=_.ATTRIB_NAME):S(this,"Invalid attribute name");continue;case _.ATTRIB_VALUE_UNQUOTED:if(!(">"===(s=i)||g(s))){"&"===i?this.state=_.ATTRIB_VALUE_ENTITY_U:this.attribValue+=i;continue}A(this),">"===i?T(this):this.state=_.ATTRIB;continue;case _.CLOSE_TAG:this.tagName?">"===i?j(this):b(p,i)?this.tagName+=i:this.script?(this.script+="</"+this.tagName,this.tagName="",this.state=_.SCRIPT):(g(i)||S(this,"Invalid tagname in closing tag"),this.state=_.CLOSE_TAG_SAW_WHITE):g(i)||(b(h,i)?this.tagName=i:this.script?(this.script+="</"+i,this.state=_.SCRIPT):S(this,"Invalid tagname in closing tag."));continue;case _.CLOSE_TAG_SAW_WHITE:if(g(i))continue;">"===i?j(this):S(this,"Invalid characters in closing tag");continue;case _.TEXT_ENTITY:case _.ATTRIB_VALUE_ENTITY_Q:case _.ATTRIB_VALUE_ENTITY_U:switch(this.state){case _.TEXT_ENTITY:o=_.TEXT,l="textNode";break;case _.ATTRIB_VALUE_ENTITY_Q:o=_.ATTRIB_VALUE_QUOTED,l="attribValue";break;case _.ATTRIB_VALUE_ENTITY_U:o=_.ATTRIB_VALUE_UNQUOTED,l="attribValue"}if(";"===i){if(this.opt.unparsedEntities){var s,o,l,u=N(this);this.entity="",this.state=o,this.write(u)}else this[l]+=N(this),this.entity="",this.state=o}else b(this.entity.length?f:m,i)?this.entity+=i:(S(this,"Invalid character in entity name"),this[l]+="&"+this.entity+i,this.entity="",this.state=o);continue;default:throw Error(this,"Unknown state: "+this.state)}return this.position>=this.bufferCheckPosition&&function(r){for(var a=Math.max(e.MAX_BUFFER_LENGTH,10),i=0,n=0,s=t.length;n<s;n++){var o=r[t[n]].length;if(o>a)switch(t[n]){case"textNode":I(r);break;case"cdata":O(r,"oncdata",r.cdata),r.cdata="";break;case"script":O(r,"onscript",r.script),r.script="";break;default:E(r,"Max buffer length exceeded: "+t[n])}i=Math.max(i,o)}r.bufferCheckPosition=e.MAX_BUFFER_LENGTH-i+r.position}(this),this},resume:function(){return this.error=null,this},close:function(){return this.write(null)},flush:function(){I(this),""!==this.cdata&&(O(this,"oncdata",this.cdata),this.cdata=""),""!==this.script&&(O(this,"onscript",this.script),this.script="")}};var a,i,n,s=ReadableStream;s||(s=function(){});var o=e.EVENTS.filter(function(e){return"error"!==e&&"end"!==e});function l(e,t){if(!(this instanceof l))return new l(e,t);s.apply(this),this._parser=new r(e,t),this.writable=!0,this.readable=!0;var a=this;this._parser.onend=function(){a.emit("end")},this._parser.onerror=function(e){a.emit("error",e),a._parser.error=null},this._decoder=null,o.forEach(function(e){Object.defineProperty(a,"on"+e,{get:function(){return a._parser["on"+e]},set:function(t){if(!t)return a.removeAllListeners(e),a._parser["on"+e]=t,t;a.on(e,t)},enumerable:!0,configurable:!1})})}l.prototype=Object.create(s.prototype,{constructor:{value:l}}),l.prototype.write=function(e){return this._parser.write(e.toString()),this.emit("data",e),!0},l.prototype.end=function(e){return e&&e.length&&this.write(e),this._parser.end(),!0},l.prototype.on=function(e,t){var r=this;return r._parser["on"+e]||-1===o.indexOf(e)||(r._parser["on"+e]=function(){var t=1==arguments.length?[arguments[0]]:Array.apply(null,arguments);t.splice(0,0,e),r.emit.apply(r,t)}),s.prototype.on.call(r,e,t)};var u="http://www.w3.org/XML/1998/namespace",c="http://www.w3.org/2000/xmlns/",d={xml:u,xmlns:c},h=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,p=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/,m=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,f=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/;function g(e){return" "===e||"\n"===e||"\r"===e||"	"===e}function y(e){return'"'===e||"'"===e}function b(e,t){return e.test(t)}var _=0;for(var v in e.STATE={BEGIN:_++,BEGIN_WHITESPACE:_++,TEXT:_++,TEXT_ENTITY:_++,OPEN_WAKA:_++,SGML_DECL:_++,SGML_DECL_QUOTED:_++,DOCTYPE:_++,DOCTYPE_QUOTED:_++,DOCTYPE_DTD:_++,DOCTYPE_DTD_QUOTED:_++,COMMENT_STARTING:_++,COMMENT:_++,COMMENT_ENDING:_++,COMMENT_ENDED:_++,CDATA:_++,CDATA_ENDING:_++,CDATA_ENDING_2:_++,PROC_INST:_++,PROC_INST_BODY:_++,PROC_INST_ENDING:_++,OPEN_TAG:_++,OPEN_TAG_SLASH:_++,ATTRIB:_++,ATTRIB_NAME:_++,ATTRIB_NAME_SAW_WHITE:_++,ATTRIB_VALUE:_++,ATTRIB_VALUE_QUOTED:_++,ATTRIB_VALUE_CLOSED:_++,ATTRIB_VALUE_UNQUOTED:_++,ATTRIB_VALUE_ENTITY_Q:_++,ATTRIB_VALUE_ENTITY_U:_++,CLOSE_TAG:_++,CLOSE_TAG_SAW_WHITE:_++,SCRIPT:_++,SCRIPT_ENDING:_++},e.XML_ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'"},e.ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,int:8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830},Object.keys(e.ENTITIES).forEach(function(t){var r=e.ENTITIES[t],a="number"==typeof r?String.fromCharCode(r):r;e.ENTITIES[t]=a}),e.STATE)e.STATE[e.STATE[v]]=v;function w(e,t,r){e[t]&&e[t](r)}function O(e,t,r){e.textNode&&I(e),w(e,t,r)}function I(e){e.textNode=k(e.opt,e.textNode),e.textNode&&w(e,"ontext",e.textNode),e.textNode=""}function k(e,t){return e.trim&&(t=t.trim()),e.normalize&&(t=t.replace(/\s+/g," ")),t}function E(e,t){return I(e),e.trackPosition&&(t+="\nLine: "+e.line+"\nColumn: "+e.column+"\nChar: "+e.c),e.error=t=Error(t),w(e,"onerror",t),e}function x(e){return e.sawRoot&&!e.closedRoot&&S(e,"Unclosed root tag"),e.state!==_.BEGIN&&e.state!==_.BEGIN_WHITESPACE&&e.state!==_.TEXT&&E(e,"Unexpected end"),I(e),e.c="",e.closed=!0,w(e,"onend"),r.call(e,e.strict,e.opt),e}function S(e,t){if("object"!=typeof e||!(e instanceof r))throw Error("bad call to strictFail");e.strict&&E(e,t)}function P(e,t){var r=0>e.indexOf(":")?["",e]:e.split(":"),a=r[0],i=r[1];return t&&"xmlns"===e&&(a="xmlns",i=""),{prefix:a,local:i}}function A(e){if(e.strict||(e.attribName=e.attribName[e.looseCase]()),-1!==e.attribList.indexOf(e.attribName)||e.tag.attributes.hasOwnProperty(e.attribName)){e.attribName=e.attribValue="";return}if(e.opt.xmlns){var t=P(e.attribName,!0),r=t.prefix,a=t.local;if("xmlns"===r){if("xml"===a&&e.attribValue!==u)S(e,"xml: prefix must be bound to "+u+"\nActual: "+e.attribValue);else if("xmlns"===a&&e.attribValue!==c)S(e,"xmlns: prefix must be bound to "+c+"\nActual: "+e.attribValue);else{var i=e.tag,n=e.tags[e.tags.length-1]||e;i.ns===n.ns&&(i.ns=Object.create(n.ns)),i.ns[a]=e.attribValue}}e.attribList.push([e.attribName,e.attribValue])}else e.tag.attributes[e.attribName]=e.attribValue,O(e,"onattribute",{name:e.attribName,value:e.attribValue});e.attribName=e.attribValue=""}function T(e,t){if(e.opt.xmlns){var r=e.tag,a=P(e.tagName);r.prefix=a.prefix,r.local=a.local,r.uri=r.ns[a.prefix]||"",r.prefix&&!r.uri&&(S(e,"Unbound namespace prefix: "+JSON.stringify(e.tagName)),r.uri=a.prefix);var i=e.tags[e.tags.length-1]||e;r.ns&&i.ns!==r.ns&&Object.keys(r.ns).forEach(function(t){O(e,"onopennamespace",{prefix:t,uri:r.ns[t]})});for(var n=0,s=e.attribList.length;n<s;n++){var o=e.attribList[n],l=o[0],u=o[1],c=P(l,!0),d=c.prefix,h=c.local,p=""===d?"":r.ns[d]||"",m={name:l,value:u,prefix:d,local:h,uri:p};d&&"xmlns"!==d&&!p&&(S(e,"Unbound namespace prefix: "+JSON.stringify(d)),m.uri=d),e.tag.attributes[l]=m,O(e,"onattribute",m)}e.attribList.length=0}e.tag.isSelfClosing=!!t,e.sawRoot=!0,e.tags.push(e.tag),O(e,"onopentag",e.tag),t||(e.noscript||"script"!==e.tagName.toLowerCase()?e.state=_.TEXT:e.state=_.SCRIPT,e.tag=null,e.tagName=""),e.attribName=e.attribValue="",e.attribList.length=0}function j(e){if(!e.tagName){S(e,"Weird empty close tag."),e.textNode+="</>",e.state=_.TEXT;return}if(e.script){if("script"!==e.tagName){e.script+="</"+e.tagName+">",e.tagName="",e.state=_.SCRIPT;return}O(e,"onscript",e.script),e.script=""}var t=e.tags.length,r=e.tagName;e.strict||(r=r[e.looseCase]());for(var a=r;t--;)if(e.tags[t].name!==a)S(e,"Unexpected close tag");else break;if(t<0){S(e,"Unmatched closing tag: "+e.tagName),e.textNode+="</"+e.tagName+">",e.state=_.TEXT;return}e.tagName=r;for(var i=e.tags.length;i-- >t;){var n=e.tag=e.tags.pop();e.tagName=e.tag.name,O(e,"onclosetag",e.tagName);var s={};for(var o in n.ns)s[o]=n.ns[o];var l=e.tags[e.tags.length-1]||e;e.opt.xmlns&&n.ns!==l.ns&&Object.keys(n.ns).forEach(function(t){var r=n.ns[t];O(e,"onclosenamespace",{prefix:t,uri:r})})}0===t&&(e.closedRoot=!0),e.tagName=e.attribValue=e.attribName="",e.attribList.length=0,e.state=_.TEXT}function N(e){var t,r=e.entity,a=r.toLowerCase(),i="";return e.ENTITIES[r]?e.ENTITIES[r]:e.ENTITIES[a]?e.ENTITIES[a]:("#"===(r=a).charAt(0)&&(i="x"===r.charAt(1)?(t=parseInt(r=r.slice(2),16)).toString(16):(t=parseInt(r=r.slice(1),10)).toString(10)),r=r.replace(/^0+/,""),isNaN(t)||i.toLowerCase()!==r)?(S(e,"Invalid character entity"),"&"+e.entity+";"):String.fromCodePoint(t)}function $(e,t){"<"===t?(e.state=_.OPEN_WAKA,e.startTagPosition=e.position):g(t)||(S(e,"Non-whitespace before first tag."),e.textNode=t,e.state=_.TEXT)}function R(e,t){var r="";return t<e.length&&(r=e.charAt(t)),r}return _=e.STATE,!String.fromCodePoint&&(a=String.fromCharCode,i=Math.floor,n=function(){var e,t,r=[],n=-1,s=arguments.length;if(!s)return"";for(var o="";++n<s;){var l=Number(arguments[n]);if(!isFinite(l)||l<0||l>1114111||i(l)!==l)throw RangeError("Invalid code point: "+l);l<=65535?r.push(l):(l-=65536,e=(l>>10)+55296,t=l%1024+56320,r.push(e,t)),(n+1===s||r.length>16384)&&(o+=a.apply(null,r),r.length=0)}return o},Object.defineProperty?Object.defineProperty(String,"fromCodePoint",{value:n,configurable:!0,writable:!0}):String.fromCodePoint=n),e}();i.T;let h=e=>e.split("\n").map(e=>e.replace(/^\s+/,"")).join("\n").trim(),p=e=>{if(0===Object.keys(e).length)return{};let t={};return e.children.length>0?t[e.name]=e.children.map(p):t[e.name]=e.text??void 0,t}},4929:(e,t,r)=>{"use strict";r.d(t,{d1:()=>n.d,hU:()=>s});var a=r(59305),i=r(913),n=r(58036);class s extends a.T{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","output_parsers"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}static lc_name(){return"JsonOutputParser"}_diff(e,t){return t?e?(0,i.U)(e,t):[{op:"replace",path:"",value:t}]:void 0}async parsePartialResult(e){return(0,n.D)(e[0].text)}async parse(e){return(0,n.D)(e,JSON.parse)}getFormatInstructions(){return""}}},5415:(e,t,r)=>{"use strict";r.d(t,{Ej:()=>a.Ej,FK:()=>a.FK,Fz:()=>a.Fz,H:()=>a.H,KX:()=>a.KX,Od:()=>a.Od,Q7:()=>a.Q7,XU:()=>a.XU,a7:()=>a.a7,cM:()=>a.cM,dr:()=>a.dr,uU:()=>a.uU,up:()=>a.up});var a=r(71150)},7379:(e,t,r)=>{"use strict";let a;r.d(t,{Ik:()=>$});let i=Symbol("Let zodToJsonSchema decide on which parser to use"),n={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},s=e=>"string"==typeof e?{...n,name:e}:{...n,...e},o=e=>{let t=s(e),r=void 0!==t.name?[...t.basePath,t.definitionPath,t.name]:t.basePath;return{...t,currentPath:r,propertyPath:void 0,seen:new Map(Object.entries(t.definitions).map(([e,r])=>[r._def,{def:r._def,path:[...t.basePath,t.definitionPath,e],jsonSchema:void 0}]))}};var l=r(71153);function u(e,t,r,a){a?.errorMessages&&r&&(e.errorMessage={...e.errorMessage,[t]:r})}function c(e,t,r,a,i){e[t]=r,u(e,t,a,i)}function d(e,t){return A(e.type._def,t)}let h=(e,t)=>A(e.innerType._def,t),p=(e,t)=>{let r={type:"integer",format:"unix-time"};if("openApi3"===t.target)return r;for(let a of e.checks)switch(a.kind){case"min":c(r,"minimum",a.value,a.message,t);break;case"max":c(r,"maximum",a.value,a.message,t)}return r},m=e=>(!("type"in e)||"string"!==e.type)&&"allOf"in e,f={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(void 0===a&&(a=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),a),ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function g(e,t){let r={type:"string"};if(e.checks)for(let a of e.checks)switch(a.kind){case"min":c(r,"minLength","number"==typeof r.minLength?Math.max(r.minLength,a.value):a.value,a.message,t);break;case"max":c(r,"maxLength","number"==typeof r.maxLength?Math.min(r.maxLength,a.value):a.value,a.message,t);break;case"email":switch(t.emailStrategy){case"format:email":_(r,"email",a.message,t);break;case"format:idn-email":_(r,"idn-email",a.message,t);break;case"pattern:zod":v(r,f.email,a.message,t)}break;case"url":_(r,"uri",a.message,t);break;case"uuid":_(r,"uuid",a.message,t);break;case"regex":v(r,a.regex,a.message,t);break;case"cuid":v(r,f.cuid,a.message,t);break;case"cuid2":v(r,f.cuid2,a.message,t);break;case"startsWith":v(r,RegExp(`^${y(a.value,t)}`),a.message,t);break;case"endsWith":v(r,RegExp(`${y(a.value,t)}$`),a.message,t);break;case"datetime":_(r,"date-time",a.message,t);break;case"date":_(r,"date",a.message,t);break;case"time":_(r,"time",a.message,t);break;case"duration":_(r,"duration",a.message,t);break;case"length":c(r,"minLength","number"==typeof r.minLength?Math.max(r.minLength,a.value):a.value,a.message,t),c(r,"maxLength","number"==typeof r.maxLength?Math.min(r.maxLength,a.value):a.value,a.message,t);break;case"includes":v(r,RegExp(y(a.value,t)),a.message,t);break;case"ip":"v6"!==a.version&&_(r,"ipv4",a.message,t),"v4"!==a.version&&_(r,"ipv6",a.message,t);break;case"base64url":v(r,f.base64url,a.message,t);break;case"jwt":v(r,f.jwt,a.message,t);break;case"cidr":"v6"!==a.version&&v(r,f.ipv4Cidr,a.message,t),"v4"!==a.version&&v(r,f.ipv6Cidr,a.message,t);break;case"emoji":v(r,f.emoji(),a.message,t);break;case"ulid":v(r,f.ulid,a.message,t);break;case"base64":switch(t.base64Strategy){case"format:binary":_(r,"binary",a.message,t);break;case"contentEncoding:base64":c(r,"contentEncoding","base64",a.message,t);break;case"pattern:zod":v(r,f.base64,a.message,t)}break;case"nanoid":v(r,f.nanoid,a.message,t);case"toLowerCase":case"toUpperCase":case"trim":break;default:}return r}function y(e,t){return"escape"===t.patternStrategy?function(e){let t="";for(let r=0;r<e.length;r++)b.has(e[r])||(t+="\\"),t+=e[r];return t}(e):e}let b=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function _(e,t,r,a){e.format||e.anyOf?.some(e=>e.format)?(e.anyOf||(e.anyOf=[]),e.format&&(e.anyOf.push({format:e.format,...e.errorMessage&&a.errorMessages&&{errorMessage:{format:e.errorMessage.format}}}),delete e.format,e.errorMessage&&(delete e.errorMessage.format,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.anyOf.push({format:t,...r&&a.errorMessages&&{errorMessage:{format:r}}})):c(e,"format",t,r,a)}function v(e,t,r,a){e.pattern||e.allOf?.some(e=>e.pattern)?(e.allOf||(e.allOf=[]),e.pattern&&(e.allOf.push({pattern:e.pattern,...e.errorMessage&&a.errorMessages&&{errorMessage:{pattern:e.errorMessage.pattern}}}),delete e.pattern,e.errorMessage&&(delete e.errorMessage.pattern,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.allOf.push({pattern:w(t,a),...r&&a.errorMessages&&{errorMessage:{pattern:r}}})):c(e,"pattern",w(t,a),r,a)}function w(e,t){if(!t.applyRegexFlags||!e.flags)return e.source;let r={i:e.flags.includes("i"),m:e.flags.includes("m"),s:e.flags.includes("s")},a=r.i?e.source.toLowerCase():e.source,i="",n=!1,s=!1,o=!1;for(let e=0;e<a.length;e++){if(n){i+=a[e],n=!1;continue}if(r.i){if(s){if(a[e].match(/[a-z]/)){o?(i+=a[e],i+=`${a[e-2]}-${a[e]}`.toUpperCase(),o=!1):"-"===a[e+1]&&a[e+2]?.match(/[a-z]/)?(i+=a[e],o=!0):i+=`${a[e]}${a[e].toUpperCase()}`;continue}}else if(a[e].match(/[a-z]/)){i+=`[${a[e]}${a[e].toUpperCase()}]`;continue}}if(r.m){if("^"===a[e]){i+=`(^|(?<=[\r
]))`;continue}if("$"===a[e]){i+=`($|(?=[\r
]))`;continue}}if(r.s&&"."===a[e]){i+=s?`${a[e]}\r
`:`[${a[e]}\r
]`;continue}i+=a[e],"\\"===a[e]?n=!0:s&&"]"===a[e]?s=!1:s||"["!==a[e]||(s=!0)}try{new RegExp(i)}catch{return console.warn(`Could not convert regex pattern at ${t.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),e.source}return i}function O(e,t){if("openAi"===t.target&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),"openApi3"===t.target&&e.keyType?._def.typeName===l.kY.ZodEnum)return{type:"object",required:e.keyType._def.values,properties:e.keyType._def.values.reduce((r,a)=>({...r,[a]:A(e.valueType._def,{...t,currentPath:[...t.currentPath,"properties",a]})??{}}),{}),additionalProperties:t.rejectedAdditionalProperties};let r={type:"object",additionalProperties:A(e.valueType._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??t.allowedAdditionalProperties};if("openApi3"===t.target)return r;if(e.keyType?._def.typeName===l.kY.ZodString&&e.keyType._def.checks?.length){let{type:a,...i}=g(e.keyType._def,t);return{...r,propertyNames:i}}if(e.keyType?._def.typeName===l.kY.ZodEnum)return{...r,propertyNames:{enum:e.keyType._def.values}};if(e.keyType?._def.typeName===l.kY.ZodBranded&&e.keyType._def.type._def.typeName===l.kY.ZodString&&e.keyType._def.type._def.checks?.length){let{type:a,...i}=d(e.keyType._def,t);return{...r,propertyNames:i}}return r}let I={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"},k=(e,t)=>{let r=(e.options instanceof Map?Array.from(e.options.values()):e.options).map((e,r)=>A(e._def,{...t,currentPath:[...t.currentPath,"anyOf",`${r}`]})).filter(e=>!!e&&(!t.strictUnions||"object"==typeof e&&Object.keys(e).length>0));return r.length?{anyOf:r}:void 0},E=(e,t)=>{if(t.currentPath.toString()===t.propertyPath?.toString())return A(e.innerType._def,t);let r=A(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","1"]});return r?{anyOf:[{not:{}},r]}:{}},x=(e,t)=>{if("input"===t.pipeStrategy)return A(e.in._def,t);if("output"===t.pipeStrategy)return A(e.out._def,t);let r=A(e.in._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),a=A(e.out._def,{...t,currentPath:[...t.currentPath,"allOf",r?"1":"0"]});return{allOf:[r,a].filter(e=>void 0!==e)}},S=(e,t)=>A(e.innerType._def,t),P=(e,t,r)=>{switch(t){case l.kY.ZodString:return g(e,r);case l.kY.ZodNumber:return function(e,t){let r={type:"number"};if(!e.checks)return r;for(let a of e.checks)switch(a.kind){case"int":r.type="integer",u(r,"type",a.message,t);break;case"min":"jsonSchema7"===t.target?a.inclusive?c(r,"minimum",a.value,a.message,t):c(r,"exclusiveMinimum",a.value,a.message,t):(a.inclusive||(r.exclusiveMinimum=!0),c(r,"minimum",a.value,a.message,t));break;case"max":"jsonSchema7"===t.target?a.inclusive?c(r,"maximum",a.value,a.message,t):c(r,"exclusiveMaximum",a.value,a.message,t):(a.inclusive||(r.exclusiveMaximum=!0),c(r,"maximum",a.value,a.message,t));break;case"multipleOf":c(r,"multipleOf",a.value,a.message,t)}return r}(e,r);case l.kY.ZodObject:return function(e,t){let r="openAi"===t.target,a={type:"object",properties:{}},i=[],n=e.shape();for(let e in n){let s=n[e];if(void 0===s||void 0===s._def)continue;let o=function(e){try{return e.isOptional()}catch{return!0}}(s);o&&r&&(s instanceof l.Ii&&(s=s._def.innerType),s.isNullable()||(s=s.nullable()),o=!1);let u=A(s._def,{...t,currentPath:[...t.currentPath,"properties",e],propertyPath:[...t.currentPath,"properties",e]});void 0!==u&&(a.properties[e]=u,o||i.push(e))}i.length&&(a.required=i);let s=function(e,t){if("ZodNever"!==e.catchall._def.typeName)return A(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]});switch(e.unknownKeys){case"passthrough":return t.allowedAdditionalProperties;case"strict":return t.rejectedAdditionalProperties;case"strip":return"strict"===t.removeAdditionalStrategy?t.allowedAdditionalProperties:t.rejectedAdditionalProperties}}(e,t);return void 0!==s&&(a.additionalProperties=s),a}(e,r);case l.kY.ZodBigInt:return function(e,t){let r={type:"integer",format:"int64"};if(!e.checks)return r;for(let a of e.checks)switch(a.kind){case"min":"jsonSchema7"===t.target?a.inclusive?c(r,"minimum",a.value,a.message,t):c(r,"exclusiveMinimum",a.value,a.message,t):(a.inclusive||(r.exclusiveMinimum=!0),c(r,"minimum",a.value,a.message,t));break;case"max":"jsonSchema7"===t.target?a.inclusive?c(r,"maximum",a.value,a.message,t):c(r,"exclusiveMaximum",a.value,a.message,t):(a.inclusive||(r.exclusiveMaximum=!0),c(r,"maximum",a.value,a.message,t));break;case"multipleOf":c(r,"multipleOf",a.value,a.message,t)}return r}(e,r);case l.kY.ZodBoolean:return{type:"boolean"};case l.kY.ZodDate:return function e(t,r,a){let i=a??r.dateStrategy;if(Array.isArray(i))return{anyOf:i.map((a,i)=>e(t,r,a))};switch(i){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return p(t,r)}}(e,r);case l.kY.ZodUndefined:return{not:{}};case l.kY.ZodNull:return"openApi3"===r.target?{enum:["null"],nullable:!0}:{type:"null"};case l.kY.ZodArray:return function(e,t){let r={type:"array"};return e.type?._def&&e.type?._def?.typeName!==l.kY.ZodAny&&(r.items=A(e.type._def,{...t,currentPath:[...t.currentPath,"items"]})),e.minLength&&c(r,"minItems",e.minLength.value,e.minLength.message,t),e.maxLength&&c(r,"maxItems",e.maxLength.value,e.maxLength.message,t),e.exactLength&&(c(r,"minItems",e.exactLength.value,e.exactLength.message,t),c(r,"maxItems",e.exactLength.value,e.exactLength.message,t)),r}(e,r);case l.kY.ZodUnion:case l.kY.ZodDiscriminatedUnion:return function(e,t){if("openApi3"===t.target)return k(e,t);let r=e.options instanceof Map?Array.from(e.options.values()):e.options;if(r.every(e=>e._def.typeName in I&&(!e._def.checks||!e._def.checks.length))){let e=r.reduce((e,t)=>{let r=I[t._def.typeName];return r&&!e.includes(r)?[...e,r]:e},[]);return{type:e.length>1?e:e[0]}}if(r.every(e=>"ZodLiteral"===e._def.typeName&&!e.description)){let e=r.reduce((e,t)=>{let r=typeof t._def.value;switch(r){case"string":case"number":case"boolean":return[...e,r];case"bigint":return[...e,"integer"];case"object":if(null===t._def.value)return[...e,"null"];default:return e}},[]);if(e.length===r.length){let t=e.filter((e,t,r)=>r.indexOf(e)===t);return{type:t.length>1?t:t[0],enum:r.reduce((e,t)=>e.includes(t._def.value)?e:[...e,t._def.value],[])}}}else if(r.every(e=>"ZodEnum"===e._def.typeName))return{type:"string",enum:r.reduce((e,t)=>[...e,...t._def.values.filter(t=>!e.includes(t))],[])};return k(e,t)}(e,r);case l.kY.ZodIntersection:return function(e,t){let r=[A(e.left._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),A(e.right._def,{...t,currentPath:[...t.currentPath,"allOf","1"]})].filter(e=>!!e),a="jsonSchema2019-09"===t.target?{unevaluatedProperties:!1}:void 0,i=[];return r.forEach(e=>{if(m(e))i.push(...e.allOf),void 0===e.unevaluatedProperties&&(a=void 0);else{let t=e;if("additionalProperties"in e&&!1===e.additionalProperties){let{additionalProperties:r,...a}=e;t=a}else a=void 0;i.push(t)}}),i.length?{allOf:i,...a}:void 0}(e,r);case l.kY.ZodTuple:return function(e,t){return e.rest?{type:"array",minItems:e.items.length,items:e.items.map((e,r)=>A(e._def,{...t,currentPath:[...t.currentPath,"items",`${r}`]})).reduce((e,t)=>void 0===t?e:[...e,t],[]),additionalItems:A(e.rest._def,{...t,currentPath:[...t.currentPath,"additionalItems"]})}:{type:"array",minItems:e.items.length,maxItems:e.items.length,items:e.items.map((e,r)=>A(e._def,{...t,currentPath:[...t.currentPath,"items",`${r}`]})).reduce((e,t)=>void 0===t?e:[...e,t],[])}}(e,r);case l.kY.ZodRecord:return O(e,r);case l.kY.ZodLiteral:return function(e,t){let r=typeof e.value;return"bigint"!==r&&"number"!==r&&"boolean"!==r&&"string"!==r?{type:Array.isArray(e.value)?"array":"object"}:"openApi3"===t.target?{type:"bigint"===r?"integer":r,enum:[e.value]}:{type:"bigint"===r?"integer":r,const:e.value}}(e,r);case l.kY.ZodEnum:return{type:"string",enum:Array.from(e.values)};case l.kY.ZodNativeEnum:return function(e){let t=e.values,r=Object.keys(e.values).filter(e=>"number"!=typeof t[t[e]]).map(e=>t[e]),a=Array.from(new Set(r.map(e=>typeof e)));return{type:1===a.length?"string"===a[0]?"string":"number":["string","number"],enum:r}}(e);case l.kY.ZodNullable:return function(e,t){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(e.innerType._def.typeName)&&(!e.innerType._def.checks||!e.innerType._def.checks.length))return"openApi3"===t.target?{type:I[e.innerType._def.typeName],nullable:!0}:{type:[I[e.innerType._def.typeName],"null"]};if("openApi3"===t.target){let r=A(e.innerType._def,{...t,currentPath:[...t.currentPath]});return r&&"$ref"in r?{allOf:[r],nullable:!0}:r&&{...r,nullable:!0}}let r=A(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","0"]});return r&&{anyOf:[r,{type:"null"}]}}(e,r);case l.kY.ZodOptional:return E(e,r);case l.kY.ZodMap:return function(e,t){return"record"===t.mapStrategy?O(e,t):{type:"array",maxItems:125,items:{type:"array",items:[A(e.keyType._def,{...t,currentPath:[...t.currentPath,"items","items","0"]})||{},A(e.valueType._def,{...t,currentPath:[...t.currentPath,"items","items","1"]})||{}],minItems:2,maxItems:2}}}(e,r);case l.kY.ZodSet:return function(e,t){let r={type:"array",uniqueItems:!0,items:A(e.valueType._def,{...t,currentPath:[...t.currentPath,"items"]})};return e.minSize&&c(r,"minItems",e.minSize.value,e.minSize.message,t),e.maxSize&&c(r,"maxItems",e.maxSize.value,e.maxSize.message,t),r}(e,r);case l.kY.ZodLazy:return()=>e.getter()._def;case l.kY.ZodPromise:return A(e.type._def,r);case l.kY.ZodNaN:case l.kY.ZodNever:return{not:{}};case l.kY.ZodEffects:return function(e,t){return"input"===t.effectStrategy?A(e.schema._def,t):{}}(e,r);case l.kY.ZodAny:case l.kY.ZodUnknown:return{};case l.kY.ZodDefault:return function(e,t){return{...A(e.innerType._def,t),default:e.defaultValue()}}(e,r);case l.kY.ZodBranded:return d(e,r);case l.kY.ZodReadonly:return S(e,r);case l.kY.ZodCatch:return h(e,r);case l.kY.ZodPipeline:return x(e,r);case l.kY.ZodFunction:case l.kY.ZodVoid:case l.kY.ZodSymbol:default:return}};function A(e,t,r=!1){let a=t.seen.get(e);if(t.override){let n=t.override?.(e,t,a,r);if(n!==i)return n}if(a&&!r){let e=T(a,t);if(void 0!==e)return e}let n={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.set(e,n);let s=P(e,e.typeName,t),o="function"==typeof s?A(s(),t):s;if(o&&N(e,t,o),t.postProcess){let r=t.postProcess(o,e,t);return n.jsonSchema=o,r}return n.jsonSchema=o,o}let T=(e,t)=>{switch(t.$refStrategy){case"root":return{$ref:e.path.join("/")};case"relative":return{$ref:j(t.currentPath,e.path)};case"none":case"seen":if(e.path.length<t.currentPath.length&&e.path.every((e,r)=>t.currentPath[r]===e))return console.warn(`Recursive reference detected at ${t.currentPath.join("/")}! Defaulting to any`),{};return"seen"===t.$refStrategy?{}:void 0}},j=(e,t)=>{let r=0;for(;r<e.length&&r<t.length&&e[r]===t[r];r++);return[(e.length-r).toString(),...t.slice(r)].join("/")},N=(e,t,r)=>(e.description&&(r.description=e.description,t.markdownDescription&&(r.markdownDescription=e.description)),r),$=(e,t)=>{let r=o(t),a="object"==typeof t&&t.definitions?Object.entries(t.definitions).reduce((e,[t,a])=>({...e,[t]:A(a._def,{...r,currentPath:[...r.basePath,r.definitionPath,t]},!0)??{}}),{}):void 0,i="string"==typeof t?t:t?.nameStrategy==="title"?void 0:t?.name,n=A(e._def,void 0===i?r:{...r,currentPath:[...r.basePath,r.definitionPath,i]},!1)??{},s="object"==typeof t&&void 0!==t.name&&"title"===t.nameStrategy?t.name:void 0;void 0!==s&&(n.title=s);let l=void 0===i?a?{...n,[r.definitionPath]:a}:n:{$ref:[..."relative"===r.$refStrategy?[]:r.basePath,r.definitionPath,i].join("/"),[r.definitionPath]:{...a,[i]:n}};return"jsonSchema7"===r.target?l.$schema="http://json-schema.org/draft-07/schema#":("jsonSchema2019-09"===r.target||"openAi"===r.target)&&(l.$schema="https://json-schema.org/draft/2019-09/schema#"),"openAi"===r.target&&("anyOf"in l||"oneOf"in l||"allOf"in l||"type"in l&&Array.isArray(l.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),l}},8044:(e,t,r)=>{"use strict";let a=r(36053);e.exports=(e,t,r)=>{let i=new a(e,r),n=new a(t,r);return i.compare(n)||i.compareBuild(n)}},11014:(e,t,r)=>{"use strict";r.d(t,{PF:()=>s});var a=r(70238),i=r(7379);r(70014);var n=r(34497);function s(e){return(0,n.Pq)(e)?(0,a.blZ)(e):(0,n.IU)(e)?(0,i.Ik)(e):e}},13818:(e,t,r)=>{"use strict";let a=r(34290);e.exports=(e,t,r)=>a(e,t,">",r)},14654:(e,t,r)=>{"use strict";r.d(t,{CC:()=>o,mJ:()=>s});var a=r(1995),i=r(42452);class n extends a.YN{parseResultWithPrompt(e,t,r){return this.parseResult(e,r)}_baseMessageToString(e){return"string"==typeof e.content?e.content:this._baseMessageContentToString(e.content)}_baseMessageContentToString(e){return JSON.stringify(e)}async invoke(e,t){return"string"==typeof e?this._callWithConfig(async(e,t)=>this.parseResult([{text:e}],t?.callbacks),e,{...t,runType:"parser"}):this._callWithConfig(async(e,t)=>this.parseResult([{message:e,text:this._baseMessageToString(e)}],t?.callbacks),e,{...t,runType:"parser"})}}class s extends n{parseResult(e,t){return this.parse(e[0].text,t)}async parseWithPrompt(e,t,r){return this.parse(e,r)}_type(){throw Error("_type not implemented")}}class o extends Error{constructor(e,t,r,a=!1){if(super(e),Object.defineProperty(this,"llmOutput",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"observation",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sendToLLM",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.llmOutput=t,this.observation=r,this.sendToLLM=a,a&&(void 0===r||void 0===t))throw Error("Arguments 'observation' & 'llmOutput' are required if 'sendToLlm' is true");(0,i.Y)(this,"OUTPUT_PARSING_FAILURE")}}},15395:e=>{"use strict";class t{constructor(){this.max=1e3,this.map=new Map}get(e){let t=this.map.get(e);if(void 0!==t)return this.map.delete(e),this.map.set(e,t),t}delete(e){return this.map.delete(e)}set(e,t){if(!this.delete(e)&&void 0!==t){if(this.map.size>=this.max){let e=this.map.keys().next().value;this.delete(e)}this.map.set(e,t)}return this}}e.exports=t},16587:(e,t,r)=>{"use strict";let a=r(88193);e.exports=(e,t,r)=>a(t,e,r)},17877:(e,t,r)=>{"use strict";let a=r(42870);e.exports=(e,t,r)=>(e=new a(e,r),t=new a(t,r),e.intersects(t,r))},19277:(e,t,r)=>{"use strict";let a=r(36053),i=r(42870);e.exports=(e,t,r)=>{let n=null,s=null,o=null;try{o=new i(t,r)}catch(e){return null}return e.forEach(e=>{o.test(e)&&(!n||-1===s.compare(e))&&(s=new a(n=e,r))}),n}},19902:(e,t,r)=>{"use strict";let a=r(36053);e.exports=(e,t,r,i,n)=>{"string"==typeof r&&(n=i,i=r,r=void 0);try{return new a(e instanceof a?e.version:e,r).inc(t,i,n).version}catch(e){return null}}},21232:e=>{"use strict";e.exports=(e,t)=>(t=t||(()=>{}),e.then(e=>new Promise(e=>{e(t())}).then(()=>e),e=>new Promise(e=>{e(t())}).then(()=>{throw e})))},21563:(e,t,r)=>{"use strict";r.d(t,{P:()=>u,I:()=>c});var a=r(71150),i=r(23294),n=r(80918),s=r(34621),o=r(87150),l=r(72716);class u extends s.j_{constructor({concurrency:e,...t}){super(e?{maxConcurrency:e,...t}:t),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","llms",this._llmType()]})}async invoke(e,t){let r=u._convertInputToPromptValue(e);return(await this.generatePrompt([r],t,t?.callbacks)).generations[0][0].text}async *_streamResponseChunks(e,t,r){throw Error("Not implemented.")}_separateRunnableConfigFromCallOptionsCompat(e){let[t,r]=super._separateRunnableConfigFromCallOptions(e);return r.signal=t.signal,[t,r]}async *_streamIterator(e,t){if(this._streamResponseChunks===u.prototype._streamResponseChunks)yield this.invoke(e,t);else{let r=u._convertInputToPromptValue(e),[a,s]=this._separateRunnableConfigFromCallOptionsCompat(t),o=await n.Td.configure(a.callbacks,this.callbacks,a.tags,this.tags,a.metadata,this.metadata,{verbose:this.verbose}),l={options:s,invocation_params:this?.invocationParams(s),batch_size:1},c=await o?.handleLLMStart(this.toJSON(),[r.toString()],a.runId,void 0,l,void 0,void 0,a.runName),d=new i.mu({text:""});try{for await(let e of this._streamResponseChunks(r.toString(),s,c?.[0]))d=d?d.concat(e):e,"string"==typeof e.text&&(yield e.text)}catch(e){throw await Promise.all((c??[]).map(t=>t?.handleLLMError(e))),e}await Promise.all((c??[]).map(e=>e?.handleLLMEnd({generations:[[d]]})))}}async generatePrompt(e,t,r){let a=e.map(e=>e.toString());return this.generate(a,t,r)}invocationParams(e){return{}}_flattenLLMResult(e){let t=[];for(let r=0;r<e.generations.length;r+=1){let a=e.generations[r];if(0===r)t.push({generations:[a],llmOutput:e.llmOutput});else{let r=e.llmOutput?{...e.llmOutput,tokenUsage:{}}:void 0;t.push({generations:[a],llmOutput:r})}}return t}async _generateUncached(e,t,r,a){let s,c;if(void 0!==a&&a.length===e.length)s=a;else{let a=await n.Td.configure(r.callbacks,this.callbacks,r.tags,this.tags,r.metadata,this.metadata,{verbose:this.verbose}),i={options:t,invocation_params:this?.invocationParams(t),batch_size:e.length};s=await a?.handleLLMStart(this.toJSON(),e,r.runId,void 0,i,void 0,void 0,r?.runName)}if(s?.[0].handlers.find(l.xL)&&1===e.length&&this._streamResponseChunks!==u.prototype._streamResponseChunks)try{let r;for await(let a of(await this._streamResponseChunks(e[0],t,s?.[0])))r=void 0===r?a:(0,o.xW)(r,a);if(void 0===r)throw Error("Received empty response from chat model call.");c={generations:[[r]],llmOutput:{}},await s?.[0].handleLLMEnd(c)}catch(e){throw await s?.[0].handleLLMError(e),e}else{try{c=await this._generate(e,t,s?.[0])}catch(e){throw await Promise.all((s??[]).map(t=>t?.handleLLMError(e))),e}let r=this._flattenLLMResult(c);await Promise.all((s??[]).map((e,t)=>e?.handleLLMEnd(r[t])))}let d=s?.map(e=>e.runId)||void 0;return Object.defineProperty(c,i.SP,{value:d?{runIds:d}:void 0,configurable:!0}),c}async _generateCached({prompts:e,cache:t,llmStringKey:r,parsedOptions:a,handledOptions:s,runId:o}){let l=await n.Td.configure(s.callbacks,this.callbacks,s.tags,this.tags,s.metadata,this.metadata,{verbose:this.verbose}),u={options:a,invocation_params:this?.invocationParams(a),batch_size:e.length},c=await l?.handleLLMStart(this.toJSON(),e,o,void 0,u,void 0,void 0,s?.runName),d=[],h=(await Promise.allSettled(e.map(async(e,a)=>{let i=await t.lookup(e,r);return null==i&&d.push(a),i}))).map((e,t)=>({result:e,runManager:c?.[t]})).filter(({result:e})=>"fulfilled"===e.status&&null!=e.value||"rejected"===e.status),p=[];await Promise.all(h.map(async({result:e,runManager:t},r)=>{if("fulfilled"!==e.status)return await t?.handleLLMError(e.reason,void 0,void 0,void 0,{cached:!0}),Promise.reject(e.reason);{let a=e.value;return p[r]=a.map(e=>(e.generationInfo={...e.generationInfo,tokenUsage:{}},e)),a.length&&await t?.handleLLMNewToken(a[0].text),t?.handleLLMEnd({generations:[a]},void 0,void 0,void 0,{cached:!0})}}));let m={generations:p,missingPromptIndices:d,startedRunManagers:c};return Object.defineProperty(m,i.SP,{value:c?{runIds:c?.map(e=>e.runId)}:void 0,configurable:!0}),m}async generate(e,t,r){let a;if(!Array.isArray(e))throw Error("Argument 'prompts' is expected to be a string[]");a=Array.isArray(t)?{stop:t}:t;let[i,n]=this._separateRunnableConfigFromCallOptionsCompat(a);if(i.callbacks=i.callbacks??r,!this.cache)return this._generateUncached(e,n,i);let{cache:s}=this,o=this._getSerializedCacheKeyParametersForCall(n),{generations:l,missingPromptIndices:u,startedRunManagers:c}=await this._generateCached({prompts:e,cache:s,llmStringKey:o,parsedOptions:n,handledOptions:i,runId:i.runId}),d={};if(u.length>0){let t=await this._generateUncached(u.map(t=>e[t]),n,i,void 0!==c?u.map(e=>c?.[e]):void 0);await Promise.all(t.generations.map(async(t,r)=>{let a=u[r];return l[a]=t,s.update(e[a],o,t)})),d=t.llmOutput??{}}return{generations:l,llmOutput:d}}async call(e,t,r){let{generations:a}=await this.generate([e],t,r);return a[0][0].text}async predict(e,t,r){return this.call(e,t,r)}async predictMessages(e,t,r){let i=(0,a.Sw)(e),n=await this.call(i,t,r);return new a.Od(n)}_identifyingParams(){return{}}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}_modelType(){return"base_llm"}}class c extends u{async _generate(e,t,r){return{generations:await Promise.all(e.map((e,a)=>this._call(e,{...t,promptIndex:a},r).then(e=>[{text:e}])))}}}},22441:(e,t,r)=>{"use strict";r.d(t,{cg:()=>a.cg,c9:()=>a.c9,lm:()=>a.lm,IU:()=>a.IU,Pq:()=>a.Pq});var a=r(34497)},23229:(e,t,r)=>{"use strict";r.d(t,{qG:()=>n});var a=r(99643),i=r(34497);function n(e){return!!e&&"object"==typeof e&&"name"in e&&"schema"in e&&((0,i.c9)(e.schema)||null!=e.schema&&"object"==typeof e.schema&&"type"in e.schema&&"string"==typeof e.schema.type&&["null","boolean","object","array","number","string"].includes(e.schema.type))||void 0!==e&&a.YN.isRunnable(e)&&"lc_name"in e.constructor&&"function"==typeof e.constructor.lc_name&&"RunnableToolLike"===e.constructor.lc_name()||void 0!==e&&Array.isArray(e.lc_namespace)}},23255:(e,t,r)=>{"use strict";let a=r(34290);e.exports=(e,t,r)=>a(e,t,"<",r)},23294:(e,t,r)=>{"use strict";r.d(t,{Cf:()=>n,SP:()=>a,mu:()=>i});let a="__run";class i{constructor(e){Object.defineProperty(this,"text",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"generationInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.text=e.text,this.generationInfo=e.generationInfo}concat(e){return new i({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo}})}}class n extends i{constructor(e){super(e),Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.message=e.message}concat(e){return new n({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo},message:this.message.concat(e.message)})}}},23906:(e,t,r)=>{"use strict";let a=r(88193);e.exports=(e,t,r)=>0>a(e,t,r)},23931:(e,t,r)=>{"use strict";r.d(t,{y:()=>o,Z:()=>s});var a=r(76591);function i(e,t){return t?.[e]||a(e)}function n(e){return Array.isArray(e)?[...e]:{...e}}function s(e){let t=Object.getPrototypeOf(e);return"function"==typeof e.lc_name&&("function"!=typeof t.lc_name||e.lc_name()!==t.lc_name())?e.lc_name():e.name}r(85560);class o{static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,s(this.constructor)]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}get lc_serializable_keys(){}constructor(e,...t){Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),void 0!==this.lc_serializable_keys?this.lc_kwargs=Object.fromEntries(Object.entries(e||{}).filter(([e])=>this.lc_serializable_keys?.includes(e))):this.lc_kwargs=e??{}}toJSON(){if(!this.lc_serializable||this.lc_kwargs instanceof o||"object"!=typeof this.lc_kwargs||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();let e={},t={},r=Object.keys(this.lc_kwargs).reduce((e,t)=>(e[t]=t in this?this[t]:this.lc_kwargs[t],e),{});for(let a=Object.getPrototypeOf(this);a;a=Object.getPrototypeOf(a))Object.assign(e,Reflect.get(a,"lc_aliases",this)),Object.assign(t,Reflect.get(a,"lc_secrets",this)),Object.assign(r,Reflect.get(a,"lc_attributes",this));return Object.keys(t).forEach(e=>{let t=this,a=r,[i,...n]=e.split(".").reverse();for(let e of n.reverse()){if(!(e in t)||void 0===t[e])return;e in a&&void 0!==a[e]||("object"==typeof t[e]&&null!=t[e]?a[e]={}:Array.isArray(t[e])&&(a[e]=[])),t=t[e],a=a[e]}i in t&&void 0!==t[i]&&(a[i]=a[i]||t[i])}),{lc:1,type:"constructor",id:this.lc_id,kwargs:function(e,t,r){let a={};for(let i in e)Object.hasOwn(e,i)&&(a[t(i,r)]=e[i]);return a}(Object.keys(t).length?function(e,t){let r=n(e);for(let[e,a]of Object.entries(t)){let[t,...i]=e.split(".").reverse(),s=r;for(let e of i.reverse()){if(void 0===s[e])break;s[e]=n(s[e]),s=s[e]}void 0!==s[t]&&(s[t]={lc:1,type:"secret",id:[a]})}return r}(r,t):r,i,e)}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:this.lc_id}}}},25050:(e,t,r)=>{"use strict";r.d(t,{J:()=>u,j:()=>l});var a=r(93412),i=r(72716),n=r(4397);let s=e=>{if(e)return e.events=e.events??[],e.child_runs=e.child_runs??[],e};function o(e,t){return e&&!Array.isArray(e)&&"object"==typeof e?e:{[t]:e}}function l(e){return"function"==typeof e._addRunToRunMap}class u extends i.NK{constructor(e){super(...arguments),Object.defineProperty(this,"runMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"runTreeMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"usesRunTreeMap",{enumerable:!0,configurable:!0,writable:!0,value:!1})}copy(){return this}getRunById(e){if(void 0!==e)return this.usesRunTreeMap?s(this.runTreeMap.get(e)):this.runMap.get(e)}stringifyError(e){return e instanceof Error?e.message+(e?.stack?`

${e.stack}`:""):"string"==typeof e?e:`${e}`}_addChildRun(e,t){e.child_runs.push(t)}_addRunToRunMap(e){let t=function(e,t,r){let a=r.toFixed(0).slice(0,3).padStart(3,"0");return`${new Date(e).toISOString().slice(0,-1)}${a}Z`.replace(/[-:.]/g,"")+t}(e.start_time,e.id,e.execution_order),r={...e},i=this.getRunById(r.parent_run_id);if(void 0!==r.parent_run_id?i&&(this._addChildRun(i,r),i.child_execution_order=Math.max(i.child_execution_order,r.child_execution_order),r.trace_id=i.trace_id,void 0!==i.dotted_order&&(r.dotted_order=[i.dotted_order,t].join("."))):(r.trace_id=r.id,r.dotted_order=t),this.usesRunTreeMap){let e=function e(t,r){if(t)return new a.gk({...t,parent_run:e(r),child_runs:t.child_runs.map(t=>e(t)).filter(e=>void 0!==e),extra:{...t.extra,runtime:(0,n.VS)()},tracingEnabled:!1})}(r,i);void 0!==e&&this.runTreeMap.set(r.id,e)}else this.runMap.set(r.id,r);return r}async _endTrace(e){let t=void 0!==e.parent_run_id&&this.getRunById(e.parent_run_id);t?t.child_execution_order=Math.max(t.child_execution_order,e.child_execution_order):await this.persistRun(e),await this.onRunUpdate?.(e),this.usesRunTreeMap?this.runTreeMap.delete(e.id):this.runMap.delete(e.id)}_getExecutionOrder(e){let t=void 0!==e&&this.getRunById(e);return t?t.child_execution_order+1:1}_createRunForLLMStart(e,t,r,a,i,n,s,o){let l=this._getExecutionOrder(a),u=Date.now(),c=s?{...i,metadata:s}:i,d={id:r,name:o??e.id[e.id.length-1],parent_run_id:a,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:{prompts:t},execution_order:l,child_runs:[],child_execution_order:l,run_type:"llm",extra:c??{},tags:n||[]};return this._addRunToRunMap(d)}async handleLLMStart(e,t,r,a,i,n,s,o){let l=this.getRunById(r)??this._createRunForLLMStart(e,t,r,a,i,n,s,o);return await this.onRunCreate?.(l),await this.onLLMStart?.(l),l}_createRunForChatModelStart(e,t,r,a,i,n,s,o){let l=this._getExecutionOrder(a),u=Date.now(),c=s?{...i,metadata:s}:i,d={id:r,name:o??e.id[e.id.length-1],parent_run_id:a,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:{messages:t},execution_order:l,child_runs:[],child_execution_order:l,run_type:"llm",extra:c??{},tags:n||[]};return this._addRunToRunMap(d)}async handleChatModelStart(e,t,r,a,i,n,s,o){let l=this.getRunById(r)??this._createRunForChatModelStart(e,t,r,a,i,n,s,o);return await this.onRunCreate?.(l),await this.onLLMStart?.(l),l}async handleLLMEnd(e,t,r,a,i){let n=this.getRunById(t);if(!n||n?.run_type!=="llm")throw Error("No LLM run to end.");return n.end_time=Date.now(),n.outputs=e,n.events.push({name:"end",time:new Date(n.end_time).toISOString()}),n.extra={...n.extra,...i},await this.onLLMEnd?.(n),await this._endTrace(n),n}async handleLLMError(e,t,r,a,i){let n=this.getRunById(t);if(!n||n?.run_type!=="llm")throw Error("No LLM run to end.");return n.end_time=Date.now(),n.error=this.stringifyError(e),n.events.push({name:"error",time:new Date(n.end_time).toISOString()}),n.extra={...n.extra,...i},await this.onLLMError?.(n),await this._endTrace(n),n}_createRunForChainStart(e,t,r,a,i,n,s,o){let l=this._getExecutionOrder(a),u=Date.now(),c={id:r,name:o??e.id[e.id.length-1],parent_run_id:a,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:t,execution_order:l,child_execution_order:l,run_type:s??"chain",child_runs:[],extra:n?{metadata:n}:{},tags:i||[]};return this._addRunToRunMap(c)}async handleChainStart(e,t,r,a,i,n,s,o){let l=this.getRunById(r)??this._createRunForChainStart(e,t,r,a,i,n,s,o);return await this.onRunCreate?.(l),await this.onChainStart?.(l),l}async handleChainEnd(e,t,r,a,i){let n=this.getRunById(t);if(!n)throw Error("No chain run to end.");return n.end_time=Date.now(),n.outputs=o(e,"output"),n.events.push({name:"end",time:new Date(n.end_time).toISOString()}),i?.inputs!==void 0&&(n.inputs=o(i.inputs,"input")),await this.onChainEnd?.(n),await this._endTrace(n),n}async handleChainError(e,t,r,a,i){let n=this.getRunById(t);if(!n)throw Error("No chain run to end.");return n.end_time=Date.now(),n.error=this.stringifyError(e),n.events.push({name:"error",time:new Date(n.end_time).toISOString()}),i?.inputs!==void 0&&(n.inputs=o(i.inputs,"input")),await this.onChainError?.(n),await this._endTrace(n),n}_createRunForToolStart(e,t,r,a,i,n,s){let o=this._getExecutionOrder(a),l=Date.now(),u={id:r,name:s??e.id[e.id.length-1],parent_run_id:a,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{input:t},execution_order:o,child_execution_order:o,run_type:"tool",child_runs:[],extra:n?{metadata:n}:{},tags:i||[]};return this._addRunToRunMap(u)}async handleToolStart(e,t,r,a,i,n,s){let o=this.getRunById(r)??this._createRunForToolStart(e,t,r,a,i,n,s);return await this.onRunCreate?.(o),await this.onToolStart?.(o),o}async handleToolEnd(e,t){let r=this.getRunById(t);if(!r||r?.run_type!=="tool")throw Error("No tool run to end");return r.end_time=Date.now(),r.outputs={output:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await this.onToolEnd?.(r),await this._endTrace(r),r}async handleToolError(e,t){let r=this.getRunById(t);if(!r||r?.run_type!=="tool")throw Error("No tool run to end");return r.end_time=Date.now(),r.error=this.stringifyError(e),r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await this.onToolError?.(r),await this._endTrace(r),r}async handleAgentAction(e,t){let r=this.getRunById(t);r&&r?.run_type==="chain"&&(r.actions=r.actions||[],r.actions.push(e),r.events.push({name:"agent_action",time:new Date().toISOString(),kwargs:{action:e}}),await this.onAgentAction?.(r))}async handleAgentEnd(e,t){let r=this.getRunById(t);r&&r?.run_type==="chain"&&(r.events.push({name:"agent_end",time:new Date().toISOString(),kwargs:{action:e}}),await this.onAgentEnd?.(r))}_createRunForRetrieverStart(e,t,r,a,i,n,s){let o=this._getExecutionOrder(a),l=Date.now(),u={id:r,name:s??e.id[e.id.length-1],parent_run_id:a,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{query:t},execution_order:o,child_execution_order:o,run_type:"retriever",child_runs:[],extra:n?{metadata:n}:{},tags:i||[]};return this._addRunToRunMap(u)}async handleRetrieverStart(e,t,r,a,i,n,s){let o=this.getRunById(r)??this._createRunForRetrieverStart(e,t,r,a,i,n,s);return await this.onRunCreate?.(o),await this.onRetrieverStart?.(o),o}async handleRetrieverEnd(e,t){let r=this.getRunById(t);if(!r||r?.run_type!=="retriever")throw Error("No retriever run to end");return r.end_time=Date.now(),r.outputs={documents:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await this.onRetrieverEnd?.(r),await this._endTrace(r),r}async handleRetrieverError(e,t){let r=this.getRunById(t);if(!r||r?.run_type!=="retriever")throw Error("No retriever run to end");return r.end_time=Date.now(),r.error=this.stringifyError(e),r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await this.onRetrieverError?.(r),await this._endTrace(r),r}async handleText(e,t){let r=this.getRunById(t);r&&r?.run_type==="chain"&&(r.events.push({name:"text",time:new Date().toISOString(),kwargs:{text:e}}),await this.onText?.(r))}async handleLLMNewToken(e,t,r,a,i,n){let s=this.getRunById(r);if(!s||s?.run_type!=="llm")throw Error('Invalid "runId" provided to "handleLLMNewToken" callback.');return s.events.push({name:"new_token",time:new Date().toISOString(),kwargs:{token:e,idx:t,chunk:n?.chunk}}),await this.onLLMNewToken?.(s,e,{chunk:n?.chunk}),s}}},25795:(e,t,r)=>{"use strict";r.d(t,{Kj:()=>C});var a=r(35745),i=r(52813),n=r(52435),s=r(47415);let o=[400,401,403,404,405,406,407,408],l=[409];class u{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedResponseHook",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"debug",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.debug=e.debug,this.queue=new n.default({concurrency:this.maxConcurrency}),this.onFailedResponseHook=e?.onFailedResponseHook}call(e,...t){let r=this.onFailedResponseHook;return this.queue.add(()=>i(()=>e(...t).catch(e=>{if(e instanceof Error)throw e;throw Error(e)}),{async onFailedAttempt(e){if(e.message.startsWith("Cancel")||e.message.startsWith("TimeoutError")||e.message.startsWith("AbortError")||e?.code==="ECONNABORTED")throw e;let t=e?.response,a=t?.status;if(a){if(o.includes(+a))throw e;if(l.includes(+a))return;r&&await r(t)}},retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...r){return e.signal?Promise.race([this.call(t,...r),new Promise((t,r)=>{e.signal?.addEventListener("abort",()=>{r(Error("AbortError"))})})]):this.call(t,...r)}fetch(...e){return this.call(()=>(0,s.Yx)(this.debug)(...e).then(e=>e.ok?e:Promise.reject(e)))}}function c(e){return"function"==typeof e?._getType}function d(e){let t={type:e._getType(),data:{content:e.content}};return e?.additional_kwargs&&Object.keys(e.additional_kwargs).length>0&&(t.data.additional_kwargs={...e.additional_kwargs}),t}var h=r(82851),p=r(3666),m=r(3204);function f(e,t){if(!m.A(e))throw Error(void 0!==t?`Invalid UUID for ${t}: ${e}`:`Invalid UUID: ${e}`);return e}var g=r(34544);function y(e){if(!e||e.split("/").length>2||e.startsWith("/")||e.endsWith("/")||e.split(":").length>2)throw Error(`Invalid identifier format: ${e}`);let[t,r]=e.split(":"),a=r||"latest";if(t.includes("/")){let[r,i]=t.split("/",2);if(!r||!i)throw Error(`Invalid identifier format: ${e}`);return[r,i,a]}if(!t)throw Error(`Invalid identifier format: ${e}`);return["-",t,a]}r(99548);class b extends Error{constructor(e){super(e),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="LangSmithConflictError",this.status=409}}async function _(e,t,r){let a;if(e.ok){r&&(a=await e.text());return}a=await e.text();let i=`Failed to ${t}. Received status [${e.status}]: ${e.statusText}. Server response: ${a}`;if(409===e.status)throw new b(i);let n=Error(i);throw n.status=e.status,n}var v={result:"[Circular]"},w=[],O=[];let I=new TextEncoder;function k(e){return I.encode(e)}function E(e,t,r,a,i){try{let t=JSON.stringify(e,r,a);return k(t)}catch(s){let n;if(!s.message?.includes("Converting circular structure to JSON"))return console.warn(`[WARNING]: LangSmith received unserializable value.${t?`
Context: ${t}`:""}`),k("[Unserializable]");console.warn(`[WARNING]: LangSmith received circular JSON. This will decrease tracer performance. ${t?`
Context: ${t}`:""}`),void 0===i&&(i={depthLimit:Number.MAX_SAFE_INTEGER,edgesLimit:Number.MAX_SAFE_INTEGER}),function e(t,r,a,i,n,s,o){if(s+=1,"object"==typeof t&&null!==t){for(l=0;l<i.length;l++)if(i[l]===t){x(v,t,r,n);return}if(void 0!==o.depthLimit&&s>o.depthLimit||void 0!==o.edgesLimit&&a+1>o.edgesLimit){x("[...]",t,r,n);return}if(i.push(t),Array.isArray(t))for(l=0;l<t.length;l++)e(t[l],l,l,i,t,s,o);else{var l,u=Object.keys(t);for(l=0;l<u.length;l++){var c=u[l];e(t[c],c,l,i,t,s,o)}}i.pop()}}(e,"",0,[],void 0,0,i);try{n=0===O.length?JSON.stringify(e,r,a):JSON.stringify(e,function(e){return e=void 0!==e?e:function(e,t){return t},function(t,r){if(O.length>0)for(var a=0;a<O.length;a++){var i=O[a];if(i[1]===t&&i[0]===r){r=i[2],O.splice(a,1);break}}return e.call(this,t,r)}}(r),a)}catch(e){return k("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;0!==w.length;){let e=w.pop();4===e.length?Object.defineProperty(e[0],e[1],e[3]):e[0][e[1]]=e[2]}}return k(n)}}function x(e,t,r,a){var i=Object.getOwnPropertyDescriptor(a,r);void 0!==i.get?i.configurable?(Object.defineProperty(a,r,{value:e}),w.push([a,r,t,i])):O.push([t,r,e]):(a[r]=e,w.push([a,r,t]))}function S(e){let t=(0,h.Ec)(),r=(0,h.yk)(),a=e.extra??{},i=a.metadata;return e.extra={...a,runtime:{...t,...a?.runtime},metadata:{...r,...r.revision_id||e.revision_id?{revision_id:e.revision_id??r.revision_id}:{},...i}},e}let P=e=>{let t=e?.toString()??(0,h.Jz)("TRACING_SAMPLING_RATE");if(void 0===t)return;let r=parseFloat(t);if(r<0||r>1)throw Error(`LANGSMITH_TRACING_SAMPLING_RATE must be between 0 and 1 if set. Got: ${r}`);return r},A=e=>{let t=e.replace("http://","").replace("https://","").split("/")[0].split(":")[0];return"localhost"===t||"127.0.0.1"===t||"::1"===t};async function T(e){let t=[];for await(let r of e)t.push(r);return t}function j(e){if(void 0!==e)return e.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}let N=async e=>{if(e?.status===429){let t=1e3*parseInt(e.headers.get("retry-after")??"30",10);if(t>0)return await new Promise(e=>setTimeout(e,t)),!0}return!1};function $(e){return"number"==typeof e?Number(e.toFixed(4)):e}class R{constructor(){Object.defineProperty(this,"items",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"sizeBytes",{enumerable:!0,configurable:!0,writable:!0,value:0})}peek(){return this.items[0]}push(e){let t;let r=new Promise(e=>{t=e}),a=E(e.item,`Serializing run with id: ${e.item.id}`).length;return this.items.push({action:e.action,payload:e.item,itemPromiseResolve:t,itemPromise:r,size:a}),this.sizeBytes+=a,r}pop(e){if(e<1)throw Error("Number of bytes to pop off may not be less than 1.");let t=[],r=0;for(;r+(this.peek()?.size??0)<e&&this.items.length>0;){let e=this.items.shift();e&&(t.push(e),r+=e.size,this.sizeBytes-=e.size)}if(0===t.length&&this.items.length>0){let e=this.items.shift();t.push(e),r+=e.size,this.sizeBytes-=e.size}return[t.map(e=>({action:e.action,item:e.payload})),()=>t.forEach(e=>e.itemPromiseResolve())]}}class C{constructor(e={}){Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchIngestCaller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tenantId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"hideInputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hideOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingSampleRate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filteredPostUuids",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"autoBatchTracing",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"autoBatchQueue",{enumerable:!0,configurable:!0,writable:!0,value:new R}),Object.defineProperty(this,"autoBatchTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchAggregationDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:250}),Object.defineProperty(this,"batchSizeBytesLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"settings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"blockOnRootRunFinalization",{enumerable:!0,configurable:!0,writable:!0,value:"false"===(0,h.Az)("LANGSMITH_TRACING_BACKGROUND")}),Object.defineProperty(this,"traceBatchConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:5}),Object.defineProperty(this,"_serverInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_getServerInfoPromise",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"manualFlushMode",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"debug",{enumerable:!0,configurable:!0,writable:!0,value:"true"===(0,h.Az)("LANGSMITH_DEBUG")});let t=C.getDefaultClientConfig();if(this.tracingSampleRate=P(e.tracingSamplingRate),this.apiUrl=j(e.apiUrl??t.apiUrl)??"",this.apiUrl.endsWith("/")&&(this.apiUrl=this.apiUrl.slice(0,-1)),this.apiKey=j(e.apiKey??t.apiKey),this.webUrl=j(e.webUrl??t.webUrl),this.webUrl?.endsWith("/")&&(this.webUrl=this.webUrl.slice(0,-1)),this.timeout_ms=e.timeout_ms??9e4,this.caller=new u({...e.callerOptions??{},debug:e.debug??this.debug}),this.traceBatchConcurrency=e.traceBatchConcurrency??this.traceBatchConcurrency,this.traceBatchConcurrency<1)throw Error("Trace batch concurrency must be positive.");this.debug=e.debug??this.debug,this.batchIngestCaller=new u({maxRetries:2,maxConcurrency:this.traceBatchConcurrency,...e.callerOptions??{},onFailedResponseHook:N,debug:e.debug??this.debug}),this.hideInputs=e.hideInputs??e.anonymizer??t.hideInputs,this.hideOutputs=e.hideOutputs??e.anonymizer??t.hideOutputs,this.autoBatchTracing=e.autoBatchTracing??this.autoBatchTracing,this.blockOnRootRunFinalization=e.blockOnRootRunFinalization??this.blockOnRootRunFinalization,this.batchSizeBytesLimit=e.batchSizeBytesLimit,this.fetchOptions=e.fetchOptions||{},this.manualFlushMode=e.manualFlushMode??this.manualFlushMode}static getDefaultClientConfig(){let e=(0,h.Jz)("API_KEY"),t=(0,h.Jz)("ENDPOINT")??"https://api.smith.langchain.com";return{apiUrl:t,apiKey:e,webUrl:void 0,hideInputs:"true"===(0,h.Jz)("HIDE_INPUTS"),hideOutputs:"true"===(0,h.Jz)("HIDE_OUTPUTS")}}getHostUrl(){if(this.webUrl)return this.webUrl;if(A(this.apiUrl))return this.webUrl="http://localhost:3000",this.webUrl;if(this.apiUrl.endsWith("/api/v1"))return this.webUrl=this.apiUrl.replace("/api/v1",""),this.webUrl;if(this.apiUrl.includes("/api")&&!this.apiUrl.split(".",1)[0].endsWith("api"))return this.webUrl=this.apiUrl.replace("/api",""),this.webUrl;if(this.apiUrl.split(".",1)[0].includes("dev"))return this.webUrl="https://dev.smith.langchain.com",this.webUrl;else if(this.apiUrl.split(".",1)[0].includes("eu"))return this.webUrl="https://eu.smith.langchain.com",this.webUrl;else if(this.apiUrl.split(".",1)[0].includes("beta"))return this.webUrl="https://beta.smith.langchain.com",this.webUrl;else return this.webUrl="https://smith.langchain.com",this.webUrl}get headers(){let e={"User-Agent":`langsmith-js/${p.Ls}`};return this.apiKey&&(e["x-api-key"]=`${this.apiKey}`),e}async processInputs(e){return!1===this.hideInputs?e:!0===this.hideInputs?{}:"function"==typeof this.hideInputs?this.hideInputs(e):e}async processOutputs(e){return!1===this.hideOutputs?e:!0===this.hideOutputs?{}:"function"==typeof this.hideOutputs?this.hideOutputs(e):e}async prepareRunCreateOrUpdateInputs(e){let t={...e};return void 0!==t.inputs&&(t.inputs=await this.processInputs(t.inputs)),void 0!==t.outputs&&(t.outputs=await this.processOutputs(t.outputs)),t}async _getResponse(e,t){let r=t?.toString()??"",a=`${this.apiUrl}${e}?${r}`,i=await this.caller.call((0,s.Yx)(this.debug),a,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await _(i,`Failed to fetch ${e}`),i}async _get(e,t){return(await this._getResponse(e,t)).json()}async *_getPaginated(e,t=new URLSearchParams,r){let a=Number(t.get("offset"))||0,i=Number(t.get("limit"))||100;for(;;){t.set("offset",String(a)),t.set("limit",String(i));let n=`${this.apiUrl}${e}?${t}`,o=await this.caller.call((0,s.Yx)(this.debug),n,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await _(o,`Failed to fetch ${e}`);let l=r?r(await o.json()):await o.json();if(0===l.length||(yield l,l.length<i))break;a+=l.length}}async *_getCursorPaginatedList(e,t=null,r="POST",a="runs"){let i=t?{...t}:{};for(;;){let t=await this.caller.call((0,s.Yx)(this.debug),`${this.apiUrl}${e}`,{method:r,headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:JSON.stringify(i)}),n=await t.json();if(!n||!n[a])break;yield n[a];let o=n.cursors;if(!o||!o.next)break;i.cursor=o.next}}_shouldSample(){return void 0===this.tracingSampleRate||Math.random()<this.tracingSampleRate}_filterForSampling(e,t=!1){if(void 0===this.tracingSampleRate)return e;if(t){let t=[];for(let r of e)this.filteredPostUuids.has(r.id)?this.filteredPostUuids.delete(r.id):t.push(r);return t}{let t=[];for(let r of e){let e=r.trace_id??r.id;!this.filteredPostUuids.has(e)&&(r.id===e?this._shouldSample()?t.push(r):this.filteredPostUuids.add(e):t.push(r))}return t}}async _getBatchSizeLimitBytes(){let e=await this._ensureServerInfo();return this.batchSizeBytesLimit??e.batch_ingest_config?.size_limit_bytes??0x1400000}async _getMultiPartSupport(){let e=await this._ensureServerInfo();return e.instance_flags?.dataset_examples_multipart_enabled??!1}drainAutoBatchQueue(e){let t=[];for(;this.autoBatchQueue.items.length>0;){let[r,a]=this.autoBatchQueue.pop(e);if(!r.length){a();break}let i=this._processBatch(r,a).catch(console.error);t.push(i)}return Promise.all(t)}async _processBatch(e,t){if(!e.length){t();return}try{let t={runCreates:e.filter(e=>"create"===e.action).map(e=>e.item),runUpdates:e.filter(e=>"update"===e.action).map(e=>e.item)},r=await this._ensureServerInfo();r?.batch_ingest_config?.use_multipart_endpoint?await this.multipartIngestRuns(t):await this.batchIngestRuns(t)}finally{t()}}async processRunOperation(e){clearTimeout(this.autoBatchTimeout),this.autoBatchTimeout=void 0,"create"===e.action&&(e.item=S(e.item));let t=this.autoBatchQueue.push(e);if(this.manualFlushMode)return t;let r=await this._getBatchSizeLimitBytes();return this.autoBatchQueue.sizeBytes>r&&this.drainAutoBatchQueue(r),this.autoBatchQueue.items.length>0&&(this.autoBatchTimeout=setTimeout(()=>{this.autoBatchTimeout=void 0,this.drainAutoBatchQueue(r)},this.autoBatchAggregationDelayMs)),t}async _getServerInfo(){let e=await this.caller.call((0,s.Yx)(this.debug),`${this.apiUrl}/info`,{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(2500),...this.fetchOptions});await _(e,"get server info");let t=await e.json();return this.debug&&console.log("\n=== LangSmith Server Configuration ===\n"+JSON.stringify(t,null,2)+"\n"),t}async _ensureServerInfo(){return void 0===this._getServerInfoPromise&&(this._getServerInfoPromise=(async()=>{if(void 0===this._serverInfo)try{this._serverInfo=await this._getServerInfo()}catch(e){console.warn(`[WARNING]: LangSmith failed to fetch info on supported operations with status code ${e.status}. Falling back to batch operations and default limits.`)}return this._serverInfo??{}})()),this._getServerInfoPromise.then(e=>(void 0===this._serverInfo&&(this._getServerInfoPromise=void 0),e))}async _getSettings(){return this.settings||(this.settings=this._get("/settings")),await this.settings}async flush(){let e=await this._getBatchSizeLimitBytes();await this.drainAutoBatchQueue(e)}async createRun(e){if(!this._filterForSampling([e]).length)return;let t={...this.headers,"Content-Type":"application/json"},r=e.project_name;delete e.project_name;let a=await this.prepareRunCreateOrUpdateInputs({session_name:r,...e,start_time:e.start_time??Date.now()});if(this.autoBatchTracing&&void 0!==a.trace_id&&void 0!==a.dotted_order){this.processRunOperation({action:"create",item:a}).catch(console.error);return}let i=S(a),n=await this.caller.call((0,s.Yx)(this.debug),`${this.apiUrl}/runs`,{method:"POST",headers:t,body:E(i,`Creating run with id: ${i.id}`),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await _(n,"create run",!0)}async batchIngestRuns({runCreates:e,runUpdates:t}){if(void 0===e&&void 0===t)return;let r=await Promise.all(e?.map(e=>this.prepareRunCreateOrUpdateInputs(e))??[]),a=await Promise.all(t?.map(e=>this.prepareRunCreateOrUpdateInputs(e))??[]);if(r.length>0&&a.length>0){let e=r.reduce((e,t)=>(t.id&&(e[t.id]=t),e),{}),t=[];for(let r of a)void 0!==r.id&&e[r.id]?e[r.id]={...e[r.id],...r}:t.push(r);r=Object.values(e),a=t}let i={post:r,patch:a};if(!i.post.length&&!i.patch.length)return;let n={post:[],patch:[]};for(let e of["post","patch"]){let t=i[e].reverse(),r=t.pop();for(;void 0!==r;)n[e].push(r),r=t.pop()}if(n.post.length>0||n.patch.length>0){let e=n.post.map(e=>e.id).concat(n.patch.map(e=>e.id)).join(",");await this._postBatchIngestRuns(E(n,`Ingesting runs with ids: ${e}`))}}async _postBatchIngestRuns(e){let t={...this.headers,"Content-Type":"application/json",Accept:"application/json"},r=await this.batchIngestCaller.call((0,s.Yx)(this.debug),`${this.apiUrl}/runs/batch`,{method:"POST",headers:t,body:e,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await _(r,"batch create run",!0)}async multipartIngestRuns({runCreates:e,runUpdates:t}){if(void 0===e&&void 0===t)return;let r={},a=[];for(let t of e??[]){let e=await this.prepareRunCreateOrUpdateInputs(t);void 0!==e.id&&void 0!==e.attachments&&(r[e.id]=e.attachments),delete e.attachments,a.push(e)}let i=[];for(let e of t??[])i.push(await this.prepareRunCreateOrUpdateInputs(e));if(void 0!==a.find(e=>void 0===e.trace_id||void 0===e.dotted_order))throw Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when creating a run');if(void 0!==i.find(e=>void 0===e.trace_id||void 0===e.dotted_order))throw Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when updating a run');if(a.length>0&&i.length>0){let e=a.reduce((e,t)=>(t.id&&(e[t.id]=t),e),{}),t=[];for(let r of i)void 0!==r.id&&e[r.id]?e[r.id]={...e[r.id],...r}:t.push(r);a=Object.values(e),i=t}if(0===a.length&&0===i.length)return;let n=[],s=[];for(let[e,t]of[["post",a],["patch",i]])for(let a of t){let{inputs:t,outputs:i,events:o,attachments:l,...u}=a,c={inputs:t,outputs:i,events:o},d=E(u,`Serializing for multipart ingestion of run with id: ${u.id}`);for(let[t,r]of(s.push({name:`${e}.${u.id}`,payload:new Blob([d],{type:`application/json; length=${d.length}`})}),Object.entries(c))){if(void 0===r)continue;let a=E(r,`Serializing ${t} for multipart ingestion of run with id: ${u.id}`);s.push({name:`${e}.${u.id}.${t}`,payload:new Blob([a],{type:`application/json; length=${a.length}`})})}if(void 0!==u.id){let e=r[u.id];if(e)for(let[t,a]of(delete r[u.id],Object.entries(e))){let e,r;if(Array.isArray(a)?[e,r]=a:(e=a.mimeType,r=a.data),t.includes(".")){console.warn(`Skipping attachment '${t}' for run ${u.id}: Invalid attachment name. Attachment names must not contain periods ('.'). Please rename the attachment and try again.`);continue}s.push({name:`attachment.${u.id}.${t}`,payload:new Blob([r],{type:`${e}; length=${r.byteLength}`})})}}n.push(`trace=${u.trace_id},id=${u.id}`)}await this._sendMultipartRequest(s,n.join("; "))}async _createNodeFetchBody(e,t){let r=[];for(let a of e)r.push(new Blob([`--${t}\r
`])),r.push(new Blob([`Content-Disposition: form-data; name="${a.name}"\r
`,`Content-Type: ${a.payload.type}\r
\r
`])),r.push(a.payload),r.push(new Blob(["\r\n"]));r.push(new Blob([`--${t}--\r
`]));let a=new Blob(r);return await a.arrayBuffer()}async _createMultipartStream(e,t){let r=new TextEncoder;return new ReadableStream({async start(a){let i=async e=>{"string"==typeof e?a.enqueue(r.encode(e)):a.enqueue(e)};for(let r of e){await i(`--${t}\r
`),await i(`Content-Disposition: form-data; name="${r.name}"\r
`),await i(`Content-Type: ${r.payload.type}\r
\r
`);let e=r.payload.stream().getReader();try{let t;for(;!(t=await e.read()).done;)a.enqueue(t.value)}finally{e.releaseLock()}await i("\r\n")}await i(`--${t}--\r
`),a.close()}})}async _sendMultipartRequest(e,t){try{let t="----LangSmithFormBoundary"+Math.random().toString(36).slice(2),r=await ((0,s.rO)()?this._createNodeFetchBody(e,t):this._createMultipartStream(e,t)),a=await this.batchIngestCaller.call((0,s.Yx)(this.debug),`${this.apiUrl}/runs/multipart`,{method:"POST",headers:{...this.headers,"Content-Type":`multipart/form-data; boundary=${t}`},body:r,duplex:"half",signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await _(a,"ingest multipart runs",!0)}catch(e){console.warn(`${e.message.trim()}

Context: ${t}`)}}async updateRun(e,t){f(e),t.inputs&&(t.inputs=await this.processInputs(t.inputs)),t.outputs&&(t.outputs=await this.processOutputs(t.outputs));let r={...t,id:e};if(!this._filterForSampling([r],!0).length)return;if(this.autoBatchTracing&&void 0!==r.trace_id&&void 0!==r.dotted_order){void 0!==t.end_time&&void 0===r.parent_run_id&&this.blockOnRootRunFinalization&&!this.manualFlushMode?await this.processRunOperation({action:"update",item:r}).catch(console.error):this.processRunOperation({action:"update",item:r}).catch(console.error);return}let a={...this.headers,"Content-Type":"application/json"},i=await this.caller.call((0,s.Yx)(this.debug),`${this.apiUrl}/runs/${e}`,{method:"PATCH",headers:a,body:E(t,`Serializing payload to update run with id: ${e}`),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await _(i,"update run",!0)}async readRun(e,{loadChildRuns:t}={loadChildRuns:!1}){f(e);let r=await this._get(`/runs/${e}`);return t&&(r=await this._loadChildRuns(r)),r}async getRunUrl({runId:e,run:t,projectOpts:r}){if(void 0!==t){let e;e=t.session_id?t.session_id:r?.projectName?(await this.readProject({projectName:r?.projectName})).id:r?.projectId?r?.projectId:(await this.readProject({projectName:(0,h.Jz)("PROJECT")||"default"})).id;let a=await this._getTenantId();return`${this.getHostUrl()}/o/${a}/projects/p/${e}/r/${t.id}?poll=true`}if(void 0!==e){let t=await this.readRun(e);if(!t.app_path)throw Error(`Run ${e} has no app_path`);let r=this.getHostUrl();return`${r}${t.app_path}`}throw Error("Must provide either runId or run")}async _loadChildRuns(e){let t=await T(this.listRuns({isRoot:!1,projectId:e.session_id,traceId:e.trace_id})),r={},a={};for(let i of(t.sort((e,t)=>(e?.dotted_order??"").localeCompare(t?.dotted_order??"")),t)){if(null===i.parent_run_id||void 0===i.parent_run_id)throw Error(`Child run ${i.id} has no parent`);i.dotted_order?.startsWith(e.dotted_order??"")&&i.id!==e.id&&(i.parent_run_id in r||(r[i.parent_run_id]=[]),r[i.parent_run_id].push(i),a[i.id]=i)}for(let t in e.child_runs=r[e.id]||[],r)t!==e.id&&(a[t].child_runs=r[t]);return e}async *listRuns(e){let{projectId:t,projectName:r,parentRunId:a,traceId:i,referenceExampleId:n,startTime:s,executionOrder:o,isRoot:l,runType:u,error:c,id:d,query:h,filter:p,traceFilter:m,treeFilter:f,limit:g,select:y,order:b}=e,_=[];if(t&&(_=Array.isArray(t)?t:[t]),r){let e=Array.isArray(r)?r:[r],t=await Promise.all(e.map(e=>this.readProject({projectName:e}).then(e=>e.id)));_.push(...t)}let v={session:_.length?_:null,run_type:u,reference_example:n,query:h,filter:p,trace_filter:m,tree_filter:f,execution_order:o,parent_run:a,start_time:s?s.toISOString():null,error:c,id:d,limit:g,trace:i,select:y||["app_path","completion_cost","completion_tokens","dotted_order","end_time","error","events","extra","feedback_stats","first_token_time","id","inputs","name","outputs","parent_run_id","parent_run_ids","prompt_cost","prompt_tokens","reference_example_id","run_type","session_id","start_time","status","tags","total_cost","total_tokens","trace_id"],is_root:l,order:b},w=0;for await(let e of this._getCursorPaginatedList("/runs/query",v))if(g){if(w>=g)break;if(e.length+w>g){let t=e.slice(0,g-w);yield*t;break}w+=e.length,yield*e}else yield*e}async *listGroupRuns(e){let{projectId:t,projectName:r,groupBy:a,filter:i,startTime:n,endTime:o,limit:l,offset:u}=e,c={session_id:t||(await this.readProject({projectName:r})).id,group_by:a,filter:i,start_time:n?n.toISOString():null,end_time:o?o.toISOString():null,limit:Number(l)||100},d=Number(u)||0,h="/runs/group",p=`${this.apiUrl}${h}`;for(;;){let e=Object.fromEntries(Object.entries({...c,offset:d}).filter(([e,t])=>void 0!==t)),t=await this.caller.call((0,s.Yx)(),p,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(e),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await _(t,`Failed to fetch ${h}`);let{groups:r,total:a}=await t.json();if(0===r.length)break;for(let e of r)yield e;if((d+=r.length)>=a)break}}async getRunStats({id:e,trace:t,parentRun:r,runType:a,projectNames:i,projectIds:n,referenceExampleIds:o,startTime:l,endTime:u,error:c,query:d,filter:h,traceFilter:p,treeFilter:m,isRoot:f,dataSourceType:g}){let y=n||[];i&&(y=[...n||[],...await Promise.all(i.map(e=>this.readProject({projectName:e}).then(e=>e.id)))]);let b=Object.fromEntries(Object.entries({id:e,trace:t,parent_run:r,run_type:a,session:y,reference_example:o,start_time:l,end_time:u,error:c,query:d,filter:h,trace_filter:p,tree_filter:m,is_root:f,data_source_type:g}).filter(([e,t])=>void 0!==t)),_=await this.caller.call((0,s.Yx)(this.debug),`${this.apiUrl}/runs/stats`,{method:"POST",headers:this.headers,body:JSON.stringify(b),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await _.json()}async shareRun(e,{shareId:t}={}){let r={run_id:e,share_token:t||a.A()};f(e);let i=await this.caller.call((0,s.Yx)(this.debug),`${this.apiUrl}/runs/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),n=await i.json();if(null===n||!("share_token"in n))throw Error("Invalid response from server");return`${this.getHostUrl()}/public/${n.share_token}/r`}async unshareRun(e){f(e);let t=await this.caller.call((0,s.Yx)(this.debug),`${this.apiUrl}/runs/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await _(t,"unshare run",!0)}async readRunSharedLink(e){f(e);let t=await this.caller.call((0,s.Yx)(this.debug),`${this.apiUrl}/runs/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),r=await t.json();if(null!==r&&"share_token"in r)return`${this.getHostUrl()}/public/${r.share_token}/r`}async listSharedRuns(e,{runIds:t}={}){let r=new URLSearchParams({share_token:e});if(void 0!==t)for(let e of t)r.append("id",e);f(e);let a=await this.caller.call((0,s.Yx)(this.debug),`${this.apiUrl}/public/${e}/runs${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await a.json()}async readDatasetSharedSchema(e,t){if(!e&&!t)throw Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id),f(e);let r=await this.caller.call((0,s.Yx)(this.debug),`${this.apiUrl}/datasets/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),a=await r.json();return a.url=`${this.getHostUrl()}/public/${a.share_token}/d`,a}async shareDataset(e,t){if(!e&&!t)throw Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id);let r={dataset_id:e};f(e);let a=await this.caller.call((0,s.Yx)(this.debug),`${this.apiUrl}/datasets/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),i=await a.json();return i.url=`${this.getHostUrl()}/public/${i.share_token}/d`,i}async unshareDataset(e){f(e);let t=await this.caller.call((0,s.Yx)(this.debug),`${this.apiUrl}/datasets/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await _(t,"unshare dataset",!0)}async readSharedDataset(e){f(e);let t=await this.caller.call((0,s.Yx)(this.debug),`${this.apiUrl}/public/${e}/datasets`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await t.json()}async listSharedExamples(e,t){let r={};t?.exampleIds&&(r.id=t.exampleIds);let a=new URLSearchParams;Object.entries(r).forEach(([e,t])=>{Array.isArray(t)?t.forEach(t=>a.append(e,t)):a.append(e,t)});let i=await this.caller.call((0,s.Yx)(this.debug),`${this.apiUrl}/public/${e}/examples?${a.toString()}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),n=await i.json();if(!i.ok){if("detail"in n)throw Error(`Failed to list shared examples.
Status: ${i.status}
Message: ${Array.isArray(n.detail)?n.detail.join("\n"):"Unspecified error"}`);throw Error(`Failed to list shared examples: ${i.status} ${i.statusText}`)}return n.map(e=>({...e,_hostUrl:this.getHostUrl()}))}async createProject({projectName:e,description:t=null,metadata:r=null,upsert:a=!1,projectExtra:i=null,referenceDatasetId:n=null}){let o=`${this.apiUrl}/sessions${a?"?upsert=true":""}`,l=i||{};r&&(l.metadata=r);let u={name:e,extra:l,description:t};null!==n&&(u.reference_dataset_id=n);let c=await this.caller.call((0,s.Yx)(this.debug),o,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await _(c,"create project"),await c.json()}async updateProject(e,{name:t=null,description:r=null,metadata:a=null,projectExtra:i=null,endTime:n=null}){let o=`${this.apiUrl}/sessions/${e}`,l=i;a&&(l={...l||{},metadata:a});let u={name:t,extra:l,description:r,end_time:n?new Date(n).toISOString():null},c=await this.caller.call((0,s.Yx)(this.debug),o,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await _(c,"update project"),await c.json()}async hasProject({projectId:e,projectName:t}){let r="/sessions",a=new URLSearchParams;if(void 0!==e&&void 0!==t)throw Error("Must provide either projectName or projectId, not both");if(void 0!==e)f(e),r+=`/${e}`;else if(void 0!==t)a.append("name",t);else throw Error("Must provide projectName or projectId");let i=await this.caller.call((0,s.Yx)(this.debug),`${this.apiUrl}${r}?${a}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});try{let e=await i.json();if(!i.ok)return!1;if(Array.isArray(e))return e.length>0;return!0}catch(e){return!1}}async readProject({projectId:e,projectName:t,includeStats:r}){let a,i="/sessions",n=new URLSearchParams;if(void 0!==e&&void 0!==t)throw Error("Must provide either projectName or projectId, not both");if(void 0!==e)f(e),i+=`/${e}`;else if(void 0!==t)n.append("name",t);else throw Error("Must provide projectName or projectId");void 0!==r&&n.append("include_stats",r.toString());let s=await this._get(i,n);if(Array.isArray(s)){if(0===s.length)throw Error(`Project[id=${e}, name=${t}] not found`);a=s[0]}else a=s;return a}async getProjectUrl({projectId:e,projectName:t}){if(void 0===e&&void 0===t)throw Error("Must provide either projectName or projectId");let r=await this.readProject({projectId:e,projectName:t}),a=await this._getTenantId();return`${this.getHostUrl()}/o/${a}/projects/p/${r.id}`}async getDatasetUrl({datasetId:e,datasetName:t}){if(void 0===e&&void 0===t)throw Error("Must provide either datasetName or datasetId");let r=await this.readDataset({datasetId:e,datasetName:t}),a=await this._getTenantId();return`${this.getHostUrl()}/o/${a}/datasets/${r.id}`}async _getTenantId(){if(null!==this._tenantId)return this._tenantId;let e=new URLSearchParams({limit:"1"});for await(let t of this._getPaginated("/sessions",e))return this._tenantId=t[0].tenant_id,t[0].tenant_id;throw Error("No projects found to resolve tenant.")}async *listProjects({projectIds:e,name:t,nameContains:r,referenceDatasetId:a,referenceDatasetName:i,referenceFree:n,metadata:s}={}){let o=new URLSearchParams;if(void 0!==e)for(let t of e)o.append("id",t);if(void 0!==t&&o.append("name",t),void 0!==r&&o.append("name_contains",r),void 0!==a)o.append("reference_dataset",a);else if(void 0!==i){let e=await this.readDataset({datasetName:i});o.append("reference_dataset",e.id)}for await(let e of(void 0!==n&&o.append("reference_free",n.toString()),void 0!==s&&o.append("metadata",JSON.stringify(s)),this._getPaginated("/sessions",o)))yield*e}async deleteProject({projectId:e,projectName:t}){let r;if(void 0===e&&void 0===t)throw Error("Must provide projectName or projectId");if(void 0!==e&&void 0!==t)throw Error("Must provide either projectName or projectId, not both");f(r=void 0===e?(await this.readProject({projectName:t})).id:e);let a=await this.caller.call((0,s.Yx)(this.debug),`${this.apiUrl}/sessions/${r}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await _(a,`delete session ${r} (${t})`,!0)}async uploadCsv({csvFile:e,fileName:t,inputKeys:r,outputKeys:a,description:i,dataType:n,name:o}){let l=`${this.apiUrl}/datasets/upload`,u=new FormData;u.append("file",e,t),r.forEach(e=>{u.append("input_keys",e)}),a.forEach(e=>{u.append("output_keys",e)}),i&&u.append("description",i),n&&u.append("data_type",n),o&&u.append("name",o);let c=await this.caller.call((0,s.Yx)(this.debug),l,{method:"POST",headers:this.headers,body:u,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await _(c,"upload CSV"),await c.json()}async createDataset(e,{description:t,dataType:r,inputsSchema:a,outputsSchema:i,metadata:n}={}){let o={name:e,description:t,extra:n?{metadata:n}:void 0};r&&(o.data_type=r),a&&(o.inputs_schema_definition=a),i&&(o.outputs_schema_definition=i);let l=await this.caller.call((0,s.Yx)(this.debug),`${this.apiUrl}/datasets`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await _(l,"create dataset"),await l.json()}async readDataset({datasetId:e,datasetName:t}){let r,a="/datasets",i=new URLSearchParams({limit:"1"});if(void 0!==e&&void 0!==t)throw Error("Must provide either datasetName or datasetId, not both");if(void 0!==e)f(e),a+=`/${e}`;else if(void 0!==t)i.append("name",t);else throw Error("Must provide datasetName or datasetId");let n=await this._get(a,i);if(Array.isArray(n)){if(0===n.length)throw Error(`Dataset[id=${e}, name=${t}] not found`);r=n[0]}else r=n;return r}async hasDataset({datasetId:e,datasetName:t}){try{return await this.readDataset({datasetId:e,datasetName:t}),!0}catch(e){if(e instanceof Error&&e.message.toLocaleLowerCase().includes("not found"))return!1;throw e}}async diffDatasetVersions({datasetId:e,datasetName:t,fromVersion:r,toVersion:a}){let i=e;if(void 0===i&&void 0===t)throw Error("Must provide either datasetName or datasetId");if(void 0!==i&&void 0!==t)throw Error("Must provide either datasetName or datasetId, not both");void 0===i&&(i=(await this.readDataset({datasetName:t})).id);let n=new URLSearchParams({from_version:"string"==typeof r?r:r.toISOString(),to_version:"string"==typeof a?a:a.toISOString()});return await this._get(`/datasets/${i}/versions/diff`,n)}async readDatasetOpenaiFinetuning({datasetId:e,datasetName:t}){if(void 0!==e);else if(void 0!==t)e=(await this.readDataset({datasetName:t})).id;else throw Error("Must provide either datasetName or datasetId");let r=await this._getResponse(`/datasets/${e}/openai_ft`);return(await r.text()).trim().split("\n").map(e=>JSON.parse(e))}async *listDatasets({limit:e=100,offset:t=0,datasetIds:r,datasetName:a,datasetNameContains:i,metadata:n}={}){let s=new URLSearchParams({limit:e.toString(),offset:t.toString()});if(void 0!==r)for(let e of r)s.append("id",e);for await(let e of(void 0!==a&&s.append("name",a),void 0!==i&&s.append("name_contains",i),void 0!==n&&s.append("metadata",JSON.stringify(n)),this._getPaginated("/datasets",s)))yield*e}async updateDataset(e){let{datasetId:t,datasetName:r,...a}=e;if(!t&&!r)throw Error("Must provide either datasetName or datasetId");let i=t??(await this.readDataset({datasetName:r})).id;f(i);let n=await this.caller.call((0,s.Yx)(this.debug),`${this.apiUrl}/datasets/${i}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await _(n,"update dataset"),await n.json()}async updateDatasetTag(e){let{datasetId:t,datasetName:r,asOf:a,tag:i}=e;if(!t&&!r)throw Error("Must provide either datasetName or datasetId");let n=t??(await this.readDataset({datasetName:r})).id;f(n);let o=await this.caller.call((0,s.Yx)(this.debug),`${this.apiUrl}/datasets/${n}/tags`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify({as_of:"string"==typeof a?a:a.toISOString(),tag:i}),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await _(o,"update dataset tags")}async deleteDataset({datasetId:e,datasetName:t}){let r="/datasets",a=e;if(void 0!==e&&void 0!==t)throw Error("Must provide either datasetName or datasetId, not both");if(void 0!==t&&(a=(await this.readDataset({datasetName:t})).id),void 0!==a)f(a),r+=`/${a}`;else throw Error("Must provide datasetName or datasetId");let i=await this.caller.call((0,s.Yx)(this.debug),this.apiUrl+r,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await _(i,`delete ${r}`),await i.json()}async indexDataset({datasetId:e,datasetName:t,tag:r}){let a=e;if(a||t){if(a&&t)throw Error("Must provide either datasetName or datasetId, not both");a||(a=(await this.readDataset({datasetName:t})).id)}else throw Error("Must provide either datasetName or datasetId");f(a);let i=await this.caller.call((0,s.Yx)(this.debug),`${this.apiUrl}/datasets/${a}/index`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify({tag:r}),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await _(i,"index dataset"),await i.json()}async similarExamples(e,t,r,{filter:a}={}){let i={limit:r,inputs:e};void 0!==a&&(i.filter=a),f(t);let n=await this.caller.call((0,s.Yx)(this.debug),`${this.apiUrl}/datasets/${t}/search`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await _(n,"fetch similar examples"),(await n.json()).examples}async createExample(e,t,r){let i;if(L(e)&&(void 0!==t||void 0!==r))throw Error("Cannot provide outputs or options when using ExampleCreate object");let n=t?r?.datasetId:e.dataset_id,s=t?r?.datasetName:e.dataset_name;if(void 0===n&&void 0===s)throw Error("Must provide either datasetName or datasetId");if(void 0!==n&&void 0!==s)throw Error("Must provide either datasetName or datasetId, not both");void 0===n&&(n=(await this.readDataset({datasetName:s})).id);let o=(t?r?.createdAt:e.created_at)||new Date;i=L(e)?e:{inputs:e,outputs:t,created_at:o?.toISOString(),id:r?.exampleId,metadata:r?.metadata,split:r?.split,source_run_id:r?.sourceRunId,use_source_run_io:r?.useSourceRunIO,use_source_run_attachments:r?.useSourceRunAttachments,attachments:r?.attachments};let l=await this._uploadExamplesMultipart(n,[i]);return await this.readExample(l.example_ids?.[0]??a.A())}async createExamples(e){if(Array.isArray(e)){if(0===e.length)return[];let t=e[0].dataset_id,r=e[0].dataset_name;if(void 0===t&&void 0===r)throw Error("Must provide either datasetName or datasetId");if(void 0!==t&&void 0!==r)throw Error("Must provide either datasetName or datasetId, not both");void 0===t&&(t=(await this.readDataset({datasetName:r})).id);let a=await this._uploadExamplesMultipart(t,e);return await Promise.all(a.example_ids.map(e=>this.readExample(e)))}let{inputs:t,outputs:r,metadata:a,splits:i,sourceRunIds:n,useSourceRunIOs:s,useSourceRunAttachments:o,attachments:l,exampleIds:u,datasetId:c,datasetName:d}=e;if(void 0===t)throw Error("Must provide inputs when using legacy parameters");let h=c;if(void 0===h&&void 0===d)throw Error("Must provide either datasetName or datasetId");if(void 0!==h&&void 0!==d)throw Error("Must provide either datasetName or datasetId, not both");void 0===h&&(h=(await this.readDataset({datasetName:d})).id);let p=t.map((e,t)=>({dataset_id:h,inputs:e,outputs:r?.[t],metadata:a?.[t],split:i?.[t],id:u?.[t],attachments:l?.[t],source_run_id:n?.[t],use_source_run_io:s?.[t],use_source_run_attachments:o?.[t]})),m=await this._uploadExamplesMultipart(h,p);return await Promise.all(m.example_ids.map(e=>this.readExample(e)))}async createLLMExample(e,t,r){return this.createExample({input:e},{output:t},r)}async createChatExample(e,t,r){let a=e.map(e=>c(e)?d(e):e),i=c(t)?d(t):t;return this.createExample({input:a},{output:i},r)}async readExample(e){f(e);let t=`/examples/${e}`,{attachment_urls:r,...a}=await this._get(t);return r&&(a.attachments=Object.entries(r).reduce((e,[t,r])=>(e[t.slice("attachment.".length)]={presigned_url:r.presigned_url,mime_type:r.mime_type},e),{})),a}async *listExamples({datasetId:e,datasetName:t,exampleIds:r,asOf:a,splits:i,inlineS3Urls:n,metadata:s,limit:o,offset:l,filter:u,includeAttachments:c}={}){let d;if(void 0!==e&&void 0!==t)throw Error("Must provide either datasetName or datasetId, not both");if(void 0!==e)d=e;else if(void 0!==t)d=(await this.readDataset({datasetName:t})).id;else throw Error("Must provide a datasetName or datasetId");let h=new URLSearchParams({dataset:d}),p=a?"string"==typeof a?a:a?.toISOString():void 0;if(p&&h.append("as_of",p),h.append("inline_s3_urls",(n??!0).toString()),void 0!==r)for(let e of r)h.append("id",e);if(void 0!==i)for(let e of i)h.append("splits",e);if(void 0!==s){let e=JSON.stringify(s);h.append("metadata",e)}void 0!==o&&h.append("limit",o.toString()),void 0!==l&&h.append("offset",l.toString()),void 0!==u&&h.append("filter",u),!0===c&&["attachment_urls","outputs","metadata"].forEach(e=>h.append("select",e));let m=0;for await(let e of this._getPaginated("/examples",h)){for(let t of e){let{attachment_urls:e,...r}=t;e&&(r.attachments=Object.entries(e).reduce((e,[t,r])=>(e[t.slice("attachment.".length)]={presigned_url:r.presigned_url,mime_type:r.mime_type||void 0},e),{})),yield r,m++}if(void 0!==o&&m>=o)break}}async deleteExample(e){f(e);let t=`/examples/${e}`,r=await this.caller.call((0,s.Yx)(this.debug),this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await _(r,`delete ${t}`),await r.json()}async updateExample(e,t){let r,a,i;return f(r=t?e:e.id),i=void 0!==(a=t?{id:r,...t}:e).dataset_id?a.dataset_id:(await this.readExample(r)).dataset_id,this._updateExamplesMultipart(i,[a])}async updateExamples(e){let t;return t=void 0===e[0].dataset_id?(await this.readExample(e[0].id)).dataset_id:e[0].dataset_id,this._updateExamplesMultipart(t,e)}async readDatasetVersion({datasetId:e,datasetName:t,asOf:r,tag:a}){let i;if(f(i=e||(await this.readDataset({datasetName:t})).id),r&&a||!r&&!a)throw Error("Exactly one of asOf and tag must be specified.");let n=new URLSearchParams;void 0!==r&&n.append("as_of","string"==typeof r?r:r.toISOString()),void 0!==a&&n.append("tag",a);let o=await this.caller.call((0,s.Yx)(this.debug),`${this.apiUrl}/datasets/${i}/version?${n.toString()}`,{method:"GET",headers:{...this.headers},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await _(o,"read dataset version"),await o.json()}async listDatasetSplits({datasetId:e,datasetName:t,asOf:r}){let a;if(void 0===e&&void 0===t)throw Error("Must provide dataset name or ID");if(void 0!==e&&void 0!==t)throw Error("Must provide either datasetName or datasetId, not both");f(a=void 0===e?(await this.readDataset({datasetName:t})).id:e);let i=new URLSearchParams,n=r?"string"==typeof r?r:r?.toISOString():void 0;return n&&i.append("as_of",n),await this._get(`/datasets/${a}/splits`,i)}async updateDatasetSplits({datasetId:e,datasetName:t,splitName:r,exampleIds:a,remove:i=!1}){let n;if(void 0===e&&void 0===t)throw Error("Must provide dataset name or ID");if(void 0!==e&&void 0!==t)throw Error("Must provide either datasetName or datasetId, not both");f(n=void 0===e?(await this.readDataset({datasetName:t})).id:e);let o={split_name:r,examples:a.map(e=>(f(e),e)),remove:i},l=await this.caller.call((0,s.Yx)(this.debug),`${this.apiUrl}/datasets/${n}/splits`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await _(l,"update dataset splits",!0)}async evaluateRun(e,t,{sourceInfo:r,loadChildRuns:a,referenceExample:i}={loadChildRuns:!1}){let n;if((0,g.m)("This method is deprecated and will be removed in future LangSmith versions, use `evaluate` from `langsmith/evaluation` instead."),"string"==typeof e)n=await this.readRun(e,{loadChildRuns:a});else if("object"==typeof e&&"id"in e)n=e;else throw Error(`Invalid run type: ${typeof e}`);null!==n.reference_example_id&&void 0!==n.reference_example_id&&(i=await this.readExample(n.reference_example_id));let s=await t.evaluateRun(n,i),[o,l]=await this._logEvaluationFeedback(s,n,r);return l[0]}async createFeedback(e,t,{score:r,value:i,correction:n,comment:o,sourceInfo:l,feedbackSourceType:u="api",sourceRunId:c,feedbackId:d,feedbackConfig:h,projectId:p,comparativeExperimentId:m}){if(!e&&!p)throw Error("One of runId or projectId must be provided");if(e&&p)throw Error("Only one of runId or projectId can be provided");let g={type:u??"api",metadata:l??{}};void 0===c||g?.metadata===void 0||g.metadata.__run||(g.metadata.__run={run_id:c}),g?.metadata!==void 0&&g.metadata.__run?.run_id!==void 0&&f(g.metadata.__run.run_id);let y={id:d??a.A(),run_id:e,key:t,score:$(r),value:i,correction:n,comment:o,feedback_source:g,comparative_experiment_id:m,feedbackConfig:h,session_id:p},b=`${this.apiUrl}/feedback`,v=await this.caller.call((0,s.Yx)(this.debug),b,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(y),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await _(v,"create feedback",!0),y}async updateFeedback(e,{score:t,value:r,correction:a,comment:i}){let n={};null!=t&&(n.score=$(t)),null!=r&&(n.value=r),null!=a&&(n.correction=a),null!=i&&(n.comment=i),f(e);let o=await this.caller.call((0,s.Yx)(this.debug),`${this.apiUrl}/feedback/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(n),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await _(o,"update feedback",!0)}async readFeedback(e){f(e);let t=`/feedback/${e}`;return await this._get(t)}async deleteFeedback(e){f(e);let t=`/feedback/${e}`,r=await this.caller.call((0,s.Yx)(this.debug),this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await _(r,`delete ${t}`),await r.json()}async *listFeedback({runIds:e,feedbackKeys:t,feedbackSourceTypes:r}={}){let a=new URLSearchParams;if(e&&a.append("run",e.join(",")),t)for(let e of t)a.append("key",e);if(r)for(let e of r)a.append("source",e);for await(let e of this._getPaginated("/feedback",a))yield*e}async createPresignedFeedbackToken(e,t,{expiration:r,feedbackConfig:a}={}){let i={run_id:e,feedback_key:t,feedback_config:a};r?"string"==typeof r?i.expires_at=r:(r?.hours||r?.minutes||r?.days)&&(i.expires_in=r):i.expires_in={hours:3};let n=await this.caller.call((0,s.Yx)(this.debug),`${this.apiUrl}/feedback/tokens`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await n.json()}async createComparativeExperiment({name:e,experimentIds:t,referenceDatasetId:r,createdAt:a,description:i,metadata:n,id:o}){if(0===t.length)throw Error("At least one experiment is required");if(r||(r=(await this.readProject({projectId:t[0]})).reference_dataset_id),null==!r)throw Error("A reference dataset is required");let l={id:o,name:e,experiment_ids:t,reference_dataset_id:r,description:i,created_at:(a??new Date)?.toISOString(),extra:{}};n&&(l.extra.metadata=n);let u=await this.caller.call((0,s.Yx)(this.debug),`${this.apiUrl}/datasets/comparative`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await u.json()}async *listPresignedFeedbackTokens(e){f(e);let t=new URLSearchParams({run_id:e});for await(let e of this._getPaginated("/feedback/tokens",t))yield*e}_selectEvalResults(e){let t;return"results"in e?e.results:Array.isArray(e)?e:[e]}async _logEvaluationFeedback(e,t,r){let a=this._selectEvalResults(e),i=[];for(let e of a){let a=r||{};e.evaluatorInfo&&(a={...e.evaluatorInfo,...a});let n=null;e.targetRunId?n=e.targetRunId:t&&(n=t.id),i.push(await this.createFeedback(n,e.key,{score:e.score,value:e.value,comment:e.comment,correction:e.correction,sourceInfo:a,sourceRunId:e.sourceRunId,feedbackConfig:e.feedbackConfig,feedbackSourceType:"model"}))}return[a,i]}async logEvaluationFeedback(e,t,r){let[a]=await this._logEvaluationFeedback(e,t,r);return a}async *listAnnotationQueues(e={}){let{queueIds:t,name:r,nameContains:a,limit:i}=e,n=new URLSearchParams;t&&t.forEach((e,t)=>{f(e,`queueIds[${t}]`),n.append("ids",e)}),r&&n.append("name",r),a&&n.append("name_contains",a),n.append("limit",(void 0!==i?Math.min(i,100):100).toString());let s=0;for await(let e of this._getPaginated("/annotation-queues",n))if(yield*e,s++,void 0!==i&&s>=i)break}async createAnnotationQueue(e){let{name:t,description:r,queueId:i,rubricInstructions:n}=e,o={name:t,description:r,id:i||a.A(),rubric_instructions:n},l=await this.caller.call((0,s.Yx)(this.debug),`${this.apiUrl}/annotation-queues`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(Object.fromEntries(Object.entries(o).filter(([e,t])=>void 0!==t))),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await _(l,"create annotation queue"),await l.json()}async readAnnotationQueue(e){let t=await this.caller.call((0,s.Yx)(this.debug),`${this.apiUrl}/annotation-queues/${f(e,"queueId")}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await _(t,"read annotation queue"),await t.json()}async updateAnnotationQueue(e,t){let{name:r,description:a,rubricInstructions:i}=t,n=await this.caller.call((0,s.Yx)(this.debug),`${this.apiUrl}/annotation-queues/${f(e,"queueId")}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify({name:r,description:a,rubric_instructions:i}),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await _(n,"update annotation queue")}async deleteAnnotationQueue(e){let t=await this.caller.call((0,s.Yx)(this.debug),`${this.apiUrl}/annotation-queues/${f(e,"queueId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await _(t,"delete annotation queue")}async addRunsToAnnotationQueue(e,t){let r=await this.caller.call((0,s.Yx)(this.debug),`${this.apiUrl}/annotation-queues/${f(e,"queueId")}/runs`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(t.map((e,t)=>f(e,`runIds[${t}]`).toString())),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await _(r,"add runs to annotation queue")}async getRunFromAnnotationQueue(e,t){let r=`/annotation-queues/${f(e,"queueId")}/run`,a=await this.caller.call((0,s.Yx)(this.debug),`${this.apiUrl}${r}/${t}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await _(a,"get run from annotation queue"),await a.json()}async deleteRunFromAnnotationQueue(e,t){let r=await this.caller.call((0,s.Yx)(this.debug),`${this.apiUrl}/annotation-queues/${f(e,"queueId")}/runs/${f(t,"queueRunId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await _(r,"delete run from annotation queue")}async getSizeFromAnnotationQueue(e){let t=await this.caller.call((0,s.Yx)(this.debug),`${this.apiUrl}/annotation-queues/${f(e,"queueId")}/size`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await _(t,"get size from annotation queue"),await t.json()}async _currentTenantIsOwner(e){let t=await this._getSettings();return"-"==e||t.tenant_handle===e}async _ownerConflictError(e,t){let r=await this._getSettings();return Error(`Cannot ${e} for another tenant.

      Current tenant: ${r.tenant_handle}

      Requested tenant: ${t}`)}async _getLatestCommitHash(e){let t=await this.caller.call((0,s.Yx)(this.debug),`${this.apiUrl}/commits/${e}/?limit=1&offset=0`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),r=await t.json();if(!t.ok){let e="string"==typeof r.detail?r.detail:JSON.stringify(r.detail),a=Error(`Error ${t.status}: ${t.statusText}
${e}`);throw a.statusCode=t.status,a}if(0!==r.commits.length)return r.commits[0].commit_hash}async _likeOrUnlikePrompt(e,t){let[r,a,i]=y(e),n=await this.caller.call((0,s.Yx)(this.debug),`${this.apiUrl}/likes/${r}/${a}`,{method:"POST",body:JSON.stringify({like:t}),headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await _(n,`${t?"like":"unlike"} prompt`),await n.json()}async _getPromptUrl(e){let[t,r,a]=y(e);if(await this._currentTenantIsOwner(t)){let e=await this._getSettings();return"latest"!==a?`${this.getHostUrl()}/prompts/${r}/${a.substring(0,8)}?organizationId=${e.id}`:`${this.getHostUrl()}/prompts/${r}?organizationId=${e.id}`}return"latest"!==a?`${this.getHostUrl()}/hub/${t}/${r}/${a.substring(0,8)}`:`${this.getHostUrl()}/hub/${t}/${r}`}async promptExists(e){return!!await this.getPrompt(e)}async likePrompt(e){return this._likeOrUnlikePrompt(e,!0)}async unlikePrompt(e){return this._likeOrUnlikePrompt(e,!1)}async *listCommits(e){for await(let t of this._getPaginated(`/commits/${e}/`,new URLSearchParams,e=>e.commits))yield*t}async *listPrompts(e){let t=new URLSearchParams;for await(let r of(t.append("sort_field",e?.sortField??"updated_at"),t.append("sort_direction","desc"),t.append("is_archived",(!!e?.isArchived).toString()),e?.isPublic!==void 0&&t.append("is_public",e.isPublic.toString()),e?.query&&t.append("query",e.query),this._getPaginated("/repos",t,e=>e.repos)))yield*r}async getPrompt(e){let[t,r,a]=y(e),i=await this.caller.call((0,s.Yx)(this.debug),`${this.apiUrl}/repos/${t}/${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(404===i.status)return null;await _(i,"get prompt");let n=await i.json();return n.repo?n.repo:null}async createPrompt(e,t){let r=await this._getSettings();if(t?.isPublic&&!r.tenant_handle)throw Error(`Cannot create a public prompt without first

        creating a LangChain Hub handle. 
        You can add a handle by creating a public prompt at:

        https://smith.langchain.com/prompts`);let[a,i,n]=y(e);if(!await this._currentTenantIsOwner(a))throw await this._ownerConflictError("create a prompt",a);let o={repo_handle:i,...t?.description&&{description:t.description},...t?.readme&&{readme:t.readme},...t?.tags&&{tags:t.tags},is_public:!!t?.isPublic},l=await this.caller.call((0,s.Yx)(this.debug),`${this.apiUrl}/repos/`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await _(l,"create prompt");let{repo:u}=await l.json();return u}async createCommit(e,t,r){if(!await this.promptExists(e))throw Error("Prompt does not exist, you must create it first.");let[a,i,n]=y(e),o=r?.parentCommitHash!=="latest"&&r?.parentCommitHash?r?.parentCommitHash:await this._getLatestCommitHash(`${a}/${i}`),l={manifest:JSON.parse(JSON.stringify(t)),parent_commit:o},u=await this.caller.call((0,s.Yx)(this.debug),`${this.apiUrl}/commits/${a}/${i}`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await _(u,"create commit");let c=await u.json();return this._getPromptUrl(`${a}/${i}${c.commit_hash?`:${c.commit_hash}`:""}`)}async updateExamplesMultipart(e,t=[]){return this._updateExamplesMultipart(e,t)}async _updateExamplesMultipart(e,t=[]){if(!await this._getMultiPartSupport())throw Error("Your LangSmith deployment does not allow using the multipart examples endpoint, please upgrade your deployment to the latest version.");let r=new FormData;for(let e of t){let t=e.id,a=new Blob([E({...e.metadata&&{metadata:e.metadata},...e.split&&{split:e.split}},`Serializing body for example with id: ${t}`)],{type:"application/json"});if(r.append(t,a),e.inputs){let a=new Blob([E(e.inputs,`Serializing inputs for example with id: ${t}`)],{type:"application/json"});r.append(`${t}.inputs`,a)}if(e.outputs){let a=new Blob([E(e.outputs,`Serializing outputs whle updating example with id: ${t}`)],{type:"application/json"});r.append(`${t}.outputs`,a)}if(e.attachments)for(let[a,i]of Object.entries(e.attachments)){let e,n;Array.isArray(i)?[e,n]=i:(e=i.mimeType,n=i.data);let s=new Blob([n],{type:`${e}; length=${n.byteLength}`});r.append(`${t}.attachment.${a}`,s)}if(e.attachments_operations){let a=new Blob([E(e.attachments_operations,`Serializing attachments while updating example with id: ${t}`)],{type:"application/json"});r.append(`${t}.attachments_operations`,a)}}let a=e??t[0]?.dataset_id,i=await this.caller.call((0,s.Yx)(this.debug),`${this.apiUrl}/v1/platform/datasets/${a}/examples`,{method:"PATCH",headers:this.headers,body:r});return await i.json()}async uploadExamplesMultipart(e,t=[]){return this._uploadExamplesMultipart(e,t)}async _uploadExamplesMultipart(e,t=[]){if(!await this._getMultiPartSupport())throw Error("Your LangSmith deployment does not allow using the multipart examples endpoint, please upgrade your deployment to the latest version.");let r=new FormData;for(let e of t){let t=(e.id??a.A()).toString(),i=new Blob([E({created_at:e.created_at,...e.metadata&&{metadata:e.metadata},...e.split&&{split:e.split},...e.source_run_id&&{source_run_id:e.source_run_id},...e.use_source_run_io&&{use_source_run_io:e.use_source_run_io},...e.use_source_run_attachments&&{use_source_run_attachments:e.use_source_run_attachments}},`Serializing body for uploaded example with id: ${t}`)],{type:"application/json"});if(r.append(t,i),e.inputs){let a=new Blob([E(e.inputs,`Serializing inputs for uploaded example with id: ${t}`)],{type:"application/json"});r.append(`${t}.inputs`,a)}if(e.outputs){let a=new Blob([E(e.outputs,`Serializing outputs for uploaded example with id: ${t}`)],{type:"application/json"});r.append(`${t}.outputs`,a)}if(e.attachments)for(let[a,i]of Object.entries(e.attachments)){let e,n;Array.isArray(i)?[e,n]=i:(e=i.mimeType,n=i.data);let s=new Blob([n],{type:`${e}; length=${n.byteLength}`});r.append(`${t}.attachment.${a}`,s)}}let i=await this.caller.call((0,s.Yx)(this.debug),`${this.apiUrl}/v1/platform/datasets/${e}/examples`,{method:"POST",headers:this.headers,body:r});return await _(i,"upload examples"),await i.json()}async updatePrompt(e,t){if(!await this.promptExists(e))throw Error("Prompt does not exist, you must create it first.");let[r,a]=y(e);if(!await this._currentTenantIsOwner(r))throw await this._ownerConflictError("update a prompt",r);let i={};if(t?.description!==void 0&&(i.description=t.description),t?.readme!==void 0&&(i.readme=t.readme),t?.tags!==void 0&&(i.tags=t.tags),t?.isPublic!==void 0&&(i.is_public=t.isPublic),t?.isArchived!==void 0&&(i.is_archived=t.isArchived),0===Object.keys(i).length)throw Error("No valid update options provided");let n=await this.caller.call((0,s.Yx)(this.debug),`${this.apiUrl}/repos/${r}/${a}`,{method:"PATCH",body:JSON.stringify(i),headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await _(n,"update prompt"),n.json()}async deletePrompt(e){if(!await this.promptExists(e))throw Error("Prompt does not exist, you must create it first.");let[t,r,a]=y(e);if(!await this._currentTenantIsOwner(t))throw await this._ownerConflictError("delete a prompt",t);let i=await this.caller.call((0,s.Yx)(this.debug),`${this.apiUrl}/repos/${t}/${r}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await i.json()}async pullPromptCommit(e,t){let[r,a,i]=y(e),n=await this.caller.call((0,s.Yx)(this.debug),`${this.apiUrl}/commits/${r}/${a}/${i}${t?.includeModel?"?include_model=true":""}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await _(n,"pull prompt commit");let o=await n.json();return{owner:r,repo:a,commit_hash:o.commit_hash,manifest:o.manifest,examples:o.examples}}async _pullPrompt(e,t){return JSON.stringify((await this.pullPromptCommit(e,{includeModel:t?.includeModel})).manifest)}async pushPrompt(e,t){return(await this.promptExists(e)?t&&Object.keys(t).some(e=>"object"!==e)&&await this.updatePrompt(e,{description:t?.description,readme:t?.readme,tags:t?.tags,isPublic:t?.isPublic}):await this.createPrompt(e,{description:t?.description,readme:t?.readme,tags:t?.tags,isPublic:t?.isPublic}),t?.object)?await this.createCommit(e,t?.object,{parentCommitHash:t?.parentCommitHash}):await this._getPromptUrl(e)}async clonePublicDataset(e,t={}){let{sourceApiUrl:r=this.apiUrl,datasetName:a}=t,[i,n]=this.parseTokenOrUrl(e,r),s=new C({apiUrl:i,apiKey:"placeholder"}),o=await s.readSharedDataset(n),l=a||o.name;try{if(await this.hasDataset({datasetId:l})){console.log(`Dataset ${l} already exists in your tenant. Skipping.`);return}}catch(e){}let u=await s.listSharedExamples(n),c=await this.createDataset(l,{description:o.description,dataType:o.data_type||"kv",inputsSchema:o.inputs_schema_definition??void 0,outputsSchema:o.outputs_schema_definition??void 0});try{await this.createExamples({inputs:u.map(e=>e.inputs),outputs:u.flatMap(e=>e.outputs?[e.outputs]:[]),datasetId:c.id})}catch(e){throw console.error(`An error occurred while creating dataset ${l}. You should delete it manually.`),e}}parseTokenOrUrl(e,t,r=2,a="dataset"){try{return f(e),[t,e]}catch(e){}try{let i=new URL(e).pathname.split("/").filter(e=>""!==e);if(i.length>=r){let e=i[i.length-r];return[t,e]}throw Error(`Invalid public ${a} URL: ${e}`)}catch(t){throw Error(`Invalid public ${a} URL or token: ${e}`)}}awaitPendingTraceBatches(){return this.manualFlushMode?(console.warn("[WARNING]: When tracing in manual flush mode, you must call `await client.flush()` manually to submit trace batches."),Promise.resolve()):Promise.all([...this.autoBatchQueue.items.map(({itemPromise:e})=>e),this.batchIngestCaller.queue.onIdle()])}}function L(e){return"dataset_id"in e||"dataset_name"in e}},26076:(e,t,r)=>{"use strict";let a=r(36053),i=r(42870),n=r(28973);e.exports=(e,t)=>{e=new i(e,t);let r=new a("0.0.0");if(e.test(r)||(r=new a("0.0.0-0"),e.test(r)))return r;r=null;for(let t=0;t<e.set.length;++t){let i=e.set[t],s=null;i.forEach(e=>{let t=new a(e.semver.version);switch(e.operator){case">":0===t.prerelease.length?t.patch++:t.prerelease.push(0),t.raw=t.format();case"":case">=":(!s||n(t,s))&&(s=t);break;case"<":case"<=":break;default:throw Error(`Unexpected operation: ${e.operator}`)}}),s&&(!r||n(r,s))&&(r=s)}return r&&e.test(r)?r:null}},27123:(e,t,r)=>{"use strict";r.d(t,{k:()=>s});var a=r(87150),i=r(99643),n=r(92173);class s extends i.YN{static lc_name(){return"RunnablePassthrough"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e&&(this.func=e.func)}async invoke(e,t){let r=(0,n.ZI)(t);return this.func&&await this.func(e,r),this._callWithConfig(e=>Promise.resolve(e),e,r)}async *transform(e,t){let r;let i=(0,n.ZI)(t),s=!0;for await(let t of this._transformStreamWithConfig(e,e=>e,i))if(yield t,s){if(void 0===r)r=t;else try{r=(0,a.xW)(r,t)}catch{r=void 0,s=!1}}this.func&&void 0!==r&&await this.func(r,i)}static assign(e){return new i.B2(new i.ck({steps:e}))}}},27231:(e,t,r)=>{"use strict";r.d(t,{dr:()=>s,fK:()=>i,p1:()=>o,uf:()=>n});var a=r(64520);function i(e){return null!=e&&"object"==typeof e&&"lc_direct_tool_output"in e&&!0===e.lc_direct_tool_output}class n extends a.XQ{static lc_name(){return"ToolMessage"}get lc_aliases(){return{tool_call_id:"tool_call_id"}}constructor(e,t,r){"string"==typeof e&&(e={content:e,name:r,tool_call_id:t}),super(e),Object.defineProperty(this,"lc_direct_tool_output",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"artifact",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id,this.artifact=e.artifact,this.status=e.status}_getType(){return"tool"}static isInstance(e){return"tool"===e._getType()}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}}class s extends a.gj{constructor(e){super(e),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"artifact",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id,this.artifact=e.artifact,this.status=e.status}static lc_name(){return"ToolMessageChunk"}_getType(){return"tool"}concat(e){return new s({content:(0,a._I)(this.content,e.content),additional_kwargs:(0,a.ns)(this.additional_kwargs,e.additional_kwargs),response_metadata:(0,a.ns)(this.response_metadata,e.response_metadata),artifact:(0,a.F7)(this.artifact,e.artifact),tool_call_id:this.tool_call_id,id:this.id??e.id,status:(0,a.Iv)(this.status,e.status)})}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}}function o(e){let t=[],r=[];for(let a of e)if(a.function){let e=a.function.name;try{let r=JSON.parse(a.function.arguments),i={name:e||"",args:r||{},id:a.id};t.push(i)}catch(t){r.push({name:e,args:a.function.arguments,id:a.id,error:"Malformed args."})}}return[t,r]}},28809:(e,t,r)=>{"use strict";function a(e){return!!(e&&"object"==typeof e&&"type"in e&&"tool_call"===e.type)}function i(e){return!!(e&&"object"==typeof e&&"toolCall"in e&&null!=e.toolCall&&"object"==typeof e.toolCall&&"id"in e.toolCall&&"string"==typeof e.toolCall.id)}r.d(t,{Ky:()=>a,hR:()=>i,qe:()=>n});class n extends Error{constructor(e,t){super(e),Object.defineProperty(this,"output",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.output=t}}},28973:(e,t,r)=>{"use strict";let a=r(88193);e.exports=(e,t,r)=>a(e,t,r)>0},29200:e=>{function t(e,t){"boolean"==typeof t&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}e.exports=t,t.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},t.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},t.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var t=new Date().getTime();if(e&&t-this._operationStart>=this._maxRetryTime)return this._errors.push(e),this._errors.unshift(Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var r=this._timeouts.shift();if(void 0===r){if(!this._cachedTimeouts)return!1;this._errors.splice(0,this._errors.length-1),r=this._cachedTimeouts.slice(-1)}var a=this;return this._timer=setTimeout(function(){a._attempts++,a._operationTimeoutCb&&(a._timeout=setTimeout(function(){a._operationTimeoutCb(a._attempts)},a._operationTimeout),a._options.unref&&a._timeout.unref()),a._fn(a._attempts)},r),this._options.unref&&this._timer.unref(),!0},t.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var r=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){r._operationTimeoutCb()},r._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)},t.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},t.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},t.prototype.start=t.prototype.try,t.prototype.errors=function(){return this._errors},t.prototype.attempts=function(){return this._attempts},t.prototype.mainError=function(){if(0===this._errors.length)return null;for(var e={},t=null,r=0,a=0;a<this._errors.length;a++){var i=this._errors[a],n=i.message,s=(e[n]||0)+1;e[n]=s,s>=r&&(t=i,r=s)}return t}},29555:(e,t,r)=>{"use strict";let a=r(36053);e.exports=(e,t)=>new a(e,t).major},30986:(e,t,r)=>{"use strict";e=r.nmd(e);let a=(e=0)=>t=>`\u001B[${38+e};5;${t}m`,i=(e=0)=>(t,r,a)=>`\u001B[${38+e};2;${t};${r};${a}m`;Object.defineProperty(e,"exports",{enumerable:!0,get:function(){let e=new Map,t={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};for(let[r,a]of(t.color.gray=t.color.blackBright,t.bgColor.bgGray=t.bgColor.bgBlackBright,t.color.grey=t.color.blackBright,t.bgColor.bgGrey=t.bgColor.bgBlackBright,Object.entries(t))){for(let[r,i]of Object.entries(a))t[r]={open:`\u001B[${i[0]}m`,close:`\u001B[${i[1]}m`},a[r]=t[r],e.set(i[0],i[1]);Object.defineProperty(t,r,{value:a,enumerable:!1})}return Object.defineProperty(t,"codes",{value:e,enumerable:!1}),t.color.close="\x1b[39m",t.bgColor.close="\x1b[49m",t.color.ansi256=a(),t.color.ansi16m=i(),t.bgColor.ansi256=a(10),t.bgColor.ansi16m=i(10),Object.defineProperties(t,{rgbToAnsi256:{value:(e,t,r)=>e===t&&t===r?e<8?16:e>248?231:Math.round((e-8)/247*24)+232:16+36*Math.round(e/255*5)+6*Math.round(t/255*5)+Math.round(r/255*5),enumerable:!1},hexToRgb:{value:e=>{let t=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(e.toString(16));if(!t)return[0,0,0];let{colorString:r}=t.groups;3===r.length&&(r=r.split("").map(e=>e+e).join(""));let a=Number.parseInt(r,16);return[a>>16&255,a>>8&255,255&a]},enumerable:!1},hexToAnsi256:{value:e=>t.rgbToAnsi256(...t.hexToRgb(e)),enumerable:!1}}),t}})},31107:(e,t,r)=>{"use strict";let a=r(42870);e.exports=(e,t)=>{try{return new a(e,t).range||"*"}catch(e){return null}}},31432:(e,t,r)=>{"use strict";let a=r(89377);e.exports=(e,t)=>{let r=a(e,t);return r?r.version:null}},32002:e=>{"use strict";let t=Object.freeze({loose:!0}),r=Object.freeze({});e.exports=e=>e?"object"!=typeof e?t:e:r},32227:(e,t,r)=>{"use strict";let a=r(36053),i=r(89377),{safeRe:n,t:s}=r(56655);e.exports=(e,t)=>{if(e instanceof a)return e;if("number"==typeof e&&(e=String(e)),"string"!=typeof e)return null;let r=null;if((t=t||{}).rtl){let a;let i=t.includePrerelease?n[s.COERCERTLFULL]:n[s.COERCERTL];for(;(a=i.exec(e))&&(!r||r.index+r[0].length!==e.length);)r&&a.index+a[0].length===r.index+r[0].length||(r=a),i.lastIndex=a.index+a[1].length+a[2].length;i.lastIndex=-1}else r=e.match(t.includePrerelease?n[s.COERCEFULL]:n[s.COERCE]);if(null===r)return null;let o=r[2],l=r[3]||"0",u=r[4]||"0",c=t.includePrerelease&&r[5]?`-${r[5]}`:"",d=t.includePrerelease&&r[6]?`+${r[6]}`:"";return i(`${o}.${l}.${u}${c}${d}`,t)}},32417:(e,t,r)=>{"use strict";r.d(t,{k:()=>n});for(var a=[],i=0;i<256;++i)a.push((i+256).toString(16).slice(1));function n(e,t=0){return(a[e[t+0]]+a[e[t+1]]+a[e[t+2]]+a[e[t+3]]+"-"+a[e[t+4]]+a[e[t+5]]+"-"+a[e[t+6]]+a[e[t+7]]+"-"+a[e[t+8]]+a[e[t+9]]+"-"+a[e[t+10]]+a[e[t+11]]+a[e[t+12]]+a[e[t+13]]+a[e[t+14]]+a[e[t+15]]).toLowerCase()}},32463:(e,t,r)=>{"use strict";let a=r(36053);e.exports=(e,t)=>new a(e,t).minor},34290:(e,t,r)=>{"use strict";let a=r(36053),i=r(50113),{ANY:n}=i,s=r(42870),o=r(43879),l=r(28973),u=r(23906),c=r(34817),d=r(98344);e.exports=(e,t,r,h)=>{let p,m,f,g,y;switch(e=new a(e,h),t=new s(t,h),r){case">":p=l,m=c,f=u,g=">",y=">=";break;case"<":p=u,m=d,f=l,g="<",y="<=";break;default:throw TypeError('Must provide a hilo val of "<" or ">"')}if(o(e,t,h))return!1;for(let r=0;r<t.set.length;++r){let a=t.set[r],s=null,o=null;if(a.forEach(e=>{e.semver===n&&(e=new i(">=0.0.0")),s=s||e,o=o||e,p(e.semver,s.semver,h)?s=e:f(e.semver,o.semver,h)&&(o=e)}),s.operator===g||s.operator===y||(!o.operator||o.operator===g)&&m(e,o.semver)||o.operator===y&&f(e,o.semver))return!1}return!0}},34399:(e,t,r)=>{"use strict";let a,i,n,s,o,l,u,c,d,h,p;function m(e,t,r){function a(r,a){var i;for(let n in Object.defineProperty(r,"_zod",{value:r._zod??{},enumerable:!1}),(i=r._zod).traits??(i.traits=new Set),r._zod.traits.add(e),t(r,a),s.prototype)Object.defineProperty(r,n,{value:s.prototype[n].bind(r)});r._zod.constr=s,r._zod.def=a}let i=r?.Parent??Object;class n extends i{}function s(e){var t;let i=r?.Parent?new n:this;for(let r of(a(i,e),(t=i._zod).deferred??(t.deferred=[]),i._zod.deferred))r();return i}return Object.defineProperty(n,"name",{value:e}),Object.defineProperty(s,"init",{value:a}),Object.defineProperty(s,Symbol.hasInstance,{value:t=>!!r?.Parent&&t instanceof r.Parent||t?._zod?.traits?.has(e)}),Object.defineProperty(s,"name",{value:e}),s}r.d(t,{Db:()=>sO}),Symbol("zod_brand");class f extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}let g={};function y(e,t){return"bigint"==typeof t?t.toString():t}function b(e){return"string"==typeof e?e:e?.message}Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,Number.MAX_VALUE,Number.MAX_VALUE;let _=(e,t)=>{e.name="$ZodError",Object.defineProperty(e,"_zod",{value:e._zod,enumerable:!1}),Object.defineProperty(e,"issues",{value:t,enumerable:!1}),Object.defineProperty(e,"message",{get:()=>JSON.stringify(t,y,2),enumerable:!0})},v=(m("$ZodError",_),m("$ZodError",_,{Parent:Error})),w=(e,t,r,a)=>{let i=r?Object.assign(r,{async:!1}):{async:!1},n=e._zod.run({value:t,issues:[]},i);if(n instanceof Promise)throw new f;if(n.issues.length){let e=new(a?.Err??v)(n.issues.map(e=>(function(e,t,r){let a={...e,path:e.path??[]};return e.message||(a.message=b(e.inst?._zod.def?.error?.(e))??b(t?.error?.(e))??b(r.customError?.(e))??b(r.localeError?.(e))??"Invalid input"),delete a.inst,delete a.continue,t?.reportInput||delete a.input,a})(e,i,function(e){return g}())));throw Error.captureStackTrace(e,a?.callee),e}return n.value},O=e=>e?RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${e}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000)$/;O(4),O(6),O(7),RegExp(`(${/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/.source})|(${/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})$/.source})`);RegExp("^((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))$");let I={string:{unit:"",verb:" "},file:{unit:"",verb:" "},array:{unit:"",verb:" "},set:{unit:"",verb:" "}},k=e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"number";case"object":if(Array.isArray(e))return"array";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t},E={regex:"",email:" ",url:"",emoji:"",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"   ISO",date:"  ISO",time:"  ISO",duration:"  ISO",ipv4:" IPv4",ipv6:" IPv6",cidrv4:"   IPv4",cidrv6:"   IPv6",base64:"  base64-encoded",base64url:"  base64url-encoded",json_string:"   JSON",e164:"   E.164",jwt:"JWT",template_literal:""},x={string:{unit:"simvol",verb:"olmaldr"},file:{unit:"bayt",verb:"olmaldr"},array:{unit:"element",verb:"olmaldr"},set:{unit:"element",verb:"olmaldr"}},S=e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"number";case"object":if(Array.isArray(e))return"array";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t},P={regex:"input",email:"email address",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO datetime",date:"ISO date",time:"ISO time",duration:"ISO duration",ipv4:"IPv4 address",ipv6:"IPv6 address",cidrv4:"IPv4 range",cidrv6:"IPv6 range",base64:"base64-encoded string",base64url:"base64url-encoded string",json_string:"JSON string",e164:"E.164 number",jwt:"JWT",template_literal:"input"};function A(e,t,r,a){let i=Math.abs(e),n=i%10,s=i%100;return s>=11&&s<=19?a:1===n?t:n>=2&&n<=4?r:a}let T={string:{unit:{one:"",few:"",many:""},verb:""},array:{unit:{one:"",few:"",many:""},verb:""},set:{unit:{one:"",few:"",many:""},verb:""},file:{unit:{one:"",few:"",many:""},verb:""}},j=e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"";case"object":if(Array.isArray(e))return"";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t},N={regex:"",email:"email ",url:"URL",emoji:"",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO   ",date:"ISO ",time:"ISO ",duration:"ISO ",ipv4:"IPv4 ",ipv6:"IPv6 ",cidrv4:"IPv4 ",cidrv6:"IPv6 ",base64:"   base64",base64url:"   base64url",json_string:"JSON ",e164:" E.164",jwt:"JWT",template_literal:""},$={string:{unit:"car\xe0cters",verb:"contenir"},file:{unit:"bytes",verb:"contenir"},array:{unit:"elements",verb:"contenir"},set:{unit:"elements",verb:"contenir"}},R=e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"number";case"object":if(Array.isArray(e))return"array";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t},C={regex:"entrada",email:"adre\xe7a electr\xf2nica",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"data i hora ISO",date:"data ISO",time:"hora ISO",duration:"durada ISO",ipv4:"adre\xe7a IPv4",ipv6:"adre\xe7a IPv6",cidrv4:"rang IPv4",cidrv6:"rang IPv6",base64:"cadena codificada en base64",base64url:"cadena codificada en base64url",json_string:"cadena JSON",e164:"n\xfamero E.164",jwt:"JWT",template_literal:"entrada"},L={string:{unit:"znak",verb:"m\xedt"},file:{unit:"bajt",verb:"m\xedt"},array:{unit:"prvk",verb:"m\xedt"},set:{unit:"prvk",verb:"m\xedt"}},U=e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"\xedslo";case"string":return"etzec";case"boolean":return"boolean";case"bigint":return"bigint";case"function":return"funkce";case"symbol":return"symbol";case"undefined":return"undefined";case"object":if(Array.isArray(e))return"pole";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t},M={regex:"regul\xe1rn\xed v\xfdraz",email:"e-mailov\xe1 adresa",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"datum a as ve form\xe1tu ISO",date:"datum ve form\xe1tu ISO",time:"as ve form\xe1tu ISO",duration:"doba trv\xe1n\xed ISO",ipv4:"IPv4 adresa",ipv6:"IPv6 adresa",cidrv4:"rozsah IPv4",cidrv6:"rozsah IPv6",base64:"etzec zak\xf3dovan\xfd ve form\xe1tu base64",base64url:"etzec zak\xf3dovan\xfd ve form\xe1tu base64url",json_string:"etzec ve form\xe1tu JSON",e164:"\xedslo E.164",jwt:"JWT",template_literal:"vstup"},D={string:{unit:"Zeichen",verb:"zu haben"},file:{unit:"Bytes",verb:"zu haben"},array:{unit:"Elemente",verb:"zu haben"},set:{unit:"Elemente",verb:"zu haben"}},F=e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"Zahl";case"object":if(Array.isArray(e))return"Array";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t},z={regex:"Eingabe",email:"E-Mail-Adresse",url:"URL",emoji:"Emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO-Datum und -Uhrzeit",date:"ISO-Datum",time:"ISO-Uhrzeit",duration:"ISO-Dauer",ipv4:"IPv4-Adresse",ipv6:"IPv6-Adresse",cidrv4:"IPv4-Bereich",cidrv6:"IPv6-Bereich",base64:"Base64-codierter String",base64url:"Base64-URL-codierter String",json_string:"JSON-String",e164:"E.164-Nummer",jwt:"JWT",template_literal:"Eingabe"},B={string:{unit:"characters",verb:"to have"},file:{unit:"bytes",verb:"to have"},array:{unit:"items",verb:"to have"},set:{unit:"items",verb:"to have"}},Z=e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"number";case"object":if(Array.isArray(e))return"array";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t},J={regex:"input",email:"email address",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO datetime",date:"ISO date",time:"ISO time",duration:"ISO duration",ipv4:"IPv4 address",ipv6:"IPv6 address",cidrv4:"IPv4 range",cidrv6:"IPv6 range",base64:"base64-encoded string",base64url:"base64url-encoded string",json_string:"JSON string",e164:"E.164 number",jwt:"JWT",template_literal:"input"},q={string:{unit:"caracteres",verb:"tener"},file:{unit:"bytes",verb:"tener"},array:{unit:"elementos",verb:"tener"},set:{unit:"elementos",verb:"tener"}},G=e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"n\xfamero";case"object":if(Array.isArray(e))return"arreglo";if(null===e)return"nulo";if(Object.getPrototypeOf(e)!==Object.prototype)return e.constructor.name}return t},W={regex:"entrada",email:"direcci\xf3n de correo electr\xf3nico",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"fecha y hora ISO",date:"fecha ISO",time:"hora ISO",duration:"duraci\xf3n ISO",ipv4:"direcci\xf3n IPv4",ipv6:"direcci\xf3n IPv6",cidrv4:"rango IPv4",cidrv6:"rango IPv6",base64:"cadena codificada en base64",base64url:"URL codificada en base64",json_string:"cadena JSON",e164:"n\xfamero E.164",jwt:"JWT",template_literal:"entrada"},H={string:{unit:"",verb:" "},file:{unit:"",verb:" "},array:{unit:"",verb:" "},set:{unit:"",verb:" "}},Y=e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"";case"object":if(Array.isArray(e))return"";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t},V={regex:"",email:" ",url:"URL",emoji:"",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"   ",date:" ",time:" ",duration:"  ",ipv4:"IPv4 ",ipv6:"IPv6 ",cidrv4:"IPv4 ",cidrv6:"IPv6 ",base64:"base64-encoded ",base64url:"base64url-encoded ",json_string:"JSON ",e164:"E.164 ",jwt:"JWT",template_literal:""},K={string:{unit:"merkki\xe4",subject:"merkkijonon"},file:{unit:"tavua",subject:"tiedoston"},array:{unit:"alkiota",subject:"listan"},set:{unit:"alkiota",subject:"joukon"},number:{unit:"",subject:"luvun"},bigint:{unit:"",subject:"suuren kokonaisluvun"},int:{unit:"",subject:"kokonaisluvun"},date:{unit:"",subject:"p\xe4iv\xe4m\xe4\xe4r\xe4n"}},X=e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"number";case"object":if(Array.isArray(e))return"array";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t},Q={regex:"s\xe4\xe4nn\xf6llinen lauseke",email:"s\xe4hk\xf6postiosoite",url:"URL-osoite",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO-aikaleima",date:"ISO-p\xe4iv\xe4m\xe4\xe4r\xe4",time:"ISO-aika",duration:"ISO-kesto",ipv4:"IPv4-osoite",ipv6:"IPv6-osoite",cidrv4:"IPv4-alue",cidrv6:"IPv6-alue",base64:"base64-koodattu merkkijono",base64url:"base64url-koodattu merkkijono",json_string:"JSON-merkkijono",e164:"E.164-luku",jwt:"JWT",template_literal:"templaattimerkkijono"},ee={string:{unit:"caract\xe8res",verb:"avoir"},file:{unit:"octets",verb:"avoir"},array:{unit:"\xe9l\xe9ments",verb:"avoir"},set:{unit:"\xe9l\xe9ments",verb:"avoir"}},et=e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"nombre";case"object":if(Array.isArray(e))return"tableau";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t},er={regex:"entr\xe9e",email:"adresse e-mail",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"date et heure ISO",date:"date ISO",time:"heure ISO",duration:"dur\xe9e ISO",ipv4:"adresse IPv4",ipv6:"adresse IPv6",cidrv4:"plage IPv4",cidrv6:"plage IPv6",base64:"cha\xeene encod\xe9e en base64",base64url:"cha\xeene encod\xe9e en base64url",json_string:"cha\xeene JSON",e164:"num\xe9ro E.164",jwt:"JWT",template_literal:"entr\xe9e"},ea={string:{unit:"caract\xe8res",verb:"avoir"},file:{unit:"octets",verb:"avoir"},array:{unit:"\xe9l\xe9ments",verb:"avoir"},set:{unit:"\xe9l\xe9ments",verb:"avoir"}},ei=e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"number";case"object":if(Array.isArray(e))return"array";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t},en={regex:"entr\xe9e",email:"adresse courriel",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"date-heure ISO",date:"date ISO",time:"heure ISO",duration:"dur\xe9e ISO",ipv4:"adresse IPv4",ipv6:"adresse IPv6",cidrv4:"plage IPv4",cidrv6:"plage IPv6",base64:"cha\xeene encod\xe9e en base64",base64url:"cha\xeene encod\xe9e en base64url",json_string:"cha\xeene JSON",e164:"num\xe9ro E.164",jwt:"JWT",template_literal:"entr\xe9e"},es={string:{unit:"",verb:""},file:{unit:"",verb:""},array:{unit:"",verb:""},set:{unit:"",verb:""}},eo=e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"number";case"object":if(Array.isArray(e))return"array";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t},el={regex:"",email:" ",url:" ",emoji:"'",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"  ISO",date:" ISO",time:" ISO",duration:"  ISO",ipv4:" IPv4",ipv6:" IPv6",cidrv4:" IPv4",cidrv6:" IPv6",base64:"  64",base64url:"  64  ",json_string:" JSON",e164:" E.164",jwt:"JWT",template_literal:""},eu={string:{unit:"karakter",verb:"legyen"},file:{unit:"byte",verb:"legyen"},array:{unit:"elem",verb:"legyen"},set:{unit:"elem",verb:"legyen"}},ec=e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"sz\xe1m";case"object":if(Array.isArray(e))return"t\xf6mb";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t},ed={regex:"bemenet",email:"email c\xedm",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO idb\xe9lyeg",date:"ISO d\xe1tum",time:"ISO id",duration:"ISO idintervallum",ipv4:"IPv4 c\xedm",ipv6:"IPv6 c\xedm",cidrv4:"IPv4 tartom\xe1ny",cidrv6:"IPv6 tartom\xe1ny",base64:"base64-k\xf3dolt string",base64url:"base64url-k\xf3dolt string",json_string:"JSON string",e164:"E.164 sz\xe1m",jwt:"JWT",template_literal:"bemenet"},eh={string:{unit:"karakter",verb:"memiliki"},file:{unit:"byte",verb:"memiliki"},array:{unit:"item",verb:"memiliki"},set:{unit:"item",verb:"memiliki"}},ep=e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"number";case"object":if(Array.isArray(e))return"array";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t},em={regex:"input",email:"alamat email",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"tanggal dan waktu format ISO",date:"tanggal format ISO",time:"jam format ISO",duration:"durasi format ISO",ipv4:"alamat IPv4",ipv6:"alamat IPv6",cidrv4:"rentang alamat IPv4",cidrv6:"rentang alamat IPv6",base64:"string dengan enkode base64",base64url:"string dengan enkode base64url",json_string:"string JSON",e164:"angka E.164",jwt:"JWT",template_literal:"input"},ef={string:{unit:"caratteri",verb:"avere"},file:{unit:"byte",verb:"avere"},array:{unit:"elementi",verb:"avere"},set:{unit:"elementi",verb:"avere"}},eg=e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"numero";case"object":if(Array.isArray(e))return"vettore";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t},ey={regex:"input",email:"indirizzo email",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"data e ora ISO",date:"data ISO",time:"ora ISO",duration:"durata ISO",ipv4:"indirizzo IPv4",ipv6:"indirizzo IPv6",cidrv4:"intervallo IPv4",cidrv6:"intervallo IPv6",base64:"stringa codificata in base64",base64url:"URL codificata in base64",json_string:"stringa JSON",e164:"numero E.164",jwt:"JWT",template_literal:"input"},eb={string:{unit:"",verb:""},file:{unit:"",verb:""},array:{unit:"",verb:""},set:{unit:"",verb:""}},e_=e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"";case"object":if(Array.isArray(e))return"";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t},ev={regex:"",email:"",url:"URL",emoji:"",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO",date:"ISO",time:"ISO",duration:"ISO",ipv4:"IPv4",ipv6:"IPv6",cidrv4:"IPv4",cidrv6:"IPv6",base64:"base64",base64url:"base64url",json_string:"JSON",e164:"E.164",jwt:"JWT",template_literal:""},ew={string:{unit:"",verb:"to have"},file:{unit:"",verb:"to have"},array:{unit:"",verb:"to have"},set:{unit:"",verb:"to have"}},eO=e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"number";case"object":if(Array.isArray(e))return"array";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t},eI={regex:"",email:" ",url:"URL",emoji:"",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO ",date:"ISO ",time:"ISO ",duration:"ISO ",ipv4:"IPv4 ",ipv6:"IPv6 ",cidrv4:"IPv4 ",cidrv6:"IPv6 ",base64:"base64  ",base64url:"base64url  ",json_string:"JSON ",e164:"E.164 ",jwt:"JWT",template_literal:""},ek={string:{unit:"",verb:" "},file:{unit:"",verb:" "},array:{unit:"",verb:" "},set:{unit:"",verb:" "}},eE=e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"";case"object":if(Array.isArray(e))return"";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t},ex={regex:"",email:"  -",url:"URL",emoji:"",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO   ",date:"ISO ",time:"ISO ",duration:"ISO ",ipv4:"IPv4 ",ipv6:"IPv6 ",cidrv4:"IPv4 ",cidrv6:"IPv6 ",base64:"base64- ",base64url:"base64url- ",json_string:"JSON ",e164:"E.164 ",jwt:"JWT",template_literal:""},eS={string:{unit:"aksara",verb:"mempunyai"},file:{unit:"bait",verb:"mempunyai"},array:{unit:"elemen",verb:"mempunyai"},set:{unit:"elemen",verb:"mempunyai"}},eP=e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"nombor";case"object":if(Array.isArray(e))return"array";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t},eA={regex:"input",email:"alamat e-mel",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"tarikh masa ISO",date:"tarikh ISO",time:"masa ISO",duration:"tempoh ISO",ipv4:"alamat IPv4",ipv6:"alamat IPv6",cidrv4:"julat IPv4",cidrv6:"julat IPv6",base64:"string dikodkan base64",base64url:"string dikodkan base64url",json_string:"string JSON",e164:"nombor E.164",jwt:"JWT",template_literal:"input"},eT={string:{unit:"tegn",verb:"\xe5 ha"},file:{unit:"bytes",verb:"\xe5 ha"},array:{unit:"elementer",verb:"\xe5 inneholde"},set:{unit:"elementer",verb:"\xe5 inneholde"}},ej=e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"tall";case"object":if(Array.isArray(e))return"liste";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t},eN={regex:"input",email:"e-postadresse",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO dato- og klokkeslett",date:"ISO-dato",time:"ISO-klokkeslett",duration:"ISO-varighet",ipv4:"IPv4-omr\xe5de",ipv6:"IPv6-omr\xe5de",cidrv4:"IPv4-spekter",cidrv6:"IPv6-spekter",base64:"base64-enkodet streng",base64url:"base64url-enkodet streng",json_string:"JSON-streng",e164:"E.164-nummer",jwt:"JWT",template_literal:"input"},e$={string:{unit:"harf",verb:"olmaldr"},file:{unit:"bayt",verb:"olmaldr"},array:{unit:"unsur",verb:"olmaldr"},set:{unit:"unsur",verb:"olmaldr"}},eR=e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"numara";case"object":if(Array.isArray(e))return"saf";if(null===e)return"gayb";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t},eC={regex:"giren",email:"epostag\xe2h",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO heng\xe2m",date:"ISO tarihi",time:"ISO zaman",duration:"ISO m\xfcddeti",ipv4:"IPv4 ni\xe2n",ipv6:"IPv6 ni\xe2n",cidrv4:"IPv4 menzili",cidrv6:"IPv6 menzili",base64:"base64-ifreli metin",base64url:"base64url-ifreli metin",json_string:"JSON metin",e164:"E.164 says",jwt:"JWT",template_literal:"giren"},eL={string:{unit:"znak\xf3w",verb:"mie"},file:{unit:"bajt\xf3w",verb:"mie"},array:{unit:"element\xf3w",verb:"mie"},set:{unit:"element\xf3w",verb:"mie"}},eU=e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"liczba";case"object":if(Array.isArray(e))return"tablica";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t},eM={regex:"wyraenie",email:"adres email",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"data i godzina w formacie ISO",date:"data w formacie ISO",time:"godzina w formacie ISO",duration:"czas trwania ISO",ipv4:"adres IPv4",ipv6:"adres IPv6",cidrv4:"zakres IPv4",cidrv6:"zakres IPv6",base64:"cig znak\xf3w zakodowany w formacie base64",base64url:"cig znak\xf3w zakodowany w formacie base64url",json_string:"cig znak\xf3w w formacie JSON",e164:"liczba E.164",jwt:"JWT",template_literal:"wejcie"},eD={string:{unit:"caracteres",verb:"ter"},file:{unit:"bytes",verb:"ter"},array:{unit:"itens",verb:"ter"},set:{unit:"itens",verb:"ter"}},eF=e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"n\xfamero";case"object":if(Array.isArray(e))return"array";if(null===e)return"nulo";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t},ez={regex:"padr\xe3o",email:"endere\xe7o de e-mail",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"data e hora ISO",date:"data ISO",time:"hora ISO",duration:"dura\xe7\xe3o ISO",ipv4:"endere\xe7o IPv4",ipv6:"endere\xe7o IPv6",cidrv4:"faixa de IPv4",cidrv6:"faixa de IPv6",base64:"texto codificado em base64",base64url:"URL codificada em base64",json_string:"texto JSON",e164:"n\xfamero E.164",jwt:"JWT",template_literal:"entrada"};function eB(e,t,r,a){let i=Math.abs(e),n=i%10,s=i%100;return s>=11&&s<=19?a:1===n?t:n>=2&&n<=4?r:a}let eZ={string:{unit:{one:"",few:"",many:""},verb:""},file:{unit:{one:"",few:"",many:""},verb:""},array:{unit:{one:"",few:"",many:""},verb:""},set:{unit:{one:"",few:"",many:""},verb:""}},eJ=e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"";case"object":if(Array.isArray(e))return"";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t},eq={regex:"",email:"email ",url:"URL",emoji:"",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO   ",date:"ISO ",time:"ISO ",duration:"ISO ",ipv4:"IPv4 ",ipv6:"IPv6 ",cidrv4:"IPv4 ",cidrv6:"IPv6 ",base64:"   base64",base64url:"   base64url",json_string:"JSON ",e164:" E.164",jwt:"JWT",template_literal:""},eG={string:{unit:"znakov",verb:"imeti"},file:{unit:"bajtov",verb:"imeti"},array:{unit:"elementov",verb:"imeti"},set:{unit:"elementov",verb:"imeti"}},eW=e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"tevilo";case"object":if(Array.isArray(e))return"tabela";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t},eH={regex:"vnos",email:"e-potni naslov",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO datum in as",date:"ISO datum",time:"ISO as",duration:"ISO trajanje",ipv4:"IPv4 naslov",ipv6:"IPv6 naslov",cidrv4:"obseg IPv4",cidrv6:"obseg IPv6",base64:"base64 kodiran niz",base64url:"base64url kodiran niz",json_string:"JSON niz",e164:"E.164 tevilka",jwt:"JWT",template_literal:"vnos"},eY={string:{unit:"",verb:" "},file:{unit:"",verb:" "},array:{unit:"",verb:" "},set:{unit:"",verb:" "}},eV=e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?" ":"";case"object":if(Array.isArray(e))return"";if(null===e)return"";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t},eK={regex:"",email:" ",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO  ",date:"ISO ",time:"ISO ",duration:"ISO  ",ipv4:"IPv4 ",ipv6:"IPv6 ",cidrv4:"IPv4 ",cidrv6:"IPv6 ",base64:"base64-encoded ",base64url:"base64url-encoded ",json_string:"JSON ",e164:"E.164 ",jwt:"JWT",template_literal:"input"},eX={string:{unit:"",verb:""},file:{unit:"",verb:""},array:{unit:"",verb:""},set:{unit:"",verb:""}},eQ=e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?" (NaN)":"";case"object":if(Array.isArray(e))return" (Array)";if(null===e)return" (null)";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t},e0={regex:"",email:"",url:"URL",emoji:"",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:" ISO",date:" ISO",time:" ISO",duration:" ISO",ipv4:" IPv4",ipv6:" IPv6",cidrv4:" IP  IPv4",cidrv6:" IP  IPv6",base64:" Base64",base64url:" Base64  URL",json_string:" JSON",e164:" (E.164)",jwt:" JWT",template_literal:""},e1={string:{unit:"karakter",verb:"olmal"},file:{unit:"bayt",verb:"olmal"},array:{unit:"\xf6e",verb:"olmal"},set:{unit:"\xf6e",verb:"olmal"}},e4=e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"number";case"object":if(Array.isArray(e))return"array";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t},e2={regex:"girdi",email:"e-posta adresi",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO tarih ve saat",date:"ISO tarih",time:"ISO saat",duration:"ISO s\xfcre",ipv4:"IPv4 adresi",ipv6:"IPv6 adresi",cidrv4:"IPv4 aral",cidrv6:"IPv6 aral",base64:"base64 ile ifrelenmi metin",base64url:"base64url ile ifrelenmi metin",json_string:"JSON dizesi",e164:"E.164 says",jwt:"JWT",template_literal:"ablon dizesi"},e6={string:{unit:"",verb:""},file:{unit:"",verb:""},array:{unit:"",verb:""},set:{unit:"",verb:""}},e9=e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"";case"object":if(Array.isArray(e))return"";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t},e3={regex:" ",email:"  ",url:"URL",emoji:"",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"   ISO",date:" ISO",time:" ISO",duration:" ISO",ipv4:" IPv4",ipv6:" IPv6",cidrv4:" IPv4",cidrv6:" IPv6",base64:"   base64",base64url:"   base64url",json_string:" JSON",e164:" E.164",jwt:"JWT",template_literal:" "},e5={string:{unit:"",verb:""},file:{unit:"",verb:""},array:{unit:"",verb:""},set:{unit:"",verb:""}},e8=e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"";case"object":if(Array.isArray(e))return"";if(null===e)return"";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t},e7={regex:" ",email:"  ",url:"  ",emoji:"",uuid:"   ",uuidv4:"     4",uuidv6:"     6",nanoid:"  ",guid:"   ",cuid:"   ",cuid2:"    2",ulid:"   ",xid:"  ",ksuid:"    ",datetime:"    ",date:"   ",time:"   ",duration:"   ",ipv4:"   4 ",ipv6:"   6 ",cidrv4:"   4 ",cidrv6:"   6 ",base64:" 64   ",base64url:" 64      ",json_string:"    ",e164:" 164 ",jwt:"  ",template_literal:" "},te={string:{unit:"k\xfd t",verb:"c\xf3"},file:{unit:"byte",verb:"c\xf3"},array:{unit:"phn t",verb:"c\xf3"},set:{unit:"phn t",verb:"c\xf3"}},tt=e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"s";case"object":if(Array.isArray(e))return"mng";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t},tr={regex:"u v\xe0o",email:"a ch email",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ng\xe0y gi ISO",date:"ng\xe0y ISO",time:"gi ISO",duration:"khong thi gian ISO",ipv4:"a ch IPv4",ipv6:"a ch IPv6",cidrv4:"di IPv4",cidrv6:"di IPv6",base64:"chui m\xe3 h\xf3a base64",base64url:"chui m\xe3 h\xf3a base64url",json_string:"chui JSON",e164:"s E.164",jwt:"JWT",template_literal:"u v\xe0o"},ta={string:{unit:"",verb:""},file:{unit:"",verb:""},array:{unit:"",verb:""},set:{unit:"",verb:""}},ti=e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"(NaN)":"";case"object":if(Array.isArray(e))return"";if(null===e)return"(null)";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t},tn={regex:"",email:"",url:"URL",emoji:"",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO",date:"ISO",time:"ISO",duration:"ISO",ipv4:"IPv4",ipv6:"IPv6",cidrv4:"IPv4",cidrv6:"IPv6",base64:"base64",base64url:"base64url",json_string:"JSON",e164:"E.164",jwt:"JWT",template_literal:""},ts={string:{unit:"",verb:""},file:{unit:"",verb:""},array:{unit:"",verb:""},set:{unit:"",verb:""}},to=e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"number";case"object":if(Array.isArray(e))return"array";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t},tl={regex:"",email:"",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO ",date:"ISO ",time:"ISO ",duration:"ISO ",ipv4:"IPv4 ",ipv6:"IPv6 ",cidrv4:"IPv4 ",cidrv6:"IPv6 ",base64:"base64 ",base64url:"base64url ",json_string:"JSON ",e164:"E.164 ",jwt:"JWT",template_literal:""};Symbol("ZodOutput"),Symbol("ZodInput");class tu{constructor(){this._map=new WeakMap,this._idmap=new Map}add(e,...t){let r=t[0];if(this._map.set(e,r),r&&"object"==typeof r&&"id"in r){if(this._idmap.has(r.id))throw Error(`ID ${r.id} already exists in the registry`);this._idmap.set(r.id,e)}return this}remove(e){return this._map.delete(e),this}get(e){let t=e._zod.parent;if(t){let r={...this.get(t)??{}};return delete r.id,{...r,...this._map.get(e)}}return this._map.get(e)}has(e){return this._map.has(e)}}let tc=new tu;class td{constructor(e){this._def=e,this.def=e}implement(e){if("function"!=typeof e)throw Error("implement() must be called with a function");let t=(...r)=>{let a=this._def.input?parse(this._def.input,r,void 0,{callee:t}):r;if(!Array.isArray(a))throw Error("Invalid arguments schema: not an array or tuple schema.");let i=e(...a);return this._def.output?parse(this._def.output,i,void 0,{callee:t}):i};return t}implementAsync(e){if("function"!=typeof e)throw Error("implement() must be called with a function");let t=async(...r)=>{let a=this._def.input?await parseAsync(this._def.input,r,void 0,{callee:t}):r;if(!Array.isArray(a))throw Error("Invalid arguments schema: not an array or tuple schema.");let i=await e(...a);return this._def.output?parseAsync(this._def.output,i,void 0,{callee:t}):i};return t}input(...e){return new td(Array.isArray(e[0])?{type:"function",input:new $ZodTuple({type:"tuple",items:e[0],rest:e[1]}),output:this._def.output}:{type:"function",input:e[0],output:this._def.output})}output(e){return new td({type:"function",input:this._def.input,output:e})}}let th={guid:"uuid",url:"uri",datetime:"date-time",json_string:"json-string",regex:""};class tp{constructor(e){this.counter=0,this.metadataRegistry=e?.metadata??tc,this.target=e?.target??"draft-2020-12",this.unrepresentable=e?.unrepresentable??"throw",this.override=e?.override??(()=>{}),this.io=e?.io??"output",this.seen=new Map}process(e,t={path:[],schemaPath:[]}){var r;let a=e._zod.def,i=this.seen.get(e);if(i)return i.count++,t.schemaPath.includes(e)&&(i.cycle=t.path),i.count++,i.schema;let n={schema:{},count:1,cycle:void 0};this.seen.set(e,n),e._zod.toJSONSchema&&(n.schema=e._zod.toJSONSchema());let s={...t,schemaPath:[...t.schemaPath,e],path:t.path},o=e._zod.parent;if(o)n.ref=o,this.process(o,s),this.seen.get(o).isParent=!0;else{let t=n.schema;switch(a.type){case"string":{t.type="string";let{minimum:r,maximum:a,format:i,patterns:s,contentEncoding:o}=e._zod.bag;if("number"==typeof r&&(t.minLength=r),"number"==typeof a&&(t.maxLength=a),i&&(t.format=th[i]??i,""===t.format&&delete t.format),o&&(t.contentEncoding=o),s&&s.size>0){let e=[...s];1===e.length?t.pattern=e[0].source:e.length>1&&(n.schema.allOf=[...e.map(e=>({..."draft-7"===this.target?{type:"string"}:{},pattern:e.source}))])}break}case"number":{let{minimum:r,maximum:a,format:i,multipleOf:n,exclusiveMaximum:s,exclusiveMinimum:o}=e._zod.bag;"string"==typeof i&&i.includes("int")?t.type="integer":t.type="number","number"==typeof o&&(t.exclusiveMinimum=o),"number"==typeof r&&(t.minimum=r,"number"==typeof o&&(o>=r?delete t.minimum:delete t.exclusiveMinimum)),"number"==typeof s&&(t.exclusiveMaximum=s),"number"==typeof a&&(t.maximum=a,"number"==typeof s&&(s<=a?delete t.maximum:delete t.exclusiveMaximum)),"number"==typeof n&&(t.multipleOf=n);break}case"boolean":case"success":t.type="boolean";break;case"bigint":if("throw"===this.unrepresentable)throw Error("BigInt cannot be represented in JSON Schema");break;case"symbol":if("throw"===this.unrepresentable)throw Error("Symbols cannot be represented in JSON Schema");break;case"undefined":case"null":t.type="null";break;case"any":case"unknown":break;case"never":t.not={};break;case"void":if("throw"===this.unrepresentable)throw Error("Void cannot be represented in JSON Schema");break;case"date":if("throw"===this.unrepresentable)throw Error("Date cannot be represented in JSON Schema");break;case"array":{let{minimum:r,maximum:i}=e._zod.bag;"number"==typeof r&&(t.minItems=r),"number"==typeof i&&(t.maxItems=i),t.type="array",t.items=this.process(a.element,{...s,path:[...s.path,"items"]});break}case"object":{t.type="object",t.properties={};let e=a.shape;for(let r in e)t.properties[r]=this.process(e[r],{...s,path:[...s.path,"properties",r]});t.required=Array.from(new Set([...new Set(Object.keys(e))].filter(e=>{let t=a.shape[e]._zod;return"input"===this.io?void 0===t.optin:void 0===t.optout}))),a.catchall?._zod.def.type==="never"?t.additionalProperties=!1:a.catchall?a.catchall&&(t.additionalProperties=this.process(a.catchall,{...s,path:[...s.path,"additionalProperties"]})):"output"===this.io&&(t.additionalProperties=!1);break}case"union":t.anyOf=a.options.map((e,t)=>this.process(e,{...s,path:[...s.path,"anyOf",t]}));break;case"intersection":t.allOf=[this.process(a.left,{...s,path:[...s.path,"allOf",0]}),this.process(a.right,{...s,path:[...s.path,"allOf",1]})];break;case"tuple":{t.type="array";let r=a.items.map((e,t)=>this.process(e,{...s,path:[...s.path,"prefixItems",t]}));if("draft-2020-12"===this.target?t.prefixItems=r:t.items=r,a.rest){let e=this.process(a.rest,{...s,path:[...s.path,"items"]});"draft-2020-12"===this.target?t.items=e:t.additionalItems=e}a.rest&&(t.items=this.process(a.rest,{...s,path:[...s.path,"items"]}));let{minimum:i,maximum:n}=e._zod.bag;"number"==typeof i&&(t.minItems=i),"number"==typeof n&&(t.maxItems=n);break}case"record":t.type="object",t.propertyNames=this.process(a.keyType,{...s,path:[...s.path,"propertyNames"]}),t.additionalProperties=this.process(a.valueType,{...s,path:[...s.path,"additionalProperties"]});break;case"map":if("throw"===this.unrepresentable)throw Error("Map cannot be represented in JSON Schema");break;case"set":if("throw"===this.unrepresentable)throw Error("Set cannot be represented in JSON Schema");break;case"enum":t.enum=Object.values(a.entries);break;case"literal":{let e=[];for(let t of a.values)if(void 0===t){if("throw"===this.unrepresentable)throw Error("Literal `undefined` cannot be represented in JSON Schema")}else if("bigint"==typeof t){if("throw"===this.unrepresentable)throw Error("BigInt literals cannot be represented in JSON Schema");e.push(Number(t))}else e.push(t);0===e.length||(1===e.length?t.const=e[0]:t.enum=e);break}case"file":if("throw"===this.unrepresentable)throw Error("File cannot be represented in JSON Schema");break;case"transform":if("throw"===this.unrepresentable)throw Error("Transforms cannot be represented in JSON Schema");break;case"nullable":t.anyOf=[this.process(a.innerType,s),{type:"null"}];break;case"nonoptional":case"promise":case"optional":this.process(a.innerType,s),n.ref=a.innerType;break;case"default":this.process(a.innerType,s),n.ref=a.innerType,t.default=a.defaultValue;break;case"prefault":this.process(a.innerType,s),n.ref=a.innerType,"input"===this.io&&(t._prefault=a.defaultValue);break;case"catch":{let e;this.process(a.innerType,s),n.ref=a.innerType;try{e=a.catchValue(void 0)}catch{throw Error("Dynamic catch values are not supported in JSON Schema")}t.default=e;break}case"nan":if("throw"===this.unrepresentable)throw Error("NaN cannot be represented in JSON Schema");break;case"template_literal":{let r=e._zod.pattern;if(!r)throw Error("Pattern not found in template literal");t.type="string",t.pattern=r.source;break}case"pipe":{let e="input"===this.io?a.in:a.out;this.process(e,s),n.ref=e;break}case"readonly":this.process(a.innerType,s),n.ref=a.innerType,t.readOnly=!0;break;case"lazy":{let t=e._zod.innerType;this.process(t,s),n.ref=t;break}case"custom":if("throw"===this.unrepresentable)throw Error("Custom types cannot be represented in JSON Schema")}}let l=this.metadataRegistry.get(e);return l&&Object.assign(n.schema,l),"input"===this.io&&"pipe"===a.type&&(delete n.schema.examples,delete n.schema.default,n.schema._prefault&&(n.schema.default=n.schema._prefault)),"input"===this.io&&n.schema._prefault&&((r=n.schema).default??(r.default=n.schema._prefault)),delete n.schema._prefault,this.seen.get(e).schema}emit(e,t){let r={cycles:t?.cycles??"ref",reused:t?.reused??"inline",external:t?.external??void 0},a=this.seen.get(e);if(!a)throw Error("Unprocessed schema. This is a bug in Zod.");let i=e=>{let t="draft-2020-12"===this.target?"$defs":"definitions";if(r.external){let a=r.external.registry.get(e[0])?.id;if(a)return{ref:r.external.uri(a)};let i=e[1].defId??e[1].schema.id??`schema${this.counter++}`;return e[1].defId=i,{defId:i,ref:`${r.external.uri("__shared")}#/${t}/${i}`}}if(e[1]===a)return{ref:"#"};let i=`#/${t}/`,n=e[1].schema.id??`__schema${this.counter++}`;return{defId:n,ref:i+n}},n=e=>{if(e[1].schema.$ref)return;let t=e[1],{ref:r,defId:a}=i(e);t.def={...t.schema},a&&(t.defId=a);let n=t.schema;for(let e in n)delete n[e],n.$ref=r};for(let t of this.seen.entries()){let a=t[1];if(e===t[0]){n(t);continue}if(r.external){let a=r.external.registry.get(t[0])?.id;if(e!==t[0]&&a){n(t);continue}}if(this.metadataRegistry.get(t[0])?.id){n(t);continue}if(a.cycle){if("throw"===r.cycles)throw Error(`Cycle detected: #/${a.cycle?.join("/")}/<root>

Set the \`cycles\` parameter to \`"ref"\` to resolve cyclical schemas with defs.`);"ref"===r.cycles&&n(t);continue}if(a.count>1&&"ref"===r.reused){n(t);continue}}let s=(e,t)=>{let r=this.seen.get(e),a=r.def??r.schema,i={...a};if(null===r.ref)return;let n=r.ref;if(r.ref=null,n){s(n,t);let e=this.seen.get(n).schema;e.$ref&&"draft-7"===t.target?(a.allOf=a.allOf??[],a.allOf.push(e)):(Object.assign(a,e),Object.assign(a,i))}r.isParent||this.override({zodSchema:e,jsonSchema:a})};for(let e of[...this.seen.entries()].reverse())s(e[0],{target:this.target});let o={};"draft-2020-12"===this.target?o.$schema="https://json-schema.org/draft/2020-12/schema":"draft-7"===this.target?o.$schema="http://json-schema.org/draft-07/schema#":console.warn(`Invalid target: ${this.target}`),Object.assign(o,a.def);let l=r.external?.defs??{};for(let e of this.seen.entries()){let t=e[1];t.def&&t.defId&&(l[t.defId]=t.def)}!r.external&&Object.keys(l).length>0&&("draft-2020-12"===this.target?o.$defs=l:o.definitions=l);try{return JSON.parse(JSON.stringify(o))}catch(e){throw Error("Error converting schema to JSON.")}}}let tm="RFC3986",tf={RFC1738:e=>String(e).replace(/%20/g,"+"),RFC3986:e=>String(e)},tg=(Object.prototype.hasOwnProperty,Array.isArray),ty=(()=>{let e=[];for(let t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e})();function tb(e,t){if(tg(e)){let r=[];for(let a=0;a<e.length;a+=1)r.push(t(e[a]));return r}return t(e)}let t_=Object.prototype.hasOwnProperty,tv={brackets:e=>String(e)+"[]",comma:"comma",indices:(e,t)=>String(e)+"["+t+"]",repeat:e=>String(e)},tw=Array.isArray,tO=Array.prototype.push,tI=function(e,t){tO.apply(e,tw(t)?t:[t])},tk=Date.prototype.toISOString,tE={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:(e,t,r,a,i)=>{if(0===e.length)return e;let n=e;if("symbol"==typeof e?n=Symbol.prototype.toString.call(e):"string"!=typeof e&&(n=String(e)),"iso-8859-1"===r)return escape(n).replace(/%u[0-9a-f]{4}/gi,function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"});let s="";for(let e=0;e<n.length;e+=1024){let t=n.length>=1024?n.slice(e,e+1024):n,r=[];for(let e=0;e<t.length;++e){let a=t.charCodeAt(e);if(45===a||46===a||95===a||126===a||a>=48&&a<=57||a>=65&&a<=90||a>=97&&a<=122||"RFC1738"===i&&(40===a||41===a)){r[r.length]=t.charAt(e);continue}if(a<128){r[r.length]=ty[a];continue}if(a<2048){r[r.length]=ty[192|a>>6]+ty[128|63&a];continue}if(a<55296||a>=57344){r[r.length]=ty[224|a>>12]+ty[128|a>>6&63]+ty[128|63&a];continue}e+=1,a=65536+((1023&a)<<10|1023&t.charCodeAt(e)),r[r.length]=ty[240|a>>18]+ty[128|a>>12&63]+ty[128|a>>6&63]+ty[128|63&a]}s+=r.join("")}return s},encodeValuesOnly:!1,format:tm,formatter:tf[tm],indices:!1,serializeDate:e=>tk.call(e),skipNulls:!1,strictNullHandling:!1},tx={},tS="4.104.0",tP=!1;class tA{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}}let tT=()=>{n||function(e,t={auto:!1}){if(tP)throw Error(`you must \`import 'openai/shims/${e.kind}'\` before importing anything else from openai`);if(n)throw Error(`can't \`import 'openai/shims/${e.kind}'\` after \`import 'openai/shims/${n}'\``);tP=t.auto,n=e.kind,s=e.fetch,e.Request,e.Response,e.Headers,o=e.FormData,e.Blob,l=e.File,u=e.ReadableStream,c=e.getMultipartRequestOptions,d=e.getDefaultAgent,h=e.fileFromPath,p=e.isFsReadStream}(function({manuallyImported:e}={}){let t,r,a,i;let n=e?"You may need to use polyfills":`Add one of these imports before your first \`import  from 'openai'\`:
- \`import 'openai/shims/node'\` (if you're running on Node)
- \`import 'openai/shims/web'\` (otherwise)
`;try{t=fetch,r=Request,a=Response,i=Headers}catch(e){throw Error(`this environment is missing the following Web Fetch API type: ${e.message}. ${n}`)}return{kind:"web",fetch:t,Request:r,Response:a,Headers:i,FormData:"undefined"!=typeof FormData?FormData:class{constructor(){throw Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${n}`)}},Blob:"undefined"!=typeof Blob?Blob:class{constructor(){throw Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${n}`)}},File:"undefined"!=typeof File?File:class{constructor(){throw Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${n}`)}},ReadableStream:"undefined"!=typeof ReadableStream?ReadableStream:class{constructor(){throw Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${n}`)}},getMultipartRequestOptions:async(e,t)=>({...t,body:new tA(e)}),getDefaultAgent:e=>void 0,fileFromPath:()=>{throw Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:e=>!1}}(),{auto:!0})};tT();class tj extends Error{}class tN extends tj{constructor(e,t,r,a){super(`${tN.makeMessage(e,t,r)}`),this.status=e,this.headers=a,this.request_id=a?.["x-request-id"],this.error=t,this.code=t?.code,this.param=t?.param,this.type=t?.type}static makeMessage(e,t,r){let a=t?.message?"string"==typeof t.message?t.message:JSON.stringify(t.message):t?JSON.stringify(t):r;return e&&a?`${e} ${a}`:e?`${e} status code (no body)`:a||"(no status code or body)"}static generate(e,t,r,a){if(!e||!a)return new tR({message:r,cause:aP(t)});let i=t?.error;return 400===e?new tL(e,i,r,a):401===e?new tU(e,i,r,a):403===e?new tM(e,i,r,a):404===e?new tD(e,i,r,a):409===e?new tF(e,i,r,a):422===e?new tz(e,i,r,a):429===e?new tB(e,i,r,a):e>=500?new tZ(e,i,r,a):new tN(e,i,r,a)}}class t$ extends tN{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class tR extends tN{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class tC extends tR{constructor({message:e}={}){super({message:e??"Request timed out."})}}class tL extends tN{}class tU extends tN{}class tM extends tN{}class tD extends tN{}class tF extends tN{}class tz extends tN{}class tB extends tN{}class tZ extends tN{}class tJ extends tj{constructor(){super("Could not parse response content as the length limit was reached")}}class tq extends tj{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}var tG,tW,tH,tY,tV,tK,tX,tQ,t0,t1,t4,t2,t6,t9,t3,t5,t8,t7,re,rt,rr,ra,ri,rn,rs,ro,rl,ru,rc,rd,rh,rp,rm,rf,rg,ry,rb,r_,rv,rw,rO,rI,rk,rE,rx,rS,rP,rA,rT,rj,rN,r$,rR,rC,rL,rU,rM,rD,rF,rz,rB,rZ,rJ,rq,rG,rW=r(44134).hp,rH=function(e,t,r,a,i){if("m"===a)throw TypeError("Private method is not writable");if("a"===a&&!i)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===a?i.call(e,r):i?i.value=r:t.set(e,r),r},rY=function(e,t,r,a){if("a"===r&&!a)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!a:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?a:"a"===r?a.call(e):a?a.value:t.get(e)};class rV{constructor(){tG.set(this,void 0),this.buffer=new Uint8Array,rH(this,tG,null,"f")}decode(e){let t;if(null==e)return[];let r=e instanceof ArrayBuffer?new Uint8Array(e):"string"==typeof e?new TextEncoder().encode(e):e,a=new Uint8Array(this.buffer.length+r.length);a.set(this.buffer),a.set(r,this.buffer.length),this.buffer=a;let i=[];for(;null!=(t=function(e,t){for(let r=t??0;r<e.length;r++){if(10===e[r])return{preceding:r,index:r+1,carriage:!1};if(13===e[r])return{preceding:r,index:r+1,carriage:!0}}return null}(this.buffer,rY(this,tG,"f")));){if(t.carriage&&null==rY(this,tG,"f")){rH(this,tG,t.index,"f");continue}if(null!=rY(this,tG,"f")&&(t.index!==rY(this,tG,"f")+1||t.carriage)){i.push(this.decodeText(this.buffer.slice(0,rY(this,tG,"f")-1))),this.buffer=this.buffer.slice(rY(this,tG,"f")),rH(this,tG,null,"f");continue}let e=null!==rY(this,tG,"f")?t.preceding-1:t.preceding,r=this.decodeText(this.buffer.slice(0,e));i.push(r),this.buffer=this.buffer.slice(t.index),rH(this,tG,null,"f")}return i}decodeText(e){if(null==e)return"";if("string"==typeof e)return e;if(void 0!==rW){if(e instanceof rW)return e.toString();if(e instanceof Uint8Array)return rW.from(e).toString();throw new tj(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if("undefined"!=typeof TextDecoder){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new tj(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new tj("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){return this.buffer.length?this.decode("\n"):[]}}function rK(e){if(e[Symbol.asyncIterator])return e;let t=e.getReader();return{async next(){try{let e=await t.read();return e?.done&&t.releaseLock(),e}catch(e){throw t.releaseLock(),e}},async return(){let e=t.cancel();return t.releaseLock(),await e,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}tG=new WeakMap,rV.NEWLINE_CHARS=new Set(["\n","\r"]),rV.NEWLINE_REGEXP=/\r\n|[\n\r]/g;class rX{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let r=!1;async function*a(){if(r)throw Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let a=!1;try{for await(let r of rQ(e,t))if(!a){if(r.data.startsWith("[DONE]")){a=!0;continue}if(null===r.event||r.event.startsWith("response.")||r.event.startsWith("transcript.")){let t;try{t=JSON.parse(r.data)}catch(e){throw console.error("Could not parse message into JSON:",r.data),console.error("From chunk:",r.raw),e}if(t&&t.error)throw new tN(void 0,t.error,void 0,ag(e.headers));yield t}else{let e;try{e=JSON.parse(r.data)}catch(e){throw console.error("Could not parse message into JSON:",r.data),console.error("From chunk:",r.raw),e}if("error"==r.event)throw new tN(void 0,e.error,e.message,void 0);yield{event:r.event,data:e}}}a=!0}catch(e){if(e instanceof Error&&"AbortError"===e.name)return;throw e}finally{a||t.abort()}}return new rX(a,t)}static fromReadableStream(e,t){let r=!1;async function*a(){let t=new rV;for await(let r of rK(e))for(let e of t.decode(r))yield e;for(let e of t.flush())yield e}return new rX(async function*(){if(r)throw Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let e=!1;try{for await(let t of a())!e&&t&&(yield JSON.parse(t));e=!0}catch(e){if(e instanceof Error&&"AbortError"===e.name)return;throw e}finally{e||t.abort()}},t)}[Symbol.asyncIterator](){return this.iterator()}tee(){let e=[],t=[],r=this.iterator(),a=a=>({next:()=>{if(0===a.length){let a=r.next();e.push(a),t.push(a)}return a.shift()}});return[new rX(()=>a(e),this.controller),new rX(()=>a(t),this.controller)]}toReadableStream(){let e;let t=this,r=new TextEncoder;return new u({async start(){e=t[Symbol.asyncIterator]()},async pull(t){try{let{value:a,done:i}=await e.next();if(i)return t.close();let n=r.encode(JSON.stringify(a)+"\n");t.enqueue(n)}catch(e){t.error(e)}},async cancel(){await e.return?.()}})}}async function*rQ(e,t){if(!e.body)throw t.abort(),new tj("Attempted to iterate over a response with no body");let r=new r1,a=new rV;for await(let t of r0(rK(e.body)))for(let e of a.decode(t)){let t=r.decode(e);t&&(yield t)}for(let e of a.flush()){let t=r.decode(e);t&&(yield t)}}async function*r0(e){let t=new Uint8Array;for await(let r of e){let e;if(null==r)continue;let a=r instanceof ArrayBuffer?new Uint8Array(r):"string"==typeof r?new TextEncoder().encode(r):r,i=new Uint8Array(t.length+a.length);for(i.set(t),i.set(a,t.length),t=i;-1!==(e=function(e){for(let t=0;t<e.length-1;t++){if(10===e[t]&&10===e[t+1]||13===e[t]&&13===e[t+1])return t+2;if(13===e[t]&&10===e[t+1]&&t+3<e.length&&13===e[t+2]&&10===e[t+3])return t+4}return -1}(t));)yield t.slice(0,e),t=t.slice(e)}t.length>0&&(yield t)}class r1{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let e={event:this.event,data:this.data.join("\n"),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],e}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,r,a]=function(e,t){let r=e.indexOf(":");return -1!==r?[e.substring(0,r),t,e.substring(r+t.length)]:[e,"",""]}(e,":");return a.startsWith(" ")&&(a=a.substring(1)),"event"===t?this.event=a:"data"===t&&this.data.push(a),null}}var r4=r(44134).hp;let r2=e=>null!=e&&"object"==typeof e&&"string"==typeof e.url&&"function"==typeof e.blob,r6=e=>null!=e&&"object"==typeof e&&"string"==typeof e.name&&"number"==typeof e.lastModified&&r9(e),r9=e=>null!=e&&"object"==typeof e&&"number"==typeof e.size&&"string"==typeof e.type&&"function"==typeof e.text&&"function"==typeof e.slice&&"function"==typeof e.arrayBuffer,r3=e=>r6(e)||r2(e)||p(e);async function r5(e,t,r){var a;if(r6(e=await e))return e;if(r2(e)){let a=await e.blob();t||(t=new URL(e.url).pathname.split(/[\\/]/).pop()??"unknown_file");let i=r9(a)?[await a.arrayBuffer()]:[a];return new l(i,t,r)}let i=await r8(e);if(t||(t=(r7((a=e).name)||r7(a.filename)||r7(a.path)?.split(/[\\/]/).pop())??"unknown_file"),!r?.type){let e=i[0]?.type;"string"==typeof e&&(r={...r,type:e})}return new l(i,t,r)}async function r8(e){let t=[];if("string"==typeof e||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)t.push(e);else if(r9(e))t.push(await e.arrayBuffer());else if(ae(e))for await(let r of e)t.push(r);else throw Error(`Unexpected data type: ${typeof e}; constructor: ${e?.constructor?.name}; props: ${function(e){let t=Object.getOwnPropertyNames(e);return`[${t.map(e=>`"${e}"`).join(", ")}]`}(e)}`);return t}let r7=e=>"string"==typeof e?e:void 0!==r4&&e instanceof r4?String(e):void 0,ae=e=>null!=e&&"object"==typeof e&&"function"==typeof e[Symbol.asyncIterator],at=e=>e&&"object"==typeof e&&e.body&&"MultipartBody"===e[Symbol.toStringTag],ar=async e=>{let t=await aa(e.body);return c(t,e)},aa=async e=>{let t=new o;return await Promise.all(Object.entries(e||{}).map(([e,r])=>an(t,e,r))),t},ai=e=>{if(r3(e))return!0;if(Array.isArray(e))return e.some(ai);if(e&&"object"==typeof e){for(let t in e)if(ai(e[t]))return!0}return!1},an=async(e,t,r)=>{if(void 0!==r){if(null==r)throw TypeError(`Received null for "${t}"; to pass null in FormData, you must use the string 'null'`);if("string"==typeof r||"number"==typeof r||"boolean"==typeof r)e.append(t,String(r));else if(r3(r)){let a=await r5(r);e.append(t,a)}else if(Array.isArray(r))await Promise.all(r.map(r=>an(e,t+"[]",r)));else if("object"==typeof r)await Promise.all(Object.entries(r).map(([r,a])=>an(e,`${t}[${r}]`,a)));else throw TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${r} instead`)}};var as=r(44134).hp,ao=r(49509),al=function(e,t,r,a,i){if("m"===a)throw TypeError("Private method is not writable");if("a"===a&&!i)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===a?i.call(e,r):i?i.value=r:t.set(e,r),r},au=function(e,t,r,a){if("a"===r&&!a)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!a:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?a:"a"===r?a.call(e):a?a.value:t.get(e)};async function ac(e){let{response:t}=e;if(e.options.stream)return(aR("response",t.status,t.url,t.headers,t.body),e.options.__streamClass)?e.options.__streamClass.fromSSEResponse(t,e.controller):rX.fromSSEResponse(t,e.controller);if(204===t.status)return null;if(e.options.__binaryResponse)return t;let r=t.headers.get("content-type"),a=r?.split(";")[0]?.trim();if(a?.includes("application/json")||a?.endsWith("+json")){let e=await t.json();return aR("response",t.status,t.url,t.headers,e),ad(e,t)}let i=await t.text();return aR("response",t.status,t.url,t.headers,i),i}function ad(e,t){return!e||"object"!=typeof e||Array.isArray(e)?e:Object.defineProperty(e,"_request_id",{value:t.headers.get("x-request-id"),enumerable:!1})}tT();class ah extends Promise{constructor(e,t=ac){super(e=>{e(null)}),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new ah(this.responsePromise,async t=>ad(e(await this.parseResponse(t),t),t.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}class ap{constructor({baseURL:e,maxRetries:t=2,timeout:r=6e5,httpAgent:a,fetch:i}){this.baseURL=e,this.maxRetries=aS("maxRetries",t),this.timeout=aS("timeout",r),this.httpAgent=a,this.fetch=i??s}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...aO(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${aC()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,r){return this.request(Promise.resolve(r).then(async r=>{let a=r&&r9(r?.body)?new DataView(await r.body.arrayBuffer()):r?.body instanceof DataView?r.body:r?.body instanceof ArrayBuffer?new DataView(r.body):r&&ArrayBuffer.isView(r?.body)?new DataView(r.body.buffer):r?.body;return{method:e,path:t,...r,body:a}}))}getAPIList(e,t,r){return this.requestAPIList(t,{method:"get",path:e,...r})}calculateContentLength(e){if("string"==typeof e){if(void 0!==as)return as.byteLength(e,"utf8").toString();if("undefined"!=typeof TextEncoder)return new TextEncoder().encode(e).length.toString()}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e,{retryCount:t=0}={}){let r={...e},{method:a,path:i,query:n,headers:s={}}=r,o=ArrayBuffer.isView(r.body)||r.__binaryRequest&&"string"==typeof r.body?r.body:at(r.body)?r.body.body:r.body?JSON.stringify(r.body,null,2):null,l=this.calculateContentLength(o),u=this.buildURL(i,n);"timeout"in r&&aS("timeout",r.timeout),r.timeout=r.timeout??this.timeout;let c=r.httpAgent??this.httpAgent??d(u),h=r.timeout+1e3;"number"==typeof c?.options?.timeout&&h>(c.options.timeout??0)&&(c.options.timeout=h),this.idempotencyHeader&&"get"!==a&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),s[this.idempotencyHeader]=e.idempotencyKey);let p=this.buildHeaders({options:r,headers:s,contentLength:l,retryCount:t});return{req:{method:a,...o&&{body:o},headers:p,...c&&{agent:c},signal:r.signal??null},url:u,timeout:r.timeout}}buildHeaders({options:e,headers:t,contentLength:r,retryCount:a}){let i={};r&&(i["content-length"]=r);let s=this.defaultHeaders(e);return aN(i,s),aN(i,t),at(e.body)&&"node"!==n&&delete i["content-type"],void 0===aM(s,"x-stainless-retry-count")&&void 0===aM(t,"x-stainless-retry-count")&&(i["x-stainless-retry-count"]=String(a)),void 0===aM(s,"x-stainless-timeout")&&void 0===aM(t,"x-stainless-timeout")&&e.timeout&&(i["x-stainless-timeout"]=String(Math.trunc(e.timeout/1e3))),this.validateHeaders(i,t),i}async prepareOptions(e){}async prepareRequest(e,{url:t,options:r}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(e=>[...e])):{...e}:{}}makeStatusError(e,t,r,a){return tN.generate(e,t,r,a)}request(e,t=null){return new ah(this.makeRequest(e,t))}async makeRequest(e,t){let r=await e,a=r.maxRetries??this.maxRetries;null==t&&(t=a),await this.prepareOptions(r);let{req:i,url:n,timeout:s}=this.buildRequest(r,{retryCount:a-t});if(await this.prepareRequest(i,{url:n,options:r}),aR("request",n,r,i.headers),r.signal?.aborted)throw new t$;let o=new AbortController,l=await this.fetchWithTimeout(n,i,s,o).catch(aP);if(l instanceof Error){if(r.signal?.aborted)throw new t$;if(t)return this.retryRequest(r,t);if("AbortError"===l.name)throw new tC;throw new tR({cause:l})}let u=ag(l.headers);if(!l.ok){if(t&&this.shouldRetry(l)){let e=`retrying, ${t} attempts remaining`;return aR(`response (error; ${e})`,l.status,n,u),this.retryRequest(r,t,u)}let e=await l.text().catch(e=>aP(e).message),a=aI(e),i=a?void 0:e,s=t?"(error; no more retries left)":"(error; not retryable)";throw aR(`response (error; ${s})`,l.status,n,u,i),this.makeStatusError(l.status,a,i,u)}return{response:l,options:r,controller:o}}requestAPIList(e,t){return new af(this,this.makeRequest(t,null),e)}buildURL(e,t){let r=new URL(aE(e)?e:this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),a=this.defaultQuery();return aT(a)||(t={...a,...t}),"object"==typeof t&&t&&!Array.isArray(t)&&(r.search=this.stringifyQuery(t)),r.toString()}stringifyQuery(e){return Object.entries(e).filter(([e,t])=>void 0!==t).map(([e,t])=>{if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return`${encodeURIComponent(e)}=${encodeURIComponent(t)}`;if(null===t)return`${encodeURIComponent(e)}=`;throw new tj(`Cannot stringify type ${typeof t}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,t,r,a){let{signal:i,...n}=t||{};i&&i.addEventListener("abort",()=>a.abort());let s=setTimeout(()=>a.abort(),r),o={signal:a.signal,...n};return o.method&&(o.method=o.method.toUpperCase()),this.fetch.call(void 0,e,o).finally(()=>{clearTimeout(s)})}shouldRetry(e){let t=e.headers.get("x-should-retry");return"true"===t||"false"!==t&&(408===e.status||409===e.status||429===e.status||!!(e.status>=500))}async retryRequest(e,t,r){let a;let i=r?.["retry-after-ms"];if(i){let e=parseFloat(i);Number.isNaN(e)||(a=e)}let n=r?.["retry-after"];if(n&&!a){let e=parseFloat(n);a=Number.isNaN(e)?Date.parse(n)-Date.now():1e3*e}if(!(a&&0<=a&&a<6e4)){let r=e.maxRetries??this.maxRetries;a=this.calculateDefaultRetryTimeoutMillis(t,r)}return await ax(a),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){return Math.min(.5*Math.pow(2,t-e),8)*(1-.25*Math.random())*1e3}getUserAgent(){return`${this.constructor.name}/JS ${tS}`}}class am{constructor(e,t,r,a){tW.set(this,void 0),al(this,tW,e,"f"),this.options=a,this.response=t,this.body=r}hasNextPage(){return!!this.getPaginatedItems().length&&null!=this.nextPageInfo()}async getNextPage(){let e=this.nextPageInfo();if(!e)throw new tj("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");let t={...this.options};if("params"in e&&"object"==typeof t.query)t.query={...t.query,...e.params};else if("url"in e){for(let[r,a]of[...Object.entries(t.query||{}),...e.url.searchParams.entries()])e.url.searchParams.set(r,a);t.query=void 0,t.path=e.url.toString()}return await au(this,tW,"f").requestAPIList(this.constructor,t)}async *iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async *[(tW=new WeakMap,Symbol.asyncIterator)](){for await(let e of this.iterPages())for(let t of e.getPaginatedItems())yield t}}class af extends ah{constructor(e,t,r){super(t,async t=>new r(e,t.response,await ac(t),t.options))}async *[Symbol.asyncIterator](){for await(let e of(await this))yield e}}let ag=e=>new Proxy(Object.fromEntries(e.entries()),{get(e,t){let r=t.toString();return e[r.toLowerCase()]||e[r]}}),ay={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__metadata:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},ab=e=>"object"==typeof e&&null!==e&&!aT(e)&&Object.keys(e).every(e=>aj(ay,e)),a_=()=>{if("undefined"!=typeof Deno&&null!=Deno.build)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":tS,"X-Stainless-OS":aw(Deno.build.os),"X-Stainless-Arch":av(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":"string"==typeof Deno.version?Deno.version:Deno.version?.deno??"unknown"};if("undefined"!=typeof EdgeRuntime)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":tS,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":ao.version};if("[object process]"===Object.prototype.toString.call(void 0!==ao?ao:0))return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":tS,"X-Stainless-OS":aw(ao.platform),"X-Stainless-Arch":av(ao.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":ao.version};let e=function(){if("undefined"==typeof navigator||!navigator)return null;for(let{key:e,pattern:t}of[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}]){let r=t.exec(navigator.userAgent);if(r){let t=r[1]||0,a=r[2]||0,i=r[3]||0;return{browser:e,version:`${t}.${a}.${i}`}}}return null}();return e?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":tS,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${e.browser}`,"X-Stainless-Runtime-Version":e.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":tS,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}},av=e=>"x32"===e?"x32":"x86_64"===e||"x64"===e?"x64":"arm"===e?"arm":"aarch64"===e||"arm64"===e?"arm64":e?`other:${e}`:"unknown",aw=e=>(e=e.toLowerCase()).includes("ios")?"iOS":"android"===e?"Android":"darwin"===e?"MacOS":"win32"===e?"Windows":"freebsd"===e?"FreeBSD":"openbsd"===e?"OpenBSD":"linux"===e?"Linux":e?`Other:${e}`:"Unknown",aO=()=>a??(a=a_()),aI=e=>{try{return JSON.parse(e)}catch(e){return}},ak=/^[a-z][a-z0-9+.-]*:/i,aE=e=>ak.test(e),ax=e=>new Promise(t=>setTimeout(t,e)),aS=(e,t)=>{if("number"!=typeof t||!Number.isInteger(t))throw new tj(`${e} must be an integer`);if(t<0)throw new tj(`${e} must be a positive integer`);return t},aP=e=>{if(e instanceof Error)return e;if("object"==typeof e&&null!==e)try{return Error(JSON.stringify(e))}catch{}return Error(e)},aA=e=>void 0!==ao?ao.env?.[e]?.trim()??void 0:"undefined"!=typeof Deno?Deno.env?.get?.(e)?.trim():void 0;function aT(e){if(!e)return!0;for(let t in e)return!1;return!0}function aj(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function aN(e,t){for(let r in t){if(!aj(t,r))continue;let a=r.toLowerCase();if(!a)continue;let i=t[r];null===i?delete e[a]:void 0!==i&&(e[a]=i)}}let a$=new Set(["authorization","api-key"]);function aR(e,...t){void 0!==ao&&ao?.env?.DEBUG==="true"&&console.log(`OpenAI:DEBUG:${e}`,...t.map(e=>{if(!e)return e;if(e.headers){let t={...e,headers:{...e.headers}};for(let r in e.headers)a$.has(r.toLowerCase())&&(t.headers[r]="REDACTED");return t}let t=null;for(let r in e)a$.has(r.toLowerCase())&&(t??(t={...e}),t[r]="REDACTED");return t??e}))}let aC=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{let t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}),aL=()=>"undefined"!=typeof window&&void 0!==window.document&&"undefined"!=typeof navigator,aU=e=>"function"==typeof e?.get,aM=(e,t)=>{let r=t.toLowerCase();if(aU(e)){let a=t[0]?.toUpperCase()+t.substring(1).replace(/([^\w])(\w)/g,(e,t,r)=>t+r.toUpperCase());for(let i of[t,r,t.toUpperCase(),a]){let t=e.get(i);if(t)return t}}for(let[a,i]of Object.entries(e))if(a.toLowerCase()===r){if(Array.isArray(i)){if(i.length<=1)return i[0];return console.warn(`Received ${i.length} entries for the ${t} header, using the first entry.`),i[0]}return i}},aD=e=>{if(void 0!==as){let t=as.from(e,"base64");return Array.from(new Float32Array(t.buffer,t.byteOffset,t.length/Float32Array.BYTES_PER_ELEMENT))}{let t=atob(e),r=t.length,a=new Uint8Array(r);for(let e=0;e<r;e++)a[e]=t.charCodeAt(e);return Array.from(new Float32Array(a.buffer))}};function aF(e){return null!=e&&"object"==typeof e&&!Array.isArray(e)}class az{constructor(e){this._client=e}}class aB extends az{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}}class aZ extends az{list(e,t={},r){return ab(t)?this.list(e,{},t):this._client.getAPIList(`/chat/completions/${e}/messages`,aH,{query:t,...r})}}class aJ extends am{constructor(e,t,r,a){super(e,t,r,a),this.data=r.data||[],this.object=r.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}}class aq extends am{constructor(e,t,r,a){super(e,t,r,a),this.data=r.data||[],this.has_more=r.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return!1!==this.has_more&&super.hasNextPage()}nextPageParams(){let e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;let t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){let e=this.getPaginatedItems();if(!e.length)return null;let t=e[e.length-1]?.id;return t?{params:{after:t}}:null}}class aG extends az{constructor(){super(...arguments),this.messages=new aZ(this._client)}create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}retrieve(e,t){return this._client.get(`/chat/completions/${e}`,t)}update(e,t,r){return this._client.post(`/chat/completions/${e}`,{body:t,...r})}list(e={},t){return ab(e)?this.list({},e):this._client.getAPIList("/chat/completions",aW,{query:e,...t})}del(e,t){return this._client.delete(`/chat/completions/${e}`,t)}}class aW extends aq{}class aH extends aq{}aG.ChatCompletionsPage=aW,aG.Messages=aZ;class aY extends az{constructor(){super(...arguments),this.completions=new aG(this._client)}}aY.Completions=aG,aY.ChatCompletionsPage=aW;class aV extends az{create(e,t){let r=!!e.encoding_format,a=r?e.encoding_format:"base64";r&&aR("Request","User defined encoding_format:",e.encoding_format);let i=this._client.post("/embeddings",{body:{...e,encoding_format:a},...t});return r?i:(aR("response","Decoding base64 embeddings to float32 array"),i._thenUnwrap(e=>(e&&e.data&&e.data.forEach(e=>{let t=e.embedding;e.embedding=aD(t)}),e)))}}class aK extends az{create(e,t){return this._client.post("/files",ar({body:e,...t}))}retrieve(e,t){return this._client.get(`/files/${e}`,t)}list(e={},t){return ab(e)?this.list({},e):this._client.getAPIList("/files",aX,{query:e,...t})}del(e,t){return this._client.delete(`/files/${e}`,t)}content(e,t){return this._client.get(`/files/${e}/content`,{...t,headers:{Accept:"application/binary",...t?.headers},__binaryResponse:!0})}retrieveContent(e,t){return this._client.get(`/files/${e}/content`,t)}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:r=18e5}={}){let a=new Set(["processed","error","deleted"]),i=Date.now(),n=await this.retrieve(e);for(;!n.status||!a.has(n.status);)if(await ax(t),n=await this.retrieve(e),Date.now()-i>r)throw new tC({message:`Giving up on waiting for file ${e} to finish processing after ${r} milliseconds.`});return n}}class aX extends aq{}aK.FileObjectsPage=aX;class aQ extends az{createVariation(e,t){return this._client.post("/images/variations",ar({body:e,...t}))}edit(e,t){return this._client.post("/images/edits",ar({body:e,...t}))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}}class a0 extends az{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:{Accept:"application/octet-stream",...t?.headers},__binaryResponse:!0})}}class a1 extends az{create(e,t){return this._client.post("/audio/transcriptions",ar({body:e,...t,stream:e.stream??!1,__metadata:{model:e.model}}))}}class a4 extends az{create(e,t){return this._client.post("/audio/translations",ar({body:e,...t,__metadata:{model:e.model}}))}}class a2 extends az{constructor(){super(...arguments),this.transcriptions=new a1(this._client),this.translations=new a4(this._client),this.speech=new a0(this._client)}}a2.Transcriptions=a1,a2.Translations=a4,a2.Speech=a0;class a6 extends az{create(e,t){return this._client.post("/moderations",{body:e,...t})}}class a9 extends az{retrieve(e,t){return this._client.get(`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",a3,e)}del(e,t){return this._client.delete(`/models/${e}`,t)}}class a3 extends aJ{}a9.ModelsPage=a3;class a5 extends az{}class a8 extends az{run(e,t){return this._client.post("/fine_tuning/alpha/graders/run",{body:e,...t})}validate(e,t){return this._client.post("/fine_tuning/alpha/graders/validate",{body:e,...t})}}class a7 extends az{constructor(){super(...arguments),this.graders=new a8(this._client)}}a7.Graders=a8;class ie extends az{create(e,t,r){return this._client.getAPIList(`/fine_tuning/checkpoints/${e}/permissions`,it,{body:t,method:"post",...r})}retrieve(e,t={},r){return ab(t)?this.retrieve(e,{},t):this._client.get(`/fine_tuning/checkpoints/${e}/permissions`,{query:t,...r})}del(e,t,r){return this._client.delete(`/fine_tuning/checkpoints/${e}/permissions/${t}`,r)}}class it extends aJ{}ie.PermissionCreateResponsesPage=it;class ir extends az{constructor(){super(...arguments),this.permissions=new ie(this._client)}}ir.Permissions=ie,ir.PermissionCreateResponsesPage=it;class ia extends az{list(e,t={},r){return ab(t)?this.list(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/checkpoints`,ii,{query:t,...r})}}class ii extends aq{}ia.FineTuningJobCheckpointsPage=ii;class is extends az{constructor(){super(...arguments),this.checkpoints=new ia(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(`/fine_tuning/jobs/${e}`,t)}list(e={},t){return ab(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",io,{query:e,...t})}cancel(e,t){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},r){return ab(t)?this.listEvents(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,il,{query:t,...r})}pause(e,t){return this._client.post(`/fine_tuning/jobs/${e}/pause`,t)}resume(e,t){return this._client.post(`/fine_tuning/jobs/${e}/resume`,t)}}class io extends aq{}class il extends aq{}is.FineTuningJobsPage=io,is.FineTuningJobEventsPage=il,is.Checkpoints=ia,is.FineTuningJobCheckpointsPage=ii;class iu extends az{constructor(){super(...arguments),this.methods=new a5(this._client),this.jobs=new is(this._client),this.checkpoints=new ir(this._client),this.alpha=new a7(this._client)}}iu.Methods=a5,iu.Jobs=is,iu.FineTuningJobsPage=io,iu.FineTuningJobEventsPage=il,iu.Checkpoints=ir,iu.Alpha=a7;class ic extends az{}class id extends az{constructor(){super(...arguments),this.graderModels=new ic(this._client)}}id.GraderModels=ic;let ih=async e=>{let t=await Promise.allSettled(e),r=t.filter(e=>"rejected"===e.status);if(r.length){for(let e of r)console.error(e.reason);throw Error(`${r.length} promise(s) failed - see the above errors`)}let a=[];for(let e of t)"fulfilled"===e.status&&a.push(e.value);return a};class ip extends az{create(e,t,r){return this._client.post(`/vector_stores/${e}/files`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}retrieve(e,t,r){return this._client.get(`/vector_stores/${e}/files/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}update(e,t,r,a){return this._client.post(`/vector_stores/${e}/files/${t}`,{body:r,...a,headers:{"OpenAI-Beta":"assistants=v2",...a?.headers}})}list(e,t={},r){return ab(t)?this.list(e,{},t):this._client.getAPIList(`/vector_stores/${e}/files`,im,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}del(e,t,r){return this._client.delete(`/vector_stores/${e}/files/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}async createAndPoll(e,t,r){let a=await this.create(e,t,r);return await this.poll(e,a.id,r)}async poll(e,t,r){let a={...r?.headers,"X-Stainless-Poll-Helper":"true"};for(r?.pollIntervalMs&&(a["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){let i=await this.retrieve(e,t,{...r,headers:a}).withResponse(),n=i.data;switch(n.status){case"in_progress":let s=5e3;if(r?.pollIntervalMs)s=r.pollIntervalMs;else{let e=i.response.headers.get("openai-poll-after-ms");if(e){let t=parseInt(e);isNaN(t)||(s=t)}}await ax(s);break;case"failed":case"completed":return n}}}async upload(e,t,r){let a=await this._client.files.create({file:t,purpose:"assistants"},r);return this.create(e,{file_id:a.id},r)}async uploadAndPoll(e,t,r){let a=await this.upload(e,t,r);return await this.poll(e,a.id,r)}content(e,t,r){return this._client.getAPIList(`/vector_stores/${e}/files/${t}/content`,ig,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}}class im extends aq{}class ig extends aJ{}ip.VectorStoreFilesPage=im,ip.FileContentResponsesPage=ig;class iy extends az{create(e,t,r){return this._client.post(`/vector_stores/${e}/file_batches`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}retrieve(e,t,r){return this._client.get(`/vector_stores/${e}/file_batches/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}cancel(e,t,r){return this._client.post(`/vector_stores/${e}/file_batches/${t}/cancel`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}async createAndPoll(e,t,r){let a=await this.create(e,t);return await this.poll(e,a.id,r)}listFiles(e,t,r={},a){return ab(r)?this.listFiles(e,t,{},r):this._client.getAPIList(`/vector_stores/${e}/file_batches/${t}/files`,im,{query:r,...a,headers:{"OpenAI-Beta":"assistants=v2",...a?.headers}})}async poll(e,t,r){let a={...r?.headers,"X-Stainless-Poll-Helper":"true"};for(r?.pollIntervalMs&&(a["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){let{data:i,response:n}=await this.retrieve(e,t,{...r,headers:a}).withResponse();switch(i.status){case"in_progress":let s=5e3;if(r?.pollIntervalMs)s=r.pollIntervalMs;else{let e=n.headers.get("openai-poll-after-ms");if(e){let t=parseInt(e);isNaN(t)||(s=t)}}await ax(s);break;case"failed":case"cancelled":case"completed":return i}}}async uploadAndPoll(e,{files:t,fileIds:r=[]},a){if(null==t||0==t.length)throw Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");let i=Math.min(a?.maxConcurrency??5,t.length),n=this._client,s=t.values(),o=[...r];async function l(e){for(let t of e){let e=await n.files.create({file:t,purpose:"assistants"},a);o.push(e.id)}}let u=Array(i).fill(s).map(l);return await ih(u),await this.createAndPoll(e,{file_ids:o})}}class ib extends az{constructor(){super(...arguments),this.files=new ip(this._client),this.fileBatches=new iy(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}retrieve(e,t){return this._client.get(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}update(e,t,r){return this._client.post(`/vector_stores/${e}`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}list(e={},t){return ab(e)?this.list({},e):this._client.getAPIList("/vector_stores",i_,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}del(e,t){return this._client.delete(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}search(e,t,r){return this._client.getAPIList(`/vector_stores/${e}/search`,iv,{body:t,method:"post",...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}}class i_ extends aq{}class iv extends aJ{}ib.VectorStoresPage=i_,ib.VectorStoreSearchResponsesPage=iv,ib.Files=ip,ib.VectorStoreFilesPage=im,ib.FileContentResponsesPage=ig,ib.FileBatches=iy;class iw extends az{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}retrieve(e,t){return this._client.get(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}update(e,t,r){return this._client.post(`/assistants/${e}`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}list(e={},t){return ab(e)?this.list({},e):this._client.getAPIList("/assistants",iO,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}del(e,t){return this._client.delete(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}}class iO extends aq{}function iI(e){return"function"==typeof e.parse}iw.AssistantsPage=iO;let ik=e=>e?.role==="assistant",iE=e=>e?.role==="function",ix=e=>e?.role==="tool";var iS=function(e,t,r,a,i){if("m"===a)throw TypeError("Private method is not writable");if("a"===a&&!i)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===a?i.call(e,r):i?i.value=r:t.set(e,r),r},iP=function(e,t,r,a){if("a"===r&&!a)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!a:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?a:"a"===r?a.call(e):a?a.value:t.get(e)};class iA{constructor(){tH.add(this),this.controller=new AbortController,tY.set(this,void 0),tV.set(this,()=>{}),tK.set(this,()=>{}),tX.set(this,void 0),tQ.set(this,()=>{}),t0.set(this,()=>{}),t1.set(this,{}),t4.set(this,!1),t2.set(this,!1),t6.set(this,!1),t9.set(this,!1),iS(this,tY,new Promise((e,t)=>{iS(this,tV,e,"f"),iS(this,tK,t,"f")}),"f"),iS(this,tX,new Promise((e,t)=>{iS(this,tQ,e,"f"),iS(this,t0,t,"f")}),"f"),iP(this,tY,"f").catch(()=>{}),iP(this,tX,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},iP(this,tH,"m",t3).bind(this))},0)}_connected(){this.ended||(iP(this,tV,"f").call(this),this._emit("connect"))}get ended(){return iP(this,t4,"f")}get errored(){return iP(this,t2,"f")}get aborted(){return iP(this,t6,"f")}abort(){this.controller.abort()}on(e,t){return(iP(this,t1,"f")[e]||(iP(this,t1,"f")[e]=[])).push({listener:t}),this}off(e,t){let r=iP(this,t1,"f")[e];if(!r)return this;let a=r.findIndex(e=>e.listener===t);return a>=0&&r.splice(a,1),this}once(e,t){return(iP(this,t1,"f")[e]||(iP(this,t1,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,r)=>{iS(this,t9,!0,"f"),"error"!==e&&this.once("error",r),this.once(e,t)})}async done(){iS(this,t9,!0,"f"),await iP(this,tX,"f")}_emit(e,...t){if(iP(this,t4,"f"))return;"end"===e&&(iS(this,t4,!0,"f"),iP(this,tQ,"f").call(this));let r=iP(this,t1,"f")[e];if(r&&(iP(this,t1,"f")[e]=r.filter(e=>!e.once),r.forEach(({listener:e})=>e(...t))),"abort"===e){let e=t[0];iP(this,t9,"f")||r?.length||Promise.reject(e),iP(this,tK,"f").call(this,e),iP(this,t0,"f").call(this,e),this._emit("end");return}if("error"===e){let e=t[0];iP(this,t9,"f")||r?.length||Promise.reject(e),iP(this,tK,"f").call(this,e),iP(this,t0,"f").call(this,e),this._emit("end")}}_emitFinal(){}}function iT(e){return e?.$brand==="auto-parseable-response-format"}function ij(e){return e?.$brand==="auto-parseable-tool"}function iN(e,t){let r=e.choices.map(e=>{var r,a;if("length"===e.finish_reason)throw new tJ;if("content_filter"===e.finish_reason)throw new tq;return{...e,message:{...e.message,...e.message.tool_calls?{tool_calls:e.message.tool_calls?.map(e=>(function(e,t){let r=e.tools?.find(e=>e.function?.name===t.function.name);return{...t,function:{...t.function,parsed_arguments:ij(r)?r.$parseRaw(t.function.arguments):r?.function.strict?JSON.parse(t.function.arguments):null}}})(t,e))??void 0}:void 0,parsed:e.message.content&&!e.message.refusal?(r=t,a=e.message.content,r.response_format?.type!=="json_schema"?null:r.response_format?.type==="json_schema"?"$parseRaw"in r.response_format?r.response_format.$parseRaw(a):JSON.parse(a):null):null}}});return{...e,choices:r}}function i$(e){return!!iT(e.response_format)||(e.tools?.some(e=>ij(e)||"function"===e.type&&!0===e.function.strict)??!1)}tY=new WeakMap,tV=new WeakMap,tK=new WeakMap,tX=new WeakMap,tQ=new WeakMap,t0=new WeakMap,t1=new WeakMap,t4=new WeakMap,t2=new WeakMap,t6=new WeakMap,t9=new WeakMap,tH=new WeakSet,t3=function(e){if(iS(this,t2,!0,"f"),e instanceof Error&&"AbortError"===e.name&&(e=new t$),e instanceof t$)return iS(this,t6,!0,"f"),this._emit("abort",e);if(e instanceof tj)return this._emit("error",e);if(e instanceof Error){let t=new tj(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new tj(String(e)))};var iR=function(e,t,r,a){if("a"===r&&!a)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!a:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?a:"a"===r?a.call(e):a?a.value:t.get(e)};class iC extends iA{constructor(){super(...arguments),t5.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){this._chatCompletions.push(e),this._emit("chatCompletion",e);let t=e.choices[0]?.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),(iE(e)||ix(e))&&e.content)this._emit("functionCallResult",e.content);else if(ik(e)&&e.function_call)this._emit("functionCall",e.function_call);else if(ik(e)&&e.tool_calls)for(let t of e.tool_calls)"function"===t.type&&this._emit("functionCall",t.function)}}async finalChatCompletion(){await this.done();let e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new tj("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),iR(this,t5,"m",t8).call(this)}async finalMessage(){return await this.done(),iR(this,t5,"m",t7).call(this)}async finalFunctionCall(){return await this.done(),iR(this,t5,"m",re).call(this)}async finalFunctionCallResult(){return await this.done(),iR(this,t5,"m",rt).call(this)}async totalUsage(){return await this.done(),iR(this,t5,"m",rr).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){let e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);let t=iR(this,t5,"m",t7).call(this);t&&this._emit("finalMessage",t);let r=iR(this,t5,"m",t8).call(this);r&&this._emit("finalContent",r);let a=iR(this,t5,"m",re).call(this);a&&this._emit("finalFunctionCall",a);let i=iR(this,t5,"m",rt).call(this);null!=i&&this._emit("finalFunctionCallResult",i),this._chatCompletions.some(e=>e.usage)&&this._emit("totalUsage",iR(this,t5,"m",rr).call(this))}async _createChatCompletion(e,t,r){let a=r?.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort())),iR(this,t5,"m",ra).call(this,t);let i=await e.chat.completions.create({...t,stream:!1},{...r,signal:this.controller.signal});return this._connected(),this._addChatCompletion(iN(i,t))}async _runChatCompletion(e,t,r){for(let e of t.messages)this._addMessage(e,!1);return await this._createChatCompletion(e,t,r)}async _runFunctions(e,t,r){let a="function",{function_call:i="auto",stream:n,...s}=t,o="string"!=typeof i&&i?.name,{maxChatCompletions:l=10}=r||{},u={};for(let e of t.functions)u[e.name||e.function.name]=e;let c=t.functions.map(e=>({name:e.name||e.function.name,parameters:e.parameters,description:e.description}));for(let e of t.messages)this._addMessage(e,!1);for(let t=0;t<l;++t){let t;let n=await this._createChatCompletion(e,{...s,function_call:i,functions:c,messages:[...this.messages]},r),l=n.choices[0]?.message;if(!l)throw new tj("missing message in ChatCompletion response");if(!l.function_call)return;let{name:d,arguments:h}=l.function_call,p=u[d];if(p){if(o&&o!==d){let e=`Invalid function_call: ${JSON.stringify(d)}. ${JSON.stringify(o)} requested. Please try again`;this._addMessage({role:a,name:d,content:e});continue}}else{let e=`Invalid function_call: ${JSON.stringify(d)}. Available options are: ${c.map(e=>JSON.stringify(e.name)).join(", ")}. Please try again`;this._addMessage({role:a,name:d,content:e});continue}try{t=iI(p)?await p.parse(h):h}catch(e){this._addMessage({role:a,name:d,content:e instanceof Error?e.message:String(e)});continue}let m=await p.function(t,this),f=iR(this,t5,"m",ri).call(this,m);if(this._addMessage({role:a,name:d,content:f}),o)return}}async _runTools(e,t,r){let a="tool",{tool_choice:i="auto",stream:n,...s}=t,o="string"!=typeof i&&i?.function?.name,{maxChatCompletions:l=10}=r||{},u=t.tools.map(e=>{if(ij(e)){if(!e.$callback)throw new tj("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:e.$callback,name:e.function.name,description:e.function.description||"",parameters:e.function.parameters,parse:e.$parseRaw,strict:!0}}}return e}),c={};for(let e of u)"function"===e.type&&(c[e.function.name||e.function.function.name]=e.function);let d="tools"in t?u.map(e=>"function"===e.type?{type:"function",function:{name:e.function.name||e.function.function.name,parameters:e.function.parameters,description:e.function.description,strict:e.function.strict}}:e):void 0;for(let e of t.messages)this._addMessage(e,!1);for(let t=0;t<l;++t){let t=await this._createChatCompletion(e,{...s,tool_choice:i,tools:d,messages:[...this.messages]},r),n=t.choices[0]?.message;if(!n)throw new tj("missing message in ChatCompletion response");if(!n.tool_calls?.length)break;for(let e of n.tool_calls){let t;if("function"!==e.type)continue;let r=e.id,{name:i,arguments:n}=e.function,s=c[i];if(s){if(o&&o!==i){let e=`Invalid tool_call: ${JSON.stringify(i)}. ${JSON.stringify(o)} requested. Please try again`;this._addMessage({role:a,tool_call_id:r,content:e});continue}}else{let e=`Invalid tool_call: ${JSON.stringify(i)}. Available options are: ${Object.keys(c).map(e=>JSON.stringify(e)).join(", ")}. Please try again`;this._addMessage({role:a,tool_call_id:r,content:e});continue}try{t=iI(s)?await s.parse(n):n}catch(t){let e=t instanceof Error?t.message:String(t);this._addMessage({role:a,tool_call_id:r,content:e});continue}let l=await s.function(t,this),u=iR(this,t5,"m",ri).call(this,l);if(this._addMessage({role:a,tool_call_id:r,content:u}),o)return}}}}t5=new WeakSet,t8=function(){return iR(this,t5,"m",t7).call(this).content??null},t7=function(){let e=this.messages.length;for(;e-- >0;){let t=this.messages[e];if(ik(t)){let{function_call:e,...r}=t,a={...r,content:t.content??null,refusal:t.refusal??null};return e&&(a.function_call=e),a}}throw new tj("stream ended without producing a ChatCompletionMessage with role=assistant")},re=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(ik(t)&&t?.function_call)return t.function_call;if(ik(t)&&t?.tool_calls?.length)return t.tool_calls.at(-1)?.function}},rt=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(iE(t)&&null!=t.content||ix(t)&&null!=t.content&&"string"==typeof t.content&&this.messages.some(e=>"assistant"===e.role&&e.tool_calls?.some(e=>"function"===e.type&&e.id===t.tool_call_id)))return t.content}},rr=function(){let e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(let{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},ra=function(e){if(null!=e.n&&e.n>1)throw new tj("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},ri=function(e){return"string"==typeof e?e:void 0===e?"undefined":JSON.stringify(e)};class iL extends iC{static runFunctions(e,t,r){let a=new iL,i={...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"runFunctions"}};return a._run(()=>a._runFunctions(e,t,i)),a}static runTools(e,t,r){let a=new iL,i={...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"runTools"}};return a._run(()=>a._runTools(e,t,i)),a}_addMessage(e,t=!0){super._addMessage(e,t),ik(e)&&e.content&&this._emit("content",e.content)}}let iU={STR:1,NUM:2,ARR:4,OBJ:8,NULL:16,BOOL:32,NAN:64,INFINITY:128,MINUS_INFINITY:256,ALL:511};class iM extends Error{}class iD extends Error{}let iF=(e,t)=>{let r=e.length,a=0,i=e=>{throw new iM(`${e} at position ${a}`)},n=e=>{throw new iD(`${e} at position ${a}`)},s=()=>(d(),a>=r&&i("Unexpected end of input"),'"'===e[a])?o():"{"===e[a]?l():"["===e[a]?u():"null"===e.substring(a,a+4)||iU.NULL&t&&r-a<4&&"null".startsWith(e.substring(a))?(a+=4,null):"true"===e.substring(a,a+4)||iU.BOOL&t&&r-a<4&&"true".startsWith(e.substring(a))?(a+=4,!0):"false"===e.substring(a,a+5)||iU.BOOL&t&&r-a<5&&"false".startsWith(e.substring(a))?(a+=5,!1):"Infinity"===e.substring(a,a+8)||iU.INFINITY&t&&r-a<8&&"Infinity".startsWith(e.substring(a))?(a+=8,1/0):"-Infinity"===e.substring(a,a+9)||iU.MINUS_INFINITY&t&&1<r-a&&r-a<9&&"-Infinity".startsWith(e.substring(a))?(a+=9,-1/0):"NaN"===e.substring(a,a+3)||iU.NAN&t&&r-a<3&&"NaN".startsWith(e.substring(a))?(a+=3,NaN):c(),o=()=>{let s=a,o=!1;for(a++;a<r&&('"'!==e[a]||o&&"\\"===e[a-1]);)o="\\"===e[a]&&!o,a++;if('"'==e.charAt(a))try{return JSON.parse(e.substring(s,++a-Number(o)))}catch(e){n(String(e))}else if(iU.STR&t)try{return JSON.parse(e.substring(s,a-Number(o))+'"')}catch(t){return JSON.parse(e.substring(s,e.lastIndexOf("\\"))+'"')}i("Unterminated string literal")},l=()=>{a++,d();let n={};try{for(;"}"!==e[a];){if(d(),a>=r&&iU.OBJ&t)return n;let i=o();d(),a++;try{let e=s();Object.defineProperty(n,i,{value:e,writable:!0,enumerable:!0,configurable:!0})}catch(e){if(iU.OBJ&t)return n;throw e}d(),","===e[a]&&a++}}catch(e){if(iU.OBJ&t)return n;i("Expected '}' at end of object")}return a++,n},u=()=>{a++;let r=[];try{for(;"]"!==e[a];)r.push(s()),d(),","===e[a]&&a++}catch(e){if(iU.ARR&t)return r;i("Expected ']' at end of array")}return a++,r},c=()=>{if(0===a){"-"===e&&iU.NUM&t&&i("Not sure what '-' is");try{return JSON.parse(e)}catch(r){if(iU.NUM&t)try{if("."===e[e.length-1])return JSON.parse(e.substring(0,e.lastIndexOf(".")));return JSON.parse(e.substring(0,e.lastIndexOf("e")))}catch(e){}n(String(r))}}let s=a;for("-"===e[a]&&a++;e[a]&&!",]}".includes(e[a]);)a++;a!=r||iU.NUM&t||i("Unterminated number literal");try{return JSON.parse(e.substring(s,a))}catch(r){"-"===e.substring(s,a)&&iU.NUM&t&&i("Not sure what '-' is");try{return JSON.parse(e.substring(s,e.lastIndexOf("e")))}catch(e){n(String(e))}}},d=()=>{for(;a<r&&" \n\r	".includes(e[a]);)a++};return s()},iz=e=>(function(e,t=iU.ALL){if("string"!=typeof e)throw TypeError(`expecting str, got ${typeof e}`);if(!e.trim())throw Error(`${e} is empty`);return iF(e.trim(),t)})(e,iU.ALL^iU.NUM);var iB=function(e,t,r,a,i){if("m"===a)throw TypeError("Private method is not writable");if("a"===a&&!i)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===a?i.call(e,r):i?i.value=r:t.set(e,r),r},iZ=function(e,t,r,a){if("a"===r&&!a)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!a:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?a:"a"===r?a.call(e):a?a.value:t.get(e)};class iJ extends iC{constructor(e){super(),rn.add(this),rs.set(this,void 0),ro.set(this,void 0),rl.set(this,void 0),iB(this,rs,e,"f"),iB(this,ro,[],"f")}get currentChatCompletionSnapshot(){return iZ(this,rl,"f")}static fromReadableStream(e){let t=new iJ(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,r){let a=new iJ(t);return a._run(()=>a._runChatCompletion(e,{...t,stream:!0},{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})),a}async _createChatCompletion(e,t,r){super._createChatCompletion;let a=r?.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort())),iZ(this,rn,"m",ru).call(this);let i=await e.chat.completions.create({...t,stream:!0},{...r,signal:this.controller.signal});for await(let e of(this._connected(),i))iZ(this,rn,"m",rd).call(this,e);if(i.controller.signal?.aborted)throw new t$;return this._addChatCompletion(iZ(this,rn,"m",rm).call(this))}async _fromReadableStream(e,t){let r;let a=t?.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort())),iZ(this,rn,"m",ru).call(this),this._connected();let i=rX.fromReadableStream(e,this.controller);for await(let e of i)r&&r!==e.id&&this._addChatCompletion(iZ(this,rn,"m",rm).call(this)),iZ(this,rn,"m",rd).call(this,e),r=e.id;if(i.controller.signal?.aborted)throw new t$;return this._addChatCompletion(iZ(this,rn,"m",rm).call(this))}[(rs=new WeakMap,ro=new WeakMap,rl=new WeakMap,rn=new WeakSet,ru=function(){this.ended||iB(this,rl,void 0,"f")},rc=function(e){let t=iZ(this,ro,"f")[e.index];return t||(t={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},iZ(this,ro,"f")[e.index]=t),t},rd=function(e){if(this.ended)return;let t=iZ(this,rn,"m",rg).call(this,e);for(let r of(this._emit("chunk",e,t),e.choices)){let e=t.choices[r.index];null!=r.delta.content&&e.message?.role==="assistant"&&e.message?.content&&(this._emit("content",r.delta.content,e.message.content),this._emit("content.delta",{delta:r.delta.content,snapshot:e.message.content,parsed:e.message.parsed})),null!=r.delta.refusal&&e.message?.role==="assistant"&&e.message?.refusal&&this._emit("refusal.delta",{delta:r.delta.refusal,snapshot:e.message.refusal}),r.logprobs?.content!=null&&e.message?.role==="assistant"&&this._emit("logprobs.content.delta",{content:r.logprobs?.content,snapshot:e.logprobs?.content??[]}),r.logprobs?.refusal!=null&&e.message?.role==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:r.logprobs?.refusal,snapshot:e.logprobs?.refusal??[]});let a=iZ(this,rn,"m",rc).call(this,e);for(let t of(e.finish_reason&&(iZ(this,rn,"m",rp).call(this,e),null!=a.current_tool_call_index&&iZ(this,rn,"m",rh).call(this,e,a.current_tool_call_index)),r.delta.tool_calls??[]))a.current_tool_call_index!==t.index&&(iZ(this,rn,"m",rp).call(this,e),null!=a.current_tool_call_index&&iZ(this,rn,"m",rh).call(this,e,a.current_tool_call_index)),a.current_tool_call_index=t.index;for(let t of r.delta.tool_calls??[]){let r=e.message.tool_calls?.[t.index];r?.type&&(r?.type==="function"?this._emit("tool_calls.function.arguments.delta",{name:r.function?.name,index:t.index,arguments:r.function.arguments,parsed_arguments:r.function.parsed_arguments,arguments_delta:t.function?.arguments??""}):r?.type)}}},rh=function(e,t){if(iZ(this,rn,"m",rc).call(this,e).done_tool_calls.has(t))return;let r=e.message.tool_calls?.[t];if(!r)throw Error("no tool call snapshot");if(!r.type)throw Error("tool call snapshot missing `type`");if("function"===r.type){let e=iZ(this,rs,"f")?.tools?.find(e=>"function"===e.type&&e.function.name===r.function.name);this._emit("tool_calls.function.arguments.done",{name:r.function.name,index:t,arguments:r.function.arguments,parsed_arguments:ij(e)?e.$parseRaw(r.function.arguments):e?.function.strict?JSON.parse(r.function.arguments):null})}else r.type},rp=function(e){let t=iZ(this,rn,"m",rc).call(this,e);if(e.message.content&&!t.content_done){t.content_done=!0;let r=iZ(this,rn,"m",rf).call(this);this._emit("content.done",{content:e.message.content,parsed:r?r.$parseRaw(e.message.content):null})}e.message.refusal&&!t.refusal_done&&(t.refusal_done=!0,this._emit("refusal.done",{refusal:e.message.refusal})),e.logprobs?.content&&!t.logprobs_content_done&&(t.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:e.logprobs.content})),e.logprobs?.refusal&&!t.logprobs_refusal_done&&(t.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:e.logprobs.refusal}))},rm=function(){if(this.ended)throw new tj("stream has ended, this shouldn't happen");let e=iZ(this,rl,"f");if(!e)throw new tj("request ended without sending any chunks");return iB(this,rl,void 0,"f"),iB(this,ro,[],"f"),function(e,t){var r;let{id:a,choices:i,created:n,model:s,system_fingerprint:o,...l}=e;return r={...l,id:a,choices:i.map(({message:t,finish_reason:r,index:a,logprobs:i,...n})=>{if(!r)throw new tj(`missing finish_reason for choice ${a}`);let{content:s=null,function_call:o,tool_calls:l,...u}=t,c=t.role;if(!c)throw new tj(`missing role for choice ${a}`);if(o){let{arguments:e,name:l}=o;if(null==e)throw new tj(`missing function_call.arguments for choice ${a}`);if(!l)throw new tj(`missing function_call.name for choice ${a}`);return{...n,message:{content:s,function_call:{arguments:e,name:l},role:c,refusal:t.refusal??null},finish_reason:r,index:a,logprobs:i}}return l?{...n,index:a,finish_reason:r,logprobs:i,message:{...u,role:c,content:s,refusal:t.refusal??null,tool_calls:l.map((t,r)=>{let{function:i,type:n,id:s,...o}=t,{arguments:l,name:u,...c}=i||{};if(null==s)throw new tj(`missing choices[${a}].tool_calls[${r}].id
${iq(e)}`);if(null==n)throw new tj(`missing choices[${a}].tool_calls[${r}].type
${iq(e)}`);if(null==u)throw new tj(`missing choices[${a}].tool_calls[${r}].function.name
${iq(e)}`);if(null==l)throw new tj(`missing choices[${a}].tool_calls[${r}].function.arguments
${iq(e)}`);return{...o,id:s,type:n,function:{...c,name:u,arguments:l}}})}}:{...n,message:{...u,content:s,role:c,refusal:t.refusal??null},finish_reason:r,index:a,logprobs:i}}),created:n,model:s,object:"chat.completion",...o?{system_fingerprint:o}:{}},t&&i$(t)?iN(r,t):{...r,choices:r.choices.map(e=>({...e,message:{...e.message,parsed:null,...e.message.tool_calls?{tool_calls:e.message.tool_calls}:void 0}}))}}(e,iZ(this,rs,"f"))},rf=function(){let e=iZ(this,rs,"f")?.response_format;return iT(e)?e:null},rg=function(e){var t,r,a,i;let n=iZ(this,rl,"f"),{choices:s,...o}=e;for(let{delta:s,finish_reason:l,index:u,logprobs:c=null,...d}of(n?Object.assign(n,o):n=iB(this,rl,{...o,choices:[]},"f"),e.choices)){let e=n.choices[u];if(e||(e=n.choices[u]={finish_reason:l,index:u,message:{},logprobs:c,...d}),c){if(e.logprobs){let{content:a,refusal:i,...n}=c;Object.assign(e.logprobs,n),a&&((t=e.logprobs).content??(t.content=[]),e.logprobs.content.push(...a)),i&&((r=e.logprobs).refusal??(r.refusal=[]),e.logprobs.refusal.push(...i))}else e.logprobs=Object.assign({},c)}if(l&&(e.finish_reason=l,iZ(this,rs,"f")&&i$(iZ(this,rs,"f")))){if("length"===l)throw new tJ;if("content_filter"===l)throw new tq}if(Object.assign(e,d),!s)continue;let{content:o,refusal:h,function_call:p,role:m,tool_calls:f,...g}=s;if(Object.assign(e.message,g),h&&(e.message.refusal=(e.message.refusal||"")+h),m&&(e.message.role=m),p&&(e.message.function_call?(p.name&&(e.message.function_call.name=p.name),p.arguments&&((a=e.message.function_call).arguments??(a.arguments=""),e.message.function_call.arguments+=p.arguments)):e.message.function_call=p),o&&(e.message.content=(e.message.content||"")+o,!e.message.refusal&&iZ(this,rn,"m",rf).call(this)&&(e.message.parsed=iz(e.message.content))),f)for(let{index:t,id:r,type:a,function:n,...s}of(e.message.tool_calls||(e.message.tool_calls=[]),f)){let o=(i=e.message.tool_calls)[t]??(i[t]={});Object.assign(o,s),r&&(o.id=r),a&&(o.type=a),n&&(o.function??(o.function={name:n.name??"",arguments:""})),n?.name&&(o.function.name=n.name),n?.arguments&&(o.function.arguments+=n.arguments,function(e,t){if(!e)return!1;let r=e.tools?.find(e=>e.function?.name===t.function.name);return ij(r)||r?.function.strict||!1}(iZ(this,rs,"f"),o)&&(o.function.parsed_arguments=iz(o.function.arguments)))}}return n},Symbol.asyncIterator)](){let e=[],t=[],r=!1;return this.on("chunk",r=>{let a=t.shift();a?a.resolve(r):e.push(r)}),this.on("end",()=>{for(let e of(r=!0,t))e.resolve(void 0);t.length=0}),this.on("abort",e=>{for(let a of(r=!0,t))a.reject(e);t.length=0}),this.on("error",e=>{for(let a of(r=!0,t))a.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((e,r)=>t.push({resolve:e,reject:r})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new rX(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function iq(e){return JSON.stringify(e)}class iG extends iJ{static fromReadableStream(e){let t=new iG(null);return t._run(()=>t._fromReadableStream(e)),t}static runFunctions(e,t,r){let a=new iG(null),i={...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"runFunctions"}};return a._run(()=>a._runFunctions(e,t,i)),a}static runTools(e,t,r){let a=new iG(t),i={...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"runTools"}};return a._run(()=>a._runTools(e,t,i)),a}}class iW extends az{parse(e,t){return!function(e){for(let t of e??[]){if("function"!==t.type)throw new tj(`Currently only \`function\` tool types support auto-parsing; Received \`${t.type}\``);if(!0!==t.function.strict)throw new tj(`The \`${t.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t?.headers,"X-Stainless-Helper-Method":"beta.chat.completions.parse"}})._thenUnwrap(t=>iN(t,e))}runFunctions(e,t){return e.stream?iG.runFunctions(this._client,e,t):iL.runFunctions(this._client,e,t)}runTools(e,t){return e.stream?iG.runTools(this._client,e,t):iL.runTools(this._client,e,t)}stream(e,t){return iJ.createChatCompletion(this._client,e,t)}}class iH extends az{constructor(){super(...arguments),this.completions=new iW(this._client)}}(iH||(iH={})).Completions=iW;class iY extends az{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}}class iV extends az{create(e,t){return this._client.post("/realtime/transcription_sessions",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}}class iK extends az{constructor(){super(...arguments),this.sessions=new iY(this._client),this.transcriptionSessions=new iV(this._client)}}iK.Sessions=iY,iK.TranscriptionSessions=iV;var iX=function(e,t,r,a){if("a"===r&&!a)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!a:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?a:"a"===r?a.call(e):a?a.value:t.get(e)},iQ=function(e,t,r,a,i){if("m"===a)throw TypeError("Private method is not writable");if("a"===a&&!i)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===a?i.call(e,r):i?i.value=r:t.set(e,r),r};class i0 extends iA{constructor(){super(...arguments),ry.add(this),rb.set(this,[]),r_.set(this,{}),rv.set(this,{}),rw.set(this,void 0),rO.set(this,void 0),rI.set(this,void 0),rk.set(this,void 0),rE.set(this,void 0),rx.set(this,void 0),rS.set(this,void 0),rP.set(this,void 0),rA.set(this,void 0)}[(rb=new WeakMap,r_=new WeakMap,rv=new WeakMap,rw=new WeakMap,rO=new WeakMap,rI=new WeakMap,rk=new WeakMap,rE=new WeakMap,rx=new WeakMap,rS=new WeakMap,rP=new WeakMap,rA=new WeakMap,ry=new WeakSet,Symbol.asyncIterator)](){let e=[],t=[],r=!1;return this.on("event",r=>{let a=t.shift();a?a.resolve(r):e.push(r)}),this.on("end",()=>{for(let e of(r=!0,t))e.resolve(void 0);t.length=0}),this.on("abort",e=>{for(let a of(r=!0,t))a.reject(e);t.length=0}),this.on("error",e=>{for(let a of(r=!0,t))a.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((e,r)=>t.push({resolve:e,reject:r})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){let t=new i0;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){let r=t?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),this._connected();let a=rX.fromReadableStream(e,this.controller);for await(let e of a)iX(this,ry,"m",rT).call(this,e);if(a.controller.signal?.aborted)throw new t$;return this._addRun(iX(this,ry,"m",rj).call(this))}toReadableStream(){return new rX(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,r,a,i){let n=new i0;return n._run(()=>n._runToolAssistantStream(e,t,r,a,{...i,headers:{...i?.headers,"X-Stainless-Helper-Method":"stream"}})),n}async _createToolAssistantStream(e,t,r,a,i){let n=i?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort()));let s={...a,stream:!0},o=await e.submitToolOutputs(t,r,s,{...i,signal:this.controller.signal});for await(let e of(this._connected(),o))iX(this,ry,"m",rT).call(this,e);if(o.controller.signal?.aborted)throw new t$;return this._addRun(iX(this,ry,"m",rj).call(this))}static createThreadAssistantStream(e,t,r){let a=new i0;return a._run(()=>a._threadAssistantStream(e,t,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})),a}static createAssistantStream(e,t,r,a){let i=new i0;return i._run(()=>i._runAssistantStream(e,t,r,{...a,headers:{...a?.headers,"X-Stainless-Helper-Method":"stream"}})),i}currentEvent(){return iX(this,rS,"f")}currentRun(){return iX(this,rP,"f")}currentMessageSnapshot(){return iX(this,rw,"f")}currentRunStepSnapshot(){return iX(this,rA,"f")}async finalRunSteps(){return await this.done(),Object.values(iX(this,r_,"f"))}async finalMessages(){return await this.done(),Object.values(iX(this,rv,"f"))}async finalRun(){if(await this.done(),!iX(this,rO,"f"))throw Error("Final run was not received.");return iX(this,rO,"f")}async _createThreadAssistantStream(e,t,r){let a=r?.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));let i={...t,stream:!0},n=await e.createAndRun(i,{...r,signal:this.controller.signal});for await(let e of(this._connected(),n))iX(this,ry,"m",rT).call(this,e);if(n.controller.signal?.aborted)throw new t$;return this._addRun(iX(this,ry,"m",rj).call(this))}async _createAssistantStream(e,t,r,a){let i=a?.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));let n={...r,stream:!0},s=await e.create(t,n,{...a,signal:this.controller.signal});for await(let e of(this._connected(),s))iX(this,ry,"m",rT).call(this,e);if(s.controller.signal?.aborted)throw new t$;return this._addRun(iX(this,ry,"m",rj).call(this))}static accumulateDelta(e,t){for(let[r,a]of Object.entries(t)){if(!e.hasOwnProperty(r)){e[r]=a;continue}let t=e[r];if(null==t||"index"===r||"type"===r){e[r]=a;continue}if("string"==typeof t&&"string"==typeof a)t+=a;else if("number"==typeof t&&"number"==typeof a)t+=a;else if(aF(t)&&aF(a))t=this.accumulateDelta(t,a);else if(Array.isArray(t)&&Array.isArray(a)){if(t.every(e=>"string"==typeof e||"number"==typeof e)){t.push(...a);continue}for(let e of a){if(!aF(e))throw Error(`Expected array delta entry to be an object but got: ${e}`);let r=e.index;if(null==r)throw console.error(e),Error("Expected array delta entry to have an `index` property");if("number"!=typeof r)throw Error(`Expected array delta entry \`index\` property to be a number but got ${r}`);let a=t[r];null==a?t.push(e):t[r]=this.accumulateDelta(a,e)}continue}else throw Error(`Unhandled record type: ${r}, deltaValue: ${a}, accValue: ${t}`);e[r]=t}return e}_addRun(e){return e}async _threadAssistantStream(e,t,r){return await this._createThreadAssistantStream(t,e,r)}async _runAssistantStream(e,t,r,a){return await this._createAssistantStream(t,e,r,a)}async _runToolAssistantStream(e,t,r,a,i){return await this._createToolAssistantStream(r,e,t,a,i)}}rT=function(e){if(!this.ended)switch(iQ(this,rS,e,"f"),iX(this,ry,"m",rR).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":iX(this,ry,"m",rM).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":iX(this,ry,"m",r$).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":iX(this,ry,"m",rN).call(this,e);break;case"error":throw Error("Encountered an error event in event processing - errors should be processed earlier")}},rj=function(){if(this.ended)throw new tj("stream has ended, this shouldn't happen");if(!iX(this,rO,"f"))throw Error("Final run has not been received");return iX(this,rO,"f")},rN=function(e){let[t,r]=iX(this,ry,"m",rL).call(this,e,iX(this,rw,"f"));for(let e of(iQ(this,rw,t,"f"),iX(this,rv,"f")[t.id]=t,r)){let r=t.content[e.index];r?.type=="text"&&this._emit("textCreated",r.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(let r of e.data.delta.content){if("text"==r.type&&r.text){let e=r.text,a=t.content[r.index];if(a&&"text"==a.type)this._emit("textDelta",e,a.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(r.index!=iX(this,rI,"f")){if(iX(this,rk,"f"))switch(iX(this,rk,"f").type){case"text":this._emit("textDone",iX(this,rk,"f").text,iX(this,rw,"f"));break;case"image_file":this._emit("imageFileDone",iX(this,rk,"f").image_file,iX(this,rw,"f"))}iQ(this,rI,r.index,"f")}iQ(this,rk,t.content[r.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(void 0!==iX(this,rI,"f")){let t=e.data.content[iX(this,rI,"f")];if(t)switch(t.type){case"image_file":this._emit("imageFileDone",t.image_file,iX(this,rw,"f"));break;case"text":this._emit("textDone",t.text,iX(this,rw,"f"))}}iX(this,rw,"f")&&this._emit("messageDone",e.data),iQ(this,rw,void 0,"f")}},r$=function(e){let t=iX(this,ry,"m",rC).call(this,e);switch(iQ(this,rA,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":let r=e.data.delta;if(r.step_details&&"tool_calls"==r.step_details.type&&r.step_details.tool_calls&&"tool_calls"==t.step_details.type)for(let e of r.step_details.tool_calls)e.index==iX(this,rE,"f")?this._emit("toolCallDelta",e,t.step_details.tool_calls[e.index]):(iX(this,rx,"f")&&this._emit("toolCallDone",iX(this,rx,"f")),iQ(this,rE,e.index,"f"),iQ(this,rx,t.step_details.tool_calls[e.index],"f"),iX(this,rx,"f")&&this._emit("toolCallCreated",iX(this,rx,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":iQ(this,rA,void 0,"f"),"tool_calls"==e.data.step_details.type&&iX(this,rx,"f")&&(this._emit("toolCallDone",iX(this,rx,"f")),iQ(this,rx,void 0,"f")),this._emit("runStepDone",e.data,t)}},rR=function(e){iX(this,rb,"f").push(e),this._emit("event",e)},rC=function(e){switch(e.event){case"thread.run.step.created":return iX(this,r_,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=iX(this,r_,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let r=e.data;if(r.delta){let a=i0.accumulateDelta(t,r.delta);iX(this,r_,"f")[e.data.id]=a}return iX(this,r_,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":iX(this,r_,"f")[e.data.id]=e.data}if(iX(this,r_,"f")[e.data.id])return iX(this,r_,"f")[e.data.id];throw Error("No snapshot available")},rL=function(e,t){let r=[];switch(e.event){case"thread.message.created":return[e.data,r];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let a=e.data;if(a.delta.content)for(let e of a.delta.content)if(e.index in t.content){let r=t.content[e.index];t.content[e.index]=iX(this,ry,"m",rU).call(this,e,r)}else t.content[e.index]=e,r.push(e);return[t,r];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,r];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},rU=function(e,t){return i0.accumulateDelta(t,e)},rM=function(e){switch(iQ(this,rP,e.data,"f"),e.event){case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":iQ(this,rO,e.data,"f"),iX(this,rx,"f")&&(this._emit("toolCallDone",iX(this,rx,"f")),iQ(this,rx,void 0,"f"))}};class i1 extends az{create(e,t,r){return this._client.post(`/threads/${e}/messages`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}retrieve(e,t,r){return this._client.get(`/threads/${e}/messages/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}update(e,t,r,a){return this._client.post(`/threads/${e}/messages/${t}`,{body:r,...a,headers:{"OpenAI-Beta":"assistants=v2",...a?.headers}})}list(e,t={},r){return ab(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/messages`,i4,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}del(e,t,r){return this._client.delete(`/threads/${e}/messages/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}}class i4 extends aq{}i1.MessagesPage=i4;class i2 extends az{retrieve(e,t,r,a={},i){return ab(a)?this.retrieve(e,t,r,{},a):this._client.get(`/threads/${e}/runs/${t}/steps/${r}`,{query:a,...i,headers:{"OpenAI-Beta":"assistants=v2",...i?.headers}})}list(e,t,r={},a){return ab(r)?this.list(e,t,{},r):this._client.getAPIList(`/threads/${e}/runs/${t}/steps`,i6,{query:r,...a,headers:{"OpenAI-Beta":"assistants=v2",...a?.headers}})}}class i6 extends aq{}i2.RunStepsPage=i6;class i9 extends az{constructor(){super(...arguments),this.steps=new i2(this._client)}create(e,t,r){let{include:a,...i}=t;return this._client.post(`/threads/${e}/runs`,{query:{include:a},body:i,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers},stream:t.stream??!1})}retrieve(e,t,r){return this._client.get(`/threads/${e}/runs/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}update(e,t,r,a){return this._client.post(`/threads/${e}/runs/${t}`,{body:r,...a,headers:{"OpenAI-Beta":"assistants=v2",...a?.headers}})}list(e,t={},r){return ab(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/runs`,i3,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}cancel(e,t,r){return this._client.post(`/threads/${e}/runs/${t}/cancel`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}async createAndPoll(e,t,r){let a=await this.create(e,t,r);return await this.poll(e,a.id,r)}createAndStream(e,t,r){return i0.createAssistantStream(e,this._client.beta.threads.runs,t,r)}async poll(e,t,r){let a={...r?.headers,"X-Stainless-Poll-Helper":"true"};for(r?.pollIntervalMs&&(a["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){let{data:i,response:n}=await this.retrieve(e,t,{...r,headers:{...r?.headers,...a}}).withResponse();switch(i.status){case"queued":case"in_progress":case"cancelling":let s=5e3;if(r?.pollIntervalMs)s=r.pollIntervalMs;else{let e=n.headers.get("openai-poll-after-ms");if(e){let t=parseInt(e);isNaN(t)||(s=t)}}await ax(s);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return i}}}stream(e,t,r){return i0.createAssistantStream(e,this._client.beta.threads.runs,t,r)}submitToolOutputs(e,t,r,a){return this._client.post(`/threads/${e}/runs/${t}/submit_tool_outputs`,{body:r,...a,headers:{"OpenAI-Beta":"assistants=v2",...a?.headers},stream:r.stream??!1})}async submitToolOutputsAndPoll(e,t,r,a){let i=await this.submitToolOutputs(e,t,r,a);return await this.poll(e,i.id,a)}submitToolOutputsStream(e,t,r,a){return i0.createToolAssistantStream(e,t,this._client.beta.threads.runs,r,a)}}class i3 extends aq{}i9.RunsPage=i3,i9.Steps=i2,i9.RunStepsPage=i6;class i5 extends az{constructor(){super(...arguments),this.runs=new i9(this._client),this.messages=new i1(this._client)}create(e={},t){return ab(e)?this.create({},e):this._client.post("/threads",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}retrieve(e,t){return this._client.get(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}update(e,t,r){return this._client.post(`/threads/${e}`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}del(e,t){return this._client.delete(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers},stream:e.stream??!1})}async createAndRunPoll(e,t){let r=await this.createAndRun(e,t);return await this.runs.poll(r.thread_id,r.id,t)}createAndRunStream(e,t){return i0.createThreadAssistantStream(e,this._client.beta.threads,t)}}i5.Runs=i9,i5.RunsPage=i3,i5.Messages=i1,i5.MessagesPage=i4;class i8 extends az{constructor(){super(...arguments),this.realtime=new iK(this._client),this.chat=new iH(this._client),this.assistants=new iw(this._client),this.threads=new i5(this._client)}}i8.Realtime=iK,i8.Assistants=iw,i8.AssistantsPage=iO,i8.Threads=i5;class i7 extends az{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(`/batches/${e}`,t)}list(e={},t){return ab(e)?this.list({},e):this._client.getAPIList("/batches",ne,{query:e,...t})}cancel(e,t){return this._client.post(`/batches/${e}/cancel`,t)}}class ne extends aq{}i7.BatchesPage=ne;class nt extends az{create(e,t,r){return this._client.post(`/uploads/${e}/parts`,ar({body:t,...r}))}}class nr extends az{constructor(){super(...arguments),this.parts=new nt(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(`/uploads/${e}/cancel`,t)}complete(e,t,r){return this._client.post(`/uploads/${e}/complete`,{body:t,...r})}}function na(e,t){let r=e.output.map(e=>{if("function_call"===e.type)return{...e,parsed_arguments:function(e,t){let r=function(e,t){return e.find(e=>"function"===e.type&&e.name===t)}(e.tools??[],t.name);return{...t,...t,parsed_arguments:function(e){return e?.$brand==="auto-parseable-tool"}(r)?r.$parseRaw(t.arguments):r?.strict?JSON.parse(t.arguments):null}}(t,e)};if("message"===e.type){let r=e.content.map(e=>{var r,a;return"output_text"===e.type?{...e,parsed:(r=t,a=e.text,r.text?.format?.type!=="json_schema"?null:"$parseRaw"in r.text?.format?(r.text?.format).$parseRaw(a):JSON.parse(a))}:e});return{...e,content:r}}return e}),a=Object.assign({},e,{output:r});return Object.getOwnPropertyDescriptor(e,"output_text")||ni(a),Object.defineProperty(a,"output_parsed",{enumerable:!0,get(){for(let e of a.output)if("message"===e.type){for(let t of e.content)if("output_text"===t.type&&null!==t.parsed)return t.parsed}return null}}),a}nr.Parts=nt;function ni(e){let t=[];for(let r of e.output)if("message"===r.type)for(let e of r.content)"output_text"===e.type&&t.push(e.text);e.output_text=t.join("")}class nn extends az{list(e,t={},r){return ab(t)?this.list(e,{},t):this._client.getAPIList(`/responses/${e}/input_items`,nc,{query:t,...r})}}var ns=function(e,t,r,a,i){if("m"===a)throw TypeError("Private method is not writable");if("a"===a&&!i)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===a?i.call(e,r):i?i.value=r:t.set(e,r),r},no=function(e,t,r,a){if("a"===r&&!a)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!a:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?a:"a"===r?a.call(e):a?a.value:t.get(e)};class nl extends iA{constructor(e){super(),rD.add(this),rF.set(this,void 0),rz.set(this,void 0),rB.set(this,void 0),ns(this,rF,e,"f")}static createResponse(e,t,r){let a=new nl(t);return a._run(()=>a._createOrRetrieveResponse(e,t,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})),a}async _createOrRetrieveResponse(e,t,r){let a;let i=r?.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort())),no(this,rD,"m",rZ).call(this);let n=null;for await(let i of("response_id"in t?(a=await e.responses.retrieve(t.response_id,{stream:!0},{...r,signal:this.controller.signal,stream:!0}),n=t.starting_after??null):a=await e.responses.create({...t,stream:!0},{...r,signal:this.controller.signal}),this._connected(),a))no(this,rD,"m",rJ).call(this,i,n);if(a.controller.signal?.aborted)throw new t$;return no(this,rD,"m",rq).call(this)}[(rF=new WeakMap,rz=new WeakMap,rB=new WeakMap,rD=new WeakSet,rZ=function(){this.ended||ns(this,rz,void 0,"f")},rJ=function(e,t){if(this.ended)return;let r=(e,r)=>{(null==t||r.sequence_number>t)&&this._emit(e,r)},a=no(this,rD,"m",rG).call(this,e);switch(r("event",e),e.type){case"response.output_text.delta":{let t=a.output[e.output_index];if(!t)throw new tj(`missing output at index ${e.output_index}`);if("message"===t.type){let a=t.content[e.content_index];if(!a)throw new tj(`missing content at index ${e.content_index}`);if("output_text"!==a.type)throw new tj(`expected content to be 'output_text', got ${a.type}`);r("response.output_text.delta",{...e,snapshot:a.text})}break}case"response.function_call_arguments.delta":{let t=a.output[e.output_index];if(!t)throw new tj(`missing output at index ${e.output_index}`);"function_call"===t.type&&r("response.function_call_arguments.delta",{...e,snapshot:t.arguments});break}default:r(e.type,e)}},rq=function(){if(this.ended)throw new tj("stream has ended, this shouldn't happen");let e=no(this,rz,"f");if(!e)throw new tj("request ended without sending any events");ns(this,rz,void 0,"f");let t=function(e,t){var r;return t&&(r=t,iT(r.text?.format))?na(e,t):{...e,output_parsed:null,output:e.output.map(e=>"function_call"===e.type?{...e,parsed_arguments:null}:"message"===e.type?{...e,content:e.content.map(e=>({...e,parsed:null}))}:e)}}(e,no(this,rF,"f"));return ns(this,rB,t,"f"),t},rG=function(e){let t=no(this,rz,"f");if(!t){if("response.created"!==e.type)throw new tj(`When snapshot hasn't been set yet, expected 'response.created' event, got ${e.type}`);return ns(this,rz,e.response,"f")}switch(e.type){case"response.output_item.added":t.output.push(e.item);break;case"response.content_part.added":{let r=t.output[e.output_index];if(!r)throw new tj(`missing output at index ${e.output_index}`);"message"===r.type&&r.content.push(e.part);break}case"response.output_text.delta":{let r=t.output[e.output_index];if(!r)throw new tj(`missing output at index ${e.output_index}`);if("message"===r.type){let t=r.content[e.content_index];if(!t)throw new tj(`missing content at index ${e.content_index}`);if("output_text"!==t.type)throw new tj(`expected content to be 'output_text', got ${t.type}`);t.text+=e.delta}break}case"response.function_call_arguments.delta":{let r=t.output[e.output_index];if(!r)throw new tj(`missing output at index ${e.output_index}`);"function_call"===r.type&&(r.arguments+=e.delta);break}case"response.completed":ns(this,rz,e.response,"f")}return t},Symbol.asyncIterator)](){let e=[],t=[],r=!1;return this.on("event",r=>{let a=t.shift();a?a.resolve(r):e.push(r)}),this.on("end",()=>{for(let e of(r=!0,t))e.resolve(void 0);t.length=0}),this.on("abort",e=>{for(let a of(r=!0,t))a.reject(e);t.length=0}),this.on("error",e=>{for(let a of(r=!0,t))a.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((e,r)=>t.push({resolve:e,reject:r})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();let e=no(this,rB,"f");if(!e)throw new tj("stream ended without producing a ChatCompletion");return e}}class nu extends az{constructor(){super(...arguments),this.inputItems=new nn(this._client)}create(e,t){return this._client.post("/responses",{body:e,...t,stream:e.stream??!1})._thenUnwrap(e=>("object"in e&&"response"===e.object&&ni(e),e))}retrieve(e,t={},r){return this._client.get(`/responses/${e}`,{query:t,...r,stream:t?.stream??!1})}del(e,t){return this._client.delete(`/responses/${e}`,{...t,headers:{Accept:"*/*",...t?.headers}})}parse(e,t){return this._client.responses.create(e,t)._thenUnwrap(t=>na(t,e))}stream(e,t){return nl.createResponse(this._client,e,t)}cancel(e,t){return this._client.post(`/responses/${e}/cancel`,{...t,headers:{Accept:"*/*",...t?.headers}})}}class nc extends aq{}nu.InputItems=nn;class nd extends az{retrieve(e,t,r,a){return this._client.get(`/evals/${e}/runs/${t}/output_items/${r}`,a)}list(e,t,r={},a){return ab(r)?this.list(e,t,{},r):this._client.getAPIList(`/evals/${e}/runs/${t}/output_items`,nh,{query:r,...a})}}class nh extends aq{}nd.OutputItemListResponsesPage=nh;class np extends az{constructor(){super(...arguments),this.outputItems=new nd(this._client)}create(e,t,r){return this._client.post(`/evals/${e}/runs`,{body:t,...r})}retrieve(e,t,r){return this._client.get(`/evals/${e}/runs/${t}`,r)}list(e,t={},r){return ab(t)?this.list(e,{},t):this._client.getAPIList(`/evals/${e}/runs`,nm,{query:t,...r})}del(e,t,r){return this._client.delete(`/evals/${e}/runs/${t}`,r)}cancel(e,t,r){return this._client.post(`/evals/${e}/runs/${t}`,r)}}class nm extends aq{}np.RunListResponsesPage=nm,np.OutputItems=nd,np.OutputItemListResponsesPage=nh;class nf extends az{constructor(){super(...arguments),this.runs=new np(this._client)}create(e,t){return this._client.post("/evals",{body:e,...t})}retrieve(e,t){return this._client.get(`/evals/${e}`,t)}update(e,t,r){return this._client.post(`/evals/${e}`,{body:t,...r})}list(e={},t){return ab(e)?this.list({},e):this._client.getAPIList("/evals",ng,{query:e,...t})}del(e,t){return this._client.delete(`/evals/${e}`,t)}}class ng extends aq{}nf.EvalListResponsesPage=ng,nf.Runs=np,nf.RunListResponsesPage=nm;class ny extends az{retrieve(e,t,r){return this._client.get(`/containers/${e}/files/${t}/content`,{...r,headers:{Accept:"application/binary",...r?.headers},__binaryResponse:!0})}}class nb extends az{constructor(){super(...arguments),this.content=new ny(this._client)}create(e,t,r){return this._client.post(`/containers/${e}/files`,ar({body:t,...r}))}retrieve(e,t,r){return this._client.get(`/containers/${e}/files/${t}`,r)}list(e,t={},r){return ab(t)?this.list(e,{},t):this._client.getAPIList(`/containers/${e}/files`,n_,{query:t,...r})}del(e,t,r){return this._client.delete(`/containers/${e}/files/${t}`,{...r,headers:{Accept:"*/*",...r?.headers}})}}class n_ extends aq{}nb.FileListResponsesPage=n_,nb.Content=ny;class nv extends az{constructor(){super(...arguments),this.files=new nb(this._client)}create(e,t){return this._client.post("/containers",{body:e,...t})}retrieve(e,t){return this._client.get(`/containers/${e}`,t)}list(e={},t){return ab(e)?this.list({},e):this._client.getAPIList("/containers",nw,{query:e,...t})}del(e,t){return this._client.delete(`/containers/${e}`,{...t,headers:{Accept:"*/*",...t?.headers}})}}class nw extends aq{}nv.ContainerListResponsesPage=nw,nv.Files=nb,nv.FileListResponsesPage=n_,r(49509);class nO extends ap{constructor({baseURL:e=aA("OPENAI_BASE_URL"),apiKey:t=aA("OPENAI_API_KEY"),organization:r=aA("OPENAI_ORG_ID")??null,project:a=aA("OPENAI_PROJECT_ID")??null,...i}={}){if(void 0===t)throw new tj("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");let n={apiKey:t,organization:r,project:a,...i,baseURL:e||"https://api.openai.com/v1"};if(!n.dangerouslyAllowBrowser&&aL())throw new tj("It looks like you're running in a browser-like environment.\n\nThis is disabled by default, as it risks exposing your secret API credentials to attackers.\nIf you understand the risks and have appropriate mitigations in place,\nyou can set the `dangerouslyAllowBrowser` option to `true`, e.g.,\n\nnew OpenAI({ apiKey, dangerouslyAllowBrowser: true });\n\nhttps://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety\n");super({baseURL:n.baseURL,timeout:n.timeout??6e5,httpAgent:n.httpAgent,maxRetries:n.maxRetries,fetch:n.fetch}),this.completions=new aB(this),this.chat=new aY(this),this.embeddings=new aV(this),this.files=new aK(this),this.images=new aQ(this),this.audio=new a2(this),this.moderations=new a6(this),this.models=new a9(this),this.fineTuning=new iu(this),this.graders=new id(this),this.vectorStores=new ib(this),this.beta=new i8(this),this.batches=new i7(this),this.uploads=new nr(this),this.responses=new nu(this),this.evals=new nf(this),this.containers=new nv(this),this._options=n,this.apiKey=t,this.organization=r,this.project=a}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}stringifyQuery(e){return function(e,t={}){let r,a,i=e,n=function(e=tE){let t;if(void 0!==e.allowEmptyArrays&&"boolean"!=typeof e.allowEmptyArrays)throw TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(void 0!==e.encodeDotInKeys&&"boolean"!=typeof e.encodeDotInKeys)throw TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==e.encoder&&void 0!==e.encoder&&"function"!=typeof e.encoder)throw TypeError("Encoder has to be a function.");let r=e.charset||tE.charset;if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let a=tm;if(void 0!==e.format){if(!t_.call(tf,e.format))throw TypeError("Unknown format option provided.");a=e.format}let i=tf[a],n=tE.filter;if(("function"==typeof e.filter||tw(e.filter))&&(n=e.filter),t=e.arrayFormat&&e.arrayFormat in tv?e.arrayFormat:"indices"in e?e.indices?"indices":"repeat":tE.arrayFormat,"commaRoundTrip"in e&&"boolean"!=typeof e.commaRoundTrip)throw TypeError("`commaRoundTrip` must be a boolean, or absent");let s=void 0===e.allowDots?!0==!!e.encodeDotInKeys||tE.allowDots:!!e.allowDots;return{addQueryPrefix:"boolean"==typeof e.addQueryPrefix?e.addQueryPrefix:tE.addQueryPrefix,allowDots:s,allowEmptyArrays:"boolean"==typeof e.allowEmptyArrays?!!e.allowEmptyArrays:tE.allowEmptyArrays,arrayFormat:t,charset:r,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:tE.charsetSentinel,commaRoundTrip:!!e.commaRoundTrip,delimiter:void 0===e.delimiter?tE.delimiter:e.delimiter,encode:"boolean"==typeof e.encode?e.encode:tE.encode,encodeDotInKeys:"boolean"==typeof e.encodeDotInKeys?e.encodeDotInKeys:tE.encodeDotInKeys,encoder:"function"==typeof e.encoder?e.encoder:tE.encoder,encodeValuesOnly:"boolean"==typeof e.encodeValuesOnly?e.encodeValuesOnly:tE.encodeValuesOnly,filter:n,format:a,formatter:i,serializeDate:"function"==typeof e.serializeDate?e.serializeDate:tE.serializeDate,skipNulls:"boolean"==typeof e.skipNulls?e.skipNulls:tE.skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:tE.strictNullHandling}}(t);"function"==typeof n.filter?i=(0,n.filter)("",i):tw(n.filter)&&(r=n.filter);let s=[];if("object"!=typeof i||null===i)return"";let o=tv[n.arrayFormat],l="comma"===o&&n.commaRoundTrip;r||(r=Object.keys(i)),n.sort&&r.sort(n.sort);let u=new WeakMap;for(let e=0;e<r.length;++e){let t=r[e];(!n.skipNulls||null!==i[t])&&tI(s,function e(t,r,a,i,n,s,o,l,u,c,d,h,p,m,f,g,y,b){var _,v;let w,O=t,I=b,k=0,E=!1;for(;void 0!==(I=I.get(tx))&&!E;){let e=I.get(t);if(k+=1,void 0!==e){if(e===k)throw RangeError("Cyclic object value");E=!0}void 0===I.get(tx)&&(k=0)}if("function"==typeof c?O=c(r,O):O instanceof Date?O=p?.(O):"comma"===a&&tw(O)&&(O=tb(O,function(e){return e instanceof Date?p?.(e):e})),null===O){if(s)return u&&!g?u(r,tE.encoder,y,"key",m):r;O=""}if("string"==typeof(_=O)||"number"==typeof _||"boolean"==typeof _||"symbol"==typeof _||"bigint"==typeof _||(v=O)&&"object"==typeof v&&v.constructor&&v.constructor.isBuffer&&v.constructor.isBuffer(v)){if(u){let e=g?r:u(r,tE.encoder,y,"key",m);return[f?.(e)+"="+f?.(u(O,tE.encoder,y,"value",m))]}return[f?.(r)+"="+f?.(String(O))]}let x=[];if(void 0===O)return x;if("comma"===a&&tw(O))g&&u&&(O=tb(O,u)),w=[{value:O.length>0?O.join(",")||null:void 0}];else if(tw(c))w=c;else{let e=Object.keys(O);w=d?e.sort(d):e}let S=l?String(r).replace(/\./g,"%2E"):String(r),P=i&&tw(O)&&1===O.length?S+"[]":S;if(n&&tw(O)&&0===O.length)return P+"[]";for(let r=0;r<w.length;++r){let _=w[r],v="object"==typeof _&&void 0!==_.value?_.value:O[_];if(o&&null===v)continue;let I=h&&l?_.replace(/\./g,"%2E"):_,E=tw(O)?"function"==typeof a?a(P,I):P:P+(h?"."+I:"["+I+"]");b.set(t,k);let S=new WeakMap;S.set(tx,b),tI(x,e(v,E,a,i,n,s,o,l,"comma"===a&&g&&tw(O)?null:u,c,d,h,p,m,f,g,y,S))}return x}(i[t],t,o,l,n.allowEmptyArrays,n.strictNullHandling,n.skipNulls,n.encodeDotInKeys,n.encode?n.encoder:null,n.filter,n.sort,n.allowDots,n.serializeDate,n.format,n.formatter,n.encodeValuesOnly,n.charset,u))}let c=s.join(n.delimiter),d=!0===n.addQueryPrefix?"?":"";return n.charsetSentinel&&("iso-8859-1"===n.charset?d+="utf8=%26%2310003%3B&":d+="utf8=%E2%9C%93&"),c.length>0?d+c:""}(e,{arrayFormat:"brackets"})}}nO.OpenAI=nO,nO.DEFAULT_TIMEOUT=6e5,nO.OpenAIError=tj,nO.APIError=tN,nO.APIConnectionError=tR,nO.APIConnectionTimeoutError=tC,nO.APIUserAbortError=t$,nO.NotFoundError=tD,nO.ConflictError=tF,nO.RateLimitError=tB,nO.BadRequestError=tL,nO.AuthenticationError=tU,nO.InternalServerError=tZ,nO.PermissionDeniedError=tM,nO.UnprocessableEntityError=tz,nO.toFile=r5,nO.fileFromPath=h,nO.Completions=aB,nO.Chat=aY,nO.ChatCompletionsPage=aW,nO.Embeddings=aV,nO.Files=aK,nO.FileObjectsPage=aX,nO.Images=aQ,nO.Audio=a2,nO.Moderations=a6,nO.Models=a9,nO.ModelsPage=a3,nO.FineTuning=iu,nO.Graders=id,nO.VectorStores=ib,nO.VectorStoresPage=i_,nO.VectorStoreSearchResponsesPage=iv,nO.Beta=i8,nO.Batches=i7,nO.BatchesPage=ne,nO.Uploads=nr,nO.Responses=nu,nO.Evals=nf,nO.EvalListResponsesPage=ng,nO.Containers=nv,nO.ContainerListResponsesPage=nw;var nI=r(5415),nk=r(43399),nE=r(4397),nx=r(46580),nS=r(34621),nP=r(58775),nA=r(4911),nT=r(14654),nj=r(4929),nN=r(59305),n$=r(41039),nR=r(34497);function nC(e,t){let r;if(void 0===e.function)return;if(t?.partial)try{r=(0,nj.d1)(e.function.arguments??"{}")}catch(e){return}else try{r=JSON.parse(e.function.arguments)}catch(t){throw new nT.CC([`Function "${e.function.name}" arguments:`,"",e.function.arguments,"","are not valid JSON.",`Error: ${t.message}`].join("\n"))}let a={name:e.function.name,args:r,type:"tool_call"};return t?.returnId&&(a.id=e.id),a}function nL(e){if(void 0===e.id)throw Error('All OpenAI tool calls must have an "id" field.');return{id:e.id,type:"function",function:{name:e.name,arguments:JSON.stringify(e.args)}}}function nU(e,t){return{name:e.function?.name,args:e.function?.arguments,id:e.id,error:t,type:"invalid_tool_call"}}class nM extends nN.T{static lc_name(){return"JsonOutputToolsParser"}constructor(e){super(e),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","openai_tools"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.returnId=e?.returnId??this.returnId}_diff(){throw Error("Not supported.")}async parse(){throw Error("Not implemented.")}async parseResult(e){return await this.parsePartialResult(e,!1)}async parsePartialResult(e,t=!0){let r;let a=e[0].message;if((0,n$.KX)(a)&&a.tool_calls?.length?r=a.tool_calls.map(e=>{let{id:t,...r}=e;return this.returnId?{id:t,...r}:r}):void 0!==a.additional_kwargs.tool_calls&&(r=JSON.parse(JSON.stringify(a.additional_kwargs.tool_calls)).map(e=>nC(e,{returnId:this.returnId,partial:t}))),!r)return[];let i=[];for(let e of r)if(void 0!==e){let t={type:e.name,args:e.args,id:e.id};i.push(t)}return i}}class nD extends nM{static lc_name(){return"JsonOutputKeyToolsParser"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","openai_tools"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"keyName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnSingle",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"zodSchema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keyName=e.keyName,this.returnSingle=e.returnSingle??this.returnSingle,this.zodSchema=e.zodSchema}async _validateResult(e){if(void 0===this.zodSchema)return e;let t=await (0,nR.K3)(this.zodSchema,e);if(t.success)return t.data;throw new nT.CC(`Failed to parse. Text: "${JSON.stringify(e,null,2)}". Error: ${JSON.stringify(t.error?.issues)}`,JSON.stringify(e,null,2))}async parsePartialResult(e){let t=(await super.parsePartialResult(e)).filter(e=>e.type===this.keyName),r=t;return t.length?(this.returnId||(r=t.map(e=>e.args)),this.returnSingle)?r[0]:r:void 0}async parseResult(e){let t=(await super.parsePartialResult(e,!1)).filter(e=>e.type===this.keyName),r=t;return t.length?(this.returnId||(r=t.map(e=>e.args)),this.returnSingle)?this._validateResult(r[0]):await Promise.all(r.map(e=>this._validateResult(e))):void 0}}var nF=r(71153);function nz(e,t,r,a){a?.errorMessages&&r&&(e.errorMessage={...e.errorMessage,[t]:r})}function nB(e,t,r,a,i){e[t]=r,nz(e,t,a,i)}let nZ=(e,t)=>n5(e.innerType._def,t),nJ=(e,t)=>{let r={type:"integer",format:"unix-time"};if("openApi3"===t.target)return r;for(let a of e.checks)switch(a.kind){case"min":nB(r,"minimum",a.value,a.message,t);break;case"max":nB(r,"maximum",a.value,a.message,t)}return r},nq=e=>(!("type"in e)||"string"!==e.type)&&"allOf"in e,nG={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(void 0===i&&(i=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),i),base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/};function nW(e,t){let r={type:"string"};function a(e){return"escape"===t.patternStrategy?nH(e):e}if(e.checks)for(let i of e.checks)switch(i.kind){case"min":nB(r,"minLength","number"==typeof r.minLength?Math.max(r.minLength,i.value):i.value,i.message,t);break;case"max":nB(r,"maxLength","number"==typeof r.maxLength?Math.min(r.maxLength,i.value):i.value,i.message,t);break;case"email":switch(t.emailStrategy){case"format:email":nY(r,"email",i.message,t);break;case"format:idn-email":nY(r,"idn-email",i.message,t);break;case"pattern:zod":nV(r,nG.email,i.message,t)}break;case"url":nY(r,"uri",i.message,t);break;case"uuid":nY(r,"uuid",i.message,t);break;case"regex":nV(r,i.regex,i.message,t);break;case"cuid":nV(r,nG.cuid,i.message,t);break;case"cuid2":nV(r,nG.cuid2,i.message,t);break;case"startsWith":nV(r,RegExp(`^${a(i.value)}`),i.message,t);break;case"endsWith":nV(r,RegExp(`${a(i.value)}$`),i.message,t);break;case"datetime":nY(r,"date-time",i.message,t);break;case"date":nY(r,"date",i.message,t);break;case"time":nY(r,"time",i.message,t);break;case"duration":nY(r,"duration",i.message,t);break;case"length":nB(r,"minLength","number"==typeof r.minLength?Math.max(r.minLength,i.value):i.value,i.message,t),nB(r,"maxLength","number"==typeof r.maxLength?Math.min(r.maxLength,i.value):i.value,i.message,t);break;case"includes":nV(r,RegExp(a(i.value)),i.message,t);break;case"ip":"v6"!==i.version&&nY(r,"ipv4",i.message,t),"v4"!==i.version&&nY(r,"ipv6",i.message,t);break;case"emoji":nV(r,nG.emoji,i.message,t);break;case"ulid":nV(r,nG.ulid,i.message,t);break;case"base64":switch(t.base64Strategy){case"format:binary":nY(r,"binary",i.message,t);break;case"contentEncoding:base64":nB(r,"contentEncoding","base64",i.message,t);break;case"pattern:zod":nV(r,nG.base64,i.message,t)}break;case"nanoid":nV(r,nG.nanoid,i.message,t);case"toLowerCase":case"toUpperCase":case"trim":break;default:}return r}let nH=e=>Array.from(e).map(e=>/[a-zA-Z0-9]/.test(e)?e:`\\${e}`).join(""),nY=(e,t,r,a)=>{e.format||e.anyOf?.some(e=>e.format)?(e.anyOf||(e.anyOf=[]),e.format&&(e.anyOf.push({format:e.format,...e.errorMessage&&a.errorMessages&&{errorMessage:{format:e.errorMessage.format}}}),delete e.format,e.errorMessage&&(delete e.errorMessage.format,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.anyOf.push({format:t,...r&&a.errorMessages&&{errorMessage:{format:r}}})):nB(e,"format",t,r,a)},nV=(e,t,r,a)=>{e.pattern||e.allOf?.some(e=>e.pattern)?(e.allOf||(e.allOf=[]),e.pattern&&(e.allOf.push({pattern:e.pattern,...e.errorMessage&&a.errorMessages&&{errorMessage:{pattern:e.errorMessage.pattern}}}),delete e.pattern,e.errorMessage&&(delete e.errorMessage.pattern,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.allOf.push({pattern:nK(t,a),...r&&a.errorMessages&&{errorMessage:{pattern:r}}})):nB(e,"pattern",nK(t,a),r,a)},nK=(e,t)=>{let r="function"==typeof e?e():e;if(!t.applyRegexFlags||!r.flags)return r.source;let a={i:r.flags.includes("i"),m:r.flags.includes("m"),s:r.flags.includes("s")},i=a.i?r.source.toLowerCase():r.source,n="",s=!1,o=!1,l=!1;for(let e=0;e<i.length;e++){if(s){n+=i[e],s=!1;continue}if(a.i){if(o){if(i[e].match(/[a-z]/)){l?(n+=i[e],n+=`${i[e-2]}-${i[e]}`.toUpperCase(),l=!1):"-"===i[e+1]&&i[e+2]?.match(/[a-z]/)?(n+=i[e],l=!0):n+=`${i[e]}${i[e].toUpperCase()}`;continue}}else if(i[e].match(/[a-z]/)){n+=`[${i[e]}${i[e].toUpperCase()}]`;continue}}if(a.m){if("^"===i[e]){n+=`(^|(?<=[\r
]))`;continue}if("$"===i[e]){n+=`($|(?=[\r
]))`;continue}}if(a.s&&"."===i[e]){n+=o?`${i[e]}\r
`:`[${i[e]}\r
]`;continue}n+=i[e],"\\"===i[e]?s=!0:o&&"]"===i[e]?o=!1:o||"["!==i[e]||(o=!0)}try{new RegExp(n)}catch{return console.warn(`Could not convert regex pattern at ${t.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),r.source}return n};function nX(e,t){if("openApi3"===t.target&&e.keyType?._def.typeName===nF.kY.ZodEnum)return{type:"object",required:e.keyType._def.values,properties:e.keyType._def.values.reduce((r,a)=>({...r,[a]:n5(e.valueType._def,{...t,currentPath:[...t.currentPath,"properties",a]})??{}}),{}),additionalProperties:!1};let r={type:"object",additionalProperties:n5(e.valueType._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??{}};if("openApi3"===t.target)return r;if(e.keyType?._def.typeName===nF.kY.ZodString&&e.keyType._def.checks?.length){let a=Object.entries(nW(e.keyType._def,t)).reduce((e,[t,r])=>"type"===t?e:{...e,[t]:r},{});return{...r,propertyNames:a}}return e.keyType?._def.typeName===nF.kY.ZodEnum?{...r,propertyNames:{enum:e.keyType._def.values}}:r}let nQ={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"},n0=(e,t)=>{let r=(e.options instanceof Map?Array.from(e.options.values()):e.options).map((e,r)=>n5(e._def,{...t,currentPath:[...t.currentPath,"anyOf",`${r}`]})).filter(e=>!!e&&(!t.strictUnions||"object"==typeof e&&Object.keys(e).length>0));return r.length?{anyOf:r}:void 0},n1=(e,t)=>{if(t.currentPath.toString()===t.propertyPath?.toString())return n5(e.innerType._def,t);let r=n5(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","1"]});return r?{anyOf:[{not:{}},r]}:{}},n4=(e,t)=>{if("input"===t.pipeStrategy)return n5(e.in._def,t);if("output"===t.pipeStrategy)return n5(e.out._def,t);let r=n5(e.in._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),a=n5(e.out._def,{...t,currentPath:[...t.currentPath,"allOf",r?"1":"0"]});return{allOf:[r,a].filter(e=>void 0!==e)}},n2=(e,t)=>n5(e.innerType._def,t),n6=Symbol("Let zodToJsonSchema decide on which parser to use"),n9={name:void 0,$refStrategy:"root",effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",nullableStrategy:"from-target",removeAdditionalStrategy:"passthrough",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},n3=e=>"string"==typeof e?{...n9,basePath:["#"],definitions:{},name:e}:{...n9,basePath:["#"],definitions:{},...e};function n5(e,t,r=!1){let a=t.seen.get(e);if(t.override){let i=t.override?.(e,t,a,r);if(i!==n6)return i}if(a&&!r){let e=n8(a,t);if(void 0!==e)return"$ref"in e&&t.seenRefs.add(e.$ref),e}let i={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.set(e,i);let n=se(e,e.typeName,t,r);return n&&st(e,t,n),i.jsonSchema=n,n}let n8=(e,t)=>{switch(t.$refStrategy){case"root":return{$ref:e.path.join("/")};case"extract-to-root":let r=e.path.slice(t.basePath.length+1).join("_");return r!==t.name&&"duplicate-ref"===t.nameStrategy&&(t.definitions[r]=e.def),{$ref:[...t.basePath,t.definitionPath,r].join("/")};case"relative":return{$ref:n7(t.currentPath,e.path)};case"none":case"seen":if(e.path.length<t.currentPath.length&&e.path.every((e,r)=>t.currentPath[r]===e))return console.warn(`Recursive reference detected at ${t.currentPath.join("/")}! Defaulting to any`),{};return"seen"===t.$refStrategy?{}:void 0}},n7=(e,t)=>{let r=0;for(;r<e.length&&r<t.length&&e[r]===t[r];r++);return[(e.length-r).toString(),...t.slice(r)].join("/")},se=(e,t,r,a)=>{switch(t){case nF.kY.ZodString:return nW(e,r);case nF.kY.ZodNumber:return function(e,t){let r={type:"number"};if(!e.checks)return r;for(let a of e.checks)switch(a.kind){case"int":r.type="integer",nz(r,"type",a.message,t);break;case"min":"jsonSchema7"===t.target?a.inclusive?nB(r,"minimum",a.value,a.message,t):nB(r,"exclusiveMinimum",a.value,a.message,t):(a.inclusive||(r.exclusiveMinimum=!0),nB(r,"minimum",a.value,a.message,t));break;case"max":"jsonSchema7"===t.target?a.inclusive?nB(r,"maximum",a.value,a.message,t):nB(r,"exclusiveMaximum",a.value,a.message,t):(a.inclusive||(r.exclusiveMaximum=!0),nB(r,"maximum",a.value,a.message,t));break;case"multipleOf":nB(r,"multipleOf",a.value,a.message,t)}return r}(e,r);case nF.kY.ZodObject:return function(e,t){let r={type:"object",...Object.entries(e.shape()).reduce((e,[r,a])=>{if(void 0===a||void 0===a._def)return e;let i=[...t.currentPath,"properties",r],n=n5(a._def,{...t,currentPath:i,propertyPath:i});return void 0===n?e:(t.openaiStrictMode&&a.isOptional()&&!a.isNullable()&&console.warn(`Zod field at \`${i.join("/")}\` uses \`.optional()\` without \`.nullable()\` which is not supported by the API. See: https://platform.openai.com/docs/guides/structured-outputs?api-mode=responses#all-fields-must-be-required
This will become an error in a future version of the SDK.`),{properties:{...e.properties,[r]:n},required:a.isOptional()&&!t.openaiStrictMode?e.required:[...e.required,r]})},{properties:{},required:[]}),additionalProperties:"strict"===t.removeAdditionalStrategy?"ZodNever"===e.catchall._def.typeName?"strict"!==e.unknownKeys:n5(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??!0:"ZodNever"===e.catchall._def.typeName?"passthrough"===e.unknownKeys:n5(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??!0};return r.required.length||delete r.required,r}(e,r);case nF.kY.ZodBigInt:return function(e,t){let r={type:"integer",format:"int64"};if(!e.checks)return r;for(let a of e.checks)switch(a.kind){case"min":"jsonSchema7"===t.target?a.inclusive?nB(r,"minimum",a.value,a.message,t):nB(r,"exclusiveMinimum",a.value,a.message,t):(a.inclusive||(r.exclusiveMinimum=!0),nB(r,"minimum",a.value,a.message,t));break;case"max":"jsonSchema7"===t.target?a.inclusive?nB(r,"maximum",a.value,a.message,t):nB(r,"exclusiveMaximum",a.value,a.message,t):(a.inclusive||(r.exclusiveMaximum=!0),nB(r,"maximum",a.value,a.message,t));break;case"multipleOf":nB(r,"multipleOf",a.value,a.message,t)}return r}(e,r);case nF.kY.ZodBoolean:return{type:"boolean"};case nF.kY.ZodDate:return function e(t,r,a){let i=a??r.dateStrategy;if(Array.isArray(i))return{anyOf:i.map((a,i)=>e(t,r,a))};switch(i){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return nJ(t,r)}}(e,r);case nF.kY.ZodUndefined:return{not:{}};case nF.kY.ZodNull:return"openApi3"===r.target?{enum:["null"],nullable:!0}:{type:"null"};case nF.kY.ZodArray:return function(e,t){let r={type:"array"};return e.type?._def?.typeName!==nF.kY.ZodAny&&(r.items=n5(e.type._def,{...t,currentPath:[...t.currentPath,"items"]})),e.minLength&&nB(r,"minItems",e.minLength.value,e.minLength.message,t),e.maxLength&&nB(r,"maxItems",e.maxLength.value,e.maxLength.message,t),e.exactLength&&(nB(r,"minItems",e.exactLength.value,e.exactLength.message,t),nB(r,"maxItems",e.exactLength.value,e.exactLength.message,t)),r}(e,r);case nF.kY.ZodUnion:case nF.kY.ZodDiscriminatedUnion:return function(e,t){if("openApi3"===t.target)return n0(e,t);let r=e.options instanceof Map?Array.from(e.options.values()):e.options;if(r.every(e=>e._def.typeName in nQ&&(!e._def.checks||!e._def.checks.length))){let e=r.reduce((e,t)=>{let r=nQ[t._def.typeName];return r&&!e.includes(r)?[...e,r]:e},[]);return{type:e.length>1?e:e[0]}}if(r.every(e=>"ZodLiteral"===e._def.typeName&&!e.description)){let e=r.reduce((e,t)=>{let r=typeof t._def.value;switch(r){case"string":case"number":case"boolean":return[...e,r];case"bigint":return[...e,"integer"];case"object":if(null===t._def.value)return[...e,"null"];default:return e}},[]);if(e.length===r.length){let t=e.filter((e,t,r)=>r.indexOf(e)===t);return{type:t.length>1?t:t[0],enum:r.reduce((e,t)=>e.includes(t._def.value)?e:[...e,t._def.value],[])}}}else if(r.every(e=>"ZodEnum"===e._def.typeName))return{type:"string",enum:r.reduce((e,t)=>[...e,...t._def.values.filter(t=>!e.includes(t))],[])};return n0(e,t)}(e,r);case nF.kY.ZodIntersection:return function(e,t){let r=[n5(e.left._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),n5(e.right._def,{...t,currentPath:[...t.currentPath,"allOf","1"]})].filter(e=>!!e),a="jsonSchema2019-09"===t.target?{unevaluatedProperties:!1}:void 0,i=[];return r.forEach(e=>{if(nq(e))i.push(...e.allOf),void 0===e.unevaluatedProperties&&(a=void 0);else{let t=e;if("additionalProperties"in e&&!1===e.additionalProperties){let{additionalProperties:r,...a}=e;t=a}else a=void 0;i.push(t)}}),i.length?{allOf:i,...a}:void 0}(e,r);case nF.kY.ZodTuple:return function(e,t){return e.rest?{type:"array",minItems:e.items.length,items:e.items.map((e,r)=>n5(e._def,{...t,currentPath:[...t.currentPath,"items",`${r}`]})).reduce((e,t)=>void 0===t?e:[...e,t],[]),additionalItems:n5(e.rest._def,{...t,currentPath:[...t.currentPath,"additionalItems"]})}:{type:"array",minItems:e.items.length,maxItems:e.items.length,items:e.items.map((e,r)=>n5(e._def,{...t,currentPath:[...t.currentPath,"items",`${r}`]})).reduce((e,t)=>void 0===t?e:[...e,t],[])}}(e,r);case nF.kY.ZodRecord:return nX(e,r);case nF.kY.ZodLiteral:return function(e,t){let r=typeof e.value;return"bigint"!==r&&"number"!==r&&"boolean"!==r&&"string"!==r?{type:Array.isArray(e.value)?"array":"object"}:"openApi3"===t.target?{type:"bigint"===r?"integer":r,enum:[e.value]}:{type:"bigint"===r?"integer":r,const:e.value}}(e,r);case nF.kY.ZodEnum:return{type:"string",enum:[...e.values]};case nF.kY.ZodNativeEnum:return function(e){let t=e.values,r=Object.keys(e.values).filter(e=>"number"!=typeof t[t[e]]).map(e=>t[e]),a=Array.from(new Set(r.map(e=>typeof e)));return{type:1===a.length?"string"===a[0]?"string":"number":["string","number"],enum:r}}(e);case nF.kY.ZodNullable:return function(e,t){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(e.innerType._def.typeName)&&(!e.innerType._def.checks||!e.innerType._def.checks.length))return"openApi3"===t.target||"property"===t.nullableStrategy?{type:nQ[e.innerType._def.typeName],nullable:!0}:{type:[nQ[e.innerType._def.typeName],"null"]};if("openApi3"===t.target){let r=n5(e.innerType._def,{...t,currentPath:[...t.currentPath]});return r&&"$ref"in r?{allOf:[r],nullable:!0}:r&&{...r,nullable:!0}}let r=n5(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","0"]});return r&&{anyOf:[r,{type:"null"}]}}(e,r);case nF.kY.ZodOptional:return n1(e,r);case nF.kY.ZodMap:return function(e,t){return"record"===t.mapStrategy?nX(e,t):{type:"array",maxItems:125,items:{type:"array",items:[n5(e.keyType._def,{...t,currentPath:[...t.currentPath,"items","items","0"]})||{},n5(e.valueType._def,{...t,currentPath:[...t.currentPath,"items","items","1"]})||{}],minItems:2,maxItems:2}}}(e,r);case nF.kY.ZodSet:return function(e,t){let r={type:"array",uniqueItems:!0,items:n5(e.valueType._def,{...t,currentPath:[...t.currentPath,"items"]})};return e.minSize&&nB(r,"minItems",e.minSize.value,e.minSize.message,t),e.maxSize&&nB(r,"maxItems",e.maxSize.value,e.maxSize.message,t),r}(e,r);case nF.kY.ZodLazy:return n5(e.getter()._def,r);case nF.kY.ZodPromise:return n5(e.type._def,r);case nF.kY.ZodNaN:case nF.kY.ZodNever:return{not:{}};case nF.kY.ZodEffects:return function(e,t,r){return"input"===t.effectStrategy?n5(e.schema._def,t,r):{}}(e,r,a);case nF.kY.ZodAny:case nF.kY.ZodUnknown:return{};case nF.kY.ZodDefault:return function(e,t){return{...n5(e.innerType._def,t),default:e.defaultValue()}}(e,r);case nF.kY.ZodBranded:return n5(e.type._def,r);case nF.kY.ZodReadonly:return n2(e,r);case nF.kY.ZodCatch:return nZ(e,r);case nF.kY.ZodPipeline:return n4(e,r);case nF.kY.ZodFunction:case nF.kY.ZodVoid:case nF.kY.ZodSymbol:default:return}},st=(e,t,r)=>(e.description&&(r.description=e.description,t.markdownDescription&&(r.markdownDescription=e.description)),r),sr=e=>"_def"in e?e._def:e,sa=e=>{let t=n3(e),r=void 0!==t.name?[...t.basePath,t.definitionPath,t.name]:t.basePath;return{...t,currentPath:r,propertyPath:void 0,seenRefs:new Set,seen:new Map(Object.entries(t.definitions).map(([e,r])=>[sr(r),{def:sr(r),path:[...t.basePath,t.definitionPath,e],jsonSchema:void 0}]))}},si=(e,t)=>{let r=sa(t),a="string"==typeof t?t:t?.nameStrategy==="title"?void 0:t?.name,i=n5(e._def,void 0===a?r:{...r,currentPath:[...r.basePath,r.definitionPath,a]},!1)??{},n="object"==typeof t&&void 0!==t.name&&"title"===t.nameStrategy?t.name:void 0;void 0!==n&&(i.title=n);let s=(()=>{if(function(e){if(!e)return!0;for(let t in e)return!1;return!0}(r.definitions))return;let e={},t=new Set;for(let a=0;a<500;a++){let a=Object.entries(r.definitions).filter(([e])=>!t.has(e));if(0===a.length)break;for(let[i,n]of a)e[i]=n5(sr(n),{...r,currentPath:[...r.basePath,r.definitionPath,i]},!0)??{},t.add(i)}return e})(),o=void 0===a?s?{...i,[r.definitionPath]:s}:i:"duplicate-ref"===r.nameStrategy?{...i,...s||r.seenRefs.size?{[r.definitionPath]:{...s,...r.seenRefs.size?{[a]:i}:void 0}}:void 0}:{$ref:[..."relative"===r.$refStrategy?[]:r.basePath,r.definitionPath,a].join("/"),[r.definitionPath]:{...s,[a]:i}};return"jsonSchema7"===r.target?o.$schema="http://json-schema.org/draft-07/schema#":"jsonSchema2019-09"===r.target&&(o.$schema="https://json-schema.org/draft/2019-09/schema#"),o};var sn=r(22441),ss=r(11014),so=r(46628);function sl(e,t){return e.lc_error_code=t,e.message=`${e.message}

Troubleshooting URL: https://js.langchain.com/docs/troubleshooting/errors/${t}/
`,e}function su(e){let t;return e.constructor.name===tC.name?(t=Error(e.message)).name="TimeoutError":e.constructor.name===t$.name?(t=Error(e.message)).name="AbortError":t=400===e.status&&e.message.includes("tool_calls")?sl(e,"INVALID_TOOL_RESULTS"):401===e.status?sl(e,"MODEL_AUTHENTICATION"):429===e.status?sl(e,"MODEL_RATE_LIMIT"):404===e.status?sl(e,"MODEL_NOT_FOUND"):e,t}function sc(e){if(e){if("any"===e||"required"===e)return"required";if("auto"===e)return"auto";if("none"===e)return"none";else if("string"==typeof e)return{type:"function",function:{name:e}};else return e}}function sd(e,t){let r=[];for(let[a,i]of Object.entries(e.properties??{}))i.description&&t<2&&r.push(`// ${i.description}`),e.required?.includes(a)?r.push(`${a}: ${sh(i,t)},`):r.push(`${a}?: ${sh(i,t)},`);return r.map(e=>" ".repeat(t)+e).join("\n")}function sh(e,t){if(void 0!==e.anyOf&&Array.isArray(e.anyOf))return e.anyOf.map(e=>sh(e,t)).join(" | ");switch(e.type){case"string":if(e.enum)return e.enum.map(e=>`"${e}"`).join(" | ");return"string";case"number":if(e.enum)return e.enum.map(e=>`${e}`).join(" | ");return"number";case"integer":if(e.enum)return e.enum.map(e=>`${e}`).join(" | ");return"number";case"boolean":return"boolean";case"null":return"null";case"object":return["{",sd(e,t+2),"}"].join("\n");case"array":if(e.items)return`${sh(e.items,t)}[]`;return"any[]";default:return""}}function sp(e){let t=e._getType();switch(t){case"system":return"system";case"ai":return"assistant";case"human":return"user";case"function":return"function";case"tool":return"tool";case"generic":if(!nI.cM.isInstance(e))throw Error("Invalid generic chat message");return"system"!==e.role&&"developer"!==e.role&&"assistant"!==e.role&&"user"!==e.role&&"function"!==e.role&&"tool"!==e.role&&console.warn(`Unknown message role: ${e.role}`),e.role;default:throw Error(`Unknown message type: ${t}`)}}let sm={providerName:"ChatOpenAI",fromStandardTextBlock:e=>({type:"text",text:e.text}),fromStandardImageBlock(e){if("url"===e.source_type)return{type:"image_url",image_url:{url:e.url,...e.metadata?.detail?{detail:e.metadata.detail}:{}}};if("base64"===e.source_type)return{type:"image_url",image_url:{url:`data:${e.mime_type??""};base64,${e.data}`,...e.metadata?.detail?{detail:e.metadata.detail}:{}}};throw Error(`Image content blocks with source_type ${e.source_type} are not supported for ChatOpenAI`)},fromStandardAudioBlock(e){if("url"===e.source_type){let t;let r=(0,nI.Q7)({dataUrl:e.url});if(!r)throw Error(`URL audio blocks with source_type ${e.source_type} must be formatted as a data URL for ChatOpenAI`);let a=r.mime_type||e.mime_type||"";try{t=(0,nI.Ej)(a)}catch{throw Error(`Audio blocks with source_type ${e.source_type} must have mime type of audio/wav or audio/mp3`)}if("audio"!==t.type||"wav"!==t.subtype&&"mp3"!==t.subtype)throw Error(`Audio blocks with source_type ${e.source_type} must have mime type of audio/wav or audio/mp3`);return{type:"input_audio",input_audio:{format:t.subtype,data:r.data}}}if("base64"===e.source_type){let t;try{t=(0,nI.Ej)(e.mime_type??"")}catch{throw Error(`Audio blocks with source_type ${e.source_type} must have mime type of audio/wav or audio/mp3`)}if("audio"!==t.type||"wav"!==t.subtype&&"mp3"!==t.subtype)throw Error(`Audio blocks with source_type ${e.source_type} must have mime type of audio/wav or audio/mp3`);return{type:"input_audio",input_audio:{format:t.subtype,data:e.data}}}throw Error(`Audio content blocks with source_type ${e.source_type} are not supported for ChatOpenAI`)},fromStandardFileBlock(e){if("url"===e.source_type){if(!(0,nI.Q7)({dataUrl:e.url}))throw Error(`URL file blocks with source_type ${e.source_type} must be formatted as a data URL for ChatOpenAI`);return{type:"file",file:{file_data:e.url,...e.metadata?.filename||e.metadata?.name?{filename:e.metadata?.filename||e.metadata?.name}:{}}}}if("base64"===e.source_type)return{type:"file",file:{file_data:`data:${e.mime_type??""};base64,${e.data}`,...e.metadata?.filename||e.metadata?.name||e.metadata?.title?{filename:e.metadata?.filename||e.metadata?.name||e.metadata?.title}:{}}};if("id"===e.source_type)return{type:"file",file:{file_id:e.id}};throw Error(`File content blocks with source_type ${e.source_type} are not supported for ChatOpenAI`)}};function sf(e,t){return e.flatMap(e=>{let r=sp(e);"system"===r&&sw(t)&&(r="developer");let a={role:r,content:"string"==typeof e.content?e.content:e.content.map(e=>(0,nI.Fz)(e)?(0,nI.up)(e,sm):e)};return(null!=e.name&&(a.name=e.name),null!=e.additional_kwargs.function_call&&(a.function_call=e.additional_kwargs.function_call,a.content=""),(0,nI.KX)(e)&&e.tool_calls?.length?(a.tool_calls=e.tool_calls.map(nL),a.content=""):(null!=e.additional_kwargs.tool_calls&&(a.tool_calls=e.additional_kwargs.tool_calls),null!=e.tool_call_id&&(a.tool_call_id=e.tool_call_id)),e.additional_kwargs.audio&&"object"==typeof e.additional_kwargs.audio&&"id"in e.additional_kwargs.audio)?[a,{role:"assistant",audio:{id:e.additional_kwargs.audio.id}}]:a})}let sg="__openai_function_call_ids__";function sy(e,t,r){let a=e.filter(e=>(0,nI.KX)(e)).pop(),i=a?.response_metadata?.id;return(i&&i.startsWith("resp_")&&!r?e.slice(e.indexOf(a)+1):e).flatMap(e=>{let a=sp(e);if("system"===a&&sw(t)&&(a="developer"),"function"===a)throw Error("Function messages are not supported in Responses API");if("tool"===a)return e.additional_kwargs?.type==="computer_call_output"?{type:"computer_call_output",output:(()=>{if("string"==typeof e.content)return{type:"computer_screenshot",image_url:e.content};if(Array.isArray(e.content)){let t=e.content.find(e=>"computer_screenshot"===e.type);if(t)return t;let r=e.content.find(e=>"image_url"===e.type);if(r)return{type:"computer_screenshot",image_url:"string"==typeof r.image_url?r.image_url:r.image_url.url}}throw Error("Invalid computer call output")})(),call_id:e.tool_call_id}:{type:"function_call_output",call_id:e.tool_call_id,id:e.id?.startsWith("fc_")?e.id:void 0,output:"string"!=typeof e.content?JSON.stringify(e.content):e.content};if("assistant"===a){if(!r&&null!=e.response_metadata.output&&Array.isArray(e.response_metadata.output)&&e.response_metadata.output.length>0&&e.response_metadata.output.every(e=>"type"in e))return e.response_metadata.output;let t=[];if(!r&&null!=e.additional_kwargs.reasoning){let r;if("object"==typeof(r=e.additional_kwargs.reasoning)&&null!=r&&"type"in r&&"reasoning"===r.type){let r=function(e){let t=(e.summary.length>1?e.summary.reduce((e,t)=>{let r=e.at(-1);return r.index===t.index?r.text+=t.text:e.push(t),e},[{...e.summary[0]}]):e.summary).map(e=>Object.fromEntries(Object.entries(e).filter(([e])=>"index"!==e)));return{...e,summary:t}}(e.additional_kwargs.reasoning);t.push(r)}}let{content:a}=e;null!=e.additional_kwargs.refusal&&("string"==typeof a&&(a=[{type:"output_text",text:a,annotations:[]}]),a=[...a,{type:"refusal",refusal:e.additional_kwargs.refusal}]),t.push({type:"message",role:"assistant",...e.id&&!r?{id:e.id}:{},content:"string"==typeof a?a:a.flatMap(e=>"text"===e.type?{type:"output_text",text:e.text,annotations:e.annotations??[]}:"output_text"===e.type||"refusal"===e.type?e:[])});let i=e.additional_kwargs[sg];(0,nI.KX)(e)&&e.tool_calls?.length?t.push(...e.tool_calls.map(e=>({type:"function_call",name:e.name,arguments:JSON.stringify(e.args),call_id:e.id,...r?{id:i?.[e.id]}:{}}))):null!=e.additional_kwargs.tool_calls&&t.push(...e.additional_kwargs.tool_calls.map(e=>({type:"function_call",name:e.function.name,call_id:e.id,...r?{id:i?.[e.id]}:{},arguments:e.function.arguments})));let n=e.response_metadata.output?.length?e.response_metadata.output:e.additional_kwargs.tool_outputs,s=[];return null!=n&&(s=n?.filter(e=>"computer_call"===e.type)).length>0&&t.push(...s),t}let i="string"==typeof e.content?e.content:e.content.flatMap(e=>(0,nI.Fz)(e)?(0,nI.up)(e,sm):"text"===e.type?{type:"input_text",text:e.text}:"image_url"===e.type?{type:"input_image",image_url:"string"==typeof e.image_url?e.image_url:e.image_url.url,detail:"string"==typeof e.image_url?"auto":e.image_url.detail}:"input_text"===e.type||"input_image"===e.type||"input_file"===e.type?e:[]);return"user"===a||"system"===a||"developer"===a?{type:"message",role:a,content:i}:(console.warn(`Unsupported role found when converting to OpenAI Responses API: ${a}`),[])})}function sb(e){let t;if(e.error){let t=Error(e.error.message);throw t.name=e.error.code,t}let r=[],a=[],i=[],n={model:e.model,created_at:e.created_at,id:e.id,incomplete_details:e.incomplete_details,metadata:e.metadata,object:e.object,status:e.status,user:e.user,model_name:e.model},s={};for(let n of e.output)if("message"===n.type)t=n.id,r.push(...n.content.flatMap(e=>"output_text"===e.type?("parsed"in e&&null!=e.parsed&&(s.parsed=e.parsed),{type:"text",text:e.text,annotations:e.annotations}):"refusal"===e.type?(s.refusal=e.refusal,[]):e));else if("function_call"===n.type){let e={function:{name:n.name,arguments:n.arguments},id:n.call_id};try{a.push(nC(e,{returnId:!0}))}catch(r){let t;"object"==typeof r&&null!=r&&"message"in r&&"string"==typeof r.message&&(t=r.message),i.push(nU(e,t))}s[sg]??={},n.id&&(s[sg][n.call_id]=n.id)}else"reasoning"===n.type?s.reasoning=n:(s.tool_outputs??=[],s.tool_outputs.push(n));return new nI.Od({id:t,content:r,tool_calls:a,invalid_tool_calls:i,usage_metadata:e.usage,additional_kwargs:s,response_metadata:n})}function s_(e){return"type"in e&&"function"!==e.type}function sv(e,t){let r;return(0,nS.VC)(e)?t?.strict!==void 0?{...e,function:{...e.function,strict:t.strict}}:e:(r=(0,so.qG)(e)?(0,so.fL)(e):e,t?.strict!==void 0&&(r.function.strict=t.strict),r)}function sw(e){return e&&/^o\d/.test(e)}class sO extends nx.xV{static lc_name(){return"ChatOpenAI"}get callKeys(){return[...super.callKeys,"options","function_call","functions","tools","tool_choice","promptIndex","response_format","seed","reasoning_effort"]}get lc_secrets(){return{openAIApiKey:"OPENAI_API_KEY",apiKey:"OPENAI_API_KEY",organization:"OPENAI_ORGANIZATION"}}get lc_aliases(){return{modelName:"model",openAIApiKey:"openai_api_key",apiKey:"openai_api_key"}}get lc_serializable_keys(){return["configuration","logprobs","topLogprobs","prefixMessages","supportsStrictToolCalling","modalities","audio","reasoningEffort","temperature","maxTokens","topP","frequencyPenalty","presencePenalty","n","logitBias","user","streaming","streamUsage","modelName","model","modelKwargs","stop","stopSequences","timeout","openAIApiKey","apiKey","cache","maxConcurrency","maxRetries","verbose","callbacks","tags","metadata","disableStreaming","useResponsesApi","zdrEnabled","reasoning"]}constructor(e){super(e??{}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"frequencyPenalty",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"presencePenalty",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"logitBias",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"gpt-3.5-turbo"}),Object.defineProperty(this,"modelKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stopSequences",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"streamUsage",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"logprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topLogprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"openAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"organization",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"__includeRawResponse",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"supportsStrictToolCalling",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"audio",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modalities",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reasoningEffort",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reasoning",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"useResponsesApi",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"zdrEnabled",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.openAIApiKey=e?.apiKey??e?.openAIApiKey??e?.configuration?.apiKey??(0,nE.Az)("OPENAI_API_KEY"),this.apiKey=this.openAIApiKey,this.organization=e?.configuration?.organization??(0,nE.Az)("OPENAI_ORGANIZATION"),this.model=e?.model??e?.modelName??this.model,this.modelName=this.model,this.modelKwargs=e?.modelKwargs??{},this.timeout=e?.timeout,this.temperature=e?.temperature??this.temperature,this.topP=e?.topP??this.topP,this.frequencyPenalty=e?.frequencyPenalty??this.frequencyPenalty,this.presencePenalty=e?.presencePenalty??this.presencePenalty,this.logprobs=e?.logprobs,this.topLogprobs=e?.topLogprobs,this.n=e?.n??this.n,this.logitBias=e?.logitBias,this.stop=e?.stopSequences??e?.stop,this.stopSequences=this.stop,this.user=e?.user,this.__includeRawResponse=e?.__includeRawResponse,this.audio=e?.audio,this.modalities=e?.modalities,this.reasoningEffort=e?.reasoningEffort??e?.reasoning?.effort,this.reasoning=e?.reasoning??(e?.reasoningEffort?{effort:e.reasoningEffort}:void 0),this.maxTokens=e?.maxCompletionTokens??e?.maxTokens,this.useResponsesApi=e?.useResponsesApi??this.useResponsesApi,this.disableStreaming=e?.disableStreaming??this.disableStreaming,this.streaming=e?.streaming??!1,this.disableStreaming&&(this.streaming=!1),this.streamUsage=e?.streamUsage??this.streamUsage,this.disableStreaming&&(this.streamUsage=!1),this.clientConfig={apiKey:this.apiKey,organization:this.organization,dangerouslyAllowBrowser:!0,...e?.configuration},e?.supportsStrictToolCalling!==void 0&&(this.supportsStrictToolCalling=e.supportsStrictToolCalling),this.zdrEnabled=e?.zdrEnabled??!1}getLsParams(e){let t=this.invocationParams(e);return{ls_provider:"openai",ls_model_name:this.model,ls_model_type:"chat",ls_temperature:t.temperature??void 0,ls_max_tokens:t.max_tokens??void 0,ls_stop:e.stop}}bindTools(e,t){let r;return t?.strict!==void 0?r=t.strict:void 0!==this.supportsStrictToolCalling&&(r=this.supportsStrictToolCalling),this.withConfig({tools:e.map(e=>s_(e)?e:sv(e,{strict:r})),...t})}createResponseFormat(e){return e&&"json_schema"===e.type&&e.json_schema.schema&&(0,sn.c9)(e.json_schema.schema)?function(e,t,r){if((0,sn.IU)(e))return function(e,t){let r={...e};return Object.defineProperties(r,{$brand:{value:"auto-parseable-response-format",enumerable:!1},$parseRaw:{value:t,enumerable:!1}}),r}({type:"json_schema",json_schema:{...r,name:t,strict:!0,schema:si(e,{openaiStrictMode:!0,name:{name:t}.name,nameStrategy:"duplicate-ref",$refStrategy:"extract-to-root",nullableStrategy:"property"})}},t=>e.parse(JSON.parse(t)));if((0,sn.Pq)(e))return function(e,t){let r={...e};return Object.defineProperties(r,{$brand:{value:"auto-parseable-response-format",enumerable:!1},$parseRaw:{value:t,enumerable:!1}}),r}({type:"json_schema",json_schema:{...r,name:t,strict:!0,schema:function(e,t){if(e instanceof tu){let r=new tp(t),a={};for(let t of e._idmap.entries()){let[e,a]=t;r.process(a)}let i={},n={registry:e,uri:t?.uri||(e=>e),defs:a};for(let a of e._idmap.entries()){let[e,s]=a;i[e]=r.emit(s,{...t,external:n})}return Object.keys(a).length>0&&(i.__shared={["draft-2020-12"===r.target?"$defs":"definitions"]:a}),{schemas:i}}let r=new tp(t);return r.process(e),r.emit(e,t)}(e,{cycles:"ref",reused:"ref",override(e){e.jsonSchema.title=t}})}},t=>w(e,JSON.parse(t)));throw Error("Unsupported schema response format")}(e.json_schema.schema,e.json_schema.name,{description:e.json_schema.description}):e}getReasoningParams(e){let t;if(sw(this.model))return void 0!==this.reasoningEffort&&(t={effort:this.reasoningEffort}),void 0!==this.reasoning&&(t={...t,...this.reasoning}),e?.reasoning_effort!==void 0&&(t={...t,effort:e.reasoning_effort}),e?.reasoning!==void 0&&(t={...t,...e.reasoning}),t}invocationParams(e,t){let r;if(e?.strict!==void 0?r=e.strict:void 0!==this.supportsStrictToolCalling&&(r=this.supportsStrictToolCalling),this._useResponseApi(e)){var a;let t={model:this.model,temperature:this.temperature,top_p:this.topP,user:this.user,stream:this.streaming,previous_response_id:e?.previous_response_id,truncation:e?.truncation,include:e?.include,tools:e?.tools?.length?e.tools.map(e=>s_(e)?e:(0,nS.VC)(e)?{type:"function",name:e.function.name,parameters:e.function.parameters,description:e.function.description,strict:r}:null).filter(e=>null!==e):void 0,tool_choice:null!=(a=e?.tool_choice)&&"object"==typeof a&&"type"in a&&"function"!==a.type?e?.tool_choice:(()=>{let t=sc(e?.tool_choice);return"object"==typeof t&&"type"in t?{type:"function",name:t.function.name}:void 0})(),text:(()=>{if(e?.text)return e.text;let t=this.createResponseFormat(e?.response_format);return t?.type==="json_schema"?null!=t.json_schema.schema?{format:{type:"json_schema",schema:t.json_schema.schema,description:t.json_schema.description,name:t.json_schema.name,strict:t.json_schema.strict}}:void 0:{format:t}})(),parallel_tool_calls:e?.parallel_tool_calls,max_output_tokens:-1===this.maxTokens?void 0:this.maxTokens,...this.zdrEnabled?{store:!1}:{},...this.modelKwargs},i=this.getReasoningParams(e);return void 0!==i&&(t.reasoning=i),t}let i={};e?.stream_options!==void 0?i={stream_options:e.stream_options}:this.streamUsage&&(this.streaming||t?.streaming)&&(i={stream_options:{include_usage:!0}});let n={model:this.model,temperature:this.temperature,top_p:this.topP,frequency_penalty:this.frequencyPenalty,presence_penalty:this.presencePenalty,logprobs:this.logprobs,top_logprobs:this.topLogprobs,n:this.n,logit_bias:this.logitBias,stop:e?.stop??this.stopSequences,user:this.user,stream:this.streaming,functions:e?.functions,function_call:e?.function_call,tools:e?.tools?.length?e.tools.map(e=>sv(e,{strict:r})):void 0,tool_choice:sc(e?.tool_choice),response_format:this.createResponseFormat(e?.response_format),seed:e?.seed,...i,parallel_tool_calls:e?.parallel_tool_calls,...this.audio||e?.audio?{audio:this.audio||e?.audio}:{},...this.modalities||e?.modalities?{modalities:this.modalities||e?.modalities}:{},...this.modelKwargs};e?.prediction!==void 0&&(n.prediction=e.prediction);let s=this.getReasoningParams(e);return void 0!==s&&void 0!==s.effort&&(n.reasoning_effort=s.effort),sw(n.model)?n.max_completion_tokens=-1===this.maxTokens?void 0:this.maxTokens:n.max_tokens=-1===this.maxTokens?void 0:this.maxTokens,n}_convertOpenAIChatCompletionMessageToBaseMessage(e,t){let r=e.tool_calls;if("assistant"===e.role){let a=[],i=[];for(let e of r??[])try{a.push(nC(e,{returnId:!0}))}catch(t){i.push(nU(e,t.message))}let n={function_call:e.function_call,tool_calls:r};void 0!==this.__includeRawResponse&&(n.__raw_response=t);let s={model_name:t.model,...t.system_fingerprint?{usage:{...t.usage},system_fingerprint:t.system_fingerprint}:{}};return e.audio&&(n.audio=e.audio),new nI.Od({content:e.content||"",tool_calls:a,invalid_tool_calls:i,additional_kwargs:n,response_metadata:s,id:t.id})}return new nI.cM(e.content||"",e.role??"unknown")}_convertOpenAIDeltaToBaseMessageChunk(e,t,r){let a;let i=e.role??r,n=e.content??"";a=e.function_call?{function_call:e.function_call}:e.tool_calls?{tool_calls:e.tool_calls}:{},this.__includeRawResponse&&(a.__raw_response=t),e.audio&&(a.audio={...e.audio,index:t.choices[0].index});let s={usage:{...t.usage}};if("user"===i)return new nI.a7({content:n,response_metadata:s});if("assistant"===i){let r=[];if(Array.isArray(e.tool_calls))for(let t of e.tool_calls)r.push({name:t.function?.name,args:t.function?.arguments,id:t.id,index:t.index,type:"tool_call_chunk"});return new nI.H({content:n,tool_call_chunks:r,additional_kwargs:a,id:t.id,response_metadata:s})}if("system"===i)return new nI.uU({content:n,response_metadata:s});if("developer"===i)return new nI.uU({content:n,response_metadata:s,additional_kwargs:{__openai_role__:"developer"}});if("function"===i)return new nI.FK({content:n,additional_kwargs:a,name:e.name,response_metadata:s});else if("tool"===i)return new nI.dr({content:n,additional_kwargs:a,tool_call_id:e.tool_call_id,response_metadata:s});else return new nI.XU({content:n,role:i,response_metadata:s})}_identifyingParams(){return{model_name:this.model,...this.invocationParams(),...this.clientConfig}}async *_streamResponseChunks(e,t,r){let a,i;if(this._useResponseApi(t)){let r=e.filter(e=>(0,nI.KX)(e)).pop(),a=r?.response_metadata?.id;for await(let r of(await this.responseApiWithRetry({...this.invocationParams(t,{streaming:!0}),input:sy(e,this.model,this.zdrEnabled),stream:!0,...a&&a.startsWith("resp_")&&!this.zdrEnabled?{previous_response_id:a}:{}},t))){let e=function(e){let t,r;let a=[],i={},n=[],s={},o={};if("response.output_text.delta"===e.type)a.push({type:"text",text:e.delta,index:e.content_index});else if("response.output_text.annotation.added"===e.type)a.push({type:"text",text:"",annotations:[e.annotation],index:e.content_index});else if("response.output_item.added"===e.type&&"message"===e.item.type)r=e.item.id;else if("response.output_item.added"===e.type&&"function_call"===e.item.type)n.push({type:"tool_call_chunk",name:e.item.name,args:e.item.arguments,id:e.item.call_id,index:e.output_index}),o[sg]={[e.item.call_id]:e.item.id};else if("response.output_item.done"===e.type&&("web_search_call"===e.item.type||"file_search_call"===e.item.type||"computer_call"===e.item.type))o.tool_outputs=[e.item];else if("response.created"===e.type)s.id=e.response.id,s.model_name=e.response.model,s.model=e.response.model;else if("response.completed"===e.type){let r=sb(e.response);for(let[a,i]of(t=e.response.usage,e.response.text?.format?.type==="json_schema"&&(o.parsed??=JSON.parse(r.text)),Object.entries(e.response)))"id"!==a&&(s[a]=i)}else if("response.function_call_arguments.delta"===e.type)n.push({type:"tool_call_chunk",args:e.delta,index:e.output_index});else if("response.web_search_call.completed"===e.type||"response.file_search_call.completed"===e.type)i={tool_outputs:{id:e.item_id,type:e.type.replace("response.","").replace(".completed",""),status:"completed"}};else if("response.refusal.done"===e.type)o.refusal=e.refusal;else if("response.output_item.added"===e.type&&"item"in e&&"reasoning"===e.item.type){let t=e.item.summary?e.item.summary.map((e,t)=>({...e,index:t})):void 0;o.reasoning={id:e.item.id,type:e.item.type,...t?{summary:t}:{}}}else if("response.reasoning_summary_part.added"===e.type)o.reasoning={type:"reasoning",summary:[{...e.part,index:e.summary_index}]};else{if("response.reasoning_summary_text.delta"!==e.type)return null;o.reasoning={type:"reasoning",summary:[{text:e.delta,type:"summary_text",index:e.summary_index}]}}return new nk.Cf({text:a.map(e=>e.text).join(""),message:new nI.H({id:r,content:a,tool_call_chunks:n,usage_metadata:t,additional_kwargs:o,response_metadata:s}),generationInfo:i})}(r);null!=e&&(yield e)}return}let n=sf(e,this.model),s={...this.invocationParams(t,{streaming:!0}),messages:n,stream:!0};for await(let e of(await this.completionWithRetry(s,t))){let n=e?.choices?.[0];if(e.usage&&(i=e.usage),!n)continue;let{delta:s}=n;if(!s)continue;let o=this._convertOpenAIDeltaToBaseMessageChunk(s,e,a);a=s.role??a;let l={prompt:t.promptIndex??0,completion:n.index??0};if("string"!=typeof o.content){console.log("[WARNING]: Received non-string content from OpenAI. This is currently not supported.");continue}let u={...l};null!=n.finish_reason&&(u.finish_reason=n.finish_reason,u.system_fingerprint=e.system_fingerprint,u.model_name=e.model),this.logprobs&&(u.logprobs=n.logprobs);let c=new nk.Cf({message:o,text:o.content,generationInfo:u});yield c,await r?.handleLLMNewToken(c.text??"",l,void 0,void 0,void 0,{chunk:c})}if(i){let e={...i.prompt_tokens_details?.audio_tokens!==null&&{audio:i.prompt_tokens_details?.audio_tokens},...i.prompt_tokens_details?.cached_tokens!==null&&{cache_read:i.prompt_tokens_details?.cached_tokens}},t={...i.completion_tokens_details?.audio_tokens!==null&&{audio:i.completion_tokens_details?.audio_tokens},...i.completion_tokens_details?.reasoning_tokens!==null&&{reasoning:i.completion_tokens_details?.reasoning_tokens}},r=new nk.Cf({message:new nI.H({content:"",response_metadata:{usage:{...i}},usage_metadata:{input_tokens:i.prompt_tokens,output_tokens:i.completion_tokens,total_tokens:i.total_tokens,...Object.keys(e).length>0&&{input_token_details:e},...Object.keys(t).length>0&&{output_token_details:t}}}),text:""});yield r}if(t.signal?.aborted)throw Error("AbortError")}identifyingParams(){return this._identifyingParams()}async _responseApiGenerate(e,t,r){let a=this.invocationParams(t);if(a.stream){let a;for await(let i of this._streamResponseChunks(e,t,r))i.message.response_metadata={...i.generationInfo,...i.message.response_metadata},a=a?.concat(i)??i;return{generations:a?[a]:[],llmOutput:{estimatedTokenUsage:a?.message?.usage_metadata}}}let i=e.filter(e=>(0,nI.KX)(e)).pop(),n=i?.response_metadata?.id,s=sy(e,this.model,this.zdrEnabled),o=await this.responseApiWithRetry({input:s,...a,...n&&n.startsWith("resp_")&&!this.zdrEnabled?{previous_response_id:n}:{}},{signal:t?.signal,...t?.options});return{generations:[{text:o.output_text,message:sb(o)}],llmOutput:{id:o.id,estimatedTokenUsage:o.usage?{promptTokens:o.usage.input_tokens,completionTokens:o.usage.output_tokens,totalTokens:o.usage.total_tokens}:void 0}}}_useResponseApi(e){let t=e?.tools?.some(s_),r=e?.previous_response_id!=null||e?.text!=null||e?.truncation!=null||e?.include!=null||e?.reasoning?.summary!=null||this.reasoning?.summary!=null;return this.useResponsesApi||t||r}async _generate(e,t,r){if(this._useResponseApi(t))return this._responseApiGenerate(e,t,r);let a={},i=this.invocationParams(t),n=sf(e,this.model);if(i.stream){let i=this._streamResponseChunks(e,t,r),n={};for await(let e of i){e.message.response_metadata={...e.generationInfo,...e.message.response_metadata};let t=e.generationInfo?.completion??0;void 0===n[t]?n[t]=e:n[t]=n[t].concat(e)}let s=Object.entries(n).sort(([e],[t])=>parseInt(e,10)-parseInt(t,10)).map(([e,t])=>t),{functions:o,function_call:l}=this.invocationParams(t),u=await this.getEstimatedTokenCountFromPrompt(e,o,l),c=await this.getNumTokensFromGenerations(s);return a.input_tokens=u,a.output_tokens=c,a.total_tokens=u+c,{generations:s,llmOutput:{estimatedTokenUsage:{promptTokens:a.input_tokens,completionTokens:a.output_tokens,totalTokens:a.total_tokens}}}}{let e;e=t.response_format&&"json_schema"===t.response_format.type?await this.betaParsedCompletionWithRetry({...i,stream:!1,messages:n},{signal:t?.signal,...t?.options}):await this.completionWithRetry({...i,stream:!1,messages:n},{signal:t?.signal,...t?.options});let{completion_tokens:r,prompt_tokens:s,total_tokens:o,prompt_tokens_details:l,completion_tokens_details:u}=e?.usage??{};r&&(a.output_tokens=(a.output_tokens??0)+r),s&&(a.input_tokens=(a.input_tokens??0)+s),o&&(a.total_tokens=(a.total_tokens??0)+o),(l?.audio_tokens!==null||l?.cached_tokens!==null)&&(a.input_token_details={...l?.audio_tokens!==null&&{audio:l?.audio_tokens},...l?.cached_tokens!==null&&{cache_read:l?.cached_tokens}}),(u?.audio_tokens!==null||u?.reasoning_tokens!==null)&&(a.output_token_details={...u?.audio_tokens!==null&&{audio:u?.audio_tokens},...u?.reasoning_tokens!==null&&{reasoning:u?.reasoning_tokens}});let c=[];for(let t of e?.choices??[]){let r={text:t.message?.content??"",message:this._convertOpenAIChatCompletionMessageToBaseMessage(t.message??{role:"assistant"},e)};r.generationInfo={...t.finish_reason?{finish_reason:t.finish_reason}:{},...t.logprobs?{logprobs:t.logprobs}:{}},(0,nI.KX)(r.message)&&(r.message.usage_metadata=a),r.message=new nI.Od(Object.fromEntries(Object.entries(r.message).filter(([e])=>!e.startsWith("lc_")))),c.push(r)}return{generations:c,llmOutput:{tokenUsage:{promptTokens:a.input_tokens,completionTokens:a.output_tokens,totalTokens:a.total_tokens}}}}}async getEstimatedTokenCountFromPrompt(e,t,r){let a=(await this.getNumTokensFromMessages(e)).totalCount;if(t&&"auto"!==r){let e=function(e){let t=["namespace functions {",""];for(let r of e)r.description&&t.push(`// ${r.description}`),Object.keys(r.parameters.properties??{}).length>0?(t.push(`type ${r.name} = (_: {`),t.push(sd(r.parameters,0)),t.push("}) => any;")):t.push(`type ${r.name} = () => any;`),t.push("");return t.push("} // namespace functions"),t.join("\n")}(t);a+=await this.getNumTokens(e),a+=9}return t&&e.find(e=>"system"===e._getType())&&(a-=4),"none"===r?a+=1:"object"==typeof r&&(a+=await this.getNumTokens(r.name)+4),a}async getNumTokensFromGenerations(e){return(await Promise.all(e.map(async e=>e.message.additional_kwargs?.function_call?(await this.getNumTokensFromMessages([e.message])).countPerMessage[0]:await this.getNumTokens(e.message.content)))).reduce((e,t)=>e+t,0)}async getNumTokensFromMessages(e){let t=0,r=0,a=0;"gpt-3.5-turbo-0301"===this.model?(r=4,a=-1):(r=3,a=1);let i=await Promise.all(e.map(async e=>{let i=await this.getNumTokens(e.content),n=await this.getNumTokens(sp(e)),s=void 0!==e.name?a+await this.getNumTokens(e.name):0,o=i+r+n+s;if("function"===e._getType()&&(o-=2),e.additional_kwargs?.function_call&&(o+=3),e?.additional_kwargs.function_call?.name&&(o+=await this.getNumTokens(e.additional_kwargs.function_call?.name)),e.additional_kwargs.function_call?.arguments)try{o+=await this.getNumTokens(JSON.stringify(JSON.parse(e.additional_kwargs.function_call?.arguments)))}catch(t){console.error("Error parsing function arguments",t,JSON.stringify(e.additional_kwargs.function_call)),o+=await this.getNumTokens(e.additional_kwargs.function_call?.arguments)}return t+=o,o}));return{totalCount:t+=3,countPerMessage:i}}async completionWithRetry(e,t){let r=this._getClientOptions(t);return this.caller.call(async()=>{try{return await this.client.chat.completions.create(e,r)}catch(e){throw su(e)}})}async responseApiWithRetry(e,t){return this.caller.call(async()=>{let r=this._getClientOptions(t);try{if(e.text?.format?.type==="json_schema"&&!e.stream)return await this.client.responses.parse(e,r);return await this.client.responses.create(e,r)}catch(e){throw su(e)}})}async betaParsedCompletionWithRetry(e,t){let r=this._getClientOptions(t);return this.caller.call(async()=>{try{return await this.client.beta.chat.completions.parse(e,r)}catch(e){throw su(e)}})}_getClientOptions(e){if(!this.client){let e=function(e){let{azureOpenAIApiDeploymentName:t,azureOpenAIApiInstanceName:r,azureOpenAIApiKey:a,azureOpenAIBasePath:i,baseURL:n,azureADTokenProvider:s,azureOpenAIEndpoint:o}=e;if((a||s)&&i&&t)return`${i}/${t}`;if((a||s)&&o&&t)return`${o}/openai/deployments/${t}`;if(a||s){if(!r)throw Error("azureOpenAIApiInstanceName is required when using azureOpenAIApiKey");if(!t)throw Error("azureOpenAIApiDeploymentName is a required parameter when using azureOpenAIApiKey");return`https://${r}.openai.azure.com/openai/deployments/${t}`}return n}({baseURL:this.clientConfig.baseURL}),t={...this.clientConfig,baseURL:e,timeout:this.timeout,maxRetries:0};t.baseURL||delete t.baseURL,this.client=new nO(t)}return{...this.clientConfig,...e}}_llmType(){return"openai"}_combineLLMOutput(...e){return e.reduce((e,t)=>(t&&t.tokenUsage&&(e.tokenUsage.completionTokens+=t.tokenUsage.completionTokens??0,e.tokenUsage.promptTokens+=t.tokenUsage.promptTokens??0,e.tokenUsage.totalTokens+=t.tokenUsage.totalTokens??0),e),{tokenUsage:{completionTokens:0,promptTokens:0,totalTokens:0}})}withStructuredOutput(e,t){var r;let a,i,n,s,o,l;if(void 0!==(r=e)&&"object"==typeof r.schema?(a=e.schema,i=e.name,n=e.method,s=e.includeRaw):(a=e,i=t?.name,n=t?.method,s=t?.includeRaw),t?.strict!==void 0&&"jsonMode"===n)throw Error("Argument `strict` is only supported for `method` = 'function_calling'");if(this.model.startsWith("gpt-3")||this.model.startsWith("gpt-4-")||"gpt-4"===this.model?"jsonSchema"===n&&console.warn(`[WARNING]: JSON Schema is not supported for model "${this.model}". Falling back to tool calling.`):void 0===n&&(n="jsonSchema"),"jsonMode"===n)o=this.withConfig({response_format:{type:"json_object"}}),l=(0,sn.c9)(a)?nA._6.fromZodSchema(a):new nA.hU;else if("jsonSchema"===n){if(o=this.withConfig({response_format:{type:"json_schema",json_schema:{name:i??"extract",description:(0,sn.cg)(a),schema:a,strict:t?.strict}}}),(0,sn.c9)(a)){let e=nA._6.fromZodSchema(a);l=nP.jY.from(t=>"parsed"in t.additional_kwargs?t.additional_kwargs.parsed:e)}else l=new nA.hU}else{let e=i??"extract";if((0,sn.c9)(a)){let r=(0,ss.PF)(a);o=this.withConfig({tools:[{type:"function",function:{name:e,description:r.description,parameters:r}}],tool_choice:{type:"function",function:{name:e}},...t?.strict!==void 0?{strict:t.strict}:{}}),l=new nD({returnSingle:!0,keyName:e,zodSchema:a})}else{let r;"string"==typeof a.name&&"object"==typeof a.parameters&&null!=a.parameters?(r=a,e=a.name):r={name:e=a.title??e,description:a.description??"",parameters:a},o=this.withConfig({tools:[{type:"function",function:r}],tool_choice:{type:"function",function:{name:e}},...t?.strict!==void 0?{strict:t.strict}:{}}),l=new nD({returnSingle:!0,keyName:e})}}if(!s)return o.pipe(l);let u=nP.kI.assign({parsed:(e,t)=>l.invoke(e.raw,t)}),c=nP.kI.assign({parsed:()=>null}),d=u.withFallbacks({fallbacks:[c]});return nP.zZ.from([{raw:o},d])}}r(49509);var sI=r(21563);sI.P,r(72257).J;var sk=r(70014),sE=r(80918),sx=r(92173),sS=r(27231);r(89351);var sP=r(28809);r(23229);class sA extends nS.ZE{get lc_namespace(){return["langchain","tools"]}constructor(e){super(e??{}),Object.defineProperty(this,"returnDirect",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"verboseParsingErrors",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"responseFormat",{enumerable:!0,configurable:!0,writable:!0,value:"content"}),this.verboseParsingErrors=e?.verboseParsingErrors??this.verboseParsingErrors,this.responseFormat=e?.responseFormat??this.responseFormat}async invoke(e,t){let r;let a=(0,sx.ZI)(t);return(0,sP.Ky)(e)?(r=e.args,a={...a,toolCall:e}):r=e,this.call(r,a)}async call(e,t,r){let a,i,n,s,o;let l=(0,sP.Ky)(e)?e.args:e;if((0,nR.c9)(this.schema))try{a=await (0,nR.hZ)(this.schema,l)}catch(r){let t="Received tool input did not match expected schema";throw this.verboseParsingErrors&&(t=`${t}
Details: ${r.message}`),new sP.qe(t,JSON.stringify(e))}else{let t=(0,sk.tf)(l,this.schema);if(!t.valid){let r="Received tool input did not match expected schema";throw this.verboseParsingErrors&&(r=`${r}
Details: ${t.errors.map(e=>`${e.keywordLocation}: ${e.error}`).join("\n")}`),new sP.qe(r,JSON.stringify(e))}a=l}let u=(0,sE.H_)(t),c=sE.Td.configure(u.callbacks,this.callbacks,u.tags||r,this.tags,u.metadata,this.metadata,{verbose:this.verbose}),d=await c?.handleToolStart(this.toJSON(),"string"==typeof e?e:JSON.stringify(e),u.runId,void 0,void 0,void 0,u.runName);delete u.runId;try{i=await this._call(a,d,u)}catch(e){throw await d?.handleToolError(e),e}if("content_and_artifact"===this.responseFormat){if(Array.isArray(i)&&2===i.length)[n,s]=i;else throw Error(`Tool response format is "content_and_artifact" but the output was not a two-tuple.
Result: ${JSON.stringify(i)}`)}else n=i;(0,sP.Ky)(e)&&(o=e.id),!o&&(0,sP.hR)(u)&&(o=u.toolCall.id);let h=function(e){let{content:t,artifact:r,toolCallId:a}=e;return!a||(0,sS.fK)(t)?t:new sS.uf("string"==typeof t||Array.isArray(t)&&t.every(e=>"object"==typeof e)?{content:t,artifact:r,tool_call_id:a,name:e.name}:{content:function(e){try{return JSON.stringify(e,null,2)??""}catch(t){return`${e}`}}(t),artifact:r,tool_call_id:a,name:e.name})}({content:n,artifact:s,toolCallId:o,name:this.name});return await d?.handleToolEnd(h),h}}class sT extends sA{constructor(e){super(e),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:nF.z.object({input:nF.z.string().optional()}).transform(e=>e.input)})}call(e,t){return super.call("string"==typeof e||null==e?{input:e}:e,t)}}class sj extends sT{static lc_name(){return"DallEAPIWrapper"}constructor(e){e?.responseFormat!==void 0&&["url","b64_json"].includes(e.responseFormat)&&(e.dallEResponseFormat=e.responseFormat,e.responseFormat="content"),super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"dalle_api_wrapper"}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:"A wrapper around OpenAI DALL-E API. Useful for when you need to generate images from a text description. Input should be an image description."}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"dall-e-3"}),Object.defineProperty(this,"style",{enumerable:!0,configurable:!0,writable:!0,value:"vivid"}),Object.defineProperty(this,"quality",{enumerable:!0,configurable:!0,writable:!0,value:"standard"}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"size",{enumerable:!0,configurable:!0,writable:!0,value:"1024x1024"}),Object.defineProperty(this,"dallEResponseFormat",{enumerable:!0,configurable:!0,writable:!0,value:"url"}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let t={apiKey:e?.apiKey??e?.openAIApiKey??(0,nE.Az)("OPENAI_API_KEY"),organization:e?.organization??(0,nE.Az)("OPENAI_ORGANIZATION"),dangerouslyAllowBrowser:!0,baseURL:e?.baseUrl};this.client=new nO(t),this.model=e?.model??e?.modelName??this.model,this.style=e?.style??this.style,this.quality=e?.quality??this.quality,this.n=e?.n??this.n,this.size=e?.size??this.size,this.dallEResponseFormat=e?.dallEResponseFormat??this.dallEResponseFormat,this.user=e?.user}processMultipleGeneratedUrls(e){return"url"===this.dallEResponseFormat?e.flatMap(e=>e.data?.flatMap(e=>e.url?{type:"image_url",image_url:e.url}:[]).filter(e=>void 0!==e&&"image_url"===e.type&&"string"==typeof e.image_url&&void 0!==e.image_url)??[]):e.flatMap(e=>e.data?.flatMap(e=>e.b64_json?{type:"image_url",image_url:{url:e.b64_json}}:[]).filter(e=>void 0!==e&&"image_url"===e.type&&"object"==typeof e.image_url&&"url"in e.image_url&&"string"==typeof e.image_url.url&&void 0!==e.image_url.url)??[])}async _call(e){let t={model:this.model,prompt:e,n:1,size:this.size,response_format:this.dallEResponseFormat,style:this.style,quality:this.quality,user:this.user};if(this.n>1){let e=await Promise.all(Array.from({length:this.n}).map(()=>this.client.images.generate(t)));return this.processMultipleGeneratedUrls(e)}let r=await this.client.images.generate(t),a="";return"url"===this.dallEResponseFormat?[a]=r.data?.map(e=>e.url).filter(e=>"undefined"!==e)??[]:[a]=r.data?.map(e=>e.b64_json).filter(e=>"undefined"!==e)??[],a}}Object.defineProperty(sj,"toolName",{enumerable:!0,configurable:!0,writable:!0,value:"dalle_api_wrapper"})},34497:(e,t,r)=>{"use strict";r.d(t,{IU:()=>n,K3:()=>l,Pq:()=>i,c9:()=>o,cg:()=>c,hZ:()=>u,lm:()=>s,yQ:()=>d});var a=r(70238);function i(e){if("object"!=typeof e||null===e||!("_zod"in e))return!1;let t=e._zod;return"object"==typeof t&&null!==t&&"def"in t}function n(e){if("object"!=typeof e||null===e||!("_def"in e)||"_zod"in e)return!1;let t=e._def;return"object"==typeof t&&null!=t&&"typeName"in t}function s(e){return i(e)&&console.warn("[WARNING] Attempting to use Zod 4 schema in a context where Zod 3 schema is expected. This may cause unexpected behavior."),n(e)}function o(e){return!(!e||"object"!=typeof e||Array.isArray(e))&&!!(i(e)||n(e))}async function l(e,t){if(i(e))try{let r=await (0,a.EJS)(e,t);return{success:!0,data:r}}catch(e){return{success:!1,error:e}}if(n(e))return e.safeParse(t);throw Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}async function u(e,t){if(i(e))return(0,a.qgA)(e,t);if(n(e))return e.parse(t);throw Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}function c(e){return i(e)?a.fd.get(e)?.description:n(e)||"description"in e&&"string"==typeof e.description?e.description:void 0}function d(e){return!!o(e)&&(n(e)?"ZodString"===e._def.typeName:!!i(e)&&"string"===e._zod.def.type)}},34544:(e,t,r)=>{"use strict";r.d(t,{m:()=>i});let a={};function i(e){a[e]||(console.warn(e),a[e]=!0)}},34621:(e,t,r)=>{"use strict";r.d(t,{ZE:()=>j,j_:()=>N,Z2:()=>A,VC:()=>P});var a="object"==typeof window?window:{},i="0123456789abcdef".split(""),n=[-0x80000000,8388608,32768,128],s=[24,16,8,0],o=[];function l(e){e?(o[0]=o[16]=o[1]=o[2]=o[3]=o[4]=o[5]=o[6]=o[7]=o[8]=o[9]=o[10]=o[11]=o[12]=o[13]=o[14]=o[15]=0,this.blocks=o):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.h0=0x67452301,this.h1=0xefcdab89,this.h2=0x98badcfe,this.h3=0x10325476,this.h4=0xc3d2e1f0,this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}l.prototype.update=function(e){if(!this.finalized){var t="string"!=typeof e;t&&e.constructor===a.ArrayBuffer&&(e=new Uint8Array(e));for(var r,i,n=0,o=e.length||0,l=this.blocks;n<o;){if(this.hashed&&(this.hashed=!1,l[0]=this.block,l[16]=l[1]=l[2]=l[3]=l[4]=l[5]=l[6]=l[7]=l[8]=l[9]=l[10]=l[11]=l[12]=l[13]=l[14]=l[15]=0),t)for(i=this.start;n<o&&i<64;++n)l[i>>2]|=e[n]<<s[3&i++];else for(i=this.start;n<o&&i<64;++n)(r=e.charCodeAt(n))<128?l[i>>2]|=r<<s[3&i++]:(r<2048?l[i>>2]|=(192|r>>6)<<s[3&i++]:(r<55296||r>=57344?l[i>>2]|=(224|r>>12)<<s[3&i++]:(r=65536+((1023&r)<<10|1023&e.charCodeAt(++n)),l[i>>2]|=(240|r>>18)<<s[3&i++],l[i>>2]|=(128|r>>12&63)<<s[3&i++]),l[i>>2]|=(128|r>>6&63)<<s[3&i++]),l[i>>2]|=(128|63&r)<<s[3&i++]);this.lastByteIndex=i,this.bytes+=i-this.start,i>=64?(this.block=l[16],this.start=i-64,this.hash(),this.hashed=!0):this.start=i}return this.bytes>0xffffffff&&(this.hBytes+=this.bytes/0x100000000<<0,this.bytes=this.bytes%0x100000000),this}},l.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var e=this.blocks,t=this.lastByteIndex;e[16]=this.block,e[t>>2]|=n[3&t],this.block=e[16],t>=56&&(this.hashed||this.hash(),e[0]=this.block,e[16]=e[1]=e[2]=e[3]=e[4]=e[5]=e[6]=e[7]=e[8]=e[9]=e[10]=e[11]=e[12]=e[13]=e[14]=e[15]=0),e[14]=this.hBytes<<3|this.bytes>>>29,e[15]=this.bytes<<3,this.hash()}},l.prototype.hash=function(){var e,t,r,a=this.h0,i=this.h1,n=this.h2,s=this.h3,o=this.h4,l=this.blocks;for(t=16;t<80;++t)r=l[t-3]^l[t-8]^l[t-14]^l[t-16],l[t]=r<<1|r>>>31;for(t=0;t<20;t+=5)e=i&n|~i&s,o=(r=a<<5|a>>>27)+e+o+0x5a827999+l[t]<<0,e=a&(i=i<<30|i>>>2)|~a&n,s=(r=o<<5|o>>>27)+e+s+0x5a827999+l[t+1]<<0,e=o&(a=a<<30|a>>>2)|~o&i,n=(r=s<<5|s>>>27)+e+n+0x5a827999+l[t+2]<<0,e=s&(o=o<<30|o>>>2)|~s&a,i=(r=n<<5|n>>>27)+e+i+0x5a827999+l[t+3]<<0,e=n&(s=s<<30|s>>>2)|~n&o,a=(r=i<<5|i>>>27)+e+a+0x5a827999+l[t+4]<<0,n=n<<30|n>>>2;for(;t<40;t+=5)e=i^n^s,o=(r=a<<5|a>>>27)+e+o+0x6ed9eba1+l[t]<<0,e=a^(i=i<<30|i>>>2)^n,s=(r=o<<5|o>>>27)+e+s+0x6ed9eba1+l[t+1]<<0,e=o^(a=a<<30|a>>>2)^i,n=(r=s<<5|s>>>27)+e+n+0x6ed9eba1+l[t+2]<<0,e=s^(o=o<<30|o>>>2)^a,i=(r=n<<5|n>>>27)+e+i+0x6ed9eba1+l[t+3]<<0,e=n^(s=s<<30|s>>>2)^o,a=(r=i<<5|i>>>27)+e+a+0x6ed9eba1+l[t+4]<<0,n=n<<30|n>>>2;for(;t<60;t+=5)e=i&n|i&s|n&s,o=(r=a<<5|a>>>27)+e+o-0x70e44324+l[t]<<0,e=a&(i=i<<30|i>>>2)|a&n|i&n,s=(r=o<<5|o>>>27)+e+s-0x70e44324+l[t+1]<<0,e=o&(a=a<<30|a>>>2)|o&i|a&i,n=(r=s<<5|s>>>27)+e+n-0x70e44324+l[t+2]<<0,e=s&(o=o<<30|o>>>2)|s&a|o&a,i=(r=n<<5|n>>>27)+e+i-0x70e44324+l[t+3]<<0,e=n&(s=s<<30|s>>>2)|n&o|s&o,a=(r=i<<5|i>>>27)+e+a-0x70e44324+l[t+4]<<0,n=n<<30|n>>>2;for(;t<80;t+=5)e=i^n^s,o=(r=a<<5|a>>>27)+e+o-0x359d3e2a+l[t]<<0,e=a^(i=i<<30|i>>>2)^n,s=(r=o<<5|o>>>27)+e+s-0x359d3e2a+l[t+1]<<0,e=o^(a=a<<30|a>>>2)^i,n=(r=s<<5|s>>>27)+e+n-0x359d3e2a+l[t+2]<<0,e=s^(o=o<<30|o>>>2)^a,i=(r=n<<5|n>>>27)+e+i-0x359d3e2a+l[t+3]<<0,e=n^(s=s<<30|s>>>2)^o,a=(r=i<<5|i>>>27)+e+a-0x359d3e2a+l[t+4]<<0,n=n<<30|n>>>2;this.h0=this.h0+a<<0,this.h1=this.h1+i<<0,this.h2=this.h2+n<<0,this.h3=this.h3+s<<0,this.h4=this.h4+o<<0},l.prototype.hex=function(){this.finalize();var e=this.h0,t=this.h1,r=this.h2,a=this.h3,n=this.h4;return i[e>>28&15]+i[e>>24&15]+i[e>>20&15]+i[e>>16&15]+i[e>>12&15]+i[e>>8&15]+i[e>>4&15]+i[15&e]+i[t>>28&15]+i[t>>24&15]+i[t>>20&15]+i[t>>16&15]+i[t>>12&15]+i[t>>8&15]+i[t>>4&15]+i[15&t]+i[r>>28&15]+i[r>>24&15]+i[r>>20&15]+i[r>>16&15]+i[r>>12&15]+i[r>>8&15]+i[r>>4&15]+i[15&r]+i[a>>28&15]+i[a>>24&15]+i[a>>20&15]+i[a>>16&15]+i[a>>12&15]+i[a>>8&15]+i[a>>4&15]+i[15&a]+i[n>>28&15]+i[n>>24&15]+i[n>>20&15]+i[n>>16&15]+i[n>>12&15]+i[n>>8&15]+i[n>>4&15]+i[15&n]},l.prototype.toString=l.prototype.hex,l.prototype.digest=function(){this.finalize();var e=this.h0,t=this.h1,r=this.h2,a=this.h3,i=this.h4;return[e>>24&255,e>>16&255,e>>8&255,255&e,t>>24&255,t>>16&255,t>>8&255,255&t,r>>24&255,r>>16&255,r>>8&255,255&r,a>>24&255,a>>16&255,a>>8&255,255&a,i>>24&255,i>>16&255,i>>8&255,255&i]},l.prototype.array=l.prototype.digest,l.prototype.arrayBuffer=function(){this.finalize();var e=new ArrayBuffer(20),t=new DataView(e);return t.setUint32(0,this.h0),t.setUint32(4,this.h1),t.setUint32(8,this.h2),t.setUint32(12,this.h3),t.setUint32(16,this.h4),e};let u=e=>new l(!0).update(e).hex();var c=r(90338);let d=(...e)=>u(e.join("_"));class h{}let p=new Map;class m extends h{constructor(e){super(),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.cache=e??new Map}lookup(e,t){return Promise.resolve(this.cache.get(d(e,t))??null)}async update(e,t,r){this.cache.set(d(e,t),r)}static global(){return new m(p)}}var f=r(91481),g=r(65408),y=r(57719),b=Object.defineProperty,_=(e,t,r)=>t in e?b(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,v=class{specialTokens;inverseSpecialTokens;patStr;textEncoder=new TextEncoder;textDecoder=new TextDecoder("utf-8");rankMap=new Map;textMap=new Map;constructor(e,t){for(let[t,r]of(this.patStr=e.pat_str,Object.entries(e.bpe_ranks.split("\n").filter(Boolean).reduce((e,t)=>{let[r,a,...i]=t.split(" "),n=Number.parseInt(a,10);return i.forEach((t,r)=>e[t]=n+r),e},{})))){let e=y.toByteArray(t);this.rankMap.set(e.join(","),r),this.textMap.set(r,e)}this.specialTokens={...e.special_tokens,...t},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce((e,[t,r])=>(e[r]=this.textEncoder.encode(t),e),{})}encode(e,t=[],r="all"){let a=RegExp(this.patStr,"ug"),i=v.specialTokenRegex(Object.keys(this.specialTokens)),n=[],s=new Set("all"===t?Object.keys(this.specialTokens):t),o=new Set("all"===r?Object.keys(this.specialTokens).filter(e=>!s.has(e)):r);if(o.size>0){let t=v.specialTokenRegex([...o]),r=e.match(t);if(null!=r)throw Error(`The text contains a special token that is not allowed: ${r[0]}`)}let l=0;for(;;){let t=null,r=l;for(;i.lastIndex=r,!(null==(t=i.exec(e))||s.has(t[0]));)r=t.index+1;let o=t?.index??e.length;for(let t of e.substring(l,o).matchAll(a)){let e=this.textEncoder.encode(t[0]),r=this.rankMap.get(e.join(","));if(null!=r){n.push(r);continue}n.push(...function(e,t){return 1===e.length?[t.get(e.join(","))]:(function(e,t){let r=Array.from({length:e.length},(e,t)=>({start:t,end:t+1}));for(;r.length>1;){let a=null;for(let i=0;i<r.length-1;i++){let n=e.slice(r[i].start,r[i+1].end),s=t.get(n.join(","));null!=s&&(null==a||s<a[0])&&(a=[s,i])}if(null!=a){let e=a[1];r[e]={start:r[e].start,end:r[e+1].end},r.splice(e+1,1)}else break}return r})(e,t).map(r=>t.get(e.slice(r.start,r.end).join(","))).filter(e=>null!=e)}(e,this.rankMap))}if(null==t)break;let u=this.specialTokens[t[0]];n.push(u),l=t.index+t[0].length}return n}decode(e){let t=[],r=0;for(let a=0;a<e.length;++a){let i=e[a],n=this.textMap.get(i)??this.inverseSpecialTokens[i];null!=n&&(t.push(n),r+=n.length)}let a=new Uint8Array(r),i=0;for(let e of t)a.set(e,i),i+=e.length;return this.textDecoder.decode(a)}};((e,t,r)=>_(e,"symbol"!=typeof t?t+"":t,r))(v,"specialTokenRegex",e=>RegExp(e.map(e=>e.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")).join("|"),"g"));let w={},O=new g.g({});async function I(e){return e in w||(w[e]=O.fetch(`https://tiktoken.pages.dev/js/${e}.json`).then(e=>e.json()).then(e=>new v(e)).catch(t=>{throw delete w[e],t})),await w[e]}async function k(e){return I(function(e){switch(e){case"gpt2":return"gpt2";case"code-cushman-001":case"code-cushman-002":case"code-davinci-001":case"code-davinci-002":case"cushman-codex":case"davinci-codex":case"davinci-002":case"text-davinci-002":case"text-davinci-003":return"p50k_base";case"code-davinci-edit-001":case"text-davinci-edit-001":return"p50k_edit";case"ada":case"babbage":case"babbage-002":case"code-search-ada-code-001":case"code-search-babbage-code-001":case"curie":case"davinci":case"text-ada-001":case"text-babbage-001":case"text-curie-001":case"text-davinci-001":case"text-search-ada-doc-001":case"text-search-babbage-doc-001":case"text-search-curie-doc-001":case"text-search-davinci-doc-001":case"text-similarity-ada-001":case"text-similarity-babbage-001":case"text-similarity-curie-001":case"text-similarity-davinci-001":return"r50k_base";case"gpt-3.5-turbo-instruct-0914":case"gpt-3.5-turbo-instruct":case"gpt-3.5-turbo-16k-0613":case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo":case"gpt-4-32k-0613":case"gpt-4-32k-0314":case"gpt-4-32k":case"gpt-4-0613":case"gpt-4-0314":case"gpt-4":case"gpt-3.5-turbo-1106":case"gpt-35-turbo":case"gpt-4-1106-preview":case"gpt-4-vision-preview":case"gpt-3.5-turbo-0125":case"gpt-4-turbo":case"gpt-4-turbo-2024-04-09":case"gpt-4-turbo-preview":case"gpt-4-0125-preview":case"text-embedding-ada-002":case"text-embedding-3-small":case"text-embedding-3-large":return"cl100k_base";case"gpt-4o":case"gpt-4o-2024-05-13":case"gpt-4o-2024-08-06":case"gpt-4o-2024-11-20":case"gpt-4o-mini-2024-07-18":case"gpt-4o-mini":case"gpt-4o-search-preview":case"gpt-4o-search-preview-2025-03-11":case"gpt-4o-mini-search-preview":case"gpt-4o-mini-search-preview-2025-03-11":case"gpt-4o-audio-preview":case"gpt-4o-audio-preview-2024-12-17":case"gpt-4o-audio-preview-2024-10-01":case"gpt-4o-mini-audio-preview":case"gpt-4o-mini-audio-preview-2024-12-17":case"o1":case"o1-2024-12-17":case"o1-mini":case"o1-mini-2024-09-12":case"o1-preview":case"o1-preview-2024-09-12":case"o1-pro":case"o1-pro-2025-03-19":case"o3":case"o3-2025-04-16":case"o3-mini":case"o3-mini-2025-01-31":case"o4-mini":case"o4-mini-2025-04-16":case"chatgpt-4o-latest":case"gpt-4o-realtime":case"gpt-4o-realtime-preview-2024-10-01":case"gpt-4o-realtime-preview-2024-12-17":case"gpt-4o-mini-realtime-preview":case"gpt-4o-mini-realtime-preview-2024-12-17":case"gpt-4.1":case"gpt-4.1-2025-04-14":case"gpt-4.1-mini":case"gpt-4.1-mini-2025-04-14":case"gpt-4.1-nano":case"gpt-4.1-nano-2025-04-14":case"gpt-4.5-preview":case"gpt-4.5-preview-2025-02-27":return"o200k_base";default:throw Error("Unknown model")}}(e))}var E=r(99643);let x=e=>e.startsWith("gpt-3.5-turbo-16k")?"gpt-3.5-turbo-16k":e.startsWith("gpt-3.5-turbo-")?"gpt-3.5-turbo":e.startsWith("gpt-4-32k")?"gpt-4-32k":e.startsWith("gpt-4-")?"gpt-4":e.startsWith("gpt-4o")?"gpt-4o":e,S=e=>{switch(x(e)){case"gpt-3.5-turbo-16k":return 16384;case"gpt-3.5-turbo":return 4096;case"gpt-4-32k":return 32768;case"gpt-4":return 8192;case"text-davinci-003":default:return 4097;case"text-curie-001":case"text-babbage-001":case"text-ada-001":case"code-cushman-001":return 2048;case"code-davinci-002":return 8e3}};function P(e){return"object"==typeof e&&!!e&&("type"in e&&"function"===e.type&&"function"in e&&"object"==typeof e.function&&!!e.function&&"name"in e.function&&"parameters"in e.function||!1)}let A=async({prompt:e,modelName:t})=>{let r;try{r=(await k(x(t))).encode(e).length}catch(t){console.warn("Failed to calculate number of tokens, falling back to approximate count"),r=Math.ceil(e.length/4)}return S(t)-r},T=()=>!1;class j extends E.YN{get lc_attributes(){return{callbacks:void 0,verbose:void 0}}constructor(e){super(e),Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.verbose=e.verbose??T(),this.callbacks=e.callbacks,this.tags=e.tags??[],this.metadata=e.metadata??{}}}class N extends j{get callKeys(){return["stop","timeout","signal","tags","metadata","callbacks"]}constructor({callbacks:e,callbackManager:t,...r}){let{cache:a,...i}=r;super({callbacks:e??t,...i}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_encoding",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),"object"==typeof a?this.cache=a:a?this.cache=m.global():this.cache=void 0,this.caller=new g.g(r??{})}async getNumTokens(e){let t;let r=Math.ceil((t="string"==typeof e?e:e.map(e=>"string"==typeof e?e:"text"===e.type&&"text"in e?e.text:"").join("")).length/4);if(!this._encoding)try{this._encoding=await k("modelName"in this?x(this.modelName):"gpt2")}catch(e){console.warn("Failed to calculate number of tokens, falling back to approximate count",e)}if(this._encoding)try{r=this._encoding.encode(t).length}catch(e){console.warn("Failed to calculate number of tokens, falling back to approximate count",e)}return r}static _convertInputToPromptValue(e){return"string"==typeof e?new f.HY(e):Array.isArray(e)?new f.aB(e.map(c.K0)):e}_identifyingParams(){return{}}_getSerializedCacheKeyParametersForCall({config:e,...t}){return Object.entries({...this._identifyingParams(),...t,_type:this._llmType(),_model:this._modelType()}).filter(([e,t])=>void 0!==t).map(([e,t])=>`${e}:${JSON.stringify(t)}`).sort().join(",")}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}static async deserialize(e){throw Error("Use .toJSON() instead")}}},34817:(e,t,r)=>{"use strict";let a=r(88193);e.exports=(e,t,r)=>0>=a(e,t,r)},34984:(e,t,r)=>{"use strict";let a=r(88193);e.exports=(e,t,r)=>0===a(e,t,r)},35695:(e,t,r)=>{"use strict";var a=r(18999);r.o(a,"usePathname")&&r.d(t,{usePathname:function(){return a.usePathname}}),r.o(a,"useRouter")&&r.d(t,{useRouter:function(){return a.useRouter}}),r.o(a,"useSearchParams")&&r.d(t,{useSearchParams:function(){return a.useSearchParams}})},35745:(e,t,r)=>{"use strict";r.d(t,{A:()=>o});let a={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};var i,n=new Uint8Array(16),s=r(32417);let o=function(e,t,r){if(a.randomUUID&&!t&&!e)return a.randomUUID();var o=(e=e||{}).random||(e.rng||function(){if(!i&&!(i="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return i(n)})();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t){r=r||0;for(var l=0;l<16;++l)t[r+l]=o[l];return t}return(0,s.k)(o)}},36053:(e,t,r)=>{"use strict";let a=r(57265),{MAX_LENGTH:i,MAX_SAFE_INTEGER:n}=r(81979),{safeRe:s,t:o}=r(56655),l=r(32002),{compareIdentifiers:u}=r(83930);class c{constructor(e,t){if(t=l(t),e instanceof c){if(!!t.loose===e.loose&&!!t.includePrerelease===e.includePrerelease)return e;e=e.version}else if("string"!=typeof e)throw TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>i)throw TypeError(`version is longer than ${i} characters`);a("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;let r=e.trim().match(t.loose?s[o.LOOSE]:s[o.FULL]);if(!r)throw TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+r[1],this.minor=+r[2],this.patch=+r[3],this.major>n||this.major<0)throw TypeError("Invalid major version");if(this.minor>n||this.minor<0)throw TypeError("Invalid minor version");if(this.patch>n||this.patch<0)throw TypeError("Invalid patch version");r[4]?this.prerelease=r[4].split(".").map(e=>{if(/^[0-9]+$/.test(e)){let t=+e;if(t>=0&&t<n)return t}return e}):this.prerelease=[],this.build=r[5]?r[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(a("SemVer.compare",this.version,this.options,e),!(e instanceof c)){if("string"==typeof e&&e===this.version)return 0;e=new c(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof c||(e=new c(e,this.options)),u(this.major,e.major)||u(this.minor,e.minor)||u(this.patch,e.patch)}comparePre(e){if(e instanceof c||(e=new c(e,this.options)),this.prerelease.length&&!e.prerelease.length)return -1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{let r=this.prerelease[t],i=e.prerelease[t];if(a("prerelease compare",t,r,i),void 0===r&&void 0===i)return 0;if(void 0===i)return 1;if(void 0===r)return -1;else if(r===i)continue;else return u(r,i)}while(++t)}compareBuild(e){e instanceof c||(e=new c(e,this.options));let t=0;do{let r=this.build[t],i=e.build[t];if(a("build compare",t,r,i),void 0===r&&void 0===i)return 0;if(void 0===i)return 1;if(void 0===r)return -1;else if(r===i)continue;else return u(r,i)}while(++t)}inc(e,t,r){if(e.startsWith("pre")){if(!t&&!1===r)throw Error("invalid increment argument: identifier is empty");if(t){let e=`-${t}`.match(this.options.loose?s[o.PRERELEASELOOSE]:s[o.PRERELEASE]);if(!e||e[1]!==t)throw Error(`invalid identifier: ${t}`)}}switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t,r);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t,r);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t,r),this.inc("pre",t,r);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t,r),this.inc("pre",t,r);break;case"release":if(0===this.prerelease.length)throw Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":(0!==this.minor||0!==this.patch||0===this.prerelease.length)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(0!==this.patch||0===this.prerelease.length)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":{let e=+!!Number(r);if(0===this.prerelease.length)this.prerelease=[e];else{let a=this.prerelease.length;for(;--a>=0;)"number"==typeof this.prerelease[a]&&(this.prerelease[a]++,a=-2);if(-1===a){if(t===this.prerelease.join(".")&&!1===r)throw Error("invalid increment argument: identifier already exists");this.prerelease.push(e)}}if(t){let a=[t,e];!1===r&&(a=[t]),0===u(this.prerelease[0],t)?isNaN(this.prerelease[1])&&(this.prerelease=a):this.prerelease=a}break}default:throw Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}}e.exports=c},41039:(e,t,r)=>{"use strict";r.d(t,{H:()=>u,KX:()=>o,Od:()=>s,jm:()=>l});var a=r(58036),i=r(64520),n=r(27231);class s extends i.XQ{get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls"}}constructor(e,t){let r;if("string"==typeof e)r={content:e,tool_calls:[],invalid_tool_calls:[],additional_kwargs:t??{}};else{r=e;let t=r.additional_kwargs?.tool_calls,a=r.tool_calls;null!=t&&t.length>0&&(void 0===a||0===a.length)&&console.warn("New LangChain packages are available that more efficiently handle tool calling.\n\nPlease upgrade your packages to versions that set message tool calls. e.g., `yarn add @langchain/anthropic`, yarn add @langchain/openai`, etc.");try{if(null!=t&&void 0===a){let[e,a]=(0,n.p1)(t);r.tool_calls=e??[],r.invalid_tool_calls=a??[]}else r.tool_calls=r.tool_calls??[],r.invalid_tool_calls=r.invalid_tool_calls??[]}catch(e){r.tool_calls=[],r.invalid_tool_calls=[]}}super(r),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),"string"!=typeof r&&(this.tool_calls=r.tool_calls??this.tool_calls,this.invalid_tool_calls=r.invalid_tool_calls??this.invalid_tool_calls),this.usage_metadata=r.usage_metadata}static lc_name(){return"AIMessage"}_getType(){return"ai"}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}}function o(e){return"ai"===e._getType()}function l(e){return"ai"===e._getType()}class u extends i.gj{constructor(e){let t;if("string"==typeof e)t={content:e,tool_calls:[],invalid_tool_calls:[],tool_call_chunks:[]};else if(void 0===e.tool_call_chunks)t={...e,tool_calls:e.tool_calls??[],invalid_tool_calls:[],tool_call_chunks:[],usage_metadata:void 0!==e.usage_metadata?e.usage_metadata:void 0};else{let r=[],i=[];for(let t of e.tool_call_chunks){let e={};try{if(e=(0,a.d)(t.args||"{}"),null===e||"object"!=typeof e||Array.isArray(e))throw Error("Malformed tool call chunk args.");r.push({name:t.name??"",args:e,id:t.id,type:"tool_call"})}catch(e){i.push({name:t.name,args:t.args,id:t.id,error:"Malformed args.",type:"invalid_tool_call"})}}t={...e,tool_calls:r,invalid_tool_calls:i,usage_metadata:void 0!==e.usage_metadata?e.usage_metadata:void 0}}super(t),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tool_call_chunks",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_chunks=t.tool_call_chunks??this.tool_call_chunks,this.tool_calls=t.tool_calls??this.tool_calls,this.invalid_tool_calls=t.invalid_tool_calls??this.invalid_tool_calls,this.usage_metadata=t.usage_metadata}get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls",tool_call_chunks:"tool_call_chunks"}}static lc_name(){return"AIMessageChunk"}_getType(){return"ai"}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,tool_call_chunks:this.tool_call_chunks,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}concat(e){let t={content:(0,i._I)(this.content,e.content),additional_kwargs:(0,i.ns)(this.additional_kwargs,e.additional_kwargs),response_metadata:(0,i.ns)(this.response_metadata,e.response_metadata),tool_call_chunks:[],id:this.id??e.id};if(void 0!==this.tool_call_chunks||void 0!==e.tool_call_chunks){let r=(0,i.Vt)(this.tool_call_chunks,e.tool_call_chunks);void 0!==r&&r.length>0&&(t.tool_call_chunks=r)}if(void 0!==this.usage_metadata||void 0!==e.usage_metadata){let r={...(this.usage_metadata?.input_token_details?.audio!==void 0||e.usage_metadata?.input_token_details?.audio!==void 0)&&{audio:(this.usage_metadata?.input_token_details?.audio??0)+(e.usage_metadata?.input_token_details?.audio??0)},...(this.usage_metadata?.input_token_details?.cache_read!==void 0||e.usage_metadata?.input_token_details?.cache_read!==void 0)&&{cache_read:(this.usage_metadata?.input_token_details?.cache_read??0)+(e.usage_metadata?.input_token_details?.cache_read??0)},...(this.usage_metadata?.input_token_details?.cache_creation!==void 0||e.usage_metadata?.input_token_details?.cache_creation!==void 0)&&{cache_creation:(this.usage_metadata?.input_token_details?.cache_creation??0)+(e.usage_metadata?.input_token_details?.cache_creation??0)}},a={...(this.usage_metadata?.output_token_details?.audio!==void 0||e.usage_metadata?.output_token_details?.audio!==void 0)&&{audio:(this.usage_metadata?.output_token_details?.audio??0)+(e.usage_metadata?.output_token_details?.audio??0)},...(this.usage_metadata?.output_token_details?.reasoning!==void 0||e.usage_metadata?.output_token_details?.reasoning!==void 0)&&{reasoning:(this.usage_metadata?.output_token_details?.reasoning??0)+(e.usage_metadata?.output_token_details?.reasoning??0)}},i=this.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},n=e.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0};t.usage_metadata={input_tokens:i.input_tokens+n.input_tokens,output_tokens:i.output_tokens+n.output_tokens,total_tokens:i.total_tokens+n.total_tokens,...Object.keys(r).length>0&&{input_token_details:r},...Object.keys(a).length>0&&{output_token_details:a}}}return new u(t)}}},41412:(e,t,r)=>{"use strict";let a=r(43879),i=r(88193);e.exports=(e,t,r)=>{let n=[],s=null,o=null,l=e.sort((e,t)=>i(e,t,r));for(let e of l)a(e,t,r)?(o=e,s||(s=e)):(o&&n.push([s,o]),o=null,s=null);s&&n.push([s,null]);let u=[];for(let[e,t]of n)e===t?u.push(e):t||e!==l[0]?t?e===l[0]?u.push(`<=${t}`):u.push(`${e} - ${t}`):u.push(`>=${e}`):u.push("*");let c=u.join(" || "),d="string"==typeof t.raw?t.raw:String(t);return c.length<d.length?c:t}},42452:(e,t,r)=>{"use strict";function a(e,t){return e.lc_error_code=t,e.message=`${e.message}

Troubleshooting URL: https://js.langchain.com/docs/troubleshooting/errors/${t}/
`,e}r.d(t,{Y:()=>a})},42870:(e,t,r)=>{"use strict";let a=/\s+/g;class i{constructor(e,t){if(t=s(t),e instanceof i){if(!!t.loose===e.loose&&!!t.includePrerelease===e.includePrerelease)return e;return new i(e.raw,t)}if(e instanceof o)return this.raw=e.value,this.set=[[e]],this.formatted=void 0,this;if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e.trim().replace(a," "),this.set=this.raw.split("||").map(e=>this.parseRange(e.trim())).filter(e=>e.length),!this.set.length)throw TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){let e=this.set[0];if(this.set=this.set.filter(e=>!y(e[0])),0===this.set.length)this.set=[e];else if(this.set.length>1){for(let e of this.set)if(1===e.length&&b(e[0])){this.set=[e];break}}}this.formatted=void 0}get range(){if(void 0===this.formatted){this.formatted="";for(let e=0;e<this.set.length;e++){e>0&&(this.formatted+="||");let t=this.set[e];for(let e=0;e<t.length;e++)e>0&&(this.formatted+=" "),this.formatted+=t[e].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(e){let t=((this.options.includePrerelease&&f)|(this.options.loose&&g))+":"+e,r=n.get(t);if(r)return r;let a=this.options.loose,i=a?c[d.HYPHENRANGELOOSE]:c[d.HYPHENRANGE];l("hyphen replace",e=e.replace(i,T(this.options.includePrerelease))),l("comparator trim",e=e.replace(c[d.COMPARATORTRIM],h)),l("tilde trim",e=e.replace(c[d.TILDETRIM],p)),l("caret trim",e=e.replace(c[d.CARETTRIM],m));let s=e.split(" ").map(e=>v(e,this.options)).join(" ").split(/\s+/).map(e=>A(e,this.options));a&&(s=s.filter(e=>(l("loose invalid filter",e,this.options),!!e.match(c[d.COMPARATORLOOSE])))),l("range list",s);let u=new Map;for(let e of s.map(e=>new o(e,this.options))){if(y(e))return[e];u.set(e.value,e)}u.size>1&&u.has("")&&u.delete("");let b=[...u.values()];return n.set(t,b),b}intersects(e,t){if(!(e instanceof i))throw TypeError("a Range is required");return this.set.some(r=>_(r,t)&&e.set.some(e=>_(e,t)&&r.every(r=>e.every(e=>r.intersects(e,t)))))}test(e){if(!e)return!1;if("string"==typeof e)try{e=new u(e,this.options)}catch(e){return!1}for(let t=0;t<this.set.length;t++)if(j(this.set[t],e,this.options))return!0;return!1}}e.exports=i;let n=new(r(15395)),s=r(32002),o=r(50113),l=r(57265),u=r(36053),{safeRe:c,t:d,comparatorTrimReplace:h,tildeTrimReplace:p,caretTrimReplace:m}=r(56655),{FLAG_INCLUDE_PRERELEASE:f,FLAG_LOOSE:g}=r(81979),y=e=>"<0.0.0-0"===e.value,b=e=>""===e.value,_=(e,t)=>{let r=!0,a=e.slice(),i=a.pop();for(;r&&a.length;)r=a.every(e=>i.intersects(e,t)),i=a.pop();return r},v=(e,t)=>(l("comp",e,t),l("caret",e=k(e,t)),l("tildes",e=O(e,t)),l("xrange",e=x(e,t)),l("stars",e=P(e,t)),e),w=e=>!e||"x"===e.toLowerCase()||"*"===e,O=(e,t)=>e.trim().split(/\s+/).map(e=>I(e,t)).join(" "),I=(e,t)=>{let r=t.loose?c[d.TILDELOOSE]:c[d.TILDE];return e.replace(r,(t,r,a,i,n)=>{let s;return l("tilde",e,t,r,a,i,n),w(r)?s="":w(a)?s=`>=${r}.0.0 <${+r+1}.0.0-0`:w(i)?s=`>=${r}.${a}.0 <${r}.${+a+1}.0-0`:n?(l("replaceTilde pr",n),s=`>=${r}.${a}.${i}-${n} <${r}.${+a+1}.0-0`):s=`>=${r}.${a}.${i} <${r}.${+a+1}.0-0`,l("tilde return",s),s})},k=(e,t)=>e.trim().split(/\s+/).map(e=>E(e,t)).join(" "),E=(e,t)=>{l("caret",e,t);let r=t.loose?c[d.CARETLOOSE]:c[d.CARET],a=t.includePrerelease?"-0":"";return e.replace(r,(t,r,i,n,s)=>{let o;return l("caret",e,t,r,i,n,s),w(r)?o="":w(i)?o=`>=${r}.0.0${a} <${+r+1}.0.0-0`:w(n)?o="0"===r?`>=${r}.${i}.0${a} <${r}.${+i+1}.0-0`:`>=${r}.${i}.0${a} <${+r+1}.0.0-0`:s?(l("replaceCaret pr",s),o="0"===r?"0"===i?`>=${r}.${i}.${n}-${s} <${r}.${i}.${+n+1}-0`:`>=${r}.${i}.${n}-${s} <${r}.${+i+1}.0-0`:`>=${r}.${i}.${n}-${s} <${+r+1}.0.0-0`):(l("no pr"),o="0"===r?"0"===i?`>=${r}.${i}.${n}${a} <${r}.${i}.${+n+1}-0`:`>=${r}.${i}.${n}${a} <${r}.${+i+1}.0-0`:`>=${r}.${i}.${n} <${+r+1}.0.0-0`),l("caret return",o),o})},x=(e,t)=>(l("replaceXRanges",e,t),e.split(/\s+/).map(e=>S(e,t)).join(" ")),S=(e,t)=>{e=e.trim();let r=t.loose?c[d.XRANGELOOSE]:c[d.XRANGE];return e.replace(r,(r,a,i,n,s,o)=>{l("xRange",e,r,a,i,n,s,o);let u=w(i),c=u||w(n),d=c||w(s);return"="===a&&d&&(a=""),o=t.includePrerelease?"-0":"",u?r=">"===a||"<"===a?"<0.0.0-0":"*":a&&d?(c&&(n=0),s=0,">"===a?(a=">=",c?(i=+i+1,n=0):n=+n+1,s=0):"<="===a&&(a="<",c?i=+i+1:n=+n+1),"<"===a&&(o="-0"),r=`${a+i}.${n}.${s}${o}`):c?r=`>=${i}.0.0${o} <${+i+1}.0.0-0`:d&&(r=`>=${i}.${n}.0${o} <${i}.${+n+1}.0-0`),l("xRange return",r),r})},P=(e,t)=>(l("replaceStars",e,t),e.trim().replace(c[d.STAR],"")),A=(e,t)=>(l("replaceGTE0",e,t),e.trim().replace(c[t.includePrerelease?d.GTE0PRE:d.GTE0],"")),T=e=>(t,r,a,i,n,s,o,l,u,c,d,h)=>(r=w(a)?"":w(i)?`>=${a}.0.0${e?"-0":""}`:w(n)?`>=${a}.${i}.0${e?"-0":""}`:s?`>=${r}`:`>=${r}${e?"-0":""}`,l=w(u)?"":w(c)?`<${+u+1}.0.0-0`:w(d)?`<${u}.${+c+1}.0-0`:h?`<=${u}.${c}.${d}-${h}`:e?`<${u}.${c}.${+d+1}-0`:`<=${l}`,`${r} ${l}`.trim()),j=(e,t,r)=>{for(let r=0;r<e.length;r++)if(!e[r].test(t))return!1;if(t.prerelease.length&&!r.includePrerelease){for(let r=0;r<e.length;r++)if(l(e[r].semver),e[r].semver!==o.ANY&&e[r].semver.prerelease.length>0){let a=e[r].semver;if(a.major===t.major&&a.minor===t.minor&&a.patch===t.patch)return!0}return!1}return!0}},43377:(e,t,r)=>{"use strict";let a=r(42870),i=r(50113),{ANY:n}=i,s=r(43879),o=r(88193),l=[new i(">=0.0.0-0")],u=[new i(">=0.0.0")],c=(e,t,r)=>{let a,i,c,p,m,f,g;if(e===t)return!0;if(1===e.length&&e[0].semver===n){if(1===t.length&&t[0].semver===n)return!0;e=r.includePrerelease?l:u}if(1===t.length&&t[0].semver===n){if(r.includePrerelease)return!0;t=u}let y=new Set;for(let t of e)">"===t.operator||">="===t.operator?a=d(a,t,r):"<"===t.operator||"<="===t.operator?i=h(i,t,r):y.add(t.semver);if(y.size>1||a&&i&&((c=o(a.semver,i.semver,r))>0||0===c&&(">="!==a.operator||"<="!==i.operator)))return null;for(let e of y){if(a&&!s(e,String(a),r)||i&&!s(e,String(i),r))return null;for(let a of t)if(!s(e,String(a),r))return!1;return!0}let b=!!i&&!r.includePrerelease&&!!i.semver.prerelease.length&&i.semver,_=!!a&&!r.includePrerelease&&!!a.semver.prerelease.length&&a.semver;for(let e of(b&&1===b.prerelease.length&&"<"===i.operator&&0===b.prerelease[0]&&(b=!1),t)){if(g=g||">"===e.operator||">="===e.operator,f=f||"<"===e.operator||"<="===e.operator,a){if(_&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===_.major&&e.semver.minor===_.minor&&e.semver.patch===_.patch&&(_=!1),">"===e.operator||">="===e.operator){if((p=d(a,e,r))===e&&p!==a)return!1}else if(">="===a.operator&&!s(a.semver,String(e),r))return!1}if(i){if(b&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===b.major&&e.semver.minor===b.minor&&e.semver.patch===b.patch&&(b=!1),"<"===e.operator||"<="===e.operator){if((m=h(i,e,r))===e&&m!==i)return!1}else if("<="===i.operator&&!s(i.semver,String(e),r))return!1}if(!e.operator&&(i||a)&&0!==c)return!1}return(!a||!f||!!i||0===c)&&(!i||!g||!!a||0===c)&&!_&&!b&&!0},d=(e,t,r)=>{if(!e)return t;let a=o(e.semver,t.semver,r);return a>0?e:a<0?t:">"===t.operator&&">="===e.operator?t:e},h=(e,t,r)=>{if(!e)return t;let a=o(e.semver,t.semver,r);return a<0?e:a>0?t:"<"===t.operator&&"<="===e.operator?t:e};e.exports=(e,t,r={})=>{if(e===t)return!0;e=new a(e,r),t=new a(t,r);let i=!1;e:for(let a of e.set){for(let e of t.set){let t=c(a,e,r);if(i=i||null!==t,t)continue e}if(i)return!1}return!0}},43399:(e,t,r)=>{"use strict";r.d(t,{Cf:()=>a.Cf,mu:()=>a.mu});var a=r(23294)},43879:(e,t,r)=>{"use strict";let a=r(42870);e.exports=(e,t,r)=>{try{t=new a(t,r)}catch(e){return!1}return t.test(e)}},44726:(e,t,r)=>{"use strict";let a=r(88193);e.exports=(e,t,r)=>0!==a(e,t,r)},44768:(e,t,r)=>{"use strict";r.d(t,{X0:()=>s,hr:()=>i,pH:()=>n});let a=Symbol.for("ls:tracing_async_local_storage"),i=Symbol.for("lc:context_variables"),n=e=>{globalThis[a]=e},s=()=>globalThis[a]},46520:(e,t,r)=>{"use strict";let a=r(21232);class i extends Error{constructor(e){super(e),this.name="TimeoutError"}}let n=(e,t,r)=>new Promise((n,s)=>{if("number"!=typeof t||t<0)throw TypeError("Expected `milliseconds` to be a positive number");if(t===1/0){n(e);return}let o=setTimeout(()=>{if("function"==typeof r){try{n(r())}catch(e){s(e)}return}let a="string"==typeof r?r:`Promise timed out after ${t} milliseconds`,o=r instanceof Error?r:new i(a);"function"==typeof e.cancel&&e.cancel(),s(o)},t);a(e.then(n,s),()=>{clearTimeout(o)})});e.exports=n,e.exports.default=n,e.exports.TimeoutError=i},46580:(e,t,r)=>{"use strict";r.d(t,{xV:()=>m});var a=r(71150),i=r(23294),n=r(34621),s=r(80918),o=r(99643),l=r(87150),u=r(27123),c=r(34497),d=r(72716),h=r(11014);function p(e){let t=[];for(let r of e){let e=r;if(Array.isArray(r.content))for(let t=0;t<r.content.length;t++){let i=r.content[t];((0,a.W)(i)||(0,a.cJ)(i))&&e===r&&(e=new r.constructor({...e,content:[...r.content.slice(0,t),(0,a.Vi)(i),...r.content.slice(t+1)]}))}t.push(e)}return t}class m extends n.j_{constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","chat_models",this._llmType()]}),Object.defineProperty(this,"disableStreaming",{enumerable:!0,configurable:!0,writable:!0,value:!1})}_separateRunnableConfigFromCallOptionsCompat(e){let[t,r]=super._separateRunnableConfigFromCallOptions(e);return r.signal=t.signal,[t,r]}async invoke(e,t){let r=m._convertInputToPromptValue(e);return(await this.generatePrompt([r],t,t?.callbacks)).generations[0][0].message}async *_streamResponseChunks(e,t,r){throw Error("Not implemented.")}async *_streamIterator(e,t){if(this._streamResponseChunks===m.prototype._streamResponseChunks||this.disableStreaming)yield this.invoke(e,t);else{let r,i;let n=m._convertInputToPromptValue(e).toChatMessages(),[o,l]=this._separateRunnableConfigFromCallOptionsCompat(t),u={...o.metadata,...this.getLsParams(l)},c=await s.Td.configure(o.callbacks,this.callbacks,o.tags,this.tags,u,this.metadata,{verbose:this.verbose}),d={options:l,invocation_params:this?.invocationParams(l),batch_size:1},h=await c?.handleChatModelStart(this.toJSON(),[p(n)],o.runId,void 0,d,void 0,void 0,o.runName);try{for await(let e of this._streamResponseChunks(n,l,h?.[0])){if(null==e.message.id){let t=h?.at(0)?.runId;null!=t&&e.message._updateId(`run-${t}`)}e.message.response_metadata={...e.generationInfo,...e.message.response_metadata},yield e.message,r=r?r.concat(e):e,(0,a.jm)(e.message)&&void 0!==e.message.usage_metadata&&(i={tokenUsage:{promptTokens:e.message.usage_metadata.input_tokens,completionTokens:e.message.usage_metadata.output_tokens,totalTokens:e.message.usage_metadata.total_tokens}})}}catch(e){throw await Promise.all((h??[]).map(t=>t?.handleLLMError(e))),e}await Promise.all((h??[]).map(e=>e?.handleLLMEnd({generations:[[r]],llmOutput:i})))}}getLsParams(e){let t=this.getName().startsWith("Chat")?this.getName().replace("Chat",""):this.getName();return{ls_model_type:"chat",ls_stop:e.stop,ls_provider:t}}async _generateUncached(e,t,r,n){let o;let u=e.map(e=>e.map(a.K0));if(void 0!==n&&n.length===u.length)o=n;else{let e={...r.metadata,...this.getLsParams(t)},a=await s.Td.configure(r.callbacks,this.callbacks,r.tags,this.tags,e,this.metadata,{verbose:this.verbose}),i={options:t,invocation_params:this?.invocationParams(t),batch_size:1};o=await a?.handleChatModelStart(this.toJSON(),u.map(p),r.runId,void 0,i,void 0,void 0,r.runName)}let c=[],h=[];if(o?.[0].handlers.find(d.xL)&&!this.disableStreaming&&1===u.length&&this._streamResponseChunks!==m.prototype._streamResponseChunks)try{let e,r;for await(let i of(await this._streamResponseChunks(u[0],t,o?.[0]))){if(null==i.message.id){let e=o?.at(0)?.runId;null!=e&&i.message._updateId(`run-${e}`)}e=void 0===e?i:(0,l.xW)(e,i),(0,a.jm)(i.message)&&void 0!==i.message.usage_metadata&&(r={tokenUsage:{promptTokens:i.message.usage_metadata.input_tokens,completionTokens:i.message.usage_metadata.output_tokens,totalTokens:i.message.usage_metadata.total_tokens}})}if(void 0===e)throw Error("Received empty response from chat model call.");c.push([e]),await o?.[0].handleLLMEnd({generations:c,llmOutput:r})}catch(e){throw await o?.[0].handleLLMError(e),e}else{let e=await Promise.allSettled(u.map((e,r)=>this._generate(e,{...t,promptIndex:r},o?.[r])));await Promise.all(e.map(async(e,t)=>{if("fulfilled"!==e.status)return await o?.[t]?.handleLLMError(e.reason),Promise.reject(e.reason);{let r=e.value;for(let e of r.generations){if(null==e.message.id){let t=o?.at(0)?.runId;null!=t&&e.message._updateId(`run-${t}`)}e.message.response_metadata={...e.generationInfo,...e.message.response_metadata}}return 1===r.generations.length&&(r.generations[0].message.response_metadata={...r.llmOutput,...r.generations[0].message.response_metadata}),c[t]=r.generations,h[t]=r.llmOutput,o?.[t]?.handleLLMEnd({generations:[r.generations],llmOutput:r.llmOutput})}}))}let f={generations:c,llmOutput:h.length?this._combineLLMOutput?.(...h):void 0};return Object.defineProperty(f,i.SP,{value:o?{runIds:o?.map(e=>e.runId)}:void 0,configurable:!0}),f}async _generateCached({messages:e,cache:t,llmStringKey:r,parsedOptions:n,handledOptions:o}){let l=e.map(e=>e.map(a.K0)),u={...o.metadata,...this.getLsParams(n)},c=await s.Td.configure(o.callbacks,this.callbacks,o.tags,this.tags,u,this.metadata,{verbose:this.verbose}),d={options:n,invocation_params:this?.invocationParams(n),batch_size:1},h=await c?.handleChatModelStart(this.toJSON(),l.map(p),o.runId,void 0,d,void 0,void 0,o.runName),f=[],g=(await Promise.allSettled(l.map(async(e,a)=>{let i=m._convertInputToPromptValue(e).toString(),n=await t.lookup(i,r);return null==n&&f.push(a),n}))).map((e,t)=>({result:e,runManager:h?.[t]})).filter(({result:e})=>"fulfilled"===e.status&&null!=e.value||"rejected"===e.status),y=[];await Promise.all(g.map(async({result:e,runManager:t},r)=>{if("fulfilled"!==e.status)return await t?.handleLLMError(e.reason,void 0,void 0,void 0,{cached:!0}),Promise.reject(e.reason);{let i=e.value;return y[r]=i.map(e=>("message"in e&&(0,a.ny)(e.message)&&(0,a.KX)(e.message)&&(e.message.usage_metadata={input_tokens:0,output_tokens:0,total_tokens:0}),e.generationInfo={...e.generationInfo,tokenUsage:{}},e)),i.length&&await t?.handleLLMNewToken(i[0].text),t?.handleLLMEnd({generations:[i]},void 0,void 0,void 0,{cached:!0})}}));let b={generations:y,missingPromptIndices:f,startedRunManagers:h};return Object.defineProperty(b,i.SP,{value:h?{runIds:h?.map(e=>e.runId)}:void 0,configurable:!0}),b}async generate(e,t,r){let i;i=Array.isArray(t)?{stop:t}:t;let n=e.map(e=>e.map(a.K0)),[s,o]=this._separateRunnableConfigFromCallOptionsCompat(i);if(s.callbacks=s.callbacks??r,!this.cache)return this._generateUncached(n,o,s);let{cache:l}=this,u=this._getSerializedCacheKeyParametersForCall(o),{generations:c,missingPromptIndices:d,startedRunManagers:h}=await this._generateCached({messages:n,cache:l,llmStringKey:u,parsedOptions:o,handledOptions:s}),p={};if(d.length>0){let e=await this._generateUncached(d.map(e=>n[e]),o,s,void 0!==h?d.map(e=>h?.[e]):void 0);await Promise.all(e.generations.map(async(e,t)=>{let r=d[t];c[r]=e;let a=m._convertInputToPromptValue(n[r]).toString();return l.update(a,u,e)})),p=e.llmOutput??{}}return{generations:c,llmOutput:p}}invocationParams(e){return{}}_modelType(){return"base_chat_model"}serialize(){return{...this.invocationParams(),_type:this._llmType(),_model:this._modelType()}}async generatePrompt(e,t,r){let a=e.map(e=>e.toChatMessages());return this.generate(a,t,r)}async call(e,t,r){return(await this.generate([e.map(a.K0)],t,r)).generations[0][0].message}async callPrompt(e,t,r){let a=e.toChatMessages();return this.call(a,t,r)}async predictMessages(e,t,r){return this.call(e,t,r)}async predict(e,t,r){let i=new a.xc(e),n=await this.call([i],t,r);if("string"!=typeof n.content)throw Error("Cannot use predict when output is not a string.");return n.content}withStructuredOutput(e,t){let r;if("function"!=typeof this.bindTools)throw Error('Chat model must implement ".bindTools()" to use withStructuredOutput.');if(t?.strict)throw Error('"strict" mode is not supported for this model by default.');let a=t?.name,i=(0,c.cg)(e)??"A function available to call.",n=t?.method,s=t?.includeRaw;if("jsonMode"===n)throw Error('Base withStructuredOutput implementation only supports "functionCalling" as a method.');let l=a??"extract";(0,c.c9)(e)?r=[{type:"function",function:{name:l,description:i,parameters:(0,h.PF)(e)}}]:("name"in e&&(l=e.name),r=[{type:"function",function:{name:l,description:i,parameters:e}}]);let d=this.bindTools(r),p=o.jY.from(e=>{if(!e.tool_calls||0===e.tool_calls.length)throw Error("No tool calls found in the response.");let t=e.tool_calls.find(e=>e.name===l);if(!t)throw Error(`No tool call found with name ${l}.`);return t.args});if(!s)return d.pipe(p).withConfig({runName:"StructuredOutput"});let m=u.k.assign({parsed:(e,t)=>p.invoke(e.raw,t)}),f=u.k.assign({parsed:()=>null}),g=m.withFallbacks({fallbacks:[f]});return o.zZ.from([{raw:d},g]).withConfig({runName:"StructuredOutputRunnable"})}}},46628:(e,t,r)=>{"use strict";r.d(t,{fL:()=>n,qG:()=>a.qG});var a=r(23229),i=r(11014);function n(e,t){var r,n;let s;let o="number"==typeof t?void 0:t;return s=(0,a.qG)(e)?{type:"function",function:{name:(r=e).name,description:r.description,parameters:(0,i.PF)(r.schema),...void 0!=void 0?{strict:n.strict}:{}}}:e,o?.strict!==void 0&&(s.function.strict=o.strict),s}},46725:(e,t,r)=>{"use strict";r.d(t,{q:()=>i});var a=r(82851);let i=()=>(0,a.Jz)("PROJECT")??(0,a.Az)("LANGCHAIN_SESSION")??"default"},47415:(e,t,r)=>{"use strict";r.d(t,{Yx:()=>o,rO:()=>s});var a=r(82851);let i=(...e)=>fetch(...e),n=Symbol.for("ls:fetch_implementation"),s=()=>{let e=globalThis[n];return!!e&&"function"==typeof e&&"Headers"in e&&"Request"in e&&"Response"in e},o=e=>async(...t)=>{if(e||"true"===(0,a.Jz)("DEBUG")){let[e,r]=t;console.log(` ${r?.method||"GET"} ${e}`)}let r=await (globalThis[n]??i)(...t);return(e||"true"===(0,a.Jz)("DEBUG"))&&console.log(` ${r.status} ${r.statusText} ${r.url}`),r}},48350:(e,t,r)=>{"use strict";let a=r(34984),i=r(44726),n=r(28973),s=r(98344),o=r(23906),l=r(34817);e.exports=(e,t,r,u)=>{switch(t){case"===":return"object"==typeof e&&(e=e.version),"object"==typeof r&&(r=r.version),e===r;case"!==":return"object"==typeof e&&(e=e.version),"object"==typeof r&&(r=r.version),e!==r;case"":case"=":case"==":return a(e,r,u);case"!=":return i(e,r,u);case">":return n(e,r,u);case">=":return s(e,r,u);case"<":return o(e,r,u);case"<=":return l(e,r,u);default:throw TypeError(`Invalid operator: ${t}`)}}},50113:(e,t,r)=>{"use strict";let a=Symbol("SemVer ANY");class i{static get ANY(){return a}constructor(e,t){if(t=n(t),e instanceof i){if(!!t.loose===e.loose)return e;e=e.value}u("comparator",e=e.trim().split(/\s+/).join(" "),t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===a?this.value="":this.value=this.operator+this.semver.version,u("comp",this)}parse(e){let t=this.options.loose?s[o.COMPARATORLOOSE]:s[o.COMPARATOR],r=e.match(t);if(!r)throw TypeError(`Invalid comparator: ${e}`);this.operator=void 0!==r[1]?r[1]:"","="===this.operator&&(this.operator=""),r[2]?this.semver=new c(r[2],this.options.loose):this.semver=a}toString(){return this.value}test(e){if(u("Comparator.test",e,this.options.loose),this.semver===a||e===a)return!0;if("string"==typeof e)try{e=new c(e,this.options)}catch(e){return!1}return l(e,this.operator,this.semver,this.options)}intersects(e,t){if(!(e instanceof i))throw TypeError("a Comparator is required");return""===this.operator?""===this.value||new d(e.value,t).test(this.value):""===e.operator?""===e.value||new d(this.value,t).test(e.semver):!((t=n(t)).includePrerelease&&("<0.0.0-0"===this.value||"<0.0.0-0"===e.value)||!t.includePrerelease&&(this.value.startsWith("<0.0.0")||e.value.startsWith("<0.0.0")))&&!!(this.operator.startsWith(">")&&e.operator.startsWith(">")||this.operator.startsWith("<")&&e.operator.startsWith("<")||this.semver.version===e.semver.version&&this.operator.includes("=")&&e.operator.includes("=")||l(this.semver,"<",e.semver,t)&&this.operator.startsWith(">")&&e.operator.startsWith("<")||l(this.semver,">",e.semver,t)&&this.operator.startsWith("<")&&e.operator.startsWith(">"))}}e.exports=i;let n=r(32002),{safeRe:s,t:o}=r(56655),l=r(48350),u=r(57265),c=r(36053),d=r(42870)},52435:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});let a=r(82661),i=r(46520),n=r(64951),s=()=>{},o=new i.TimeoutError;class l extends a{constructor(e){var t,r,a,i;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=s,this._resolveIdle=s,!("number"==typeof(e=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:n.default},e)).intervalCap&&e.intervalCap>=1))throw TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${null!==(r=null===(t=e.intervalCap)||void 0===t?void 0:t.toString())&&void 0!==r?r:""}\` (${typeof e.intervalCap})`);if(void 0===e.interval||!(Number.isFinite(e.interval)&&e.interval>=0))throw TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${null!==(i=null===(a=e.interval)||void 0===a?void 0:a.toString())&&void 0!==i?i:""}\` (${typeof e.interval})`);this._carryoverConcurrencyCount=e.carryoverConcurrencyCount,this._isIntervalIgnored=e.intervalCap===1/0||0===e.interval,this._intervalCap=e.intervalCap,this._interval=e.interval,this._queue=new e.queueClass,this._queueClass=e.queueClass,this.concurrency=e.concurrency,this._timeout=e.timeout,this._throwOnTimeout=!0===e.throwOnTimeout,this._isPaused=!1===e.autoStart}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=s,0===this._pendingCount&&(this._resolveIdle(),this._resolveIdle=s,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){let e=Date.now();if(void 0===this._intervalId){let t=this._intervalEnd-e;if(!(t<0))return void 0===this._timeoutId&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},t)),!0;this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0}return!1}_tryToStartAnother(){if(0===this._queue.size)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){let e=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){let t=this._queue.dequeue();return!!t&&(this.emit("active"),t(),e&&this._initializeIntervalIfNeeded(),!0)}}return!1}_initializeIntervalIfNeeded(){!this._isIntervalIgnored&&void 0===this._intervalId&&(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){0===this._intervalCount&&0===this._pendingCount&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(e){if(!("number"==typeof e&&e>=1))throw TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this._concurrency=e,this._processQueue()}async add(e,t={}){return new Promise((r,a)=>{let n=async()=>{this._pendingCount++,this._intervalCount++;try{let n=void 0===this._timeout&&void 0===t.timeout?e():i.default(Promise.resolve(e()),void 0===t.timeout?this._timeout:t.timeout,()=>{(void 0===t.throwOnTimeout?this._throwOnTimeout:t.throwOnTimeout)&&a(o)});r(await n)}catch(e){a(e)}this._next()};this._queue.enqueue(n,t),this._tryToStartAnother(),this.emit("add")})}async addAll(e,t){return Promise.all(e.map(async e=>this.add(e,t)))}start(){return this._isPaused&&(this._isPaused=!1,this._processQueue()),this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(0!==this._queue.size)return new Promise(e=>{let t=this._resolveEmpty;this._resolveEmpty=()=>{t(),e()}})}async onIdle(){if(0!==this._pendingCount||0!==this._queue.size)return new Promise(e=>{let t=this._resolveIdle;this._resolveIdle=()=>{t(),e()}})}get size(){return this._queue.size}sizeBy(e){return this._queue.filter(e).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(e){this._timeout=e}}t.default=l},52813:(e,t,r)=>{"use strict";let a=r(84896),i=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"];class n extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,{message:e}=e):(this.originalError=Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}}let s=(e,t,r)=>{let a=r.retries-(t-1);return e.attemptNumber=t,e.retriesLeft=a,e},o=e=>i.includes(e),l=(e,t)=>new Promise((r,i)=>{t={onFailedAttempt:()=>{},retries:10,...t};let l=a.operation(t);l.attempt(async a=>{try{r(await e(a))}catch(e){if(!(e instanceof Error)){i(TypeError(`Non-error was thrown: "${e}". You should only throw errors.`));return}if(e instanceof n)l.stop(),i(e.originalError);else if(e instanceof TypeError&&!o(e.message))l.stop(),i(e);else{s(e,a,t);try{await t.onFailedAttempt(e)}catch(e){i(e);return}l.retry(e)||i(l.mainError())}}})});e.exports=l,e.exports.default=l,e.exports.AbortError=n},54099:(e,t,r)=>{"use strict";r.d(t,{vR:()=>u,GZ:()=>c});var a=r(86951);class i{getStore(){}run(e,t){return t()}}let n=Symbol.for("ls:tracing_async_local_storage"),s=new i;class o{getInstance(){return globalThis[n]??s}initializeGlobalInstance(e){void 0===globalThis[n]&&(globalThis[n]=e)}}let l=new o;function u(e=!1){let t=l.getInstance().getStore();if(!e&&!(0,a.m5)(t))throw Error("Could not get the current run tree.\n\nPlease make sure you are calling this method within a traceable function and that tracing is enabled.");return t}function c(e){return"function"==typeof e&&"langsmith:traceable"in e}Symbol.for("langsmith:traceable:root")},55949:(e,t,r)=>{"use strict";function a(e){return"object"==typeof e&&null!==e&&"type"in e&&"string"==typeof e.type&&"source_type"in e&&("url"===e.source_type||"base64"===e.source_type||"text"===e.source_type||"id"===e.source_type)}function i(e){return a(e)&&"url"===e.source_type&&"url"in e&&"string"==typeof e.url}function n(e){return a(e)&&"base64"===e.source_type&&"data"in e&&"string"==typeof e.data}function s(e){if(a(e)){if("url"===e.source_type)return{type:"image_url",image_url:{url:e.url}};if("base64"===e.source_type){if(!e.mime_type)throw Error("mime_type key is required for base64 data.");let t=e.mime_type;return{type:"image_url",image_url:{url:`data:${t};base64,${e.data}`}}}}throw Error("Unsupported source type. Only 'url' and 'base64' are supported.")}function o(e){let t=e.split(";")[0].split("/");if(2!==t.length)throw Error(`Invalid mime type: "${e}" - does not match type/subtype format.`);let r=t[0].trim(),a=t[1].trim();if(""===r||""===a)throw Error(`Invalid mime type: "${e}" - type or subtype is empty.`);let i={};for(let t of e.split(";").slice(1)){let r=t.split("=");if(2!==r.length)throw Error(`Invalid parameter syntax in mime type: "${e}".`);let a=r[0].trim(),n=r[1].trim();if(""===a)throw Error(`Invalid parameter syntax in mime type: "${e}".`);i[a]=n}return{type:r,subtype:a,parameters:i}}function l({dataUrl:e,asTypedArray:t=!1}){let r=e.match(/^data:(\w+\/\w+);base64,([A-Za-z0-9+/]+=*)$/);if(r)return{mime_type:r[1].toLowerCase(),data:t?Uint8Array.from(atob(r[2]),e=>e.charCodeAt(0)):r[2]}}function u(e,t){if("text"===e.type){if(!t.fromStandardTextBlock)throw Error(`Converter for ${t.providerName} does not implement \`fromStandardTextBlock\` method.`);return t.fromStandardTextBlock(e)}if("image"===e.type){if(!t.fromStandardImageBlock)throw Error(`Converter for ${t.providerName} does not implement \`fromStandardImageBlock\` method.`);return t.fromStandardImageBlock(e)}if("audio"===e.type){if(!t.fromStandardAudioBlock)throw Error(`Converter for ${t.providerName} does not implement \`fromStandardAudioBlock\` method.`);return t.fromStandardAudioBlock(e)}if("file"===e.type){if(!t.fromStandardFileBlock)throw Error(`Converter for ${t.providerName} does not implement \`fromStandardFileBlock\` method.`);return t.fromStandardFileBlock(e)}throw Error(`Unable to convert content block type '${e.type}' to provider-specific format: not recognized.`)}r.d(t,{Ej:()=>o,Fz:()=>a,Q7:()=>l,Vi:()=>s,W:()=>i,cJ:()=>n,up:()=>u})},56655:(e,t,r)=>{"use strict";let{MAX_SAFE_COMPONENT_LENGTH:a,MAX_SAFE_BUILD_LENGTH:i,MAX_LENGTH:n}=r(81979),s=r(57265),o=(t=e.exports={}).re=[],l=t.safeRe=[],u=t.src=[],c=t.safeSrc=[],d=t.t={},h=0,p="[a-zA-Z0-9-]",m=[["\\s",1],["\\d",n],[p,i]],f=e=>{for(let[t,r]of m)e=e.split(`${t}*`).join(`${t}{0,${r}}`).split(`${t}+`).join(`${t}{1,${r}}`);return e},g=(e,t,r)=>{let a=f(t),i=h++;s(e,i,t),d[e]=i,u[i]=t,c[i]=a,o[i]=new RegExp(t,r?"g":void 0),l[i]=new RegExp(a,r?"g":void 0)};g("NUMERICIDENTIFIER","0|[1-9]\\d*"),g("NUMERICIDENTIFIERLOOSE","\\d+"),g("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${p}*`),g("MAINVERSION",`(${u[d.NUMERICIDENTIFIER]})\\.(${u[d.NUMERICIDENTIFIER]})\\.(${u[d.NUMERICIDENTIFIER]})`),g("MAINVERSIONLOOSE",`(${u[d.NUMERICIDENTIFIERLOOSE]})\\.(${u[d.NUMERICIDENTIFIERLOOSE]})\\.(${u[d.NUMERICIDENTIFIERLOOSE]})`),g("PRERELEASEIDENTIFIER",`(?:${u[d.NONNUMERICIDENTIFIER]}|${u[d.NUMERICIDENTIFIER]})`),g("PRERELEASEIDENTIFIERLOOSE",`(?:${u[d.NONNUMERICIDENTIFIER]}|${u[d.NUMERICIDENTIFIERLOOSE]})`),g("PRERELEASE",`(?:-(${u[d.PRERELEASEIDENTIFIER]}(?:\\.${u[d.PRERELEASEIDENTIFIER]})*))`),g("PRERELEASELOOSE",`(?:-?(${u[d.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${u[d.PRERELEASEIDENTIFIERLOOSE]})*))`),g("BUILDIDENTIFIER",`${p}+`),g("BUILD",`(?:\\+(${u[d.BUILDIDENTIFIER]}(?:\\.${u[d.BUILDIDENTIFIER]})*))`),g("FULLPLAIN",`v?${u[d.MAINVERSION]}${u[d.PRERELEASE]}?${u[d.BUILD]}?`),g("FULL",`^${u[d.FULLPLAIN]}$`),g("LOOSEPLAIN",`[v=\\s]*${u[d.MAINVERSIONLOOSE]}${u[d.PRERELEASELOOSE]}?${u[d.BUILD]}?`),g("LOOSE",`^${u[d.LOOSEPLAIN]}$`),g("GTLT","((?:<|>)?=?)"),g("XRANGEIDENTIFIERLOOSE",`${u[d.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),g("XRANGEIDENTIFIER",`${u[d.NUMERICIDENTIFIER]}|x|X|\\*`),g("XRANGEPLAIN",`[v=\\s]*(${u[d.XRANGEIDENTIFIER]})(?:\\.(${u[d.XRANGEIDENTIFIER]})(?:\\.(${u[d.XRANGEIDENTIFIER]})(?:${u[d.PRERELEASE]})?${u[d.BUILD]}?)?)?`),g("XRANGEPLAINLOOSE",`[v=\\s]*(${u[d.XRANGEIDENTIFIERLOOSE]})(?:\\.(${u[d.XRANGEIDENTIFIERLOOSE]})(?:\\.(${u[d.XRANGEIDENTIFIERLOOSE]})(?:${u[d.PRERELEASELOOSE]})?${u[d.BUILD]}?)?)?`),g("XRANGE",`^${u[d.GTLT]}\\s*${u[d.XRANGEPLAIN]}$`),g("XRANGELOOSE",`^${u[d.GTLT]}\\s*${u[d.XRANGEPLAINLOOSE]}$`),g("COERCEPLAIN",`(^|[^\\d])(\\d{1,${a}})(?:\\.(\\d{1,${a}}))?(?:\\.(\\d{1,${a}}))?`),g("COERCE",`${u[d.COERCEPLAIN]}(?:$|[^\\d])`),g("COERCEFULL",u[d.COERCEPLAIN]+`(?:${u[d.PRERELEASE]})?`+`(?:${u[d.BUILD]})?`+"(?:$|[^\\d])"),g("COERCERTL",u[d.COERCE],!0),g("COERCERTLFULL",u[d.COERCEFULL],!0),g("LONETILDE","(?:~>?)"),g("TILDETRIM",`(\\s*)${u[d.LONETILDE]}\\s+`,!0),t.tildeTrimReplace="$1~",g("TILDE",`^${u[d.LONETILDE]}${u[d.XRANGEPLAIN]}$`),g("TILDELOOSE",`^${u[d.LONETILDE]}${u[d.XRANGEPLAINLOOSE]}$`),g("LONECARET","(?:\\^)"),g("CARETTRIM",`(\\s*)${u[d.LONECARET]}\\s+`,!0),t.caretTrimReplace="$1^",g("CARET",`^${u[d.LONECARET]}${u[d.XRANGEPLAIN]}$`),g("CARETLOOSE",`^${u[d.LONECARET]}${u[d.XRANGEPLAINLOOSE]}$`),g("COMPARATORLOOSE",`^${u[d.GTLT]}\\s*(${u[d.LOOSEPLAIN]})$|^$`),g("COMPARATOR",`^${u[d.GTLT]}\\s*(${u[d.FULLPLAIN]})$|^$`),g("COMPARATORTRIM",`(\\s*)${u[d.GTLT]}\\s*(${u[d.LOOSEPLAIN]}|${u[d.XRANGEPLAIN]})`,!0),t.comparatorTrimReplace="$1$2$3",g("HYPHENRANGE",`^\\s*(${u[d.XRANGEPLAIN]})\\s+-\\s+(${u[d.XRANGEPLAIN]})\\s*$`),g("HYPHENRANGELOOSE",`^\\s*(${u[d.XRANGEPLAINLOOSE]})\\s+-\\s+(${u[d.XRANGEPLAINLOOSE]})\\s*$`),g("STAR","(<|>)?=?\\s*\\*"),g("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),g("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")},57265:(e,t,r)=>{"use strict";var a=r(49509);e.exports="object"==typeof a&&a.env&&a.env.NODE_DEBUG&&/\bsemver\b/i.test(a.env.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{}},58036:(e,t,r)=>{"use strict";function a(e,t=i){let r=(e=e.trim()).indexOf("```");if(-1===r)return t(e);let n=e.substring(r+3);n.startsWith("json\n")?n=n.substring(5):n.startsWith("json")?n=n.substring(4):n.startsWith("\n")&&(n=n.substring(1));let s=n.indexOf("```"),o=n;return -1!==s&&(o=n.substring(0,s)),t(o.trim())}function i(e){if(void 0===e)return null;try{return JSON.parse(e)}catch(e){}let t="",r=[],a=!1,i=!1;for(let n of e){if(a)'"'!==n||i?"\n"!==n||i?i="\\"===n&&!i:n="\\n":a=!1;else if('"'===n)a=!0,i=!1;else if("{"===n)r.push("}");else if("["===n)r.push("]");else if("}"===n||"]"===n){if(!r||r[r.length-1]!==n)return null;r.pop()}t+=n}a&&(t+='"');for(let e=r.length-1;e>=0;e-=1)t+=r[e];try{return JSON.parse(t)}catch(e){return null}}r.d(t,{D:()=>a,d:()=>i})},58775:(e,t,r)=>{"use strict";r.d(t,{jY:()=>a.jY,kI:()=>a.kI,zZ:()=>a.zZ});var a=r(1995)},59305:(e,t,r)=>{"use strict";r.d(t,{T:()=>u,k:()=>l});var a=r(70014),i=r(14654),n=r(64520),s=r(90338),o=r(23294);class l extends i.mJ{async *_transform(e){for await(let t of e)"string"==typeof t?yield this.parseResult([{text:t}]):yield this.parseResult([{message:t,text:this._baseMessageToString(t)}])}async *transform(e,t){yield*this._transformStreamWithConfig(e,this._transform.bind(this),{...t,runType:"parser"})}}class u extends l{constructor(e){super(e),Object.defineProperty(this,"diff",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.diff=e?.diff??this.diff}async *_transform(e){let t,r;for await(let i of e){let e;if("string"!=typeof i&&"string"!=typeof i.content)throw Error("Cannot handle non-string output.");if((0,n.AJ)(i)){if("string"!=typeof i.content)throw Error("Cannot handle non-string message output.");e=new o.Cf({message:i,text:i.content})}else if((0,n.ny)(i)){if("string"!=typeof i.content)throw Error("Cannot handle non-string message output.");e=new o.Cf({message:(0,s.ih)(i),text:i.content})}else e=new o.mu({text:i});r=void 0===r?e:r.concat(e);let l=await this.parsePartialResult([r]);null==l||(0,a.rA)(l,t)||(this.diff?yield this._diff(t,l):yield l,t=l)}}getFormatInstructions(){return""}}},62886:(e,t,r)=>{"use strict";r.d(t,{a7:()=>n,xc:()=>i});var a=r(64520);class i extends a.XQ{static lc_name(){return"HumanMessage"}_getType(){return"human"}constructor(e,t){super(e,t)}}class n extends a.gj{static lc_name(){return"HumanMessageChunk"}_getType(){return"human"}constructor(e,t){super(e,t)}concat(e){return new n({content:(0,a._I)(this.content,e.content),additional_kwargs:(0,a.ns)(this.additional_kwargs,e.additional_kwargs),response_metadata:(0,a.ns)(this.response_metadata,e.response_metadata),id:this.id??e.id})}}},63164:(e,t,r)=>{"use strict";let a=r(36053);e.exports=(e,t)=>new a(e,t).patch},64520:(e,t,r)=>{"use strict";r.d(t,{AJ:()=>m,F7:()=>c,Iv:()=>s,Vt:()=>u,XQ:()=>o,_I:()=>n,dp:()=>h,gj:()=>d,ns:()=>l,ny:()=>p});var a=r(23931),i=r(55949);function n(e,t){return"string"==typeof e?""===e?t:"string"==typeof t?e+t:Array.isArray(t)&&t.some(e=>(0,i.Fz)(e))?[{type:"text",source_type:"text",text:e},...t]:[{type:"text",text:e},...t]:Array.isArray(t)?u(e,t)??[...e,...t]:""===t?e:Array.isArray(e)&&e.some(e=>(0,i.Fz)(e))?[...e,{type:"file",source_type:"text",text:t}]:[...e,{type:"text",text:t}]}function s(e,t){return"error"===e||"error"===t?"error":"success"}class o extends a.y{get lc_aliases(){return{additional_kwargs:"additional_kwargs",response_metadata:"response_metadata"}}get text(){return"string"==typeof this.content?this.content:Array.isArray(this.content)?this.content.map(e=>"string"==typeof e?e:"text"===e.type?e.text:"").join(""):""}getType(){return this._getType()}constructor(e,t){"string"==typeof e&&(e={content:e,additional_kwargs:t,response_metadata:{}}),e.additional_kwargs||(e.additional_kwargs={}),e.response_metadata||(e.response_metadata={}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","messages"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"content",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"additional_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"response_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.content=e.content,this.additional_kwargs=e.additional_kwargs,this.response_metadata=e.response_metadata,this.id=e.id}toDict(){return{type:this._getType(),data:this.toJSON().kwargs}}static lc_name(){return"BaseMessage"}get _printableFields(){return{id:this.id,content:this.content,name:this.name,additional_kwargs:this.additional_kwargs,response_metadata:this.response_metadata}}_updateId(e){this.id=e,this.lc_kwargs.id=e}get[Symbol.toStringTag](){return this.constructor.lc_name()}[Symbol.for("nodejs.util.inspect.custom")](e){var t,r;if(null===e)return this;let a=(t=this._printableFields,r=Math.max(4,e),JSON.stringify(function e(t,a){if("object"!=typeof t||null==t)return t;if(a>=r)return Array.isArray(t)?"[Array]":"[Object]";if(Array.isArray(t))return t.map(t=>e(t,a+1));let i={};for(let r of Object.keys(t))i[r]=e(t[r],a+1);return i}(t,0),null,2));return`${this.constructor.lc_name()} ${a}`}}function l(e,t){let r={...e};for(let[e,a]of Object.entries(t))if(null==r[e])r[e]=a;else if(null==a)continue;else if(typeof r[e]!=typeof a||Array.isArray(r[e])!==Array.isArray(a))throw Error(`field[${e}] already exists in the message chunk, but with a different type.`);else if("string"==typeof r[e]){if("type"===e)continue;r[e]+=a}else if("object"!=typeof r[e]||Array.isArray(r[e])){if(Array.isArray(r[e]))r[e]=u(r[e],a);else{if(r[e]===a)continue;console.warn(`field[${e}] already exists in this message chunk and value has unsupported type.`)}}else r[e]=l(r[e],a);return r}function u(e,t){if(void 0!==e||void 0!==t){if(void 0===e||void 0===t)return e||t;{let r=[...e];for(let e of t)if("object"==typeof e&&"index"in e&&"number"==typeof e.index){let t=r.findIndex(t=>t.index===e.index);-1!==t?r[t]=l(r[t],e):r.push(e)}else{if("object"==typeof e&&"text"in e&&""===e.text)continue;r.push(e)}return r}}}function c(e,t){if(!e&&!t)throw Error("Cannot merge two undefined objects.");if(!e||!t)return e||t;if(typeof e!=typeof t)throw Error(`Cannot merge objects of different types.
Left ${typeof e}
Right ${typeof t}`);if("string"==typeof e&&"string"==typeof t)return e+t;if(Array.isArray(e)&&Array.isArray(t))return u(e,t);if("object"==typeof e&&"object"==typeof t)return l(e,t);else if(e===t)return e;else throw Error(`Can not merge objects of different types.
Left ${e}
Right ${t}`)}class d extends o{}function h(e){return"string"==typeof e.role}function p(e){return"function"==typeof e?._getType}function m(e){return p(e)&&"function"==typeof e.concat}},64951:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});let a=r(4071);class i{constructor(){this._queue=[]}enqueue(e,t){let r={priority:(t=Object.assign({priority:0},t)).priority,run:e};if(this.size&&this._queue[this.size-1].priority>=t.priority){this._queue.push(r);return}let i=a.default(this._queue,r,(e,t)=>t.priority-e.priority);this._queue.splice(i,0,r)}dequeue(){let e=this._queue.shift();return null==e?void 0:e.run}filter(e){return this._queue.filter(t=>t.priority===e.priority).map(e=>e.run)}get size(){return this._queue.length}}t.default=i},65408:(e,t,r)=>{"use strict";r.d(t,{g:()=>o});var a=r(52813),i=r(52435);let n=[400,401,402,403,404,405,406,407,409],s=e=>{if(e.message.startsWith("Cancel")||e.message.startsWith("AbortError")||"AbortError"===e.name||e?.code==="ECONNABORTED")throw e;let t=e?.response?.status??e?.status;if(t&&n.includes(+t))throw e;if(e?.error?.code==="insufficient_quota"){let t=Error(e?.message);throw t.name="InsufficientQuotaError",t}};class o{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.onFailedAttempt=e.onFailedAttempt??s;let t=i.default;this.queue=new t({concurrency:this.maxConcurrency})}call(e,...t){return this.queue.add(()=>a(()=>e(...t).catch(e=>{if(e instanceof Error)throw e;throw Error(e)}),{onFailedAttempt:this.onFailedAttempt,retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...r){return e.signal?Promise.race([this.call(t,...r),new Promise((t,r)=>{e.signal?.addEventListener("abort",()=>{r(Error("AbortError"))})})]):this.call(t,...r)}fetch(...e){return this.call(()=>fetch(...e).then(e=>e.ok?e:Promise.reject(e)))}}},66327:(e,t,r)=>{"use strict";let a=r(36053),i=r(42870);e.exports=(e,t,r)=>{let n=null,s=null,o=null;try{o=new i(t,r)}catch(e){return null}return e.forEach(e=>{o.test(e)&&(!n||1===s.compare(e))&&(s=new a(n=e,r))}),n}},67146:(e,t,r)=>{"use strict";async function a(e,t){let r;return void 0===t?e:Promise.race([e.catch(e=>{if(!t?.aborted)throw e}),new Promise((e,a)=>{r=()=>{a(Error("Aborted"))},t.addEventListener("abort",r),t.aborted&&a(Error("Aborted"))})]).finally(()=>t.removeEventListener("abort",r))}r.d(t,{o:()=>a})},70014:(e,t,r)=>{"use strict";var a;function i(e,t){let r=typeof e;if(r!==typeof t)return!1;if(Array.isArray(e)){if(!Array.isArray(t))return!1;let r=e.length;if(r!==t.length)return!1;for(let a=0;a<r;a++)if(!i(e[a],t[a]))return!1;return!0}if("object"===r){if(!e||!t)return e===t;let r=Object.keys(e),a=Object.keys(t);if(r.length!==a.length)return!1;for(let a of r)if(!i(e[a],t[a]))return!1;return!0}return e===t}function n(e){return encodeURI(e.replace(/~/g,"~0").replace(/\//g,"~1"))}r.d(t,{rA:()=>i,tf:()=>function e(t,r,a="2019-09",c=function e(t,r=Object.create(null),a=u,i=""){if(t&&"object"==typeof t&&!Array.isArray(t)){let n=t.$id||t.id;if(n){let s=new URL(n,a.href);s.hash.length>1?r[s.href]=t:(s.hash="",""===i?a=s:e(t,r,a))}}else if(!0!==t&&!1!==t)return r;let c=a.href+(i?"#"+i:"");if(void 0!==r[c])throw Error(`Duplicate schema URI "${c}".`);if(r[c]=t,!0===t||!1===t)return r;if(void 0===t.__absolute_uri__&&Object.defineProperty(t,"__absolute_uri__",{enumerable:!1,value:c}),t.$ref&&void 0===t.__absolute_ref__){let e=new URL(t.$ref,a.href);e.hash=e.hash,Object.defineProperty(t,"__absolute_ref__",{enumerable:!1,value:e.href})}if(t.$recursiveRef&&void 0===t.__absolute_recursive_ref__){let e=new URL(t.$recursiveRef,a.href);e.hash=e.hash,Object.defineProperty(t,"__absolute_recursive_ref__",{enumerable:!1,value:e.href})}for(let u in t.$anchor&&(r[new URL("#"+t.$anchor,a.href).href]=t),t){if(l[u])continue;let c=`${i}/${n(u)}`,d=t[u];if(Array.isArray(d)){if(s[u]){let t=d.length;for(let i=0;i<t;i++)e(d[i],r,a,`${c}/${i}`)}}else if(o[u])for(let t in d)e(d[t],r,a,`${c}/${n(t)}`);else e(d,r,a,c)}return r}(r),d=!0,h=null,p="#",f="#",g=Object.create(null)){let y;if(!0===r)return{valid:!0,errors:[]};if(!1===r)return{valid:!1,errors:[{instanceLocation:p,keyword:"false",keywordLocation:p,error:"False boolean schema."}]};let b=typeof t;switch(b){case"boolean":case"number":case"string":y=b;break;case"object":y=null===t?"null":Array.isArray(t)?"array":"object";break;default:throw Error(`Instances of "${b}" type are not supported.`)}let{$ref:_,$recursiveRef:v,$recursiveAnchor:w,type:O,const:I,enum:k,required:E,not:x,anyOf:S,allOf:P,oneOf:A,if:T,then:j,else:N,format:$,properties:R,patternProperties:C,additionalProperties:L,unevaluatedProperties:U,minProperties:M,maxProperties:D,propertyNames:F,dependentRequired:z,dependentSchemas:B,dependencies:Z,prefixItems:J,items:q,additionalItems:G,unevaluatedItems:W,contains:H,minContains:Y,maxContains:V,minItems:K,maxItems:X,uniqueItems:Q,minimum:ee,maximum:et,exclusiveMinimum:er,exclusiveMaximum:ea,multipleOf:ei,minLength:en,maxLength:es,pattern:eo,__absolute_ref__:el,__absolute_recursive_ref__:eu}=r,ec=[];if(!0===w&&null===h&&(h=r),"#"===v){let i=null===h?c[eu]:h,n=`${f}/$recursiveRef`,s=e(t,null===h?r:h,a,c,d,i,p,n,g);s.valid||ec.push({instanceLocation:p,keyword:"$recursiveRef",keywordLocation:n,error:"A subschema had errors."},...s.errors)}if(void 0!==_){let r=c[el||_];if(void 0===r){let e=`Unresolved $ref "${_}".`;throw el&&el!==_&&(e+=`  Absolute URI "${el}".`),Error(e+=`
Known schemas:
- ${Object.keys(c).join("\n- ")}`)}let i=`${f}/$ref`,n=e(t,r,a,c,d,h,p,i,g);if(n.valid||ec.push({instanceLocation:p,keyword:"$ref",keywordLocation:i,error:"A subschema had errors."},...n.errors),"4"===a||"7"===a)return{valid:0===ec.length,errors:ec}}if(Array.isArray(O)){let e=O.length,r=!1;for(let a=0;a<e;a++)if(y===O[a]||"integer"===O[a]&&"number"===y&&t%1==0&&t==t){r=!0;break}r||ec.push({instanceLocation:p,keyword:"type",keywordLocation:`${f}/type`,error:`Instance type "${y}" is invalid. Expected "${O.join('", "')}".`})}else"integer"===O?("number"!==y||t%1||t!=t)&&ec.push({instanceLocation:p,keyword:"type",keywordLocation:`${f}/type`,error:`Instance type "${y}" is invalid. Expected "${O}".`}):void 0!==O&&y!==O&&ec.push({instanceLocation:p,keyword:"type",keywordLocation:`${f}/type`,error:`Instance type "${y}" is invalid. Expected "${O}".`});if(void 0===I||("object"===y||"array"===y?i(t,I)||ec.push({instanceLocation:p,keyword:"const",keywordLocation:`${f}/const`,error:`Instance does not match ${JSON.stringify(I)}.`}):t!==I&&ec.push({instanceLocation:p,keyword:"const",keywordLocation:`${f}/const`,error:`Instance does not match ${JSON.stringify(I)}.`})),void 0===k||("object"===y||"array"===y?k.some(e=>i(t,e))||ec.push({instanceLocation:p,keyword:"enum",keywordLocation:`${f}/enum`,error:`Instance does not match any of ${JSON.stringify(k)}.`}):k.some(e=>t===e)||ec.push({instanceLocation:p,keyword:"enum",keywordLocation:`${f}/enum`,error:`Instance does not match any of ${JSON.stringify(k)}.`})),void 0!==x){let r=`${f}/not`;e(t,x,a,c,d,h,p,r).valid&&ec.push({instanceLocation:p,keyword:"not",keywordLocation:r,error:'Instance matched "not" schema.'})}let ed=[];if(void 0!==S){let r=`${f}/anyOf`,i=ec.length,n=!1;for(let i=0;i<S.length;i++){let s=S[i],o=Object.create(g),l=e(t,s,a,c,d,!0===w?h:null,p,`${r}/${i}`,o);ec.push(...l.errors),n=n||l.valid,l.valid&&ed.push(o)}n?ec.length=i:ec.splice(i,0,{instanceLocation:p,keyword:"anyOf",keywordLocation:r,error:"Instance does not match any subschemas."})}if(void 0!==P){let r=`${f}/allOf`,i=ec.length,n=!0;for(let i=0;i<P.length;i++){let s=P[i],o=Object.create(g),l=e(t,s,a,c,d,!0===w?h:null,p,`${r}/${i}`,o);ec.push(...l.errors),n=n&&l.valid,l.valid&&ed.push(o)}n?ec.length=i:ec.splice(i,0,{instanceLocation:p,keyword:"allOf",keywordLocation:r,error:"Instance does not match every subschema."})}if(void 0!==A){let r=`${f}/oneOf`,i=ec.length,n=A.filter((i,n)=>{let s=Object.create(g),o=e(t,i,a,c,d,!0===w?h:null,p,`${r}/${n}`,s);return ec.push(...o.errors),o.valid&&ed.push(s),o.valid}).length;1===n?ec.length=i:ec.splice(i,0,{instanceLocation:p,keyword:"oneOf",keywordLocation:r,error:`Instance does not match exactly one subschema (${n} matches).`})}if(("object"===y||"array"===y)&&Object.assign(g,...ed),void 0!==T){let r=`${f}/if`;if(e(t,T,a,c,d,h,p,r,g).valid){if(void 0!==j){let i=e(t,j,a,c,d,h,p,`${f}/then`,g);i.valid||ec.push({instanceLocation:p,keyword:"if",keywordLocation:r,error:'Instance does not match "then" schema.'},...i.errors)}}else if(void 0!==N){let i=e(t,N,a,c,d,h,p,`${f}/else`,g);i.valid||ec.push({instanceLocation:p,keyword:"if",keywordLocation:r,error:'Instance does not match "else" schema.'},...i.errors)}}if("object"===y){if(void 0!==E)for(let e of E)e in t||ec.push({instanceLocation:p,keyword:"required",keywordLocation:`${f}/required`,error:`Instance does not have required property "${e}".`});let r=Object.keys(t);if(void 0!==M&&r.length<M&&ec.push({instanceLocation:p,keyword:"minProperties",keywordLocation:`${f}/minProperties`,error:`Instance does not have at least ${M} properties.`}),void 0!==D&&r.length>D&&ec.push({instanceLocation:p,keyword:"maxProperties",keywordLocation:`${f}/maxProperties`,error:`Instance does not have at least ${D} properties.`}),void 0!==F){let r=`${f}/propertyNames`;for(let i in t){let t=`${p}/${n(i)}`,s=e(i,F,a,c,d,h,t,r);s.valid||ec.push({instanceLocation:p,keyword:"propertyNames",keywordLocation:r,error:`Property name "${i}" does not match schema.`},...s.errors)}}if(void 0!==z){let e=`${f}/dependantRequired`;for(let r in z)if(r in t)for(let a of z[r])a in t||ec.push({instanceLocation:p,keyword:"dependentRequired",keywordLocation:e,error:`Instance has "${r}" but does not have "${a}".`})}if(void 0!==B)for(let r in B){let i=`${f}/dependentSchemas`;if(r in t){let s=e(t,B[r],a,c,d,h,p,`${i}/${n(r)}`,g);s.valid||ec.push({instanceLocation:p,keyword:"dependentSchemas",keywordLocation:i,error:`Instance has "${r}" but does not match dependant schema.`},...s.errors)}}if(void 0!==Z){let r=`${f}/dependencies`;for(let i in Z)if(i in t){let s=Z[i];if(Array.isArray(s))for(let e of s)e in t||ec.push({instanceLocation:p,keyword:"dependencies",keywordLocation:r,error:`Instance has "${i}" but does not have "${e}".`});else{let o=e(t,s,a,c,d,h,p,`${r}/${n(i)}`);o.valid||ec.push({instanceLocation:p,keyword:"dependencies",keywordLocation:r,error:`Instance has "${i}" but does not match dependant schema.`},...o.errors)}}}let i=Object.create(null),s=!1;if(void 0!==R){let r=`${f}/properties`;for(let o in R){if(!(o in t))continue;let l=`${p}/${n(o)}`,u=e(t[o],R[o],a,c,d,h,l,`${r}/${n(o)}`);if(u.valid)g[o]=i[o]=!0;else if(s=d,ec.push({instanceLocation:p,keyword:"properties",keywordLocation:r,error:`Property "${o}" does not match schema.`},...u.errors),s)break}}if(!s&&void 0!==C){let r=`${f}/patternProperties`;for(let o in C){let l=RegExp(o,"u"),u=C[o];for(let m in t){if(!l.test(m))continue;let f=`${p}/${n(m)}`,y=e(t[m],u,a,c,d,h,f,`${r}/${n(o)}`);y.valid?g[m]=i[m]=!0:(s=d,ec.push({instanceLocation:p,keyword:"patternProperties",keywordLocation:r,error:`Property "${m}" matches pattern "${o}" but does not match associated schema.`},...y.errors))}}}if(s||void 0===L){if(!s&&void 0!==U){let r=`${f}/unevaluatedProperties`;for(let i in t)if(!g[i]){let s=`${p}/${n(i)}`,o=e(t[i],U,a,c,d,h,s,r);o.valid?g[i]=!0:ec.push({instanceLocation:p,keyword:"unevaluatedProperties",keywordLocation:r,error:`Property "${i}" does not match unevaluated properties schema.`},...o.errors)}}}else{let r=`${f}/additionalProperties`;for(let o in t){if(i[o])continue;let l=`${p}/${n(o)}`,u=e(t[o],L,a,c,d,h,l,r);u.valid?g[o]=!0:(s=d,ec.push({instanceLocation:p,keyword:"additionalProperties",keywordLocation:r,error:`Property "${o}" does not match additional properties schema.`},...u.errors))}}}else if("array"===y){void 0!==X&&t.length>X&&ec.push({instanceLocation:p,keyword:"maxItems",keywordLocation:`${f}/maxItems`,error:`Array has too many items (${t.length} > ${X}).`}),void 0!==K&&t.length<K&&ec.push({instanceLocation:p,keyword:"minItems",keywordLocation:`${f}/minItems`,error:`Array has too few items (${t.length} < ${K}).`});let r=t.length,n=0,s=!1;if(void 0!==J){let i=`${f}/prefixItems`,o=Math.min(J.length,r);for(;n<o;n++){let r=e(t[n],J[n],a,c,d,h,`${p}/${n}`,`${i}/${n}`);if(g[n]=!0,!r.valid&&(s=d,ec.push({instanceLocation:p,keyword:"prefixItems",keywordLocation:i,error:"Items did not match schema."},...r.errors),s))break}}if(void 0!==q){let i=`${f}/items`;if(Array.isArray(q)){let o=Math.min(q.length,r);for(;n<o;n++){let r=e(t[n],q[n],a,c,d,h,`${p}/${n}`,`${i}/${n}`);if(g[n]=!0,!r.valid&&(s=d,ec.push({instanceLocation:p,keyword:"items",keywordLocation:i,error:"Items did not match schema."},...r.errors),s))break}}else for(;n<r;n++){let r=e(t[n],q,a,c,d,h,`${p}/${n}`,i);if(g[n]=!0,!r.valid&&(s=d,ec.push({instanceLocation:p,keyword:"items",keywordLocation:i,error:"Items did not match schema."},...r.errors),s))break}if(!s&&void 0!==G){let i=`${f}/additionalItems`;for(;n<r;n++){let r=e(t[n],G,a,c,d,h,`${p}/${n}`,i);g[n]=!0,r.valid||(s=d,ec.push({instanceLocation:p,keyword:"additionalItems",keywordLocation:i,error:"Items did not match additional items schema."},...r.errors))}}}if(void 0!==H){if(0===r&&void 0===Y)ec.push({instanceLocation:p,keyword:"contains",keywordLocation:`${f}/contains`,error:"Array is empty. It must contain at least one item matching the schema."});else if(void 0!==Y&&r<Y)ec.push({instanceLocation:p,keyword:"minContains",keywordLocation:`${f}/minContains`,error:`Array has less items (${r}) than minContains (${Y}).`});else{let i=`${f}/contains`,n=ec.length,s=0;for(let n=0;n<r;n++){let r=e(t[n],H,a,c,d,h,`${p}/${n}`,i);r.valid?(g[n]=!0,s++):ec.push(...r.errors)}s>=(Y||0)&&(ec.length=n),void 0===Y&&void 0===V&&0===s?ec.splice(n,0,{instanceLocation:p,keyword:"contains",keywordLocation:i,error:"Array does not contain item matching schema."}):void 0!==Y&&s<Y?ec.push({instanceLocation:p,keyword:"minContains",keywordLocation:`${f}/minContains`,error:`Array must contain at least ${Y} items matching schema. Only ${s} items were found.`}):void 0!==V&&s>V&&ec.push({instanceLocation:p,keyword:"maxContains",keywordLocation:`${f}/maxContains`,error:`Array may contain at most ${V} items matching schema. ${s} items were found.`})}}if(!s&&void 0!==W){let i=`${f}/unevaluatedItems`;for(;n<r;n++){if(g[n])continue;let r=e(t[n],W,a,c,d,h,`${p}/${n}`,i);g[n]=!0,r.valid||ec.push({instanceLocation:p,keyword:"unevaluatedItems",keywordLocation:i,error:"Items did not match unevaluated items schema."},...r.errors)}}if(Q)for(let e=0;e<r;e++){let a=t[e],n="object"==typeof a&&null!==a;for(let s=0;s<r;s++){if(e===s)continue;let r=t[s],o="object"==typeof r&&null!==r;(a===r||n&&o&&i(a,r))&&(ec.push({instanceLocation:p,keyword:"uniqueItems",keywordLocation:`${f}/uniqueItems`,error:`Duplicate items at indexes ${e} and ${s}.`}),e=Number.MAX_SAFE_INTEGER,s=Number.MAX_SAFE_INTEGER)}}}else if("number"===y){if("4"===a?(void 0!==ee&&(!0===er&&t<=ee||t<ee)&&ec.push({instanceLocation:p,keyword:"minimum",keywordLocation:`${f}/minimum`,error:`${t} is less than ${er?"or equal to ":""} ${ee}.`}),void 0!==et&&(!0===ea&&t>=et||t>et)&&ec.push({instanceLocation:p,keyword:"maximum",keywordLocation:`${f}/maximum`,error:`${t} is greater than ${ea?"or equal to ":""} ${et}.`})):(void 0!==ee&&t<ee&&ec.push({instanceLocation:p,keyword:"minimum",keywordLocation:`${f}/minimum`,error:`${t} is less than ${ee}.`}),void 0!==et&&t>et&&ec.push({instanceLocation:p,keyword:"maximum",keywordLocation:`${f}/maximum`,error:`${t} is greater than ${et}.`}),void 0!==er&&t<=er&&ec.push({instanceLocation:p,keyword:"exclusiveMinimum",keywordLocation:`${f}/exclusiveMinimum`,error:`${t} is less than ${er}.`}),void 0!==ea&&t>=ea&&ec.push({instanceLocation:p,keyword:"exclusiveMaximum",keywordLocation:`${f}/exclusiveMaximum`,error:`${t} is greater than or equal to ${ea}.`})),void 0!==ei){let e=t%ei;Math.abs(0-e)>=11920929e-14&&Math.abs(ei-e)>=11920929e-14&&ec.push({instanceLocation:p,keyword:"multipleOf",keywordLocation:`${f}/multipleOf`,error:`${t} is not a multiple of ${ei}.`})}}else if("string"===y){let e=void 0===en&&void 0===es?0:function(e){let t,r=0,a=e.length,i=0;for(;i<a;)r++,(t=e.charCodeAt(i++))>=55296&&t<=56319&&i<a&&(64512&(t=e.charCodeAt(i)))==56320&&i++;return r}(t);void 0!==en&&e<en&&ec.push({instanceLocation:p,keyword:"minLength",keywordLocation:`${f}/minLength`,error:`String is too short (${e} < ${en}).`}),void 0!==es&&e>es&&ec.push({instanceLocation:p,keyword:"maxLength",keywordLocation:`${f}/maxLength`,error:`String is too long (${e} > ${es}).`}),void 0===eo||RegExp(eo,"u").test(t)||ec.push({instanceLocation:p,keyword:"pattern",keywordLocation:`${f}/pattern`,error:"String does not match pattern."}),void 0!==$&&m[$]&&!m[$](t)&&ec.push({instanceLocation:p,keyword:"format",keywordLocation:`${f}/format`,error:`String does not match format "${$}".`})}return{valid:0===ec.length,errors:ec}}});let s={prefixItems:!0,items:!0,allOf:!0,anyOf:!0,oneOf:!0},o={$defs:!0,definitions:!0,properties:!0,patternProperties:!0,dependentSchemas:!0},l={id:!0,$id:!0,$ref:!0,$schema:!0,$anchor:!0,$vocabulary:!0,$comment:!0,default:!0,enum:!0,const:!0,required:!0,type:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0},u="undefined"!=typeof self&&self.location&&"null"!==self.location.origin?new URL(self.location.origin+self.location.pathname+location.search):new URL("https://github.com/cfworker"),c=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,d=[0,31,28,31,30,31,30,31,31,30,31,30,31],h=/^(\d\d):(\d\d):(\d\d)(\.\d+)?(z|[+-]\d\d(?::?\d\d)?)?$/i;function p(e){return e.test.bind(e)}let m={date:f,time:g.bind(void 0,!1),"date-time":function(e){let t=e.split(y);return 2==t.length&&f(t[0])&&g(!0,t[1])},duration:e=>e.length>1&&e.length<80&&(/^P\d+([.,]\d+)?W$/.test(e)||/^P[\dYMDTHS]*(\d[.,]\d+)?[YMDHS]$/.test(e)&&/^P([.,\d]+Y)?([.,\d]+M)?([.,\d]+D)?(T([.,\d]+H)?([.,\d]+M)?([.,\d]+S)?)?$/.test(e)),uri:function(e){return b.test(e)&&_.test(e)},"uri-reference":p(/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i),"uri-template":p(/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i),url:p(/^(?:(?:https?|ftp):\/\/)(?:\S+(?::\S*)?@)?(?:(?!10(?:\.\d{1,3}){3})(?!127(?:\.\d{1,3}){3})(?!169\.254(?:\.\d{1,3}){2})(?!192\.168(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)(?:\.(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)*(?:\.(?:[a-z\u{00a1}-\u{ffff}]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/iu),email:e=>{if('"'===e[0])return!1;let[t,r,...a]=e.split("@");return!(!t||!r||0!==a.length||t.length>64||r.length>253||"."===t[0]||t.endsWith(".")||t.includes(".."))&&!!/^[a-z0-9.-]+$/i.test(r)&&!!/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+$/i.test(t)&&r.split(".").every(e=>/^[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?$/i.test(e))},hostname:p(/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i),ipv4:p(/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/),ipv6:p(/^((([0-9a-f]{1,4}:){7}([0-9a-f]{1,4}|:))|(([0-9a-f]{1,4}:){6}(:[0-9a-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){5}(((:[0-9a-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){4}(((:[0-9a-f]{1,4}){1,3})|((:[0-9a-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){3}(((:[0-9a-f]{1,4}){1,4})|((:[0-9a-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){2}(((:[0-9a-f]{1,4}){1,5})|((:[0-9a-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){1}(((:[0-9a-f]{1,4}){1,6})|((:[0-9a-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9a-f]{1,4}){1,7})|((:[0-9a-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))$/i),regex:function(e){if(v.test(e))return!1;try{return RegExp(e,"u"),!0}catch(e){return!1}},uuid:p(/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i),"json-pointer":p(/^(?:\/(?:[^~/]|~0|~1)*)*$/),"json-pointer-uri-fragment":p(/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i),"relative-json-pointer":p(/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/)};function f(e){var t;let r=e.match(c);if(!r)return!1;let a=+r[1],i=+r[2],n=+r[3];return i>=1&&i<=12&&n>=1&&n<=(2==i&&(t=a)%4==0&&(t%100!=0||t%400==0)?29:d[i])}function g(e,t){let r=t.match(h);if(!r)return!1;let a=+r[1],i=+r[2],n=+r[3],s=!!r[5];return(a<=23&&i<=59&&n<=59||23==a&&59==i&&60==n)&&(!e||s)}let y=/t|\s/i,b=/\/|:/,_=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,v=/[^\\]\\Z/;!function(e){e[e.Flag=1]="Flag",e[e.Basic=2]="Basic",e[e.Detailed=4]="Detailed"}(a||(a={}))},70238:(e,t,r)=>{"use strict";function a(e,t,r){function a(r,a){var i;for(let n in Object.defineProperty(r,"_zod",{value:r._zod??{},enumerable:!1}),(i=r._zod).traits??(i.traits=new Set),r._zod.traits.add(e),t(r,a),s.prototype)n in r||Object.defineProperty(r,n,{value:s.prototype[n].bind(r)});r._zod.constr=s,r._zod.def=a}let i=r?.Parent??Object;class n extends i{}function s(e){var t;let i=r?.Parent?new n:this;for(let r of(a(i,e),(t=i._zod).deferred??(t.deferred=[]),i._zod.deferred))r();return i}return Object.defineProperty(n,"name",{value:e}),Object.defineProperty(s,"init",{value:a}),Object.defineProperty(s,Symbol.hasInstance,{value:t=>!!r?.Parent&&t instanceof r.Parent||t?._zod?.traits?.has(e)}),Object.defineProperty(s,"name",{value:e}),s}r.d(t,{fd:()=>v,qgA:()=>p,EJS:()=>m,blZ:()=>O}),Symbol("zod_brand");class i extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}let n={};function s(e){return e&&Object.assign(n,e),n}function o(e,t){return"bigint"==typeof t?t.toString():t}let l=Error.captureStackTrace?Error.captureStackTrace:(...e)=>{};function u(e){return"string"==typeof e?e:e?.message}function c(e,t,r){let a={...e,path:e.path??[]};return e.message||(a.message=u(e.inst?._zod.def?.error?.(e))??u(t?.error?.(e))??u(r.customError?.(e))??u(r.localeError?.(e))??"Invalid input"),delete a.inst,delete a.continue,t?.reportInput||delete a.input,a}Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,Number.MAX_VALUE,Number.MAX_VALUE;let d=(e,t)=>{e.name="$ZodError",Object.defineProperty(e,"_zod",{value:e._zod,enumerable:!1}),Object.defineProperty(e,"issues",{value:t,enumerable:!1}),Object.defineProperty(e,"message",{get:()=>JSON.stringify(t,o,2),enumerable:!0})},h=(a("$ZodError",d),a("$ZodError",d,{Parent:Error})),p=(e,t,r,a)=>{let n=r?Object.assign(r,{async:!1}):{async:!1},o=e._zod.run({value:t,issues:[]},n);if(o instanceof Promise)throw new i;if(o.issues.length){let e=new(a?.Err??h)(o.issues.map(e=>c(e,n,s())));throw l(e,a?.callee),e}return o.value},m=async(e,t,r,a)=>{let i=r?Object.assign(r,{async:!0}):{async:!0},n=e._zod.run({value:t,issues:[]},i);if(n instanceof Promise&&(n=await n),n.issues.length){let e=new(a?.Err??h)(n.issues.map(e=>c(e,i,s())));throw l(e,a?.callee),e}return n.value};function f(e,t,r,a){let i=Math.abs(e),n=i%10,s=i%100;return s>=11&&s<=19?a:1===n?t:n>=2&&n<=4?r:a}let g=e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"number";case"object":if(Array.isArray(e))return"array";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t};function y(e,t,r,a){let i=Math.abs(e),n=i%10,s=i%100;return s>=11&&s<=19?a:1===n?t:n>=2&&n<=4?r:a}let b=e=>{let t=typeof e;switch(t){case"number":return Number.isNaN(e)?"NaN":"number";case"object":if(Array.isArray(e))return"array";if(null===e)return"null";if(Object.getPrototypeOf(e)!==Object.prototype&&e.constructor)return e.constructor.name}return t};Symbol("ZodOutput"),Symbol("ZodInput");class _{constructor(){this._map=new WeakMap,this._idmap=new Map}add(e,...t){let r=t[0];if(this._map.set(e,r),r&&"object"==typeof r&&"id"in r){if(this._idmap.has(r.id))throw Error(`ID ${r.id} already exists in the registry`);this._idmap.set(r.id,e)}return this}remove(e){return this._map.delete(e),this}get(e){let t=e._zod.parent;if(t){let r={...this.get(t)??{}};return delete r.id,{...r,...this._map.get(e)}}return this._map.get(e)}has(e){return this._map.has(e)}}let v=new _;class w{constructor(e){this.counter=0,this.metadataRegistry=e?.metadata??v,this.target=e?.target??"draft-2020-12",this.unrepresentable=e?.unrepresentable??"throw",this.override=e?.override??(()=>{}),this.io=e?.io??"output",this.seen=new Map}process(e,t={path:[],schemaPath:[]}){var r;let a=e._zod.def,i=this.seen.get(e);if(i)return i.count++,t.schemaPath.includes(e)&&(i.cycle=t.path),i.schema;let n={schema:{},count:1,cycle:void 0};this.seen.set(e,n);let s=e._zod.toJSONSchema?.();if(s)n.schema=s;else{let r={...t,schemaPath:[...t.schemaPath,e],path:t.path},i=e._zod.parent;if(i)n.ref=i,this.process(i,r),this.seen.get(i).isParent=!0;else{let t=n.schema;switch(a.type){case"string":{t.type="string";let{minimum:r,maximum:a,format:i,patterns:s,contentEncoding:o}=e._zod.bag;if("number"==typeof r&&(t.minLength=r),"number"==typeof a&&(t.maxLength=a),i&&(t.format=({guid:"uuid",url:"uri",datetime:"date-time",json_string:"json-string",regex:""})[i]??i,""===t.format&&delete t.format),o&&(t.contentEncoding=o),s&&s.size>0){let e=[...s];1===e.length?t.pattern=e[0].source:e.length>1&&(n.schema.allOf=[...e.map(e=>({..."draft-7"===this.target?{type:"string"}:{},pattern:e.source}))])}break}case"number":{let{minimum:r,maximum:a,format:i,multipleOf:n,exclusiveMaximum:s,exclusiveMinimum:o}=e._zod.bag;"string"==typeof i&&i.includes("int")?t.type="integer":t.type="number","number"==typeof o&&(t.exclusiveMinimum=o),"number"==typeof r&&(t.minimum=r,"number"==typeof o&&(o>=r?delete t.minimum:delete t.exclusiveMinimum)),"number"==typeof s&&(t.exclusiveMaximum=s),"number"==typeof a&&(t.maximum=a,"number"==typeof s&&(s<=a?delete t.maximum:delete t.exclusiveMaximum)),"number"==typeof n&&(t.multipleOf=n);break}case"boolean":case"success":t.type="boolean";break;case"bigint":if("throw"===this.unrepresentable)throw Error("BigInt cannot be represented in JSON Schema");break;case"symbol":if("throw"===this.unrepresentable)throw Error("Symbols cannot be represented in JSON Schema");break;case"undefined":case"null":t.type="null";break;case"any":case"unknown":break;case"never":t.not={};break;case"void":if("throw"===this.unrepresentable)throw Error("Void cannot be represented in JSON Schema");break;case"date":if("throw"===this.unrepresentable)throw Error("Date cannot be represented in JSON Schema");break;case"array":{let{minimum:i,maximum:n}=e._zod.bag;"number"==typeof i&&(t.minItems=i),"number"==typeof n&&(t.maxItems=n),t.type="array",t.items=this.process(a.element,{...r,path:[...r.path,"items"]});break}case"object":{t.type="object",t.properties={};let e=a.shape;for(let a in e)t.properties[a]=this.process(e[a],{...r,path:[...r.path,"properties",a]});let i=new Set([...new Set(Object.keys(e))].filter(e=>{let t=a.shape[e]._zod;return"input"===this.io?void 0===t.optin:void 0===t.optout}));i.size>0&&(t.required=Array.from(i)),a.catchall?._zod.def.type==="never"?t.additionalProperties=!1:a.catchall?a.catchall&&(t.additionalProperties=this.process(a.catchall,{...r,path:[...r.path,"additionalProperties"]})):"output"===this.io&&(t.additionalProperties=!1);break}case"union":t.anyOf=a.options.map((e,t)=>this.process(e,{...r,path:[...r.path,"anyOf",t]}));break;case"intersection":{let e=this.process(a.left,{...r,path:[...r.path,"allOf",0]}),i=this.process(a.right,{...r,path:[...r.path,"allOf",1]}),n=e=>"allOf"in e&&1===Object.keys(e).length;t.allOf=[...n(e)?e.allOf:[e],...n(i)?i.allOf:[i]];break}case"tuple":{t.type="array";let i=a.items.map((e,t)=>this.process(e,{...r,path:[...r.path,"prefixItems",t]}));if("draft-2020-12"===this.target?t.prefixItems=i:t.items=i,a.rest){let e=this.process(a.rest,{...r,path:[...r.path,"items"]});"draft-2020-12"===this.target?t.items=e:t.additionalItems=e}a.rest&&(t.items=this.process(a.rest,{...r,path:[...r.path,"items"]}));let{minimum:n,maximum:s}=e._zod.bag;"number"==typeof n&&(t.minItems=n),"number"==typeof s&&(t.maxItems=s);break}case"record":t.type="object",t.propertyNames=this.process(a.keyType,{...r,path:[...r.path,"propertyNames"]}),t.additionalProperties=this.process(a.valueType,{...r,path:[...r.path,"additionalProperties"]});break;case"map":if("throw"===this.unrepresentable)throw Error("Map cannot be represented in JSON Schema");break;case"set":if("throw"===this.unrepresentable)throw Error("Set cannot be represented in JSON Schema");break;case"enum":{let e=function(e){let t=Object.values(e).filter(e=>"number"==typeof e);return Object.entries(e).filter(([e,r])=>-1===t.indexOf(+e)).map(([e,t])=>t)}(a.entries);e.every(e=>"number"==typeof e)&&(t.type="number"),e.every(e=>"string"==typeof e)&&(t.type="string"),t.enum=e;break}case"literal":{let e=[];for(let t of a.values)if(void 0===t){if("throw"===this.unrepresentable)throw Error("Literal `undefined` cannot be represented in JSON Schema")}else if("bigint"==typeof t){if("throw"===this.unrepresentable)throw Error("BigInt literals cannot be represented in JSON Schema");e.push(Number(t))}else e.push(t);if(0===e.length);else if(1===e.length){let r=e[0];t.type=null===r?"null":typeof r,t.const=r}else e.every(e=>"number"==typeof e)&&(t.type="number"),e.every(e=>"string"==typeof e)&&(t.type="string"),e.every(e=>"boolean"==typeof e)&&(t.type="string"),e.every(e=>null===e)&&(t.type="null"),t.enum=e;break}case"file":{let r={type:"string",format:"binary",contentEncoding:"binary"},{minimum:a,maximum:i,mime:n}=e._zod.bag;void 0!==a&&(r.minLength=a),void 0!==i&&(r.maxLength=i),n?1===n.length?(r.contentMediaType=n[0],Object.assign(t,r)):t.anyOf=n.map(e=>({...r,contentMediaType:e})):Object.assign(t,r);break}case"transform":if("throw"===this.unrepresentable)throw Error("Transforms cannot be represented in JSON Schema");break;case"nullable":t.anyOf=[this.process(a.innerType,r),{type:"null"}];break;case"nonoptional":case"promise":case"optional":this.process(a.innerType,r),n.ref=a.innerType;break;case"default":this.process(a.innerType,r),n.ref=a.innerType,t.default=JSON.parse(JSON.stringify(a.defaultValue));break;case"prefault":this.process(a.innerType,r),n.ref=a.innerType,"input"===this.io&&(t._prefault=JSON.parse(JSON.stringify(a.defaultValue)));break;case"catch":{let e;this.process(a.innerType,r),n.ref=a.innerType;try{e=a.catchValue(void 0)}catch{throw Error("Dynamic catch values are not supported in JSON Schema")}t.default=e;break}case"nan":if("throw"===this.unrepresentable)throw Error("NaN cannot be represented in JSON Schema");break;case"template_literal":{let r=e._zod.pattern;if(!r)throw Error("Pattern not found in template literal");t.type="string",t.pattern=r.source;break}case"pipe":{let e="input"===this.io?"transform"===a.in._zod.def.type?a.out:a.in:a.out;this.process(e,r),n.ref=e;break}case"readonly":this.process(a.innerType,r),n.ref=a.innerType,t.readOnly=!0;break;case"lazy":{let t=e._zod.innerType;this.process(t,r),n.ref=t;break}case"custom":if("throw"===this.unrepresentable)throw Error("Custom types cannot be represented in JSON Schema")}}}let o=this.metadataRegistry.get(e);return o&&Object.assign(n.schema,o),"input"===this.io&&function e(t,r){let a=r??{seen:new Set};if(a.seen.has(t))return!1;a.seen.add(t);let i=t._zod.def;switch(i.type){case"string":case"number":case"bigint":case"boolean":case"date":case"symbol":case"undefined":case"null":case"any":case"unknown":case"never":case"void":case"literal":case"enum":case"nan":case"file":case"template_literal":case"custom":case"success":case"catch":return!1;case"array":return e(i.element,a);case"object":for(let t in i.shape)if(e(i.shape[t],a))return!0;return!1;case"union":for(let t of i.options)if(e(t,a))return!0;return!1;case"intersection":return e(i.left,a)||e(i.right,a);case"tuple":for(let t of i.items)if(e(t,a))return!0;if(i.rest&&e(i.rest,a))return!0;return!1;case"record":case"map":return e(i.keyType,a)||e(i.valueType,a);case"set":return e(i.valueType,a);case"promise":case"optional":case"nonoptional":case"nullable":case"readonly":case"default":case"prefault":return e(i.innerType,a);case"lazy":return e(i.getter(),a);case"transform":return!0;case"pipe":return e(i.in,a)||e(i.out,a)}throw Error(`Unknown schema type: ${i.type}`)}(e)&&(delete n.schema.examples,delete n.schema.default),"input"===this.io&&n.schema._prefault&&((r=n.schema).default??(r.default=n.schema._prefault)),delete n.schema._prefault,this.seen.get(e).schema}emit(e,t){let r={cycles:t?.cycles??"ref",reused:t?.reused??"inline",external:t?.external??void 0},a=this.seen.get(e);if(!a)throw Error("Unprocessed schema. This is a bug in Zod.");let i=e=>{let t="draft-2020-12"===this.target?"$defs":"definitions";if(r.external){let a=r.external.registry.get(e[0])?.id;if(a)return{ref:r.external.uri(a)};let i=e[1].defId??e[1].schema.id??`schema${this.counter++}`;return e[1].defId=i,{defId:i,ref:`${r.external.uri("__shared")}#/${t}/${i}`}}if(e[1]===a)return{ref:"#"};let i=`#/${t}/`,n=e[1].schema.id??`__schema${this.counter++}`;return{defId:n,ref:i+n}},n=e=>{if(e[1].schema.$ref)return;let t=e[1],{ref:r,defId:a}=i(e);t.def={...t.schema},a&&(t.defId=a);let n=t.schema;for(let e in n)delete n[e];n.$ref=r};for(let t of this.seen.entries()){let a=t[1];if(e===t[0]){n(t);continue}if(r.external){let a=r.external.registry.get(t[0])?.id;if(e!==t[0]&&a){n(t);continue}}if(this.metadataRegistry.get(t[0])?.id){n(t);continue}if(a.cycle){if("throw"===r.cycles)throw Error(`Cycle detected: #/${a.cycle?.join("/")}/<root>

Set the \`cycles\` parameter to \`"ref"\` to resolve cyclical schemas with defs.`);"ref"===r.cycles&&n(t);continue}if(a.count>1&&"ref"===r.reused){n(t);continue}}let s=(e,t)=>{let r=this.seen.get(e),a=r.def??r.schema,i={...a};if(null===r.ref)return;let n=r.ref;if(r.ref=null,n){s(n,t);let e=this.seen.get(n).schema;e.$ref&&"draft-7"===t.target?(a.allOf=a.allOf??[],a.allOf.push(e)):(Object.assign(a,e),Object.assign(a,i))}r.isParent||this.override({zodSchema:e,jsonSchema:a})};for(let e of[...this.seen.entries()].reverse())s(e[0],{target:this.target});let o={};"draft-2020-12"===this.target?o.$schema="https://json-schema.org/draft/2020-12/schema":"draft-7"===this.target?o.$schema="http://json-schema.org/draft-07/schema#":console.warn(`Invalid target: ${this.target}`),Object.assign(o,a.def);let l=r.external?.defs??{};for(let e of this.seen.entries()){let t=e[1];t.def&&t.defId&&(l[t.defId]=t.def)}!r.external&&Object.keys(l).length>0&&("draft-2020-12"===this.target?o.$defs=l:o.definitions=l);try{return JSON.parse(JSON.stringify(o))}catch(e){throw Error("Error converting schema to JSON.")}}}function O(e,t){if(e instanceof _){let r=new w(t),a={};for(let t of e._idmap.entries()){let[e,a]=t;r.process(a)}let i={},n={registry:e,uri:t?.uri||(e=>e),defs:a};for(let a of e._idmap.entries()){let[e,s]=a;i[e]=r.emit(s,{...t,external:n})}return Object.keys(a).length>0&&(i.__shared={["draft-2020-12"===r.target?"$defs":"definitions"]:a}),{schemas:i}}let r=new w(t);return r.process(e),r.emit(e,t)}},70978:(e,t,r)=>{"use strict";r.d(t,{PH:()=>D});var a,i=r(5415),n=r(46580);r(96596);var s=r(49509);let o="11434",l=`http://127.0.0.1:${o}`;var u=Object.defineProperty,c=(e,t,r)=>t in e?u(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,d=(e,t,r)=>(c(e,"symbol"!=typeof t?t+"":t,r),r);class h extends Error{constructor(e,t){super(e),this.error=e,this.status_code=t,this.name="ResponseError",Error.captureStackTrace&&Error.captureStackTrace(this,h)}}class p{constructor(e,t,r){d(this,"abortController"),d(this,"itr"),d(this,"doneCallback"),this.abortController=e,this.itr=t,this.doneCallback=r}abort(){this.abortController.abort()}async *[Symbol.asyncIterator](){for await(let e of this.itr){if("error"in e)throw Error(e.error);if(yield e,e.done||"success"===e.status){this.doneCallback();return}}throw Error("Did not receive done or success response in stream.")}}let m=async e=>{if(e.ok)return;let t=`Error ${e.status}: ${e.statusText}`,r=null;if(e.headers.get("content-type")?.includes("application/json"))try{t=(await e.json()).error||t}catch(e){console.log("Failed to parse error response as JSON")}else try{console.log("Getting text from response"),t=await e.text()||t}catch(e){console.log("Failed to get text from error response")}throw new h(t,e.status)},f=async(e,t,r={})=>{let a={"Content-Type":"application/json",Accept:"application/json","User-Agent":`ollama-js/0.5.16 (${function(){if("undefined"!=typeof window&&window.navigator){let e=navigator;return"userAgentData"in e&&e.userAgentData?.platform?`${e.userAgentData.platform.toLowerCase()} Browser/${navigator.userAgent};`:navigator.platform?`${navigator.platform.toLowerCase()} Browser/${navigator.userAgent};`:`unknown Browser/${navigator.userAgent};`}return void 0!==s?`${s.arch} ${s.platform} Node.js/${s.version}`:""}()})`};r.headers=function(e){if(e instanceof Headers){let t={};return e.forEach((e,r)=>{t[r]=e}),t}return Array.isArray(e)?Object.fromEntries(e):e||{}}(r.headers);let i=Object.fromEntries(Object.entries(r.headers).filter(([e])=>!Object.keys(a).some(t=>t.toLowerCase()===e.toLowerCase())));return r.headers={...a,...i},e(t,r)},g=async(e,t,r)=>{let a=await f(e,t,{headers:r?.headers});return await m(a),a},y=async(e,t,r,a)=>{let i=(e=>null!==e&&"object"==typeof e&&!Array.isArray(e))(r)?JSON.stringify(r):r,n=await f(e,t,{method:"POST",body:i,signal:a?.signal,headers:a?.headers});return await m(n),n},b=async(e,t,r,a)=>{let i=await f(e,t,{method:"DELETE",body:JSON.stringify(r),headers:a?.headers});return await m(i),i},_=async function*(e){let t=new TextDecoder("utf-8"),r="",a=e.getReader();for(;;){let{done:e,value:i}=await a.read();if(e)break;let n=(r+=t.decode(i)).split("\n");for(let e of(r=n.pop()??"",n))try{yield JSON.parse(e)}catch(t){console.warn("invalid json: ",e)}}for(let e of r.split("\n").filter(e=>""!==e))try{yield JSON.parse(e)}catch(t){console.warn("invalid json: ",e)}},v=e=>{if(!e)return l;let t=e.includes("://");e.startsWith(":")&&(e=`http://127.0.0.1${e}`,t=!0),t||(e=`http://${e}`);let r=new URL(e),a=r.port;a||(a=t?"https:"===r.protocol?"443":"80":o);let i="";r.username&&(i=r.username,r.password&&(i+=`:${r.password}`),i+="@");let n=`${r.protocol}//${i}${r.hostname}:${a}${r.pathname}`;return n.endsWith("/")&&(n=n.slice(0,-1)),n};var w=Object.defineProperty,O=(e,t,r)=>t in e?w(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,I=(e,t,r)=>(O(e,"symbol"!=typeof t?t+"":t,r),r);let k=class{constructor(e){I(this,"config"),I(this,"fetch"),I(this,"ongoingStreamedRequests",[]),this.config={host:"",headers:e?.headers},e?.proxy||(this.config.host=v(e?.host??l)),this.fetch=e?.fetch??fetch}abort(){for(let e of this.ongoingStreamedRequests)e.abort();this.ongoingStreamedRequests.length=0}async processStreamableRequest(e,t){t.stream=t.stream??!1;let r=`${this.config.host}/api/${e}`;if(t.stream){let e=new AbortController,a=await y(this.fetch,r,t,{signal:e.signal,headers:this.config.headers});if(!a.body)throw Error("Missing body");let i=new p(e,_(a.body),()=>{let e=this.ongoingStreamedRequests.indexOf(i);e>-1&&this.ongoingStreamedRequests.splice(e,1)});return this.ongoingStreamedRequests.push(i),i}let a=await y(this.fetch,r,t,{headers:this.config.headers});return await a.json()}async encodeImage(e){if("string"!=typeof e){let t=new Uint8Array(e),r="",a=t.byteLength;for(let e=0;e<a;e++)r+=String.fromCharCode(t[e]);return btoa(r)}return e}async generate(e){return e.images&&(e.images=await Promise.all(e.images.map(this.encodeImage.bind(this)))),this.processStreamableRequest("generate",e)}async chat(e){if(e.messages)for(let t of e.messages)t.images&&(t.images=await Promise.all(t.images.map(this.encodeImage.bind(this))));return this.processStreamableRequest("chat",e)}async create(e){return this.processStreamableRequest("create",{...e})}async pull(e){return this.processStreamableRequest("pull",{name:e.model,stream:e.stream,insecure:e.insecure})}async push(e){return this.processStreamableRequest("push",{name:e.model,stream:e.stream,insecure:e.insecure})}async delete(e){return await b(this.fetch,`${this.config.host}/api/delete`,{name:e.model},{headers:this.config.headers}),{status:"success"}}async copy(e){return await y(this.fetch,`${this.config.host}/api/copy`,{...e},{headers:this.config.headers}),{status:"success"}}async list(){let e=await g(this.fetch,`${this.config.host}/api/tags`,{headers:this.config.headers});return await e.json()}async show(e){let t=await y(this.fetch,`${this.config.host}/api/show`,{...e},{headers:this.config.headers});return await t.json()}async embed(e){let t=await y(this.fetch,`${this.config.host}/api/embed`,{...e},{headers:this.config.headers});return await t.json()}async embeddings(e){let t=await y(this.fetch,`${this.config.host}/api/embeddings`,{...e},{headers:this.config.headers});return await t.json()}async ps(){let e=await g(this.fetch,`${this.config.host}/api/ps`,{headers:this.config.headers});return await e.json()}};new k;var E=r(43399),x=r(58775),S=r(46628),P=r(87150),A=r(4911),T=r(22441),j=r(7379);let N={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};for(var $=new Uint8Array(16),R=[],C=0;C<256;++C)R.push((C+256).toString(16).slice(1));let L=function(e,t,r){if(N.randomUUID&&!t&&!e)return N.randomUUID();var i=(e=e||{}).random||(e.rng||function(){if(!a&&!(a="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return a($)})();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t){r=r||0;for(var n=0;n<16;++n)t[r+n]=i[n];return t}return function(e,t=0){return(R[e[t+0]]+R[e[t+1]]+R[e[t+2]]+R[e[t+3]]+"-"+R[e[t+4]]+R[e[t+5]]+"-"+R[e[t+6]]+R[e[t+7]]+"-"+R[e[t+8]]+R[e[t+9]]+"-"+R[e[t+10]]+R[e[t+11]]+R[e[t+12]]+R[e[t+13]]+R[e[t+14]]+R[e[t+15]]).toLowerCase()}(i)};function U(e,t){return new i.H({content:e.content??"",tool_call_chunks:e.tool_calls?.map(e=>({name:e.function.name,args:JSON.stringify(e.function.arguments),type:"tool_call_chunk",index:0,id:L()})),response_metadata:t?.responseMetadata,usage_metadata:t?.usageMetadata})}function M(e){let t=e.match(/^data:.*?;base64,(.*)$/);return t?t[1]:""}class D extends n.xV{static lc_name(){return"ChatOllama"}constructor(e){super(e??{}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"llama3"}),Object.defineProperty(this,"numa",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"numCtx",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"numBatch",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"numGpu",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"mainGpu",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lowVram",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"f16Kv",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"logitsAll",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"vocabOnly",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"useMmap",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"useMlock",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"embeddingOnly",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"numThread",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"numKeep",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"seed",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"numPredict",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topK",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tfsZ",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"typicalP",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"repeatLastN",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"repeatPenalty",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"presencePenalty",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"frequencyPenalty",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"mirostat",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"mirostatTau",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"mirostatEta",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"penalizeNewline",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"format",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"keepAlive",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"checkOrPullModel",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"baseUrl",{enumerable:!0,configurable:!0,writable:!0,value:"http://127.0.0.1:11434"}),this.client=new k({host:e?.baseUrl,headers:e?.headers}),this.baseUrl=e?.baseUrl??this.baseUrl,this.model=e?.model??this.model,this.numa=e?.numa,this.numCtx=e?.numCtx,this.numBatch=e?.numBatch,this.numGpu=e?.numGpu,this.mainGpu=e?.mainGpu,this.lowVram=e?.lowVram,this.f16Kv=e?.f16Kv,this.logitsAll=e?.logitsAll,this.vocabOnly=e?.vocabOnly,this.useMmap=e?.useMmap,this.useMlock=e?.useMlock,this.embeddingOnly=e?.embeddingOnly,this.numThread=e?.numThread,this.numKeep=e?.numKeep,this.seed=e?.seed,this.numPredict=e?.numPredict,this.topK=e?.topK,this.topP=e?.topP,this.tfsZ=e?.tfsZ,this.typicalP=e?.typicalP,this.repeatLastN=e?.repeatLastN,this.temperature=e?.temperature,this.repeatPenalty=e?.repeatPenalty,this.presencePenalty=e?.presencePenalty,this.frequencyPenalty=e?.frequencyPenalty,this.mirostat=e?.mirostat,this.mirostatTau=e?.mirostatTau,this.mirostatEta=e?.mirostatEta,this.penalizeNewline=e?.penalizeNewline,this.streaming=e?.streaming,this.format=e?.format,this.keepAlive=e?.keepAlive,this.checkOrPullModel=e?.checkOrPullModel??this.checkOrPullModel}_llmType(){return"ollama"}async pull(e,t){let{stream:r,insecure:a,logProgress:i}={stream:!0,...t};if(r)for await(let t of(await this.client.pull({model:e,insecure:a,stream:r})))i&&console.log(t);else{let t=await this.client.pull({model:e,insecure:a});i&&console.log(t)}}bindTools(e,t){return this.withConfig({tools:e.map(e=>(0,S.fL)(e)),...t})}getLsParams(e){let t=this.invocationParams(e);return{ls_provider:"ollama",ls_model_name:this.model,ls_model_type:"chat",ls_temperature:t.options?.temperature??void 0,ls_max_tokens:t.options?.num_predict??void 0,ls_stop:e.stop}}invocationParams(e){if(e?.tool_choice)throw Error("Tool choice is not supported for ChatOllama.");return{model:this.model,format:e?.format??this.format,keep_alive:this.keepAlive,options:{numa:this.numa,num_ctx:this.numCtx,num_batch:this.numBatch,num_gpu:this.numGpu,main_gpu:this.mainGpu,low_vram:this.lowVram,f16_kv:this.f16Kv,logits_all:this.logitsAll,vocab_only:this.vocabOnly,use_mmap:this.useMmap,use_mlock:this.useMlock,embedding_only:this.embeddingOnly,num_thread:this.numThread,num_keep:this.numKeep,seed:this.seed,num_predict:this.numPredict,top_k:this.topK,top_p:this.topP,tfs_z:this.tfsZ,typical_p:this.typicalP,repeat_last_n:this.repeatLastN,temperature:this.temperature,repeat_penalty:this.repeatPenalty,presence_penalty:this.presencePenalty,frequency_penalty:this.frequencyPenalty,mirostat:this.mirostat,mirostat_tau:this.mirostatTau,mirostat_eta:this.mirostatEta,penalize_newline:this.penalizeNewline,stop:e?.stop},tools:e?.tools?.length?e.tools.map(e=>(0,S.fL)(e)):void 0}}async checkModelExistsOnMachine(e){let{models:t}=await this.client.list();return!!t.find(t=>t.name===e||t.name===`${e}:latest`)}async _generate(e,t,r){let a;for await(let i of(this.checkOrPullModel&&!await this.checkModelExistsOnMachine(this.model)&&await this.pull(this.model,{logProgress:!0}),this._streamResponseChunks(e,t,r)))a=a?(0,P.xW)(a,i.message):i.message;let n=new i.Od({id:a?.id,content:a?.content??"",tool_calls:a?.tool_calls,response_metadata:a?.response_metadata,usage_metadata:a?.usage_metadata});return{generations:[{text:"string"==typeof n.content?n.content:"",message:n}]}}async *_streamResponseChunks(e,t,r){let a;this.checkOrPullModel&&!await this.checkModelExistsOnMachine(this.model)&&await this.pull(this.model,{logProgress:!0});let n=this.invocationParams(t),s=e.flatMap(e=>{if(["human","generic"].includes(e._getType()))return"string"==typeof e.content?[{role:"user",content:e.content}]:e.content.map(e=>{if("text"===e.type)return{role:"user",content:e.text};if("image_url"===e.type){if("string"==typeof e.image_url)return{role:"user",content:"",images:[M(e.image_url)]};if(e.image_url.url&&"string"==typeof e.image_url.url)return{role:"user",content:"",images:[M(e.image_url.url)]}}throw Error(`Unsupported content type: ${e.type}`)});if("ai"===e._getType())return function(e){let t;if("string"==typeof e.content)return[{role:"assistant",content:e.content}];let r=e.content.filter(e=>"text"===e.type&&"string"==typeof e.text).map(e=>({role:"assistant",content:e.text}));if(e.content.find(e=>"tool_use"===e.type)&&e.tool_calls?.length){let r=e.tool_calls?.map(e=>({id:e.id,type:"function",function:{name:e.name,arguments:e.args}}));r&&(t={role:"assistant",tool_calls:r,content:""})}else if(e.content.find(e=>"tool_use"===e.type)&&!e.tool_calls?.length)throw Error("'tool_use' content type is not supported without tool calls.");return[...r,...t?[t]:[]]}(e);if("system"===e._getType())return function(e){if("string"==typeof e.content)return[{role:"system",content:e.content}];if(e.content.every(e=>"text"===e.type&&"string"==typeof e.text))return e.content.map(e=>({role:"system",content:e.text}));throw Error(`Unsupported content type(s): ${e.content.map(e=>e.type).join(", ")}`)}(e);if("tool"===e._getType())return function(e){if("string"!=typeof e.content)throw Error("Non string tool message content is not supported");return[{role:"tool",content:e.content}]}(e);throw Error(`Unsupported message type: ${e._getType()}`)}),o={input_tokens:0,output_tokens:0,total_tokens:0};if(n.tools&&n.tools.length>0){let{message:e,...t}=await this.client.chat({...n,messages:s,stream:!1});return o.input_tokens+=t.prompt_eval_count??0,o.output_tokens+=t.eval_count??0,o.total_tokens=o.input_tokens+o.output_tokens,yield new E.Cf({text:e.content,message:U(e,{responseMetadata:t,usageMetadata:o})}),r?.handleLLMNewToken(e.content)}for await(let e of(await this.client.chat({...n,messages:s,stream:!0}))){t.signal?.aborted&&this.client.abort();let{message:i,...n}=e;o.input_tokens+=n.prompt_eval_count??0,o.output_tokens+=n.eval_count??0,o.total_tokens=o.input_tokens+o.output_tokens,a=n,yield new E.Cf({text:i.content??"",message:U(i)}),await r?.handleLLMNewToken(i.content??"")}yield new E.Cf({text:"",message:new i.H({content:"",response_metadata:a,usage_metadata:o})})}withStructuredOutput(e,t){if(t?.method!==void 0&&t?.method!=="jsonSchema")return super.withStructuredOutput(e,t);{let r=(0,T.lm)(e),a=r?(0,j.Ik)(e):e,i=this.bindTools([{type:"function",function:{name:"extract",description:a.description,parameters:a}}]).withConfig({format:"json"}),n=r?A._6.fromZodSchema(e):new A.hU;if(!t?.includeRaw)return i.pipe(n);let s=x.kI.assign({parsed:(e,t)=>n.invoke(e.raw,t)}),o=x.kI.assign({parsed:()=>null}),l=s.withFallbacks({fallbacks:[o]});return x.zZ.from([{raw:i},l])}}}r(72257).J,r(21563).I},71150:(e,t,r)=>{"use strict";r.d(t,{Od:()=>a.Od,H:()=>a.H,XQ:()=>i.XQ,cM:()=>n.cM,XU:()=>n.XU,FK:()=>s.FK,xc:()=>o.xc,a7:()=>o.a7,tn:()=>l.tn,uU:()=>l.uU,dr:()=>d.dr,K0:()=>u.K0,Vi:()=>b.Vi,up:()=>b.up,Sw:()=>u.Sw,KX:()=>a.KX,jm:()=>a.jm,cJ:()=>b.cJ,ny:()=>i.ny,Fz:()=>b.Fz,W:()=>b.W,Q7:()=>b.Q7,Ej:()=>b.Ej});var a=r(41039),i=r(64520),n=r(71151),s=r(76937),o=r(62886),l=r(91356),u=r(90338);r(99643);class c extends i.XQ{constructor(e){super({...e,content:""}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.id=e.id}_getType(){return"remove"}get _printableFields(){return{...super._printableFields,id:this.id}}}var d=r(27231);let h=(e,t)=>{let r=[...new Set(t?.map(e=>{if("string"==typeof e)return e;let t=new e({});if(!("getType"in t)||"function"!=typeof t.getType)throw Error("Invalid type provided.");return t.getType()}))],a=e.getType();return r.some(e=>e===a)};async function p(e,t){let{maxTokens:r,tokenCounter:a,textSplitter:i,partialStrategy:n,endOn:s}=t,o=[...e],l=0;for(let e=0;e<o.length;e+=1){let t=e>0?o.slice(0,-e):o;if(await a(t)<=r){l=o.length-e;break}}if(l<o.length-1&&n){let e=!1;if(Array.isArray(o[l].content)){let t=o[l];if("string"==typeof t.content)throw Error("Expected content to be an array.");let i=t.content.length,s="last"===n?[...t.content].reverse():t.content;for(let u=1;u<=i;u+=1){let i="first"===n?s.slice(0,u):s.slice(-u),c=Object.fromEntries(Object.entries(t).filter(([e])=>"type"!==e&&!e.startsWith("lc_"))),d=g(t.getType(),{...c,content:i}),h=[...o.slice(0,l),d];if(await a(h)<=r)o=h,l+=1,e=!0;else break}e&&"last"===n&&(t.content=[...s].reverse())}if(!e){let e;let t=o[l];if(Array.isArray(t.content)&&t.content.some(e=>"string"==typeof e||"text"===e.type)){let r=t.content.find(e=>"text"===e.type&&e.text);e=r?.text}else"string"==typeof t.content&&(e=t.content);if(e){let s=await i(e),u=s.length;"last"===n&&s.reverse();for(let e=0;e<u-1;e+=1)if(s.pop(),t.content=s.join(""),await a([...o.slice(0,l),t])<=r){"last"===n&&(t.content=[...s].reverse().join("")),o=[...o.slice(0,l),t],l+=1;break}}}}if(s){let e=Array.isArray(s)?s:[s];for(;l>0&&!h(o[l-1],e);)l-=1}return o.slice(0,l)}async function m(e,t){let{allowPartial:r=!1,includeSystem:a=!1,endOn:i,startOn:n,...s}=t,o=e.map(e=>{let t=Object.fromEntries(Object.entries(e).filter(([e])=>"type"!==e&&!e.startsWith("lc_")));return g(e.getType(),t,isBaseMessageChunk(e))});if(i){let e=Array.isArray(i)?i:[i];for(;o.length>0&&!h(o[o.length-1],e);)o=o.slice(0,-1)}let l=a&&o[0]?.getType()==="system",u=l?o.slice(0,1).concat(o.slice(1).reverse()):o.reverse();return(u=await p(u,{...s,partialStrategy:r?"last":void 0,endOn:n}),l)?[u[0],...u.slice(1).reverse()]:u.reverse()}let f={human:{message:o.xc,messageChunk:o.a7},ai:{message:a.Od,messageChunk:a.H},system:{message:l.tn,messageChunk:l.uU},developer:{message:l.tn,messageChunk:l.uU},tool:{message:d.uf,messageChunk:d.dr},function:{message:s.mg,messageChunk:s.FK},generic:{message:n.cM,messageChunk:n.XU},remove:{message:c,messageChunk:c}};function g(e,t,r){let a,i;switch(e){case"human":r?a=new HumanMessageChunk(t):i=new HumanMessage(t);break;case"ai":if(r){let e={...t};"tool_calls"in e&&(e={...e,tool_call_chunks:e.tool_calls?.map(e=>({...e,type:"tool_call_chunk",index:void 0,args:JSON.stringify(e.args)}))}),a=new AIMessageChunk(e)}else i=new AIMessage(t);break;case"system":r?a=new SystemMessageChunk(t):i=new SystemMessage(t);break;case"developer":r?a=new SystemMessageChunk({...t,additional_kwargs:{...t.additional_kwargs,__openai_role__:"developer"}}):i=new SystemMessage({...t,additional_kwargs:{...t.additional_kwargs,__openai_role__:"developer"}});break;case"tool":if("tool_call_id"in t)r?a=new ToolMessageChunk(t):i=new ToolMessage(t);else throw Error("Can not convert ToolMessage to ToolMessageChunk if 'tool_call_id' field is not defined.");break;case"function":if(r)a=new FunctionMessageChunk(t);else{if(!t.name)throw Error("FunctionMessage must have a 'name' field");i=new FunctionMessage(t)}break;case"generic":if("role"in t)r?a=new ChatMessageChunk(t):i=new ChatMessage(t);else throw Error("Can not convert ChatMessage to ChatMessageChunk if 'role' field is not defined.");break;default:throw Error(`Unrecognized message type ${e}`)}if(r&&a)return a;if(i)return i;throw Error(`Unrecognized message type ${e}`)}function y(e){let t=e.split("\n");return Promise.resolve([...t.slice(0,-1).map(e=>`${e}
`),t[t.length-1]])}var b=r(55949)},71151:(e,t,r)=>{"use strict";r.d(t,{XU:()=>n,cM:()=>i});var a=r(64520);class i extends a.XQ{static lc_name(){return"ChatMessage"}static _chatMessageClass(){return i}constructor(e,t){"string"==typeof e&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}static isInstance(e){return"generic"===e._getType()}get _printableFields(){return{...super._printableFields,role:this.role}}}class n extends a.gj{static lc_name(){return"ChatMessageChunk"}constructor(e,t){"string"==typeof e&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}concat(e){return new n({content:(0,a._I)(this.content,e.content),additional_kwargs:(0,a.ns)(this.additional_kwargs,e.additional_kwargs),response_metadata:(0,a.ns)(this.response_metadata,e.response_metadata),role:this.role,id:this.id??e.id})}get _printableFields(){return{...super._printableFields,role:this.role}}}},71153:(e,t,r)=>{"use strict";let a;r.d(t,{kY:()=>o,Ii:()=>eS,z:()=>l});var i,n,s,o,l={};r.r(l),r.d(l,{BRAND:()=>eN,DIRTY:()=>I,EMPTY_PATH:()=>_,INVALID:()=>O,NEVER:()=>tm,OK:()=>k,ParseStatus:()=>w,Schema:()=>N,ZodAny:()=>en,ZodArray:()=>eu,ZodBigInt:()=>Q,ZodBoolean:()=>ee,ZodBranded:()=>e$,ZodCatch:()=>eT,ZodDate:()=>et,ZodDefault:()=>eA,ZodDiscriminatedUnion:()=>ep,ZodEffects:()=>ex,ZodEnum:()=>eI,ZodError:()=>p,ZodFirstPartyTypeKind:()=>o,ZodFunction:()=>e_,ZodIntersection:()=>em,ZodIssueCode:()=>d,ZodLazy:()=>ev,ZodLiteral:()=>ew,ZodMap:()=>ey,ZodNaN:()=>ej,ZodNativeEnum:()=>ek,ZodNever:()=>eo,ZodNull:()=>ei,ZodNullable:()=>eP,ZodNumber:()=>X,ZodObject:()=>ec,ZodOptional:()=>eS,ZodParsedType:()=>u,ZodPipeline:()=>eR,ZodPromise:()=>eE,ZodReadonly:()=>eC,ZodRecord:()=>eg,ZodSchema:()=>N,ZodSet:()=>eb,ZodString:()=>K,ZodSymbol:()=>er,ZodTransformer:()=>ex,ZodTuple:()=>ef,ZodType:()=>N,ZodUndefined:()=>ea,ZodUnion:()=>ed,ZodUnknown:()=>es,ZodVoid:()=>el,addIssueToContext:()=>v,any:()=>eY,array:()=>eQ,bigint:()=>eZ,boolean:()=>eJ,coerce:()=>tp,custom:()=>eU,date:()=>eq,datetimeRegex:()=>V,defaultErrorMap:()=>m,discriminatedUnion:()=>e2,effect:()=>tn,enum:()=>tr,function:()=>e7,getErrorMap:()=>y,getParsedType:()=>c,instanceof:()=>eD,intersection:()=>e6,isAborted:()=>E,isAsync:()=>P,isDirty:()=>x,isValid:()=>S,late:()=>eM,lazy:()=>te,literal:()=>tt,makeIssue:()=>b,map:()=>e5,nan:()=>eB,nativeEnum:()=>ta,never:()=>eK,null:()=>eH,nullable:()=>to,number:()=>ez,object:()=>e0,objectUtil:()=>n,oboolean:()=>th,onumber:()=>td,optional:()=>ts,ostring:()=>tc,pipeline:()=>tu,preprocess:()=>tl,promise:()=>ti,quotelessJson:()=>h,record:()=>e3,set:()=>e8,setErrorMap:()=>g,strictObject:()=>e1,string:()=>eF,symbol:()=>eG,transformer:()=>tn,tuple:()=>e9,undefined:()=>eW,union:()=>e4,unknown:()=>eV,util:()=>i,void:()=>eX}),function(e){e.assertEqual=e=>{},e.assertIs=function(e){},e.assertNever=function(e){throw Error()},e.arrayToEnum=e=>{let t={};for(let r of e)t[r]=r;return t},e.getValidEnumValues=t=>{let r=e.objectKeys(t).filter(e=>"number"!=typeof t[t[e]]),a={};for(let e of r)a[e]=t[e];return e.objectValues(a)},e.objectValues=t=>e.objectKeys(t).map(function(e){return t[e]}),e.objectKeys="function"==typeof Object.keys?e=>Object.keys(e):e=>{let t=[];for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return t},e.find=(e,t)=>{for(let r of e)if(t(r))return r},e.isInteger="function"==typeof Number.isInteger?e=>Number.isInteger(e):e=>"number"==typeof e&&Number.isFinite(e)&&Math.floor(e)===e,e.joinValues=function(e,t=" | "){return e.map(e=>"string"==typeof e?`'${e}'`:e).join(t)},e.jsonStringifyReplacer=(e,t)=>"bigint"==typeof t?t.toString():t}(i||(i={})),(n||(n={})).mergeShapes=(e,t)=>({...e,...t});let u=i.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),c=e=>{switch(typeof e){case"undefined":return u.undefined;case"string":return u.string;case"number":return Number.isNaN(e)?u.nan:u.number;case"boolean":return u.boolean;case"function":return u.function;case"bigint":return u.bigint;case"symbol":return u.symbol;case"object":if(Array.isArray(e))return u.array;if(null===e)return u.null;if(e.then&&"function"==typeof e.then&&e.catch&&"function"==typeof e.catch)return u.promise;if("undefined"!=typeof Map&&e instanceof Map)return u.map;if("undefined"!=typeof Set&&e instanceof Set)return u.set;if("undefined"!=typeof Date&&e instanceof Date)return u.date;return u.object;default:return u.unknown}},d=i.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),h=e=>JSON.stringify(e,null,2).replace(/"([^"]+)":/g,"$1:");class p extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};let t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){let t=e||function(e){return e.message},r={_errors:[]},a=e=>{for(let i of e.issues)if("invalid_union"===i.code)i.unionErrors.map(a);else if("invalid_return_type"===i.code)a(i.returnTypeError);else if("invalid_arguments"===i.code)a(i.argumentsError);else if(0===i.path.length)r._errors.push(t(i));else{let e=r,a=0;for(;a<i.path.length;){let r=i.path[a];a===i.path.length-1?(e[r]=e[r]||{_errors:[]},e[r]._errors.push(t(i))):e[r]=e[r]||{_errors:[]},e=e[r],a++}}};return a(this),r}static assert(e){if(!(e instanceof p))throw Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,i.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(e=e=>e.message){let t={},r=[];for(let a of this.issues)a.path.length>0?(t[a.path[0]]=t[a.path[0]]||[],t[a.path[0]].push(e(a))):r.push(e(a));return{formErrors:r,fieldErrors:t}}get formErrors(){return this.flatten()}}p.create=e=>new p(e);let m=(e,t)=>{let r;switch(e.code){case d.invalid_type:r=e.received===u.undefined?"Required":`Expected ${e.expected}, received ${e.received}`;break;case d.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(e.expected,i.jsonStringifyReplacer)}`;break;case d.unrecognized_keys:r=`Unrecognized key(s) in object: ${i.joinValues(e.keys,", ")}`;break;case d.invalid_union:r="Invalid input";break;case d.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${i.joinValues(e.options)}`;break;case d.invalid_enum_value:r=`Invalid enum value. Expected ${i.joinValues(e.options)}, received '${e.received}'`;break;case d.invalid_arguments:r="Invalid function arguments";break;case d.invalid_return_type:r="Invalid function return type";break;case d.invalid_date:r="Invalid date";break;case d.invalid_string:"object"==typeof e.validation?"includes"in e.validation?(r=`Invalid input: must include "${e.validation.includes}"`,"number"==typeof e.validation.position&&(r=`${r} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?r=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?r=`Invalid input: must end with "${e.validation.endsWith}"`:i.assertNever(e.validation):r="regex"!==e.validation?`Invalid ${e.validation}`:"Invalid";break;case d.too_small:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:"date"===e.type?`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:"Invalid input";break;case d.too_big:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"bigint"===e.type?`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"date"===e.type?`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:"Invalid input";break;case d.custom:r="Invalid input";break;case d.invalid_intersection_types:r="Intersection results could not be merged";break;case d.not_multiple_of:r=`Number must be a multiple of ${e.multipleOf}`;break;case d.not_finite:r="Number must be finite";break;default:r=t.defaultError,i.assertNever(e)}return{message:r}},f=m;function g(e){f=e}function y(){return f}let b=e=>{let{data:t,path:r,errorMaps:a,issueData:i}=e,n=[...r,...i.path||[]],s={...i,path:n};if(void 0!==i.message)return{...i,path:n,message:i.message};let o="";for(let e of a.filter(e=>!!e).slice().reverse())o=e(s,{data:t,defaultError:o}).message;return{...i,path:n,message:o}},_=[];function v(e,t){let r=f,a=b({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,r,r===m?void 0:m].filter(e=>!!e)});e.common.issues.push(a)}class w{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(e,t){let r=[];for(let a of t){if("aborted"===a.status)return O;"dirty"===a.status&&e.dirty(),r.push(a.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,t){let r=[];for(let e of t){let t=await e.key,a=await e.value;r.push({key:t,value:a})}return w.mergeObjectSync(e,r)}static mergeObjectSync(e,t){let r={};for(let a of t){let{key:t,value:i}=a;if("aborted"===t.status||"aborted"===i.status)return O;"dirty"===t.status&&e.dirty(),"dirty"===i.status&&e.dirty(),"__proto__"!==t.value&&(void 0!==i.value||a.alwaysSet)&&(r[t.value]=i.value)}return{status:e.value,value:r}}}let O=Object.freeze({status:"aborted"}),I=e=>({status:"dirty",value:e}),k=e=>({status:"valid",value:e}),E=e=>"aborted"===e.status,x=e=>"dirty"===e.status,S=e=>"valid"===e.status,P=e=>"undefined"!=typeof Promise&&e instanceof Promise;!function(e){e.errToObj=e=>"string"==typeof e?{message:e}:e||{},e.toString=e=>"string"==typeof e?e:e?.message}(s||(s={}));class A{constructor(e,t,r,a){this._cachedPath=[],this.parent=e,this.data=t,this._path=r,this._key=a}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}let T=(e,t)=>{if(S(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let t=new p(e.common.issues);return this._error=t,this._error}}};function j(e){if(!e)return{};let{errorMap:t,invalid_type_error:r,required_error:a,description:i}=e;if(t&&(r||a))throw Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');return t?{errorMap:t,description:i}:{errorMap:(t,i)=>{let{message:n}=e;return"invalid_enum_value"===t.code?{message:n??i.defaultError}:void 0===i.data?{message:n??a??i.defaultError}:"invalid_type"!==t.code?{message:i.defaultError}:{message:n??r??i.defaultError}},description:i}}class N{get description(){return this._def.description}_getType(e){return c(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:c(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new w,ctx:{common:e.parent.common,data:e.data,parsedType:c(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let t=this._parse(e);if(P(t))throw Error("Synchronous parse encountered promise.");return t}_parseAsync(e){return Promise.resolve(this._parse(e))}parse(e,t){let r=this.safeParse(e,t);if(r.success)return r.data;throw r.error}safeParse(e,t){let r={common:{issues:[],async:t?.async??!1,contextualErrorMap:t?.errorMap},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:c(e)},a=this._parseSync({data:e,path:r.path,parent:r});return T(r,a)}"~validate"(e){let t={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:c(e)};if(!this["~standard"].async)try{let r=this._parseSync({data:e,path:[],parent:t});return S(r)?{value:r.value}:{issues:t.common.issues}}catch(e){e?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),t.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:t}).then(e=>S(e)?{value:e.value}:{issues:t.common.issues})}async parseAsync(e,t){let r=await this.safeParseAsync(e,t);if(r.success)return r.data;throw r.error}async safeParseAsync(e,t){let r={common:{issues:[],contextualErrorMap:t?.errorMap,async:!0},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:c(e)},a=this._parse({data:e,path:r.path,parent:r});return T(r,await (P(a)?a:Promise.resolve(a)))}refine(e,t){let r=e=>"string"==typeof t||void 0===t?{message:t}:"function"==typeof t?t(e):t;return this._refinement((t,a)=>{let i=e(t),n=()=>a.addIssue({code:d.custom,...r(t)});return"undefined"!=typeof Promise&&i instanceof Promise?i.then(e=>!!e||(n(),!1)):!!i||(n(),!1)})}refinement(e,t){return this._refinement((r,a)=>!!e(r)||(a.addIssue("function"==typeof t?t(r,a):t),!1))}_refinement(e){return new ex({schema:this,typeName:o.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:e=>this["~validate"](e)}}optional(){return eS.create(this,this._def)}nullable(){return eP.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return eu.create(this)}promise(){return eE.create(this,this._def)}or(e){return ed.create([this,e],this._def)}and(e){return em.create(this,e,this._def)}transform(e){return new ex({...j(this._def),schema:this,typeName:o.ZodEffects,effect:{type:"transform",transform:e}})}default(e){return new eA({...j(this._def),innerType:this,defaultValue:"function"==typeof e?e:()=>e,typeName:o.ZodDefault})}brand(){return new e$({typeName:o.ZodBranded,type:this,...j(this._def)})}catch(e){return new eT({...j(this._def),innerType:this,catchValue:"function"==typeof e?e:()=>e,typeName:o.ZodCatch})}describe(e){return new this.constructor({...this._def,description:e})}pipe(e){return eR.create(this,e)}readonly(){return eC.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}let $=/^c[^\s-]{8,}$/i,R=/^[0-9a-z]+$/,C=/^[0-9A-HJKMNP-TV-Z]{26}$/i,L=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,U=/^[a-z0-9_-]{21}$/i,M=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,D=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,F=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,z=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,B=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,Z=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,J=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,q=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,G=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,W="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",H=RegExp(`^${W}$`);function Y(e){let t="[0-5]\\d";e.precision?t=`${t}\\.\\d{${e.precision}}`:null==e.precision&&(t=`${t}(\\.\\d+)?`);let r=e.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${t})${r}`}function V(e){let t=`${W}T${Y(e)}`,r=[];return r.push(e.local?"Z?":"Z"),e.offset&&r.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${r.join("|")})`,RegExp(`^${t}$`)}class K extends N{_parse(e){var t,r,n,s;let o;if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==u.string){let t=this._getOrReturnCtx(e);return v(t,{code:d.invalid_type,expected:u.string,received:t.parsedType}),O}let l=new w;for(let u of this._def.checks)if("min"===u.kind)e.data.length<u.value&&(v(o=this._getOrReturnCtx(e,o),{code:d.too_small,minimum:u.value,type:"string",inclusive:!0,exact:!1,message:u.message}),l.dirty());else if("max"===u.kind)e.data.length>u.value&&(v(o=this._getOrReturnCtx(e,o),{code:d.too_big,maximum:u.value,type:"string",inclusive:!0,exact:!1,message:u.message}),l.dirty());else if("length"===u.kind){let t=e.data.length>u.value,r=e.data.length<u.value;(t||r)&&(o=this._getOrReturnCtx(e,o),t?v(o,{code:d.too_big,maximum:u.value,type:"string",inclusive:!0,exact:!0,message:u.message}):r&&v(o,{code:d.too_small,minimum:u.value,type:"string",inclusive:!0,exact:!0,message:u.message}),l.dirty())}else if("email"===u.kind)F.test(e.data)||(v(o=this._getOrReturnCtx(e,o),{validation:"email",code:d.invalid_string,message:u.message}),l.dirty());else if("emoji"===u.kind)a||(a=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),a.test(e.data)||(v(o=this._getOrReturnCtx(e,o),{validation:"emoji",code:d.invalid_string,message:u.message}),l.dirty());else if("uuid"===u.kind)L.test(e.data)||(v(o=this._getOrReturnCtx(e,o),{validation:"uuid",code:d.invalid_string,message:u.message}),l.dirty());else if("nanoid"===u.kind)U.test(e.data)||(v(o=this._getOrReturnCtx(e,o),{validation:"nanoid",code:d.invalid_string,message:u.message}),l.dirty());else if("cuid"===u.kind)$.test(e.data)||(v(o=this._getOrReturnCtx(e,o),{validation:"cuid",code:d.invalid_string,message:u.message}),l.dirty());else if("cuid2"===u.kind)R.test(e.data)||(v(o=this._getOrReturnCtx(e,o),{validation:"cuid2",code:d.invalid_string,message:u.message}),l.dirty());else if("ulid"===u.kind)C.test(e.data)||(v(o=this._getOrReturnCtx(e,o),{validation:"ulid",code:d.invalid_string,message:u.message}),l.dirty());else if("url"===u.kind)try{new URL(e.data)}catch{v(o=this._getOrReturnCtx(e,o),{validation:"url",code:d.invalid_string,message:u.message}),l.dirty()}else"regex"===u.kind?(u.regex.lastIndex=0,u.regex.test(e.data)||(v(o=this._getOrReturnCtx(e,o),{validation:"regex",code:d.invalid_string,message:u.message}),l.dirty())):"trim"===u.kind?e.data=e.data.trim():"includes"===u.kind?e.data.includes(u.value,u.position)||(v(o=this._getOrReturnCtx(e,o),{code:d.invalid_string,validation:{includes:u.value,position:u.position},message:u.message}),l.dirty()):"toLowerCase"===u.kind?e.data=e.data.toLowerCase():"toUpperCase"===u.kind?e.data=e.data.toUpperCase():"startsWith"===u.kind?e.data.startsWith(u.value)||(v(o=this._getOrReturnCtx(e,o),{code:d.invalid_string,validation:{startsWith:u.value},message:u.message}),l.dirty()):"endsWith"===u.kind?e.data.endsWith(u.value)||(v(o=this._getOrReturnCtx(e,o),{code:d.invalid_string,validation:{endsWith:u.value},message:u.message}),l.dirty()):"datetime"===u.kind?V(u).test(e.data)||(v(o=this._getOrReturnCtx(e,o),{code:d.invalid_string,validation:"datetime",message:u.message}),l.dirty()):"date"===u.kind?H.test(e.data)||(v(o=this._getOrReturnCtx(e,o),{code:d.invalid_string,validation:"date",message:u.message}),l.dirty()):"time"===u.kind?RegExp(`^${Y(u)}$`).test(e.data)||(v(o=this._getOrReturnCtx(e,o),{code:d.invalid_string,validation:"time",message:u.message}),l.dirty()):"duration"===u.kind?D.test(e.data)||(v(o=this._getOrReturnCtx(e,o),{validation:"duration",code:d.invalid_string,message:u.message}),l.dirty()):"ip"===u.kind?(t=e.data,!(("v4"===(r=u.version)||!r)&&z.test(t)||("v6"===r||!r)&&Z.test(t))&&(v(o=this._getOrReturnCtx(e,o),{validation:"ip",code:d.invalid_string,message:u.message}),l.dirty())):"jwt"===u.kind?!function(e,t){if(!M.test(e))return!1;try{let[r]=e.split("."),a=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),i=JSON.parse(atob(a));if("object"!=typeof i||null===i||"typ"in i&&i?.typ!=="JWT"||!i.alg||t&&i.alg!==t)return!1;return!0}catch{return!1}}(e.data,u.alg)&&(v(o=this._getOrReturnCtx(e,o),{validation:"jwt",code:d.invalid_string,message:u.message}),l.dirty()):"cidr"===u.kind?(n=e.data,!(("v4"===(s=u.version)||!s)&&B.test(n)||("v6"===s||!s)&&J.test(n))&&(v(o=this._getOrReturnCtx(e,o),{validation:"cidr",code:d.invalid_string,message:u.message}),l.dirty())):"base64"===u.kind?q.test(e.data)||(v(o=this._getOrReturnCtx(e,o),{validation:"base64",code:d.invalid_string,message:u.message}),l.dirty()):"base64url"===u.kind?G.test(e.data)||(v(o=this._getOrReturnCtx(e,o),{validation:"base64url",code:d.invalid_string,message:u.message}),l.dirty()):i.assertNever(u);return{status:l.value,value:e.data}}_regex(e,t,r){return this.refinement(t=>e.test(t),{validation:t,code:d.invalid_string,...s.errToObj(r)})}_addCheck(e){return new K({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...s.errToObj(e)})}url(e){return this._addCheck({kind:"url",...s.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...s.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...s.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...s.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...s.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...s.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...s.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...s.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...s.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...s.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...s.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...s.errToObj(e)})}datetime(e){return"string"==typeof e?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:void 0===e?.precision?null:e?.precision,offset:e?.offset??!1,local:e?.local??!1,...s.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return"string"==typeof e?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:void 0===e?.precision?null:e?.precision,...s.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...s.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...s.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t?.position,...s.errToObj(t?.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...s.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...s.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...s.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...s.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...s.errToObj(t)})}nonempty(e){return this.min(1,s.errToObj(e))}trim(){return new K({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new K({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new K({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>"datetime"===e.kind)}get isDate(){return!!this._def.checks.find(e=>"date"===e.kind)}get isTime(){return!!this._def.checks.find(e=>"time"===e.kind)}get isDuration(){return!!this._def.checks.find(e=>"duration"===e.kind)}get isEmail(){return!!this._def.checks.find(e=>"email"===e.kind)}get isURL(){return!!this._def.checks.find(e=>"url"===e.kind)}get isEmoji(){return!!this._def.checks.find(e=>"emoji"===e.kind)}get isUUID(){return!!this._def.checks.find(e=>"uuid"===e.kind)}get isNANOID(){return!!this._def.checks.find(e=>"nanoid"===e.kind)}get isCUID(){return!!this._def.checks.find(e=>"cuid"===e.kind)}get isCUID2(){return!!this._def.checks.find(e=>"cuid2"===e.kind)}get isULID(){return!!this._def.checks.find(e=>"ulid"===e.kind)}get isIP(){return!!this._def.checks.find(e=>"ip"===e.kind)}get isCIDR(){return!!this._def.checks.find(e=>"cidr"===e.kind)}get isBase64(){return!!this._def.checks.find(e=>"base64"===e.kind)}get isBase64url(){return!!this._def.checks.find(e=>"base64url"===e.kind)}get minLength(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}K.create=e=>new K({checks:[],typeName:o.ZodString,coerce:e?.coerce??!1,...j(e)});class X extends N{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){let t;if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==u.number){let t=this._getOrReturnCtx(e);return v(t,{code:d.invalid_type,expected:u.number,received:t.parsedType}),O}let r=new w;for(let a of this._def.checks)"int"===a.kind?i.isInteger(e.data)||(v(t=this._getOrReturnCtx(e,t),{code:d.invalid_type,expected:"integer",received:"float",message:a.message}),r.dirty()):"min"===a.kind?(a.inclusive?e.data<a.value:e.data<=a.value)&&(v(t=this._getOrReturnCtx(e,t),{code:d.too_small,minimum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),r.dirty()):"max"===a.kind?(a.inclusive?e.data>a.value:e.data>=a.value)&&(v(t=this._getOrReturnCtx(e,t),{code:d.too_big,maximum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),r.dirty()):"multipleOf"===a.kind?0!==function(e,t){let r=(e.toString().split(".")[1]||"").length,a=(t.toString().split(".")[1]||"").length,i=r>a?r:a;return Number.parseInt(e.toFixed(i).replace(".",""))%Number.parseInt(t.toFixed(i).replace(".",""))/10**i}(e.data,a.value)&&(v(t=this._getOrReturnCtx(e,t),{code:d.not_multiple_of,multipleOf:a.value,message:a.message}),r.dirty()):"finite"===a.kind?Number.isFinite(e.data)||(v(t=this._getOrReturnCtx(e,t),{code:d.not_finite,message:a.message}),r.dirty()):i.assertNever(a);return{status:r.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,s.toString(t))}gt(e,t){return this.setLimit("min",e,!1,s.toString(t))}lte(e,t){return this.setLimit("max",e,!0,s.toString(t))}lt(e,t){return this.setLimit("max",e,!1,s.toString(t))}setLimit(e,t,r,a){return new X({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:s.toString(a)}]})}_addCheck(e){return new X({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:s.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:s.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:s.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:s.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:s.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:s.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:s.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:s.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:s.toString(e)})}get minValue(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>"int"===e.kind||"multipleOf"===e.kind&&i.isInteger(e.value))}get isFinite(){let e=null,t=null;for(let r of this._def.checks){if("finite"===r.kind||"int"===r.kind||"multipleOf"===r.kind)return!0;"min"===r.kind?(null===t||r.value>t)&&(t=r.value):"max"===r.kind&&(null===e||r.value<e)&&(e=r.value)}return Number.isFinite(t)&&Number.isFinite(e)}}X.create=e=>new X({checks:[],typeName:o.ZodNumber,coerce:e?.coerce||!1,...j(e)});class Q extends N{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){let t;if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==u.bigint)return this._getInvalidInput(e);let r=new w;for(let a of this._def.checks)"min"===a.kind?(a.inclusive?e.data<a.value:e.data<=a.value)&&(v(t=this._getOrReturnCtx(e,t),{code:d.too_small,type:"bigint",minimum:a.value,inclusive:a.inclusive,message:a.message}),r.dirty()):"max"===a.kind?(a.inclusive?e.data>a.value:e.data>=a.value)&&(v(t=this._getOrReturnCtx(e,t),{code:d.too_big,type:"bigint",maximum:a.value,inclusive:a.inclusive,message:a.message}),r.dirty()):"multipleOf"===a.kind?e.data%a.value!==BigInt(0)&&(v(t=this._getOrReturnCtx(e,t),{code:d.not_multiple_of,multipleOf:a.value,message:a.message}),r.dirty()):i.assertNever(a);return{status:r.value,value:e.data}}_getInvalidInput(e){let t=this._getOrReturnCtx(e);return v(t,{code:d.invalid_type,expected:u.bigint,received:t.parsedType}),O}gte(e,t){return this.setLimit("min",e,!0,s.toString(t))}gt(e,t){return this.setLimit("min",e,!1,s.toString(t))}lte(e,t){return this.setLimit("max",e,!0,s.toString(t))}lt(e,t){return this.setLimit("max",e,!1,s.toString(t))}setLimit(e,t,r,a){return new Q({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:s.toString(a)}]})}_addCheck(e){return new Q({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:s.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:s.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:s.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:s.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:s.toString(t)})}get minValue(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}Q.create=e=>new Q({checks:[],typeName:o.ZodBigInt,coerce:e?.coerce??!1,...j(e)});class ee extends N{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==u.boolean){let t=this._getOrReturnCtx(e);return v(t,{code:d.invalid_type,expected:u.boolean,received:t.parsedType}),O}return k(e.data)}}ee.create=e=>new ee({typeName:o.ZodBoolean,coerce:e?.coerce||!1,...j(e)});class et extends N{_parse(e){let t;if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==u.date){let t=this._getOrReturnCtx(e);return v(t,{code:d.invalid_type,expected:u.date,received:t.parsedType}),O}if(Number.isNaN(e.data.getTime()))return v(this._getOrReturnCtx(e),{code:d.invalid_date}),O;let r=new w;for(let a of this._def.checks)"min"===a.kind?e.data.getTime()<a.value&&(v(t=this._getOrReturnCtx(e,t),{code:d.too_small,message:a.message,inclusive:!0,exact:!1,minimum:a.value,type:"date"}),r.dirty()):"max"===a.kind?e.data.getTime()>a.value&&(v(t=this._getOrReturnCtx(e,t),{code:d.too_big,message:a.message,inclusive:!0,exact:!1,maximum:a.value,type:"date"}),r.dirty()):i.assertNever(a);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new et({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:s.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:s.toString(t)})}get minDate(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return null!=e?new Date(e):null}get maxDate(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return null!=e?new Date(e):null}}et.create=e=>new et({checks:[],coerce:e?.coerce||!1,typeName:o.ZodDate,...j(e)});class er extends N{_parse(e){if(this._getType(e)!==u.symbol){let t=this._getOrReturnCtx(e);return v(t,{code:d.invalid_type,expected:u.symbol,received:t.parsedType}),O}return k(e.data)}}er.create=e=>new er({typeName:o.ZodSymbol,...j(e)});class ea extends N{_parse(e){if(this._getType(e)!==u.undefined){let t=this._getOrReturnCtx(e);return v(t,{code:d.invalid_type,expected:u.undefined,received:t.parsedType}),O}return k(e.data)}}ea.create=e=>new ea({typeName:o.ZodUndefined,...j(e)});class ei extends N{_parse(e){if(this._getType(e)!==u.null){let t=this._getOrReturnCtx(e);return v(t,{code:d.invalid_type,expected:u.null,received:t.parsedType}),O}return k(e.data)}}ei.create=e=>new ei({typeName:o.ZodNull,...j(e)});class en extends N{constructor(){super(...arguments),this._any=!0}_parse(e){return k(e.data)}}en.create=e=>new en({typeName:o.ZodAny,...j(e)});class es extends N{constructor(){super(...arguments),this._unknown=!0}_parse(e){return k(e.data)}}es.create=e=>new es({typeName:o.ZodUnknown,...j(e)});class eo extends N{_parse(e){let t=this._getOrReturnCtx(e);return v(t,{code:d.invalid_type,expected:u.never,received:t.parsedType}),O}}eo.create=e=>new eo({typeName:o.ZodNever,...j(e)});class el extends N{_parse(e){if(this._getType(e)!==u.undefined){let t=this._getOrReturnCtx(e);return v(t,{code:d.invalid_type,expected:u.void,received:t.parsedType}),O}return k(e.data)}}el.create=e=>new el({typeName:o.ZodVoid,...j(e)});class eu extends N{_parse(e){let{ctx:t,status:r}=this._processInputParams(e),a=this._def;if(t.parsedType!==u.array)return v(t,{code:d.invalid_type,expected:u.array,received:t.parsedType}),O;if(null!==a.exactLength){let e=t.data.length>a.exactLength.value,i=t.data.length<a.exactLength.value;(e||i)&&(v(t,{code:e?d.too_big:d.too_small,minimum:i?a.exactLength.value:void 0,maximum:e?a.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:a.exactLength.message}),r.dirty())}if(null!==a.minLength&&t.data.length<a.minLength.value&&(v(t,{code:d.too_small,minimum:a.minLength.value,type:"array",inclusive:!0,exact:!1,message:a.minLength.message}),r.dirty()),null!==a.maxLength&&t.data.length>a.maxLength.value&&(v(t,{code:d.too_big,maximum:a.maxLength.value,type:"array",inclusive:!0,exact:!1,message:a.maxLength.message}),r.dirty()),t.common.async)return Promise.all([...t.data].map((e,r)=>a.type._parseAsync(new A(t,e,t.path,r)))).then(e=>w.mergeArray(r,e));let i=[...t.data].map((e,r)=>a.type._parseSync(new A(t,e,t.path,r)));return w.mergeArray(r,i)}get element(){return this._def.type}min(e,t){return new eu({...this._def,minLength:{value:e,message:s.toString(t)}})}max(e,t){return new eu({...this._def,maxLength:{value:e,message:s.toString(t)}})}length(e,t){return new eu({...this._def,exactLength:{value:e,message:s.toString(t)}})}nonempty(e){return this.min(1,e)}}eu.create=(e,t)=>new eu({type:e,minLength:null,maxLength:null,exactLength:null,typeName:o.ZodArray,...j(t)});class ec extends N{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;let e=this._def.shape(),t=i.objectKeys(e);return this._cached={shape:e,keys:t},this._cached}_parse(e){if(this._getType(e)!==u.object){let t=this._getOrReturnCtx(e);return v(t,{code:d.invalid_type,expected:u.object,received:t.parsedType}),O}let{status:t,ctx:r}=this._processInputParams(e),{shape:a,keys:i}=this._getCached(),n=[];if(!(this._def.catchall instanceof eo&&"strip"===this._def.unknownKeys))for(let e in r.data)i.includes(e)||n.push(e);let s=[];for(let e of i){let t=a[e],i=r.data[e];s.push({key:{status:"valid",value:e},value:t._parse(new A(r,i,r.path,e)),alwaysSet:e in r.data})}if(this._def.catchall instanceof eo){let e=this._def.unknownKeys;if("passthrough"===e)for(let e of n)s.push({key:{status:"valid",value:e},value:{status:"valid",value:r.data[e]}});else if("strict"===e)n.length>0&&(v(r,{code:d.unrecognized_keys,keys:n}),t.dirty());else if("strip"===e);else throw Error("Internal ZodObject error: invalid unknownKeys value.")}else{let e=this._def.catchall;for(let t of n){let a=r.data[t];s.push({key:{status:"valid",value:t},value:e._parse(new A(r,a,r.path,t)),alwaysSet:t in r.data})}}return r.common.async?Promise.resolve().then(async()=>{let e=[];for(let t of s){let r=await t.key,a=await t.value;e.push({key:r,value:a,alwaysSet:t.alwaysSet})}return e}).then(e=>w.mergeObjectSync(t,e)):w.mergeObjectSync(t,s)}get shape(){return this._def.shape()}strict(e){return s.errToObj,new ec({...this._def,unknownKeys:"strict",...void 0!==e?{errorMap:(t,r)=>{let a=this._def.errorMap?.(t,r).message??r.defaultError;return"unrecognized_keys"===t.code?{message:s.errToObj(e).message??a}:{message:a}}}:{}})}strip(){return new ec({...this._def,unknownKeys:"strip"})}passthrough(){return new ec({...this._def,unknownKeys:"passthrough"})}extend(e){return new ec({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new ec({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:o.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new ec({...this._def,catchall:e})}pick(e){let t={};for(let r of i.objectKeys(e))e[r]&&this.shape[r]&&(t[r]=this.shape[r]);return new ec({...this._def,shape:()=>t})}omit(e){let t={};for(let r of i.objectKeys(this.shape))e[r]||(t[r]=this.shape[r]);return new ec({...this._def,shape:()=>t})}deepPartial(){return function e(t){if(t instanceof ec){let r={};for(let a in t.shape){let i=t.shape[a];r[a]=eS.create(e(i))}return new ec({...t._def,shape:()=>r})}if(t instanceof eu)return new eu({...t._def,type:e(t.element)});if(t instanceof eS)return eS.create(e(t.unwrap()));if(t instanceof eP)return eP.create(e(t.unwrap()));if(t instanceof ef)return ef.create(t.items.map(t=>e(t)));else return t}(this)}partial(e){let t={};for(let r of i.objectKeys(this.shape)){let a=this.shape[r];e&&!e[r]?t[r]=a:t[r]=a.optional()}return new ec({...this._def,shape:()=>t})}required(e){let t={};for(let r of i.objectKeys(this.shape))if(e&&!e[r])t[r]=this.shape[r];else{let e=this.shape[r];for(;e instanceof eS;)e=e._def.innerType;t[r]=e}return new ec({...this._def,shape:()=>t})}keyof(){return eO(i.objectKeys(this.shape))}}ec.create=(e,t)=>new ec({shape:()=>e,unknownKeys:"strip",catchall:eo.create(),typeName:o.ZodObject,...j(t)}),ec.strictCreate=(e,t)=>new ec({shape:()=>e,unknownKeys:"strict",catchall:eo.create(),typeName:o.ZodObject,...j(t)}),ec.lazycreate=(e,t)=>new ec({shape:e,unknownKeys:"strip",catchall:eo.create(),typeName:o.ZodObject,...j(t)});class ed extends N{_parse(e){let{ctx:t}=this._processInputParams(e),r=this._def.options;if(t.common.async)return Promise.all(r.map(async e=>{let r={...t,common:{...t.common,issues:[]},parent:null};return{result:await e._parseAsync({data:t.data,path:t.path,parent:r}),ctx:r}})).then(function(e){for(let t of e)if("valid"===t.result.status)return t.result;for(let r of e)if("dirty"===r.result.status)return t.common.issues.push(...r.ctx.common.issues),r.result;let r=e.map(e=>new p(e.ctx.common.issues));return v(t,{code:d.invalid_union,unionErrors:r}),O});{let e;let a=[];for(let i of r){let r={...t,common:{...t.common,issues:[]},parent:null},n=i._parseSync({data:t.data,path:t.path,parent:r});if("valid"===n.status)return n;"dirty"!==n.status||e||(e={result:n,ctx:r}),r.common.issues.length&&a.push(r.common.issues)}if(e)return t.common.issues.push(...e.ctx.common.issues),e.result;let i=a.map(e=>new p(e));return v(t,{code:d.invalid_union,unionErrors:i}),O}}get options(){return this._def.options}}ed.create=(e,t)=>new ed({options:e,typeName:o.ZodUnion,...j(t)});let eh=e=>{if(e instanceof ev)return eh(e.schema);if(e instanceof ex)return eh(e.innerType());if(e instanceof ew)return[e.value];if(e instanceof eI)return e.options;if(e instanceof ek)return i.objectValues(e.enum);else if(e instanceof eA)return eh(e._def.innerType);else if(e instanceof ea)return[void 0];else if(e instanceof ei)return[null];else if(e instanceof eS)return[void 0,...eh(e.unwrap())];else if(e instanceof eP)return[null,...eh(e.unwrap())];else if(e instanceof e$)return eh(e.unwrap());else if(e instanceof eC)return eh(e.unwrap());else if(e instanceof eT)return eh(e._def.innerType);else return[]};class ep extends N{_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==u.object)return v(t,{code:d.invalid_type,expected:u.object,received:t.parsedType}),O;let r=this.discriminator,a=t.data[r],i=this.optionsMap.get(a);return i?t.common.async?i._parseAsync({data:t.data,path:t.path,parent:t}):i._parseSync({data:t.data,path:t.path,parent:t}):(v(t,{code:d.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),O)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,r){let a=new Map;for(let r of t){let t=eh(r.shape[e]);if(!t.length)throw Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let i of t){if(a.has(i))throw Error(`Discriminator property ${String(e)} has duplicate value ${String(i)}`);a.set(i,r)}}return new ep({typeName:o.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:a,...j(r)})}}class em extends N{_parse(e){let{status:t,ctx:r}=this._processInputParams(e),a=(e,a)=>{if(E(e)||E(a))return O;let n=function e(t,r){let a=c(t),n=c(r);if(t===r)return{valid:!0,data:t};if(a===u.object&&n===u.object){let a=i.objectKeys(r),n=i.objectKeys(t).filter(e=>-1!==a.indexOf(e)),s={...t,...r};for(let a of n){let i=e(t[a],r[a]);if(!i.valid)return{valid:!1};s[a]=i.data}return{valid:!0,data:s}}if(a===u.array&&n===u.array){if(t.length!==r.length)return{valid:!1};let a=[];for(let i=0;i<t.length;i++){let n=e(t[i],r[i]);if(!n.valid)return{valid:!1};a.push(n.data)}return{valid:!0,data:a}}if(a===u.date&&n===u.date&&+t==+r)return{valid:!0,data:t};return{valid:!1}}(e.value,a.value);return n.valid?((x(e)||x(a))&&t.dirty(),{status:t.value,value:n.data}):(v(r,{code:d.invalid_intersection_types}),O)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([e,t])=>a(e,t)):a(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}em.create=(e,t,r)=>new em({left:e,right:t,typeName:o.ZodIntersection,...j(r)});class ef extends N{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==u.array)return v(r,{code:d.invalid_type,expected:u.array,received:r.parsedType}),O;if(r.data.length<this._def.items.length)return v(r,{code:d.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),O;!this._def.rest&&r.data.length>this._def.items.length&&(v(r,{code:d.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());let a=[...r.data].map((e,t)=>{let a=this._def.items[t]||this._def.rest;return a?a._parse(new A(r,e,r.path,t)):null}).filter(e=>!!e);return r.common.async?Promise.all(a).then(e=>w.mergeArray(t,e)):w.mergeArray(t,a)}get items(){return this._def.items}rest(e){return new ef({...this._def,rest:e})}}ef.create=(e,t)=>{if(!Array.isArray(e))throw Error("You must pass an array of schemas to z.tuple([ ... ])");return new ef({items:e,typeName:o.ZodTuple,rest:null,...j(t)})};class eg extends N{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==u.object)return v(r,{code:d.invalid_type,expected:u.object,received:r.parsedType}),O;let a=[],i=this._def.keyType,n=this._def.valueType;for(let e in r.data)a.push({key:i._parse(new A(r,e,r.path,e)),value:n._parse(new A(r,r.data[e],r.path,e)),alwaysSet:e in r.data});return r.common.async?w.mergeObjectAsync(t,a):w.mergeObjectSync(t,a)}get element(){return this._def.valueType}static create(e,t,r){return new eg(t instanceof N?{keyType:e,valueType:t,typeName:o.ZodRecord,...j(r)}:{keyType:K.create(),valueType:e,typeName:o.ZodRecord,...j(t)})}}class ey extends N{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==u.map)return v(r,{code:d.invalid_type,expected:u.map,received:r.parsedType}),O;let a=this._def.keyType,i=this._def.valueType,n=[...r.data.entries()].map(([e,t],n)=>({key:a._parse(new A(r,e,r.path,[n,"key"])),value:i._parse(new A(r,t,r.path,[n,"value"]))}));if(r.common.async){let e=new Map;return Promise.resolve().then(async()=>{for(let r of n){let a=await r.key,i=await r.value;if("aborted"===a.status||"aborted"===i.status)return O;("dirty"===a.status||"dirty"===i.status)&&t.dirty(),e.set(a.value,i.value)}return{status:t.value,value:e}})}{let e=new Map;for(let r of n){let a=r.key,i=r.value;if("aborted"===a.status||"aborted"===i.status)return O;("dirty"===a.status||"dirty"===i.status)&&t.dirty(),e.set(a.value,i.value)}return{status:t.value,value:e}}}}ey.create=(e,t,r)=>new ey({valueType:t,keyType:e,typeName:o.ZodMap,...j(r)});class eb extends N{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==u.set)return v(r,{code:d.invalid_type,expected:u.set,received:r.parsedType}),O;let a=this._def;null!==a.minSize&&r.data.size<a.minSize.value&&(v(r,{code:d.too_small,minimum:a.minSize.value,type:"set",inclusive:!0,exact:!1,message:a.minSize.message}),t.dirty()),null!==a.maxSize&&r.data.size>a.maxSize.value&&(v(r,{code:d.too_big,maximum:a.maxSize.value,type:"set",inclusive:!0,exact:!1,message:a.maxSize.message}),t.dirty());let i=this._def.valueType;function n(e){let r=new Set;for(let a of e){if("aborted"===a.status)return O;"dirty"===a.status&&t.dirty(),r.add(a.value)}return{status:t.value,value:r}}let s=[...r.data.values()].map((e,t)=>i._parse(new A(r,e,r.path,t)));return r.common.async?Promise.all(s).then(e=>n(e)):n(s)}min(e,t){return new eb({...this._def,minSize:{value:e,message:s.toString(t)}})}max(e,t){return new eb({...this._def,maxSize:{value:e,message:s.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}eb.create=(e,t)=>new eb({valueType:e,minSize:null,maxSize:null,typeName:o.ZodSet,...j(t)});class e_ extends N{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==u.function)return v(t,{code:d.invalid_type,expected:u.function,received:t.parsedType}),O;function r(e,r){return b({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,f,m].filter(e=>!!e),issueData:{code:d.invalid_arguments,argumentsError:r}})}function a(e,r){return b({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,f,m].filter(e=>!!e),issueData:{code:d.invalid_return_type,returnTypeError:r}})}let i={errorMap:t.common.contextualErrorMap},n=t.data;if(this._def.returns instanceof eE){let e=this;return k(async function(...t){let s=new p([]),o=await e._def.args.parseAsync(t,i).catch(e=>{throw s.addIssue(r(t,e)),s}),l=await Reflect.apply(n,this,o);return await e._def.returns._def.type.parseAsync(l,i).catch(e=>{throw s.addIssue(a(l,e)),s})})}{let e=this;return k(function(...t){let s=e._def.args.safeParse(t,i);if(!s.success)throw new p([r(t,s.error)]);let o=Reflect.apply(n,this,s.data),l=e._def.returns.safeParse(o,i);if(!l.success)throw new p([a(o,l.error)]);return l.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new e_({...this._def,args:ef.create(e).rest(es.create())})}returns(e){return new e_({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,r){return new e_({args:e||ef.create([]).rest(es.create()),returns:t||es.create(),typeName:o.ZodFunction,...j(r)})}}class ev extends N{get schema(){return this._def.getter()}_parse(e){let{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}ev.create=(e,t)=>new ev({getter:e,typeName:o.ZodLazy,...j(t)});class ew extends N{_parse(e){if(e.data!==this._def.value){let t=this._getOrReturnCtx(e);return v(t,{received:t.data,code:d.invalid_literal,expected:this._def.value}),O}return{status:"valid",value:e.data}}get value(){return this._def.value}}function eO(e,t){return new eI({values:e,typeName:o.ZodEnum,...j(t)})}ew.create=(e,t)=>new ew({value:e,typeName:o.ZodLiteral,...j(t)});class eI extends N{_parse(e){if("string"!=typeof e.data){let t=this._getOrReturnCtx(e),r=this._def.values;return v(t,{expected:i.joinValues(r),received:t.parsedType,code:d.invalid_type}),O}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){let t=this._getOrReturnCtx(e),r=this._def.values;return v(t,{received:t.data,code:d.invalid_enum_value,options:r}),O}return k(e.data)}get options(){return this._def.values}get enum(){let e={};for(let t of this._def.values)e[t]=t;return e}get Values(){let e={};for(let t of this._def.values)e[t]=t;return e}get Enum(){let e={};for(let t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return eI.create(e,{...this._def,...t})}exclude(e,t=this._def){return eI.create(this.options.filter(t=>!e.includes(t)),{...this._def,...t})}}eI.create=eO;class ek extends N{_parse(e){let t=i.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==u.string&&r.parsedType!==u.number){let e=i.objectValues(t);return v(r,{expected:i.joinValues(e),received:r.parsedType,code:d.invalid_type}),O}if(this._cache||(this._cache=new Set(i.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){let e=i.objectValues(t);return v(r,{received:r.data,code:d.invalid_enum_value,options:e}),O}return k(e.data)}get enum(){return this._def.values}}ek.create=(e,t)=>new ek({values:e,typeName:o.ZodNativeEnum,...j(t)});class eE extends N{unwrap(){return this._def.type}_parse(e){let{ctx:t}=this._processInputParams(e);return t.parsedType!==u.promise&&!1===t.common.async?(v(t,{code:d.invalid_type,expected:u.promise,received:t.parsedType}),O):k((t.parsedType===u.promise?t.data:Promise.resolve(t.data)).then(e=>this._def.type.parseAsync(e,{path:t.path,errorMap:t.common.contextualErrorMap})))}}eE.create=(e,t)=>new eE({type:e,typeName:o.ZodPromise,...j(t)});class ex extends N{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===o.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:t,ctx:r}=this._processInputParams(e),a=this._def.effect||null,n={addIssue:e=>{v(r,e),e.fatal?t.abort():t.dirty()},get path(){return r.path}};if(n.addIssue=n.addIssue.bind(n),"preprocess"===a.type){let e=a.transform(r.data,n);if(r.common.async)return Promise.resolve(e).then(async e=>{if("aborted"===t.value)return O;let a=await this._def.schema._parseAsync({data:e,path:r.path,parent:r});return"aborted"===a.status?O:"dirty"===a.status||"dirty"===t.value?I(a.value):a});{if("aborted"===t.value)return O;let a=this._def.schema._parseSync({data:e,path:r.path,parent:r});return"aborted"===a.status?O:"dirty"===a.status||"dirty"===t.value?I(a.value):a}}if("refinement"===a.type){let e=e=>{let t=a.refinement(e,n);if(r.common.async)return Promise.resolve(t);if(t instanceof Promise)throw Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return e};if(!1!==r.common.async)return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(r=>"aborted"===r.status?O:("dirty"===r.status&&t.dirty(),e(r.value).then(()=>({status:t.value,value:r.value}))));{let a=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===a.status?O:("dirty"===a.status&&t.dirty(),e(a.value),{status:t.value,value:a.value})}}if("transform"===a.type){if(!1!==r.common.async)return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(e=>S(e)?Promise.resolve(a.transform(e.value,n)).then(e=>({status:t.value,value:e})):O);{let e=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!S(e))return O;let i=a.transform(e.value,n);if(i instanceof Promise)throw Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:i}}}i.assertNever(a)}}ex.create=(e,t,r)=>new ex({schema:e,typeName:o.ZodEffects,effect:t,...j(r)}),ex.createWithPreprocess=(e,t,r)=>new ex({schema:t,effect:{type:"preprocess",transform:e},typeName:o.ZodEffects,...j(r)});class eS extends N{_parse(e){return this._getType(e)===u.undefined?k(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}eS.create=(e,t)=>new eS({innerType:e,typeName:o.ZodOptional,...j(t)});class eP extends N{_parse(e){return this._getType(e)===u.null?k(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}eP.create=(e,t)=>new eP({innerType:e,typeName:o.ZodNullable,...j(t)});class eA extends N{_parse(e){let{ctx:t}=this._processInputParams(e),r=t.data;return t.parsedType===u.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}eA.create=(e,t)=>new eA({innerType:e,typeName:o.ZodDefault,defaultValue:"function"==typeof t.default?t.default:()=>t.default,...j(t)});class eT extends N{_parse(e){let{ctx:t}=this._processInputParams(e),r={...t,common:{...t.common,issues:[]}},a=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return P(a)?a.then(e=>({status:"valid",value:"valid"===e.status?e.value:this._def.catchValue({get error(){return new p(r.common.issues)},input:r.data})})):{status:"valid",value:"valid"===a.status?a.value:this._def.catchValue({get error(){return new p(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}}eT.create=(e,t)=>new eT({innerType:e,typeName:o.ZodCatch,catchValue:"function"==typeof t.catch?t.catch:()=>t.catch,...j(t)});class ej extends N{_parse(e){if(this._getType(e)!==u.nan){let t=this._getOrReturnCtx(e);return v(t,{code:d.invalid_type,expected:u.nan,received:t.parsedType}),O}return{status:"valid",value:e.data}}}ej.create=e=>new ej({typeName:o.ZodNaN,...j(e)});let eN=Symbol("zod_brand");class e$ extends N{_parse(e){let{ctx:t}=this._processInputParams(e),r=t.data;return this._def.type._parse({data:r,path:t.path,parent:t})}unwrap(){return this._def.type}}class eR extends N{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{let e=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?O:"dirty"===e.status?(t.dirty(),I(e.value)):this._def.out._parseAsync({data:e.value,path:r.path,parent:r})})();{let e=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?O:"dirty"===e.status?(t.dirty(),{status:"dirty",value:e.value}):this._def.out._parseSync({data:e.value,path:r.path,parent:r})}}static create(e,t){return new eR({in:e,out:t,typeName:o.ZodPipeline})}}class eC extends N{_parse(e){let t=this._def.innerType._parse(e),r=e=>(S(e)&&(e.value=Object.freeze(e.value)),e);return P(t)?t.then(e=>r(e)):r(t)}unwrap(){return this._def.innerType}}function eL(e,t){let r="function"==typeof e?e(t):"string"==typeof e?{message:e}:e;return"string"==typeof r?{message:r}:r}function eU(e,t={},r){return e?en.create().superRefine((a,i)=>{let n=e(a);if(n instanceof Promise)return n.then(e=>{if(!e){let e=eL(t,a),n=e.fatal??r??!0;i.addIssue({code:"custom",...e,fatal:n})}});if(!n){let e=eL(t,a),n=e.fatal??r??!0;i.addIssue({code:"custom",...e,fatal:n})}}):en.create()}eC.create=(e,t)=>new eC({innerType:e,typeName:o.ZodReadonly,...j(t)});let eM={object:ec.lazycreate};!function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"}(o||(o={}));let eD=(e,t={message:`Input not instance of ${e.name}`})=>eU(t=>t instanceof e,t),eF=K.create,ez=X.create,eB=ej.create,eZ=Q.create,eJ=ee.create,eq=et.create,eG=er.create,eW=ea.create,eH=ei.create,eY=en.create,eV=es.create,eK=eo.create,eX=el.create,eQ=eu.create,e0=ec.create,e1=ec.strictCreate,e4=ed.create,e2=ep.create,e6=em.create,e9=ef.create,e3=eg.create,e5=ey.create,e8=eb.create,e7=e_.create,te=ev.create,tt=ew.create,tr=eI.create,ta=ek.create,ti=eE.create,tn=ex.create,ts=eS.create,to=eP.create,tl=ex.createWithPreprocess,tu=eR.create,tc=()=>eF().optional(),td=()=>ez().optional(),th=()=>eJ().optional(),tp={string:e=>K.create({...e,coerce:!0}),number:e=>X.create({...e,coerce:!0}),boolean:e=>ee.create({...e,coerce:!0}),bigint:e=>Q.create({...e,coerce:!0}),date:e=>et.create({...e,coerce:!0})},tm=O},72257:(e,t,r)=>{"use strict";r.d(t,{J:()=>i});var a=r(65408);class i{constructor(e){Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.caller=new a.g(e??{})}}},72716:(e,t,r)=>{"use strict";r.d(t,{NK:()=>l,xL:()=>o,zr:()=>u});var a=r(92078),i=r(23931),n=r(4397);class s{}function o(e){return"lc_prefer_streaming"in e&&e.lc_prefer_streaming}class l extends s{get lc_namespace(){return["langchain_core","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}get lc_serializable_keys(){}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,(0,i.Z)(this.constructor)]}constructor(e){super(),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ignoreLLM",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreChain",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreAgent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreRetriever",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreCustomEvent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"raiseError",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"awaitHandlers",{enumerable:!0,configurable:!0,writable:!0,value:"false"===(0,n.Az)("LANGCHAIN_CALLBACKS_BACKGROUND")}),this.lc_kwargs=e||{},e&&(this.ignoreLLM=e.ignoreLLM??this.ignoreLLM,this.ignoreChain=e.ignoreChain??this.ignoreChain,this.ignoreAgent=e.ignoreAgent??this.ignoreAgent,this.ignoreRetriever=e.ignoreRetriever??this.ignoreRetriever,this.ignoreCustomEvent=e.ignoreCustomEvent??this.ignoreCustomEvent,this.raiseError=e.raiseError??this.raiseError,this.awaitHandlers=this.raiseError||(e._awaitHandler??this.awaitHandlers))}copy(){return new this.constructor(this)}toJSON(){return i.y.prototype.toJSON.call(this)}toJSONNotImplemented(){return i.y.prototype.toJSONNotImplemented.call(this)}static fromMethods(e){class t extends l{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:a.A()}),Object.assign(this,e)}}return new t}}let u=e=>void 0!==e&&"function"==typeof e.copy&&"string"==typeof e.name&&"boolean"==typeof e.awaitHandlers},76406:(e,t,r)=>{"use strict";let a=r(8044);e.exports=(e,t)=>e.sort((e,r)=>a(e,r,t))},76591:e=>{"use strict";e.exports=function(e,t){if("string"!=typeof e)throw TypeError("Expected a string");return t=void 0===t?"_":t,e.replace(/([a-z\d])([A-Z])/g,"$1"+t+"$2").replace(/([A-Z]+)([A-Z][a-z\d]+)/g,"$1"+t+"$2").toLowerCase()}},76937:(e,t,r)=>{"use strict";r.d(t,{FK:()=>n,mg:()=>i});var a=r(64520);class i extends a.XQ{static lc_name(){return"FunctionMessage"}constructor(e,t){"string"==typeof e&&(e={content:e,name:t}),super(e)}_getType(){return"function"}}class n extends a.gj{static lc_name(){return"FunctionMessageChunk"}_getType(){return"function"}concat(e){return new n({content:(0,a._I)(this.content,e.content),additional_kwargs:(0,a.ns)(this.additional_kwargs,e.additional_kwargs),response_metadata:(0,a.ns)(this.response_metadata,e.response_metadata),name:this.name??"",id:this.id??e.id})}}},77015:(e,t,r)=>{"use strict";let a=r(89377);e.exports=(e,t)=>{let r=a(e.trim().replace(/^[=v]+/,""),t);return r?r.version:null}},77985:(e,t,r)=>{"use strict";let a=r(89377);e.exports=(e,t)=>{let r=a(e,null,!0),i=a(t,null,!0),n=r.compare(i);if(0===n)return null;let s=n>0,o=s?r:i,l=s?i:r,u=!!o.prerelease.length;if(l.prerelease.length&&!u){if(!l.patch&&!l.minor)return"major";if(0===l.compareMain(o))return l.minor&&!l.patch?"minor":"patch"}let c=u?"pre":"";return r.major!==i.major?c+"major":r.minor!==i.minor?c+"minor":r.patch!==i.patch?c+"patch":"prerelease"}},80918:(e,t,r)=>{"use strict";let a,i;r.d(t,{Td:()=>L,tW:()=>U,H_:()=>A});var n=r(92078),s=r(72716),o=r(30986),l=r(25050);function u(e,t){return`${e.open}${t}${e.close}`}function c(e,t){try{return JSON.stringify(e,null,2)}catch(e){return t}}function d(e){return"string"==typeof e?e.trim():null==e?e:c(e,e.toString())}function h(e){if(!e.end_time)return"";let t=e.end_time-e.start_time;return t<1e3?`${t}ms`:`${(t/1e3).toFixed(2)}s`}let{color:p}=o;class m extends l.J{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"console_callback_handler"})}persistRun(e){return Promise.resolve()}getParents(e){let t=[],r=e;for(;r.parent_run_id;){let e=this.runMap.get(r.parent_run_id);if(e)t.push(e),r=e;else break}return t}getBreadcrumbs(e){let t=[...this.getParents(e).reverse(),e].map((e,t,r)=>{let a=`${e.execution_order}:${e.run_type}:${e.name}`;return t===r.length-1?u(o.bold,a):a}).join(" > ");return u(p.grey,t)}onChainStart(e){let t=this.getBreadcrumbs(e);console.log(`${u(p.green,"[chain/start]")} [${t}] Entering Chain run with input: ${c(e.inputs,"[inputs]")}`)}onChainEnd(e){let t=this.getBreadcrumbs(e);console.log(`${u(p.cyan,"[chain/end]")} [${t}] [${h(e)}] Exiting Chain run with output: ${c(e.outputs,"[outputs]")}`)}onChainError(e){let t=this.getBreadcrumbs(e);console.log(`${u(p.red,"[chain/error]")} [${t}] [${h(e)}] Chain run errored with error: ${c(e.error,"[error]")}`)}onLLMStart(e){let t=this.getBreadcrumbs(e),r="prompts"in e.inputs?{prompts:e.inputs.prompts.map(e=>e.trim())}:e.inputs;console.log(`${u(p.green,"[llm/start]")} [${t}] Entering LLM run with input: ${c(r,"[inputs]")}`)}onLLMEnd(e){let t=this.getBreadcrumbs(e);console.log(`${u(p.cyan,"[llm/end]")} [${t}] [${h(e)}] Exiting LLM run with output: ${c(e.outputs,"[response]")}`)}onLLMError(e){let t=this.getBreadcrumbs(e);console.log(`${u(p.red,"[llm/error]")} [${t}] [${h(e)}] LLM run errored with error: ${c(e.error,"[error]")}`)}onToolStart(e){let t=this.getBreadcrumbs(e);console.log(`${u(p.green,"[tool/start]")} [${t}] Entering Tool run with input: "${d(e.inputs.input)}"`)}onToolEnd(e){let t=this.getBreadcrumbs(e);console.log(`${u(p.cyan,"[tool/end]")} [${t}] [${h(e)}] Exiting Tool run with output: "${d(e.outputs?.output)}"`)}onToolError(e){let t=this.getBreadcrumbs(e);console.log(`${u(p.red,"[tool/error]")} [${t}] [${h(e)}] Tool run errored with error: ${c(e.error,"[error]")}`)}onRetrieverStart(e){let t=this.getBreadcrumbs(e);console.log(`${u(p.green,"[retriever/start]")} [${t}] Entering Retriever run with input: ${c(e.inputs,"[inputs]")}`)}onRetrieverEnd(e){let t=this.getBreadcrumbs(e);console.log(`${u(p.cyan,"[retriever/end]")} [${t}] [${h(e)}] Exiting Retriever run with output: ${c(e.outputs,"[outputs]")}`)}onRetrieverError(e){let t=this.getBreadcrumbs(e);console.log(`${u(p.red,"[retriever/error]")} [${t}] [${h(e)}] Retriever run errored with error: ${c(e.error,"[error]")}`)}onAgentAction(e){let t=this.getBreadcrumbs(e);console.log(`${u(p.blue,"[agent/action]")} [${t}] Agent selected action: ${c(e.actions[e.actions.length-1],"[action]")}`)}}var f=r(90338),g=r(4397),y=r(3479),b=r(93412),_=r(54099);let v=()=>{if(void 0===a){let e="false"===(0,g.Az)("LANGCHAIN_CALLBACKS_BACKGROUND")?{blockOnRootRunFinalization:!0}:{};a=new y.Kj(e)}return a};class w extends l.J{constructor(e={}){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"projectName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"usesRunTreeMap",{enumerable:!0,configurable:!0,writable:!0,value:!0});let{exampleId:t,projectName:r,client:a,replicas:i}=e;this.projectName=r??(0,y.q7)(),this.replicas=i,this.exampleId=t,this.client=a??v();let n=w.getTraceableRunTree();n&&this.updateFromRunTree(n)}async persistRun(e){}async onRunCreate(e){let t=this.getRunTreeWithTracingConfig(e.id);await t?.postRun()}async onRunUpdate(e){let t=this.getRunTreeWithTracingConfig(e.id);await t?.patchRun()}getRun(e){return this.runTreeMap.get(e)}updateFromRunTree(e){let t=e,r=new Set;for(;t.parent_run&&!r.has(t.id)&&(r.add(t.id),t.parent_run);){t=t.parent_run}r.clear();let a=[t];for(;a.length>0;){let e=a.shift();!(!e||r.has(e.id))&&(r.add(e.id),this.runTreeMap.set(e.id,e),e.child_runs&&a.push(...e.child_runs))}this.client=e.client??this.client,this.replicas=e.replicas??this.replicas,this.projectName=e.project_name??this.projectName,this.exampleId=e.reference_example_id??this.exampleId}getRunTreeWithTracingConfig(e){let t=this.runTreeMap.get(e);if(t)return new b.gk({...t,client:this.client,project_name:this.projectName,replicas:this.replicas,reference_example_id:this.exampleId,tracingEnabled:!0})}static getTraceableRunTree(){try{return(0,_.vR)(!0)}catch{return}}}var O=r(52435),I=r(44768);async function k(e,t){if(!0===t){let t=(0,I.X0)();void 0!==t?await t.run(void 0,async()=>e()):await e()}else void 0===i&&(i=new O.default({autoStart:!0,concurrency:1})),i.add(async()=>{let t=(0,I.X0)();void 0!==t?await t.run(void 0,async()=>e()):await e()})}let E=e=>void 0!==e?e:!!["LANGSMITH_TRACING_V2","LANGCHAIN_TRACING_V2","LANGSMITH_TRACING","LANGCHAIN_TRACING"].find(e=>"true"===(0,g.Az)(e));function x(e){let t=(0,I.X0)();if(void 0===t)return;let r=t.getStore();return r?.[I.hr]?.[e]}let S=Symbol("lc:configure_hooks"),P=()=>x(S)||[];function A(e){return e?Array.isArray(e)||"name"in e?{callbacks:e}:e:{}}class T{setHandler(e){return this.setHandlers([e])}}class j{constructor(e,t,r,a,i,n,s,o){Object.defineProperty(this,"runId",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:o})}get parentRunId(){return this._parentRunId}async handleText(e){await Promise.all(this.handlers.map(t=>k(async()=>{try{await t.handleText?.(e,this.runId,this._parentRunId,this.tags)}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleText: ${e}`),t.raiseError)throw e}},t.awaitHandlers)))}async handleCustomEvent(e,t,r,a,i){await Promise.all(this.handlers.map(r=>k(async()=>{try{await r.handleCustomEvent?.(e,t,this.runId,this.tags,this.metadata)}catch(e){if((r.raiseError?console.error:console.warn)(`Error in handler ${r.constructor.name}, handleCustomEvent: ${e}`),r.raiseError)throw e}},r.awaitHandlers)))}}class N extends j{getChild(e){let t=new L(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleRetrieverEnd(e){await Promise.all(this.handlers.map(t=>k(async()=>{if(!t.ignoreRetriever)try{await t.handleRetrieverEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleRetriever`),t.raiseError)throw e}},t.awaitHandlers)))}async handleRetrieverError(e){await Promise.all(this.handlers.map(t=>k(async()=>{if(!t.ignoreRetriever)try{await t.handleRetrieverError?.(e,this.runId,this._parentRunId,this.tags)}catch(r){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleRetrieverError: ${r}`),t.raiseError)throw e}},t.awaitHandlers)))}}class $ extends j{async handleLLMNewToken(e,t,r,a,i,n){await Promise.all(this.handlers.map(r=>k(async()=>{if(!r.ignoreLLM)try{await r.handleLLMNewToken?.(e,t??{prompt:0,completion:0},this.runId,this._parentRunId,this.tags,n)}catch(e){if((r.raiseError?console.error:console.warn)(`Error in handler ${r.constructor.name}, handleLLMNewToken: ${e}`),r.raiseError)throw e}},r.awaitHandlers)))}async handleLLMError(e,t,r,a,i){await Promise.all(this.handlers.map(t=>k(async()=>{if(!t.ignoreLLM)try{await t.handleLLMError?.(e,this.runId,this._parentRunId,this.tags,i)}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleLLMError: ${e}`),t.raiseError)throw e}},t.awaitHandlers)))}async handleLLMEnd(e,t,r,a,i){await Promise.all(this.handlers.map(t=>k(async()=>{if(!t.ignoreLLM)try{await t.handleLLMEnd?.(e,this.runId,this._parentRunId,this.tags,i)}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleLLMEnd: ${e}`),t.raiseError)throw e}},t.awaitHandlers)))}}class R extends j{getChild(e){let t=new L(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleChainError(e,t,r,a,i){await Promise.all(this.handlers.map(t=>k(async()=>{if(!t.ignoreChain)try{await t.handleChainError?.(e,this.runId,this._parentRunId,this.tags,i)}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleChainError: ${e}`),t.raiseError)throw e}},t.awaitHandlers)))}async handleChainEnd(e,t,r,a,i){await Promise.all(this.handlers.map(t=>k(async()=>{if(!t.ignoreChain)try{await t.handleChainEnd?.(e,this.runId,this._parentRunId,this.tags,i)}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleChainEnd: ${e}`),t.raiseError)throw e}},t.awaitHandlers)))}async handleAgentAction(e){await Promise.all(this.handlers.map(t=>k(async()=>{if(!t.ignoreAgent)try{await t.handleAgentAction?.(e,this.runId,this._parentRunId,this.tags)}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleAgentAction: ${e}`),t.raiseError)throw e}},t.awaitHandlers)))}async handleAgentEnd(e){await Promise.all(this.handlers.map(t=>k(async()=>{if(!t.ignoreAgent)try{await t.handleAgentEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleAgentEnd: ${e}`),t.raiseError)throw e}},t.awaitHandlers)))}}class C extends j{getChild(e){let t=new L(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleToolError(e){await Promise.all(this.handlers.map(t=>k(async()=>{if(!t.ignoreAgent)try{await t.handleToolError?.(e,this.runId,this._parentRunId,this.tags)}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleToolError: ${e}`),t.raiseError)throw e}},t.awaitHandlers)))}async handleToolEnd(e){await Promise.all(this.handlers.map(t=>k(async()=>{if(!t.ignoreAgent)try{await t.handleToolEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(e){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleToolEnd: ${e}`),t.raiseError)throw e}},t.awaitHandlers)))}}class L extends T{constructor(e,t){super(),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"callback_manager"}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.handlers=t?.handlers??this.handlers,this.inheritableHandlers=t?.inheritableHandlers??this.inheritableHandlers,this.tags=t?.tags??this.tags,this.inheritableTags=t?.inheritableTags??this.inheritableTags,this.metadata=t?.metadata??this.metadata,this.inheritableMetadata=t?.inheritableMetadata??this.inheritableMetadata,this._parentRunId=e}getParentRunId(){return this._parentRunId}async handleLLMStart(e,t,r,a,i,s,o,u){return Promise.all(t.map(async(t,a)=>{let s=0===a&&r?r:(0,n.A)();return await Promise.all(this.handlers.map(r=>{if(!r.ignoreLLM)return(0,l.j)(r)&&r._createRunForLLMStart(e,[t],s,this._parentRunId,i,this.tags,this.metadata,u),k(async()=>{try{await r.handleLLMStart?.(e,[t],s,this._parentRunId,i,this.tags,this.metadata,u)}catch(e){if((r.raiseError?console.error:console.warn)(`Error in handler ${r.constructor.name}, handleLLMStart: ${e}`),r.raiseError)throw e}},r.awaitHandlers)})),new $(s,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChatModelStart(e,t,r,a,i,s,o,u){return Promise.all(t.map(async(t,a)=>{let s=0===a&&r?r:(0,n.A)();return await Promise.all(this.handlers.map(r=>{if(!r.ignoreLLM)return(0,l.j)(r)&&r._createRunForChatModelStart(e,[t],s,this._parentRunId,i,this.tags,this.metadata,u),k(async()=>{try{if(r.handleChatModelStart)await r.handleChatModelStart?.(e,[t],s,this._parentRunId,i,this.tags,this.metadata,u);else if(r.handleLLMStart){let a=(0,f.Sw)(t);await r.handleLLMStart?.(e,[a],s,this._parentRunId,i,this.tags,this.metadata,u)}}catch(e){if((r.raiseError?console.error:console.warn)(`Error in handler ${r.constructor.name}, handleLLMStart: ${e}`),r.raiseError)throw e}},r.awaitHandlers)})),new $(s,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChainStart(e,t,r=(0,n.A)(),a,i,s,o){return await Promise.all(this.handlers.map(i=>{if(!i.ignoreChain)return(0,l.j)(i)&&i._createRunForChainStart(e,t,r,this._parentRunId,this.tags,this.metadata,a,o),k(async()=>{try{await i.handleChainStart?.(e,t,r,this._parentRunId,this.tags,this.metadata,a,o)}catch(e){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleChainStart: ${e}`),i.raiseError)throw e}},i.awaitHandlers)})),new R(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleToolStart(e,t,r=(0,n.A)(),a,i,s,o){return await Promise.all(this.handlers.map(a=>{if(!a.ignoreAgent)return(0,l.j)(a)&&a._createRunForToolStart(e,t,r,this._parentRunId,this.tags,this.metadata,o),k(async()=>{try{await a.handleToolStart?.(e,t,r,this._parentRunId,this.tags,this.metadata,o)}catch(e){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleToolStart: ${e}`),a.raiseError)throw e}},a.awaitHandlers)})),new C(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleRetrieverStart(e,t,r=(0,n.A)(),a,i,s,o){return await Promise.all(this.handlers.map(a=>{if(!a.ignoreRetriever)return(0,l.j)(a)&&a._createRunForRetrieverStart(e,t,r,this._parentRunId,this.tags,this.metadata,o),k(async()=>{try{await a.handleRetrieverStart?.(e,t,r,this._parentRunId,this.tags,this.metadata,o)}catch(e){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleRetrieverStart: ${e}`),a.raiseError)throw e}},a.awaitHandlers)})),new N(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleCustomEvent(e,t,r,a,i){await Promise.all(this.handlers.map(a=>k(async()=>{if(!a.ignoreCustomEvent)try{await a.handleCustomEvent?.(e,t,r,this.tags,this.metadata)}catch(e){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleCustomEvent: ${e}`),a.raiseError)throw e}},a.awaitHandlers)))}addHandler(e,t=!0){this.handlers.push(e),t&&this.inheritableHandlers.push(e)}removeHandler(e){this.handlers=this.handlers.filter(t=>t!==e),this.inheritableHandlers=this.inheritableHandlers.filter(t=>t!==e)}setHandlers(e,t=!0){for(let r of(this.handlers=[],this.inheritableHandlers=[],e))this.addHandler(r,t)}addTags(e,t=!0){this.removeTags(e),this.tags.push(...e),t&&this.inheritableTags.push(...e)}removeTags(e){this.tags=this.tags.filter(t=>!e.includes(t)),this.inheritableTags=this.inheritableTags.filter(t=>!e.includes(t))}addMetadata(e,t=!0){this.metadata={...this.metadata,...e},t&&(this.inheritableMetadata={...this.inheritableMetadata,...e})}removeMetadata(e){for(let t of Object.keys(e))delete this.metadata[t],delete this.inheritableMetadata[t]}copy(e=[],t=!0){let r=new L(this._parentRunId);for(let e of this.handlers){let t=this.inheritableHandlers.includes(e);r.addHandler(e,t)}for(let e of this.tags){let t=this.inheritableTags.includes(e);r.addTags([e],t)}for(let e of Object.keys(this.metadata)){let t=Object.keys(this.inheritableMetadata).includes(e);r.addMetadata({[e]:this.metadata[e]},t)}for(let a of e)!r.handlers.filter(e=>"console_callback_handler"===e.name).some(e=>e.name===a.name)&&r.addHandler(a,t);return r}static fromHandlers(e){class t extends s.NK{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:(0,n.A)()}),Object.assign(this,e)}}let r=new this;return r.addHandler(new t),r}static configure(e,t,r,a,i,n,s){return this._configureSync(e,t,r,a,i,n,s)}static _configureSync(e,t,r,a,i,n,o){let l;(e||t)&&(Array.isArray(e)||!e?(l=new L).setHandlers(e?.map(U)??[],!0):l=e,l=l.copy(Array.isArray(t)?t.map(U):t?.handlers,!1));let u="true"===(0,g.Az)("LANGCHAIN_VERBOSE")||o?.verbose,c=w.getTraceableRunTree()?.tracingEnabled||E(),d=c||((0,g.Az)("LANGCHAIN_TRACING")??!1);if(u||d){if(l||(l=new L),u&&!l.handlers.some(e=>e.name===m.prototype.name)){let e=new m;l.addHandler(e,!0)}if(d&&!l.handlers.some(e=>"langchain_tracer"===e.name)&&c){let e=new w;l.addHandler(e,!0),l._parentRunId=w.getTraceableRunTree()?.id??l._parentRunId}}for(let{contextVar:e,inheritable:t=!0,handlerClass:r,envVar:a}of P()){let i;let n=a&&"true"===(0,g.Az)(a)&&r,o=void 0!==e?x(e):void 0;o&&(0,s.zr)(o)?i=o:n&&(i=new r({})),void 0===i||(l||(l=new L),l.handlers.some(e=>e.name===i.name)||l.addHandler(i,t))}return(r||a)&&l&&(l.addTags(r??[]),l.addTags(a??[],!1)),(i||n)&&l&&(l.addMetadata(i??{}),l.addMetadata(n??{},!1)),l}}function U(e){return"name"in e?e:s.NK.fromMethods(e)}},81979:e=>{"use strict";e.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:16,MAX_SAFE_BUILD_LENGTH:250,MAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER||0x1fffffffffffff,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:"2.0.0",FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}},82591:(e,t,r)=>{"use strict";r.d(t,{X6:()=>b,UD:()=>E});var a={};r.r(a),r.d(a,{JsonPatchError:()=>h,_areEquals:()=>O,applyOperation:()=>y,applyPatch:()=>b,applyReducer:()=>_,deepClone:()=>p,getValueByPointer:()=>g,validate:()=>w,validator:()=>v});let i=Object.prototype.hasOwnProperty;function n(e,t){return i.call(e,t)}function s(e){if(Array.isArray(e)){let t=Array(e.length);for(let e=0;e<t.length;e++)t[e]=""+e;return t}if(Object.keys)return Object.keys(e);let t=[];for(let r in e)n(e,r)&&t.push(r);return t}function o(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function l(e){let t,r=0,a=e.length;for(;r<a;){if((t=e.charCodeAt(r))>=48&&t<=57){r++;continue}return!1}return!0}function u(e){return -1===e.indexOf("/")&&-1===e.indexOf("~")?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function c(e,t){let r=[e];for(let e in t){let a="object"==typeof t[e]?JSON.stringify(t[e],null,2):t[e];void 0!==a&&r.push(`${e}: ${a}`)}return r.join("\n")}class d extends Error{constructor(e,t,r,a,i){super(c(e,{name:t,index:r,operation:a,tree:i})),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"index",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"operation",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"tree",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.setPrototypeOf(this,new.target.prototype),this.message=c(e,{name:t,index:r,operation:a,tree:i})}}let h=d,p=o,m={add:function(e,t,r){return e[t]=this.value,{newDocument:r}},remove:function(e,t,r){var a=e[t];return delete e[t],{newDocument:r,removed:a}},replace:function(e,t,r){var a=e[t];return e[t]=this.value,{newDocument:r,removed:a}},move:function(e,t,r){let a=g(r,this.path);a&&(a=o(a));let i=y(r,{op:"remove",path:this.from}).removed;return y(r,{op:"add",path:this.path,value:i}),{newDocument:r,removed:a}},copy:function(e,t,r){let a=g(r,this.from);return y(r,{op:"add",path:this.path,value:o(a)}),{newDocument:r}},test:function(e,t,r){return{newDocument:r,test:O(e[t],this.value)}},_get:function(e,t,r){return this.value=e[t],{newDocument:r}}};var f={add:function(e,t,r){return l(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:r,index:t}},remove:function(e,t,r){return{newDocument:r,removed:e.splice(t,1)[0]}},replace:function(e,t,r){var a=e[t];return e[t]=this.value,{newDocument:r,removed:a}},move:m.move,copy:m.copy,test:m.test,_get:m._get};function g(e,t){if(""==t)return e;var r={op:"_get",path:t};return y(e,r),r.value}function y(e,t,r=!1,a=!0,i=!0,n=0){if(r&&("function"==typeof r?r(t,0,e,t.path):v(t,0)),""===t.path){let a={newDocument:e};if("add"===t.op)return a.newDocument=t.value,a;if("replace"===t.op)return a.newDocument=t.value,a.removed=e,a;if("move"===t.op||"copy"===t.op)return a.newDocument=g(e,t.from),"move"===t.op&&(a.removed=e),a;else if("test"===t.op){if(a.test=O(e,t.value),!1===a.test)throw new h("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return a.newDocument=e,a}else{if("remove"===t.op)return a.removed=e,a.newDocument=null,a;if("_get"===t.op)return t.value=e,a;if(!r)return a;throw new h("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",n,t,e)}}{let s,u,c;a||(e=o(e));let d=(t.path||"").split("/"),p=e,g=1,y=d.length;for(u="function"==typeof r?r:v;;){if((s=d[g])&&-1!=s.indexOf("~")&&(s=s.replace(/~1/g,"/").replace(/~0/g,"~")),i&&("__proto__"==s||"prototype"==s&&g>0&&"constructor"==d[g-1]))throw TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(r&&void 0===c&&(void 0===p[s]?c=d.slice(0,g).join("/"):g==y-1&&(c=t.path),void 0!==c&&u(t,0,e,c)),g++,Array.isArray(p)){if("-"===s)s=p.length;else{if(r&&!l(s))throw new h("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",n,t,e);l(s)&&(s=~~s)}if(g>=y){if(r&&"add"===t.op&&s>p.length)throw new h("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",n,t,e);let a=f[t.op].call(t,p,s,e);if(!1===a.test)throw new h("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return a}}else if(g>=y){let r=m[t.op].call(t,p,s,e);if(!1===r.test)throw new h("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return r}if(p=p[s],r&&g<y&&(!p||"object"!=typeof p))throw new h("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",n,t,e)}}}function b(e,t,r,a=!0,i=!0){if(r&&!Array.isArray(t))throw new h("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");a||(e=o(e));let n=Array(t.length);for(let a=0,s=t.length;a<s;a++)n[a]=y(e,t[a],r,!0,i,a),e=n[a].newDocument;return n.newDocument=e,n}function _(e,t,r){let a=y(e,t);if(!1===a.test)throw new h("Test operation failed","TEST_OPERATION_FAILED",r,t,e);return a.newDocument}function v(e,t,r,a){if("object"!=typeof e||null===e||Array.isArray(e))throw new h("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,r);if(m[e.op]){if("string"!=typeof e.path)throw new h("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,r);if(0!==e.path.indexOf("/")&&e.path.length>0)throw new h('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,r);else if(("move"===e.op||"copy"===e.op)&&"string"!=typeof e.from)throw new h("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,r);else if(("add"===e.op||"replace"===e.op||"test"===e.op)&&void 0===e.value)throw new h("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,r);else if(("add"===e.op||"replace"===e.op||"test"===e.op)&&function e(t){if(void 0===t)return!0;if(t){if(Array.isArray(t)){for(let r=0,a=t.length;r<a;r++)if(e(t[r]))return!0}else if("object"==typeof t){let a=s(t),i=a.length;for(var r=0;r<i;r++)if(e(t[a[r]]))return!0}}return!1}(e.value))throw new h("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,r);else if(r){if("add"==e.op){var i=e.path.split("/").length,n=a.split("/").length;if(i!==n+1&&i!==n)throw new h("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,r)}else if("replace"===e.op||"remove"===e.op||"_get"===e.op){if(e.path!==a)throw new h("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,r)}else if("move"===e.op||"copy"===e.op){var o=w([{op:"_get",path:e.from,value:void 0}],r);if(o&&"OPERATION_PATH_UNRESOLVABLE"===o.name)throw new h("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,r)}}}else throw new h("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,r)}function w(e,t,r){try{if(!Array.isArray(e))throw new h("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)b(o(t),o(e),r||!0);else{r=r||v;for(var a=0;a<e.length;a++)r(e[a],a,t,void 0)}}catch(e){if(e instanceof h)return e;throw e}}function O(e,t){if(e===t)return!0;if(e&&t&&"object"==typeof e&&"object"==typeof t){var r,a,i,n=Array.isArray(e),s=Array.isArray(t);if(n&&s){if((a=e.length)!=t.length)return!1;for(r=a;0!=r--;)if(!O(e[r],t[r]))return!1;return!0}if(n!=s)return!1;var o=Object.keys(e);if((a=o.length)!==Object.keys(t).length)return!1;for(r=a;0!=r--;)if(!t.hasOwnProperty(o[r]))return!1;for(r=a;0!=r--;)if(!O(e[i=o[r]],t[i]))return!1;return!0}return e!=e&&t!=t}var I=new WeakMap;function k(e,t,r,a,i){if(t!==e){"function"==typeof t.toJSON&&(t=t.toJSON());for(var l=s(t),c=s(e),d=!1,h=c.length-1;h>=0;h--){var p=c[h],m=e[p];if(n(t,p)&&(void 0!==t[p]||void 0===m||!1!==Array.isArray(t))){var f=t[p];"object"==typeof m&&null!=m&&"object"==typeof f&&null!=f&&Array.isArray(m)===Array.isArray(f)?k(m,f,r,a+"/"+u(p),i):m!==f&&(i&&r.push({op:"test",path:a+"/"+u(p),value:o(m)}),r.push({op:"replace",path:a+"/"+u(p),value:o(f)}))}else Array.isArray(e)===Array.isArray(t)?(i&&r.push({op:"test",path:a+"/"+u(p),value:o(m)}),r.push({op:"remove",path:a+"/"+u(p)}),d=!0):(i&&r.push({op:"test",path:a,value:e}),r.push({op:"replace",path:a,value:t}))}if(d||l.length!=c.length)for(var h=0;h<l.length;h++){var p=l[h];n(e,p)||void 0===t[p]||r.push({op:"add",path:a+"/"+u(p),value:o(t[p])})}}}function E(e,t,r=!1){var a=[];return k(e,t,a,"",r),a}({...a})},82661:e=>{"use strict";var t=Object.prototype.hasOwnProperty,r="~";function a(){}function i(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function n(e,t,a,n,s){if("function"!=typeof a)throw TypeError("The listener must be a function");var o=new i(a,n||e,s),l=r?r+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],o]:e._events[l].push(o):(e._events[l]=o,e._eventsCount++),e}function s(e,t){0==--e._eventsCount?e._events=new a:delete e._events[t]}function o(){this._events=new a,this._eventsCount=0}Object.create&&(a.prototype=Object.create(null),new a().__proto__||(r=!1)),o.prototype.eventNames=function(){var e,a,i=[];if(0===this._eventsCount)return i;for(a in e=this._events)t.call(e,a)&&i.push(r?a.slice(1):a);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},o.prototype.listeners=function(e){var t=r?r+e:e,a=this._events[t];if(!a)return[];if(a.fn)return[a.fn];for(var i=0,n=a.length,s=Array(n);i<n;i++)s[i]=a[i].fn;return s},o.prototype.listenerCount=function(e){var t=r?r+e:e,a=this._events[t];return a?a.fn?1:a.length:0},o.prototype.emit=function(e,t,a,i,n,s){var o=r?r+e:e;if(!this._events[o])return!1;var l,u,c=this._events[o],d=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),d){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,a),!0;case 4:return c.fn.call(c.context,t,a,i),!0;case 5:return c.fn.call(c.context,t,a,i,n),!0;case 6:return c.fn.call(c.context,t,a,i,n,s),!0}for(u=1,l=Array(d-1);u<d;u++)l[u-1]=arguments[u];c.fn.apply(c.context,l)}else{var h,p=c.length;for(u=0;u<p;u++)switch(c[u].once&&this.removeListener(e,c[u].fn,void 0,!0),d){case 1:c[u].fn.call(c[u].context);break;case 2:c[u].fn.call(c[u].context,t);break;case 3:c[u].fn.call(c[u].context,t,a);break;case 4:c[u].fn.call(c[u].context,t,a,i);break;default:if(!l)for(h=1,l=Array(d-1);h<d;h++)l[h-1]=arguments[h];c[u].fn.apply(c[u].context,l)}}return!0},o.prototype.on=function(e,t,r){return n(this,e,t,r,!1)},o.prototype.once=function(e,t,r){return n(this,e,t,r,!0)},o.prototype.removeListener=function(e,t,a,i){var n=r?r+e:e;if(!this._events[n])return this;if(!t)return s(this,n),this;var o=this._events[n];if(o.fn)o.fn!==t||i&&!o.once||a&&o.context!==a||s(this,n);else{for(var l=0,u=[],c=o.length;l<c;l++)(o[l].fn!==t||i&&!o[l].once||a&&o[l].context!==a)&&u.push(o[l]);u.length?this._events[n]=1===u.length?u[0]:u:s(this,n)}return this},o.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&s(this,t)):(this._events=new a,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=r,o.EventEmitter=o,e.exports=o},82851:(e,t,r)=>{"use strict";let a,i,n;r.d(t,{Az:()=>g,Ec:()=>m,Jz:()=>y,yk:()=>f});var s=r(3666),o=r(49509);let l=()=>"undefined"!=typeof window&&void 0!==window.document,u=()=>"object"==typeof globalThis&&globalThis.constructor&&"DedicatedWorkerGlobalScope"===globalThis.constructor.name,c=()=>"undefined"!=typeof window&&"nodejs"===window.name||"undefined"!=typeof navigator&&navigator.userAgent.includes("jsdom"),d=()=>"undefined"!=typeof Deno,h=()=>void 0!==o&&void 0!==o.versions&&void 0!==o.versions.node&&!d(),p=()=>a||(a=l()?"browser":h()?"node":u()?"webworker":c()?"jsdom":d()?"deno":"other");function m(){if(void 0===i){let e=p(),t=function(){if(void 0!==n)return n;let e={};for(let t of["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","GITHUB_SHA","TRAVIS_COMMIT","GIT_COMMIT","BUILD_VCS_NUMBER","bamboo_planRepository_revision","Build.SourceVersion","BITBUCKET_COMMIT","DRONE_COMMIT_SHA","SEMAPHORE_GIT_SHA","BUILDKITE_COMMIT"]){let r=g(t);void 0!==r&&(e[t]=r)}return n=e,e}();i={library:"langsmith",runtime:e,sdk:"langsmith-js",sdk_version:s.Ls,...t}}return i}function f(){let e=function(){try{if(void 0!==o&&o.env)return Object.entries(o.env).reduce((e,[t,r])=>(e[t]=String(r),e),{});return}catch(e){return}}()||{},t={},r=["LANGCHAIN_API_KEY","LANGCHAIN_ENDPOINT","LANGCHAIN_TRACING_V2","LANGCHAIN_PROJECT","LANGCHAIN_SESSION","LANGSMITH_API_KEY","LANGSMITH_ENDPOINT","LANGSMITH_TRACING_V2","LANGSMITH_PROJECT","LANGSMITH_SESSION"];for(let[a,i]of Object.entries(e))(a.startsWith("LANGCHAIN_")||a.startsWith("LANGSMITH_"))&&"string"==typeof i&&!r.includes(a)&&!a.toLowerCase().includes("key")&&!a.toLowerCase().includes("secret")&&!a.toLowerCase().includes("token")&&("LANGCHAIN_REVISION_ID"===a?t.revision_id=i:t[a]=i);return t}function g(e){try{return void 0!==o?o.env?.[e]:void 0}catch(e){return}}function y(e){return g(`LANGSMITH_${e}`)||g(`LANGCHAIN_${e}`)}},83930:e=>{"use strict";let t=/^[0-9]+$/,r=(e,r)=>{let a=t.test(e),i=t.test(r);return a&&i&&(e*=1,r*=1),e===r?0:a&&!i?-1:i&&!a?1:e<r?-1:1};e.exports={compareIdentifiers:r,rcompareIdentifiers:(e,t)=>r(t,e)}},84896:(e,t,r)=>{e.exports=r(90342)},85560:e=>{"use strict";let t=/[\p{Lu}]/u,r=/[\p{Ll}]/u,a=/^[\p{Lu}](?![\p{Lu}])/gu,i=/([\p{Alpha}\p{N}_]|$)/u,n=/[_.\- ]+/,s=RegExp("^"+n.source),o=RegExp(n.source+i.source,"gu"),l=RegExp("\\d+"+i.source,"gu"),u=(e,a,i)=>{let n=!1,s=!1,o=!1;for(let l=0;l<e.length;l++){let u=e[l];n&&t.test(u)?(e=e.slice(0,l)+"-"+e.slice(l),n=!1,o=s,s=!0,l++):s&&o&&r.test(u)?(e=e.slice(0,l-1)+"-"+e.slice(l-1),o=s,s=!1,n=!0):(n=a(u)===u&&i(u)!==u,o=s,s=i(u)===u&&a(u)!==u)}return e},c=(e,t)=>(a.lastIndex=0,e.replace(a,e=>t(e))),d=(e,t)=>(o.lastIndex=0,l.lastIndex=0,e.replace(o,(e,r)=>t(r)).replace(l,e=>t(e))),h=(e,t)=>{if(!("string"==typeof e||Array.isArray(e)))throw TypeError("Expected the input to be `string | string[]`");if(t={pascalCase:!1,preserveConsecutiveUppercase:!1,...t},0===(e=Array.isArray(e)?e.map(e=>e.trim()).filter(e=>e.length).join("-"):e.trim()).length)return"";let r=!1===t.locale?e=>e.toLowerCase():e=>e.toLocaleLowerCase(t.locale),a=!1===t.locale?e=>e.toUpperCase():e=>e.toLocaleUpperCase(t.locale);return 1===e.length?t.pascalCase?a(e):r(e):(e!==r(e)&&(e=u(e,r,a)),e=e.replace(s,""),e=t.preserveConsecutiveUppercase?c(e,r):r(e),t.pascalCase&&(e=a(e.charAt(0))+e.slice(1)),d(e,a))};e.exports=h,e.exports.default=h},85670:(e,t,r)=>{"use strict";let a=r(42870);e.exports=(e,t)=>new a(e,t).set.map(e=>e.map(e=>e.value).join(" ").trim().split(" "))},86951:(e,t,r)=>{"use strict";r.d(t,{gk:()=>g,m5:()=>y});var a=r(35745),i=r(32417),n=r(3204);let s=function(e){if(!(0,n.A)(e))throw TypeError("Invalid UUID");var t,r=new Uint8Array(16);return r[0]=(t=parseInt(e.slice(0,8),16))>>>24,r[1]=t>>>16&255,r[2]=t>>>8&255,r[3]=255&t,r[4]=(t=parseInt(e.slice(9,13),16))>>>8,r[5]=255&t,r[6]=(t=parseInt(e.slice(14,18),16))>>>8,r[7]=255&t,r[8]=(t=parseInt(e.slice(19,23),16))>>>8,r[9]=255&t,r[10]=(t=parseInt(e.slice(24,36),16))/0x10000000000&255,r[11]=t/0x100000000&255,r[12]=t>>>24&255,r[13]=t>>>16&255,r[14]=t>>>8&255,r[15]=255&t,r};function o(e,t){return e<<t|e>>>32-t}var l=function(e,t,r){function a(e,t,a,n){if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));for(var t=[],r=0;r<e.length;++r)t.push(e.charCodeAt(r));return t}(e)),"string"==typeof t&&(t=s(t)),(null===(o=t)||void 0===o?void 0:o.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var o,l=new Uint8Array(16+e.length);if(l.set(t),l.set(e,t.length),(l=r(l))[6]=15&l[6]|80,l[8]=63&l[8]|128,a){n=n||0;for(var u=0;u<16;++u)a[n+u]=l[u];return a}return(0,i.k)(l)}try{a.name="v5"}catch(e){}return a.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",a.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",a}(0,0,function(e){var t=[0x5a827999,0x6ed9eba1,0x8f1bbcdc,0xca62c1d6],r=[0x67452301,0xefcdab89,0x98badcfe,0x10325476,0xc3d2e1f0];if("string"==typeof e){var a=unescape(encodeURIComponent(e));e=[];for(var i=0;i<a.length;++i)e.push(a.charCodeAt(i))}else Array.isArray(e)||(e=Array.prototype.slice.call(e));e.push(128);for(var n=Math.ceil((e.length/4+2)/16),s=Array(n),l=0;l<n;++l){for(var u=new Uint32Array(16),c=0;c<16;++c)u[c]=e[64*l+4*c]<<24|e[64*l+4*c+1]<<16|e[64*l+4*c+2]<<8|e[64*l+4*c+3];s[l]=u}s[n-1][14]=(e.length-1)*8/0x100000000,s[n-1][14]=Math.floor(s[n-1][14]),s[n-1][15]=(e.length-1)*8&0xffffffff;for(var d=0;d<n;++d){for(var h=new Uint32Array(80),p=0;p<16;++p)h[p]=s[d][p];for(var m=16;m<80;++m)h[m]=o(h[m-3]^h[m-8]^h[m-14]^h[m-16],1);for(var f=r[0],g=r[1],y=r[2],b=r[3],_=r[4],v=0;v<80;++v){var w=Math.floor(v/20),O=o(f,5)+function(e,t,r,a){switch(e){case 0:return t&r^~t&a;case 1:case 3:return t^r^a;case 2:return t&r^t&a^r&a}}(w,g,y,b)+_+t[w]+h[v]>>>0;_=b,b=y,y=o(g,30)>>>0,g=f,f=O}r[0]=r[0]+f>>>0,r[1]=r[1]+g>>>0,r[2]=r[2]+y>>>0,r[3]=r[3]+b>>>0,r[4]=r[4]+_>>>0}return[r[0]>>24&255,r[0]>>16&255,r[0]>>8&255,255&r[0],r[1]>>24&255,r[1]>>16&255,r[1]>>8&255,255&r[1],r[2]>>24&255,r[2]>>16&255,r[2]>>8&255,255&r[2],r[3]>>24&255,r[3]>>16&255,r[3]>>8&255,255&r[3],r[4]>>24&255,r[4]>>16&255,r[4]>>8&255,255&r[4]]}),u=r(25795),c=r(82851);let d=e=>void 0!==e?e:!!["TRACING_V2","TRACING"].find(e=>"true"===(0,c.Jz)(e)),h=Symbol.for("lc:context_variables");var p=r(46725),m=r(34544);class f{constructor(e,t,r,a){Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.metadata=e,this.tags=t,this.project_name=r,this.replicas=a}static fromHeader(e){let t,r;let a=e.split(","),i={},n=[];for(let e of a){let[a,s]=e.split("="),o=decodeURIComponent(s);"langsmith-metadata"===a?i=JSON.parse(o):"langsmith-tags"===a?n=o.split(","):"langsmith-project"===a?t=o:"langsmith-replicas"===a&&(r=JSON.parse(o))}return new f(i,n,t,r)}toHeader(){let e=[];return this.metadata&&Object.keys(this.metadata).length>0&&e.push(`langsmith-metadata=${encodeURIComponent(JSON.stringify(this.metadata))}`),this.tags&&this.tags.length>0&&e.push(`langsmith-tags=${encodeURIComponent(this.tags.join(","))}`),this.project_name&&e.push(`langsmith-project=${encodeURIComponent(this.project_name)}`),e.join(",")}}class g{constructor(e){if(Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"run_type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_runs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"end_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"extra",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"error",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"serialized",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reference_example_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"events",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"trace_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dotted_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingEnabled",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"attachments",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),y(e)){Object.assign(this,{...e});return}let t=g.getDefaultConfig(),{metadata:r,...a}=e,i=a.client??g.getSharedClient(),n={...r,...a?.extra?.metadata};if(a.extra={...a.extra,metadata:n},Object.assign(this,{...t,...a,client:i}),this.trace_id||(this.parent_run?this.trace_id=this.parent_run.trace_id??this.id:this.trace_id=this.id),this.execution_order??=1,this.child_execution_order??=1,!this.dotted_order){let e=function(e,t,r=1){let a=r.toFixed(0).slice(0,3).padStart(3,"0");return`${new Date(e).toISOString().slice(0,-1)}${a}Z`.replace(/[-:.]/g,"")+t}(this.start_time,this.id,this.execution_order);this.parent_run?this.dotted_order=this.parent_run.dotted_order+"."+e:this.dotted_order=e}}set metadata(e){this.extra={...this.extra,metadata:{...this.extra?.metadata,...e}}}get metadata(){return this.extra?.metadata}static getDefaultConfig(){return{id:a.A(),run_type:"chain",project_name:(0,p.q)(),child_runs:[],api_url:(0,c.Az)("LANGCHAIN_ENDPOINT")??"http://localhost:1984",api_key:(0,c.Az)("LANGCHAIN_API_KEY"),caller_options:{},start_time:Date.now(),serialized:{},inputs:{},extra:{}}}static getSharedClient(){return g.sharedClient||(g.sharedClient=new u.Kj),g.sharedClient}createChild(e){var t,r;let a=this.child_execution_order+1,i=new g({...e,parent_run:this,project_name:this.project_name,replicas:this.replicas,client:this.client,tracingEnabled:this.tracingEnabled,execution_order:a,child_execution_order:a});h in this&&(i[h]=this[h]);let n=Symbol.for("lc:child_config"),s=e.extra?.[n]??this.extra[n];if(void 0!==(t=s)&&"object"==typeof t.callbacks&&(_(t.callbacks?.handlers)||_(t.callbacks))){let e={...s},t="object"==typeof(r=e.callbacks)&&null!=r&&Array.isArray(r.handlers)?e.callbacks.copy?.():void 0;t&&(Object.assign(t,{_parentRunId:i.id}),t.handlers?.find(b)?.updateFromRunTree?.(i),e.callbacks=t),i.extra[n]=e}let o=new Set,l=this;for(;null!=l&&!o.has(l.id);)o.add(l.id),l.child_execution_order=Math.max(l.child_execution_order,a),l=l.parent_run;return this.child_runs.push(i),i}async end(e,t,r=Date.now(),a){this.outputs=this.outputs??e,this.error=this.error??t,this.end_time=this.end_time??r,a&&Object.keys(a).length>0&&(this.extra=this.extra?{...this.extra,metadata:{...this.extra.metadata,...a}}:{metadata:a})}_convertToCreate(e,t,r=!0){let a,i;let n=e.extra??{};if(n?.runtime?.library===void 0&&(n.runtime||(n.runtime={}),t))for(let[e,r]of Object.entries(t))n.runtime[e]||(n.runtime[e]=r);return r?(i=e.parent_run?.id,a=[]):(a=e.child_runs.map(e=>this._convertToCreate(e,t,r)),i=void 0),{id:e.id,name:e.name,start_time:e.start_time,end_time:e.end_time,run_type:e.run_type,reference_example_id:e.reference_example_id,extra:n,serialized:e.serialized,error:e.error,inputs:e.inputs,outputs:e.outputs,session_name:e.project_name,child_runs:a,parent_run_id:i,trace_id:e.trace_id,dotted_order:e.dotted_order,tags:e.tags,attachments:e.attachments,events:e.events}}_remapForProject(e,t,r=!0){let a;let i=this._convertToCreate(this,t,r);if(e===this.project_name)return i;let n=t=>l(`${t}:${e}`,l.DNS),s=n(i.id),o=i.trace_id?n(i.trace_id):void 0,u=i.parent_run_id?n(i.parent_run_id):void 0;if(i.dotted_order){let e=i.dotted_order.split(".").map(e=>{let t=e.slice(0,-36),r=e.slice(-36),a=parseInt(t.slice(0,4)),i=parseInt(t.slice(4,6))-1,n=parseInt(t.slice(6,8)),s=parseInt(t.slice(9,11)),o=parseInt(t.slice(11,13));return[new Date(a,i,n,s,o,parseInt(t.slice(13,15)),parseInt(t.slice(15,21))/1e3),r]}),t=[];for(let r=0;r<e.length-1;r++){let[a,i]=e[r],s=n(i);t.push(a.toISOString().replace(/[-:]/g,"").replace(".","")+s)}let[r]=e[e.length-1];t.push(r.toISOString().replace(/[-:]/g,"").replace(".","")+s),a=t.join(".")}else a=void 0;return{...i,id:s,trace_id:o,parent_run_id:u,dotted_order:a,session_name:e}}async postRun(e=!0){try{let t=(0,c.Ec)();if(this.replicas&&this.replicas.length>0)for(let[e]of this.replicas){let r=this._remapForProject(e,t,!0);await this.client.createRun(r)}else{let r=this._convertToCreate(this,t,e);await this.client.createRun(r)}if(!e)for(let e of((0,m.m)("Posting with excludeChildRuns=false is deprecated and will be removed in a future version."),this.child_runs))await e.postRun(!1)}catch(e){console.error(`Error in postRun for run ${this.id}:`,e)}}async patchRun(){if(this.replicas&&this.replicas.length>0)for(let[e,t]of this.replicas){let r=this._remapForProject(e);await this.client.updateRun(r.id,{inputs:r.inputs,outputs:r.outputs,error:r.error,parent_run_id:r.parent_run_id,session_name:r.session_name,reference_example_id:r.reference_example_id,end_time:r.end_time,dotted_order:r.dotted_order,trace_id:r.trace_id,events:r.events,tags:r.tags,extra:r.extra,attachments:this.attachments,...t})}else try{let e={end_time:this.end_time,error:this.error,inputs:this.inputs,outputs:this.outputs,parent_run_id:this.parent_run?.id,reference_example_id:this.reference_example_id,extra:this.extra,events:this.events,dotted_order:this.dotted_order,trace_id:this.trace_id,tags:this.tags,attachments:this.attachments,session_name:this.project_name};await this.client.updateRun(this.id,e)}catch(e){console.error(`Error in patchRun for run ${this.id}`,e)}}toJSON(){return this._convertToCreate(this,void 0,!1)}addEvent(e){this.events||(this.events=[]),"string"==typeof e?this.events.push({name:"event",time:new Date().toISOString(),message:e}):this.events.push({...e,time:e.time??new Date().toISOString()})}static fromRunnableConfig(e,t){let r,a,i;let n=e?.callbacks,s=d();if(n){let e=n?.getParentRunId?.()??"",t=n?.handlers?.find(e=>e?.name=="langchain_tracer");r=t?.getRun?.(e),a=t?.projectName,i=t?.client,s=s||!!t}return r?new g({name:r.name,id:r.id,trace_id:r.trace_id,dotted_order:r.dotted_order,client:i,tracingEnabled:s,project_name:a,tags:[...new Set((r?.tags??[]).concat(e?.tags??[]))],extra:{metadata:{...r?.extra?.metadata,...e?.metadata}}}).createChild(t):new g({...t,client:i,tracingEnabled:s,project_name:a})}static fromDottedOrder(e){return this.fromHeaders({"langsmith-trace":e})}static fromHeaders(e,t){let r="get"in e&&"function"==typeof e.get?{"langsmith-trace":e.get("langsmith-trace"),baggage:e.get("baggage")}:e,a=r["langsmith-trace"];if(!a||"string"!=typeof a)return;let i=a.trim(),n=i.split(".").map(e=>{let[t,r]=e.split("Z");return{strTime:t,time:Date.parse(t+"Z"),uuid:r}}),s=n[0].uuid,o={...t,name:t?.name??"parent",run_type:t?.run_type??"chain",start_time:t?.start_time??Date.now(),id:n.at(-1)?.uuid,trace_id:s,dotted_order:i};if(r.baggage&&"string"==typeof r.baggage){let e=f.fromHeader(r.baggage);o.metadata=e.metadata,o.tags=e.tags,o.project_name=e.project_name,o.replicas=e.replicas}return new g(o)}toHeaders(e){let t={"langsmith-trace":this.dotted_order,baggage:new f(this.extra?.metadata,this.tags,this.project_name,this.replicas).toHeader()};if(e)for(let[r,a]of Object.entries(t))e.set(r,a);return t}}function y(e){return void 0!==e&&"function"==typeof e.createChild&&"function"==typeof e.postRun}function b(e){return"object"==typeof e&&null!=e&&"string"==typeof e.name&&"langchain_tracer"===e.name}function _(e){return Array.isArray(e)&&e.some(e=>b(e))}Object.defineProperty(g,"sharedClient",{enumerable:!0,configurable:!0,writable:!0,value:null})},87150:(e,t,r)=>{"use strict";r.d(t,{DS:()=>u,Tr:()=>l,bO:()=>s,gI:()=>o,xW:()=>function e(t,r){if(Array.isArray(t)&&Array.isArray(r))return t.concat(r);if("string"==typeof t&&"string"==typeof r)return t+r;if("number"==typeof t&&"number"==typeof r)return t+r;if("concat"in t&&"function"==typeof t.concat)return t.concat(r);if("object"==typeof t&&"object"==typeof r){let a={...t};for(let[t,i]of Object.entries(r))t in a&&!Array.isArray(a[t])?a[t]=e(a[t],i):a[t]=i;return a}else throw Error(`Cannot concat ${typeof t} and ${typeof r}`)}});var a=r(92173),i=r(89351),n=r(67146);class s extends ReadableStream{constructor(){super(...arguments),Object.defineProperty(this,"reader",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}ensureReader(){this.reader||(this.reader=this.getReader())}async next(){this.ensureReader();try{let e=await this.reader.read();if(e.done)return this.reader.releaseLock(),{done:!0,value:void 0};return{done:!1,value:e.value}}catch(e){throw this.reader.releaseLock(),e}}async return(){if(this.ensureReader(),this.locked){let e=this.reader.cancel();this.reader.releaseLock(),await e}return{done:!0,value:void 0}}async throw(e){if(this.ensureReader(),this.locked){let e=this.reader.cancel();this.reader.releaseLock(),await e}throw e}[Symbol.asyncIterator](){return this}async [Symbol.asyncDispose](){await this.return()}static fromReadableStream(e){let t=e.getReader();return new s({start:e=>(function r(){return t.read().then(({done:t,value:a})=>{if(t){e.close();return}return e.enqueue(a),r()})})(),cancel(){t.releaseLock()}})}static fromAsyncGenerator(e){return new s({async pull(t){let{value:r,done:a}=await e.next();a&&t.close(),t.enqueue(r)},async cancel(t){await e.return(t)}})}}function o(e,t=2){let r=Array.from({length:t},()=>[]);return r.map(async function*(t){for(;;)if(0===t.length){let t=await e.next();for(let e of r)e.push(t)}else{if(t[0].done)return;yield t.shift().value}})}class l{constructor(e){Object.defineProperty(this,"generator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"setup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"signal",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResult",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResultUsed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.generator=e.generator,this.config=e.config,this.signal=e.signal??this.config?.signal,this.setup=new Promise((t,r)=>{i.Nx.runWithConfig((0,a.DY)(e.config),async()=>{this.firstResult=e.generator.next(),e.startSetup?this.firstResult.then(e.startSetup).then(t,r):this.firstResult.then(e=>t(void 0),r)},!0)})}async next(...e){return(this.signal?.throwIfAborted(),this.firstResultUsed)?i.Nx.runWithConfig((0,a.DY)(this.config),this.signal?async()=>(0,n.o)(this.generator.next(...e),this.signal):async()=>this.generator.next(...e),!0):(this.firstResultUsed=!0,this.firstResult)}async return(e){return this.generator.return(e)}async throw(e){return this.generator.throw(e)}[Symbol.asyncIterator](){return this}async [Symbol.asyncDispose](){await this.return()}}async function u(e,t,r,a,...i){let n=new l({generator:t,startSetup:r,signal:a}),s=await n.setup;return{output:e(n,s,...i),setup:s}}},88193:(e,t,r)=>{"use strict";let a=r(36053);e.exports=(e,t,r)=>new a(e,r).compare(new a(t,r))},89351:(e,t,r)=>{"use strict";r.d(t,{Nx:()=>c});var a=r(3479),i=r(44768),n=r(80918);class s{getStore(){}run(e,t){return t()}enterWith(e){}}let o=new s,l=Symbol.for("lc:child_config");class u{getInstance(){return(0,i.X0)()??o}getRunnableConfig(){let e=this.getInstance();return e.getStore()?.extra?.[l]}runWithConfig(e,t,r){let s;let o=n.Td._configureSync(e?.callbacks,void 0,e?.tags,void 0,e?.metadata),u=this.getInstance(),c=u.getStore(),d=o?.getParentRunId(),h=o?.handlers?.find(e=>e?.name==="langchain_tracer");return h&&d?s=h.getRunTreeWithTracingConfig(d):r||(s=new a.gk({name:"<runnable_lambda>",tracingEnabled:!1})),s&&(s.extra={...s.extra,[l]:e}),void 0!==c&&void 0!==c[i.hr]&&(void 0===s&&(s={}),s[i.hr]=c[i.hr]),u.run(s,t)}initializeGlobalInstance(e){void 0===(0,i.X0)()&&(0,i.pH)(e)}}let c=new u},89377:(e,t,r)=>{"use strict";let a=r(36053);e.exports=(e,t,r=!1)=>{if(e instanceof a)return e;try{return new a(e,t)}catch(e){if(!r)return null;throw e}}},90338:(e,t,r)=>{"use strict";r.d(t,{K0:()=>m,Sw:()=>f,ih:()=>g});var a=r(42452),i=r(28809),n=r(41039),s=r(64520),o=r(71151),l=r(76937),u=r(62886),c=r(91356),d=r(27231);function h(e){return(0,i.Ky)(e)?e:"string"==typeof e.id&&"function"===e.type&&"object"==typeof e.function&&null!==e.function&&"arguments"in e.function&&"string"==typeof e.function.arguments&&"name"in e.function&&"string"==typeof e.function.name?{id:e.id,args:JSON.parse(e.function.arguments),name:e.function.name,type:"tool_call"}:e}function p(e){let t,r;if("object"==typeof e&&null!=e&&1===e.lc&&Array.isArray(e.id)&&null!=e.kwargs&&"object"==typeof e.kwargs){let a=e.id.at(-1);t="HumanMessage"===a||"HumanMessageChunk"===a?"user":"AIMessage"===a||"AIMessageChunk"===a?"assistant":"SystemMessage"===a||"SystemMessageChunk"===a?"system":"FunctionMessage"===a||"FunctionMessageChunk"===a?"function":"ToolMessage"===a||"ToolMessageChunk"===a?"tool":"unknown",r=e.kwargs}else{let{type:a,...i}=e;t=a,r=i}if("human"===t||"user"===t)return new u.xc(r);if("ai"===t||"assistant"===t){let{tool_calls:e,...t}=r;if(!Array.isArray(e))return new n.Od(r);let a=e.map(h);return new n.Od({...t,tool_calls:a})}if("system"===t)return new c.tn(r);if("developer"===t)return new c.tn({...r,additional_kwargs:{...r.additional_kwargs,__openai_role__:"developer"}});if("tool"===t&&"tool_call_id"in r)return new d.uf({...r,content:r.content,tool_call_id:r.tool_call_id,name:r.name});else throw(0,a.Y)(Error(`Unable to coerce message from array: only human, AI, system, developer, or tool message coercion is currently supported.

Received: ${JSON.stringify(e,null,2)}`),"MESSAGE_COERCION_FAILURE")}function m(e){if("string"==typeof e)return new u.xc(e);if((0,s.ny)(e))return e;if(Array.isArray(e)){let[t,r]=e;return p({type:t,content:r})}if(!(0,s.dp)(e))return p(e);{let{role:t,...r}=e;return p({...r,type:t})}}function f(e,t="Human",r="AI"){let a=[];for(let i of e){let e;if("human"===i._getType())e=t;else if("ai"===i._getType())e=r;else if("system"===i._getType())e="System";else if("function"===i._getType())e="Function";else if("tool"===i._getType())e="Tool";else if("generic"===i._getType())e=i.role;else throw Error(`Got unsupported message type: ${i._getType()}`);let n=i.name?`${i.name}, `:"",s="string"==typeof i.content?i.content:JSON.stringify(i.content,null,2);a.push(`${e}: ${n}${s}`)}return a.join("\n")}function g(e){let t=e._getType();if("human"===t)return new u.a7({...e});if("ai"===t){let t={...e};return"tool_calls"in t&&(t={...t,tool_call_chunks:t.tool_calls?.map(e=>({...e,type:"tool_call_chunk",index:void 0,args:JSON.stringify(e.args)}))}),new n.H({...t})}if("system"===t)return new c.uU({...e});if("function"===t)return new l.FK({...e});if(o.cM.isInstance(e))return new o.XU({...e});else throw Error("Unknown message type.")}},90342:(e,t,r)=>{var a=r(29200);t.operation=function(e){return new a(t.timeouts(e),{forever:e&&(e.forever||e.retries===1/0),unref:e&&e.unref,maxRetryTime:e&&e.maxRetryTime})},t.timeouts=function(e){if(e instanceof Array)return[].concat(e);var t={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var r in e)t[r]=e[r];if(t.minTimeout>t.maxTimeout)throw Error("minTimeout is greater than maxTimeout");for(var a=[],i=0;i<t.retries;i++)a.push(this.createTimeout(i,t));return e&&e.forever&&!a.length&&a.push(this.createTimeout(i,t)),a.sort(function(e,t){return e-t}),a},t.createTimeout=function(e,t){var r=Math.round((t.randomize?Math.random()+1:1)*Math.max(t.minTimeout,1)*Math.pow(t.factor,e));return Math.min(r,t.maxTimeout)},t.wrap=function(e,r,a){if(r instanceof Array&&(a=r,r=null),!a)for(var i in a=[],e)"function"==typeof e[i]&&a.push(i);for(var n=0;n<a.length;n++){var s=a[n],o=e[s];e[s]=(function(a){var i=t.operation(r),n=Array.prototype.slice.call(arguments,1),s=n.pop();n.push(function(e){!i.retry(e)&&(e&&(arguments[0]=i.mainError()),s.apply(this,arguments))}),i.attempt(function(){a.apply(e,n)})}).bind(e,o),e[s].options=r}}},91356:(e,t,r)=>{"use strict";r.d(t,{tn:()=>i,uU:()=>n});var a=r(64520);class i extends a.XQ{static lc_name(){return"SystemMessage"}_getType(){return"system"}constructor(e,t){super(e,t)}}class n extends a.gj{static lc_name(){return"SystemMessageChunk"}_getType(){return"system"}constructor(e,t){super(e,t)}concat(e){return new n({content:(0,a._I)(this.content,e.content),additional_kwargs:(0,a.ns)(this.additional_kwargs,e.additional_kwargs),response_metadata:(0,a.ns)(this.response_metadata,e.response_metadata),id:this.id??e.id})}}},91481:(e,t,r)=>{"use strict";r.d(t,{HY:()=>o,aB:()=>l,vX:()=>u});var a=r(23931),i=r(62886),n=r(90338);class s extends a.y{}class o extends s{static lc_name(){return"StringPromptValue"}constructor(e){super({value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.value=e}toString(){return this.value}toChatMessages(){return[new i.xc(this.value)]}}class l extends s{static lc_name(){return"ChatPromptValue"}constructor(e){Array.isArray(e)&&(e={messages:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.messages=e.messages}toString(){return(0,n.Sw)(this.messages)}toChatMessages(){return this.messages}}class u extends s{static lc_name(){return"ImagePromptValue"}constructor(e){"imageUrl"in e||(e={imageUrl:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"imageUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.imageUrl=e.imageUrl}toString(){return this.imageUrl.url}toChatMessages(){return[new i.xc({content:[{type:"image_url",image_url:{detail:this.imageUrl.detail,url:this.imageUrl.url}}]})]}}},92078:(e,t,r)=>{"use strict";r.d(t,{A:()=>l});let a={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};for(var i,n=new Uint8Array(16),s=[],o=0;o<256;++o)s.push((o+256).toString(16).slice(1));let l=function(e,t,r){if(a.randomUUID&&!t&&!e)return a.randomUUID();var o=(e=e||{}).random||(e.rng||function(){if(!i&&!(i="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return i(n)})();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t){r=r||0;for(var l=0;l<16;++l)t[r+l]=o[l];return t}return function(e,t=0){return(s[e[t+0]]+s[e[t+1]]+s[e[t+2]]+s[e[t+3]]+"-"+s[e[t+4]]+s[e[t+5]]+"-"+s[e[t+6]]+s[e[t+7]]+"-"+s[e[t+8]]+s[e[t+9]]+"-"+s[e[t+10]]+s[e[t+11]]+s[e[t+12]]+s[e[t+13]]+s[e[t+14]]+s[e[t+15]]).toLowerCase()}(o)}},92173:(e,t,r)=>{"use strict";r.d(t,{DY:()=>d,SV:()=>o,ZI:()=>u,kJ:()=>s,p_:()=>n,tn:()=>c});var a=r(80918),i=r(89351);let n=25;async function s(e){return a.Td._configureSync(e?.callbacks,void 0,e?.tags,void 0,e?.metadata)}function o(...e){let t={};for(let r of e.filter(e=>!!e))for(let e of Object.keys(r))if("metadata"===e)t[e]={...t[e],...r[e]};else if("tags"===e){let a=t[e]??[];t[e]=[...new Set(a.concat(r[e]??[]))]}else if("configurable"===e)t[e]={...t[e],...r[e]};else if("timeout"===e)void 0===t.timeout?t.timeout=r.timeout:void 0!==r.timeout&&(t.timeout=Math.min(t.timeout,r.timeout));else if("signal"===e)void 0===t.signal?t.signal=r.signal:void 0!==r.signal&&("any"in AbortSignal?t.signal=AbortSignal.any([t.signal,r.signal]):t.signal=r.signal);else if("callbacks"===e){let e=t.callbacks,i=r.callbacks;if(Array.isArray(i)){if(e){if(Array.isArray(e))t.callbacks=e.concat(i);else{let r=e.copy();for(let e of i)r.addHandler((0,a.tW)(e),!0);t.callbacks=r}}else t.callbacks=i}else if(i){if(e){if(Array.isArray(e)){let r=i.copy();for(let t of e)r.addHandler((0,a.tW)(t),!0);t.callbacks=r}else t.callbacks=new a.Td(i._parentRunId,{handlers:e.handlers.concat(i.handlers),inheritableHandlers:e.inheritableHandlers.concat(i.inheritableHandlers),tags:Array.from(new Set(e.tags.concat(i.tags))),inheritableTags:Array.from(new Set(e.inheritableTags.concat(i.inheritableTags))),metadata:{...e.metadata,...i.metadata}})}else t.callbacks=i}}else t[e]=r[e]??t[e];return t}let l=new Set(["string","number","boolean"]);function u(e){let t=i.Nx.getRunnableConfig(),r={tags:[],metadata:{},recursionLimit:25,runId:void 0};if(t){let{runId:e,runName:a,...i}=t;r=Object.entries(i).reduce((e,[t,r])=>(void 0!==r&&(e[t]=r),e),r)}if(e&&(r=Object.entries(e).reduce((e,[t,r])=>(void 0!==r&&(e[t]=r),e),r)),r?.configurable)for(let e of Object.keys(r.configurable))l.has(typeof r.configurable[e])&&!r.metadata?.[e]&&(r.metadata||(r.metadata={}),r.metadata[e]=r.configurable[e]);if(void 0!==r.timeout){if(r.timeout<=0)throw Error("Timeout must be a positive number");let e=AbortSignal.timeout(r.timeout);void 0!==r.signal?"any"in AbortSignal&&(r.signal=AbortSignal.any([r.signal,e])):r.signal=e,delete r.timeout}return r}function c(e={},{callbacks:t,maxConcurrency:r,recursionLimit:a,runName:i,configurable:n,runId:s}={}){let o=u(e);return void 0!==t&&(delete o.runName,o.callbacks=t),void 0!==a&&(o.recursionLimit=a),void 0!==r&&(o.maxConcurrency=r),void 0!==i&&(o.runName=i),void 0!==n&&(o.configurable={...o.configurable,...n}),void 0!==s&&delete o.runId,o}function d(e){return e?{configurable:e.configurable,recursionLimit:e.recursionLimit,callbacks:e.callbacks,tags:e.tags,metadata:e.metadata,maxConcurrency:e.maxConcurrency,timeout:e.timeout,signal:e.signal}:void 0}},93412:(e,t,r)=>{"use strict";r.d(t,{gk:()=>a.gk});var a=r(86951)},95132:(e,t,r)=>{"use strict";let a=r(8044);e.exports=(e,t)=>e.sort((e,r)=>a(r,e,t))},96410:(e,t,r)=>{"use strict";let a=r(88193);e.exports=(e,t)=>a(e,t,!0)},96596:(e,t)=>{"use strict";self.Headers,self.Request,self.Response,self.fetch},98344:(e,t,r)=>{"use strict";let a=r(88193);e.exports=(e,t,r)=>a(e,t,r)>=0},99548:(e,t,r)=>{"use strict";let a=r(56655),i=r(81979),n=r(36053),s=r(83930),o=r(89377),l=r(31432),u=r(77015),c=r(19902),d=r(77985),h=r(29555),p=r(32463),m=r(63164),f=r(1192),g=r(88193),y=r(16587),b=r(96410),_=r(8044),v=r(76406),w=r(95132),O=r(28973),I=r(23906),k=r(34984),E=r(44726),x=r(98344),S=r(34817),P=r(48350),A=r(32227),T=r(50113),j=r(42870),N=r(43879),$=r(85670),R=r(19277),C=r(66327),L=r(26076),U=r(31107),M=r(34290),D=r(13818),F=r(23255),z=r(17877);e.exports={parse:o,valid:l,clean:u,inc:c,diff:d,major:h,minor:p,patch:m,prerelease:f,compare:g,rcompare:y,compareLoose:b,compareBuild:_,sort:v,rsort:w,gt:O,lt:I,eq:k,neq:E,gte:x,lte:S,cmp:P,coerce:A,Comparator:T,Range:j,satisfies:N,toComparators:$,maxSatisfying:R,minSatisfying:C,minVersion:L,validRange:U,outside:M,gtr:D,ltr:F,intersects:z,simplifyRange:r(41412),subset:r(43377),SemVer:n,re:a.re,src:a.src,tokens:a.t,SEMVER_SPEC_VERSION:i.SEMVER_SPEC_VERSION,RELEASE_TYPES:i.RELEASE_TYPES,compareIdentifiers:s.compareIdentifiers,rcompareIdentifiers:s.rcompareIdentifiers}},99643:(e,t,r)=>{"use strict";r.d(t,{YN:()=>G,B2:()=>er,fJ:()=>W,jY:()=>Q,ck:()=>K,zZ:()=>V,GH:()=>q,Bp:()=>et});var a=r(71153),i=r(52813),n=r(92078),s=r(54099),o=r(82591),l=r(25050),u=r(87150),c=r(41039);class d{constructor(e){Object.defineProperty(this,"ops",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.ops=e.ops??[]}concat(e){let t=this.ops.concat(e.ops),r=(0,o.X6)({},t);return new h({ops:t,state:r[r.length-1].newDocument})}}class h extends d{constructor(e){super(e),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.state=e.state}concat(e){let t=this.ops.concat(e.ops),r=(0,o.X6)(this.state,e.ops);return new h({ops:t,state:r[r.length-1].newDocument})}static fromRunLogPatch(e){let t=(0,o.X6)({},e.ops);return new h({ops:e.ops,state:t[t.length-1].newDocument})}}let p=e=>"log_stream_tracer"===e.name;async function m(e,t){if("original"===t)throw Error("Do not assign inputs with original schema drop the key for now. When inputs are added to streamLog they should be added with standardized schema for streaming events.");let{inputs:r}=e;return["retriever","llm","prompt"].includes(e.run_type)?r:1!==Object.keys(r).length||r?.input!==""?r.input:void 0}async function f(e,t){let{outputs:r}=e;return"original"===t||["retriever","llm","prompt"].includes(e.run_type)?r:void 0!==r&&1===Object.keys(r).length&&r?.output!==void 0?r.output:r}class g extends l.J{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_schemaFormat",{enumerable:!0,configurable:!0,writable:!0,value:"original"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"keyMapByRunId",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"counterMapByRunName",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"log_stream_tracer"}),Object.defineProperty(this,"lc_prefer_streaming",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.autoClose=e?.autoClose??!0,this.includeNames=e?.includeNames,this.includeTypes=e?.includeTypes,this.includeTags=e?.includeTags,this.excludeNames=e?.excludeNames,this.excludeTypes=e?.excludeTypes,this.excludeTags=e?.excludeTags,this._schemaFormat=e?._schemaFormat??this._schemaFormat,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=u.bO.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){if(e.id===this.rootId)return!1;let t=e.tags??[],r=void 0===this.includeNames&&void 0===this.includeTags&&void 0===this.includeTypes;return void 0!==this.includeNames&&(r=r||this.includeNames.includes(e.name)),void 0!==this.includeTypes&&(r=r||this.includeTypes.includes(e.run_type)),void 0!==this.includeTags&&(r=r||void 0!==t.find(e=>this.includeTags?.includes(e))),void 0!==this.excludeNames&&(r=r&&!this.excludeNames.includes(e.name)),void 0!==this.excludeTypes&&(r=r&&!this.excludeTypes.includes(e.run_type)),void 0!==this.excludeTags&&(r=r&&t.every(e=>!this.excludeTags?.includes(e))),r}async *tapOutputIterable(e,t){for await(let r of t){if(e!==this.rootId){let t=this.keyMapByRunId[e];t&&await this.writer.write(new d({ops:[{op:"add",path:`/logs/${t}/streamed_output/-`,value:r}]}))}yield r}}async onRunCreate(e){if(void 0===this.rootId&&(this.rootId=e.id,await this.writer.write(new d({ops:[{op:"replace",path:"",value:{id:e.id,name:e.name,type:e.run_type,streamed_output:[],final_output:void 0,logs:{}}}]}))),!this._includeRun(e))return;void 0===this.counterMapByRunName[e.name]&&(this.counterMapByRunName[e.name]=0),this.counterMapByRunName[e.name]+=1;let t=this.counterMapByRunName[e.name];this.keyMapByRunId[e.id]=1===t?e.name:`${e.name}:${t}`;let r={id:e.id,name:e.name,type:e.run_type,tags:e.tags??[],metadata:e.extra?.metadata??{},start_time:new Date(e.start_time).toISOString(),streamed_output:[],streamed_output_str:[],final_output:void 0,end_time:void 0};"streaming_events"===this._schemaFormat&&(r.inputs=await m(e,this._schemaFormat)),await this.writer.write(new d({ops:[{op:"add",path:`/logs/${this.keyMapByRunId[e.id]}`,value:r}]}))}async onRunUpdate(e){try{let t=this.keyMapByRunId[e.id];if(void 0===t)return;let r=[];"streaming_events"===this._schemaFormat&&r.push({op:"replace",path:`/logs/${t}/inputs`,value:await m(e,this._schemaFormat)}),r.push({op:"add",path:`/logs/${t}/final_output`,value:await f(e,this._schemaFormat)}),void 0!==e.end_time&&r.push({op:"add",path:`/logs/${t}/end_time`,value:new Date(e.end_time).toISOString()});let a=new d({ops:r});await this.writer.write(a)}finally{if(e.id===this.rootId){let t=new d({ops:[{op:"replace",path:"/final_output",value:await f(e,this._schemaFormat)}]});await this.writer.write(t),this.autoClose&&await this.writer.close()}}}async onLLMNewToken(e,t,r){let a;let i=this.keyMapByRunId[e.id];if(void 0===i)return;if(void 0!==e.inputs.messages){var n;a=void 0!==(n=r?.chunk)&&void 0!==n.message?r?.chunk:new c.H({id:`run-${e.id}`,content:t})}else a=t;let s=new d({ops:[{op:"add",path:`/logs/${i}/streamed_output_str/-`,value:t},{op:"add",path:`/logs/${i}/streamed_output/-`,value:a}]});await this.writer.write(s)}}var y=r(23294);function b({name:e,serialized:t}){return void 0!==e?e:t?.name!==void 0?t.name:t?.id!==void 0&&Array.isArray(t?.id)?t.id[t.id.length-1]:"Unnamed"}let _=e=>"event_stream_tracer"===e.name;class v extends l.J{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"runInfoMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"tappedPromises",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"event_stream_tracer"}),Object.defineProperty(this,"lc_prefer_streaming",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.autoClose=e?.autoClose??!0,this.includeNames=e?.includeNames,this.includeTypes=e?.includeTypes,this.includeTags=e?.includeTags,this.excludeNames=e?.excludeNames,this.excludeTypes=e?.excludeTypes,this.excludeTags=e?.excludeTags,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=u.bO.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){let t=e.tags??[],r=void 0===this.includeNames&&void 0===this.includeTags&&void 0===this.includeTypes;return void 0!==this.includeNames&&(r=r||this.includeNames.includes(e.name)),void 0!==this.includeTypes&&(r=r||this.includeTypes.includes(e.runType)),void 0!==this.includeTags&&(r=r||void 0!==t.find(e=>this.includeTags?.includes(e))),void 0!==this.excludeNames&&(r=r&&!this.excludeNames.includes(e.name)),void 0!==this.excludeTypes&&(r=r&&!this.excludeTypes.includes(e.runType)),void 0!==this.excludeTags&&(r=r&&t.every(e=>!this.excludeTags?.includes(e))),r}async *tapOutputIterable(e,t){let r=await t.next();if(r.done)return;let a=this.runInfoMap.get(e);if(void 0===a){yield r.value;return}function i(e,t){return"llm"===e&&"string"==typeof t?new y.mu({text:t}):t}let n=this.tappedPromises.get(e);if(void 0===n){let s;n=new Promise(e=>{s=e}),this.tappedPromises.set(e,n);try{let n={event:`on_${a.runType}_stream`,run_id:e,name:a.name,tags:a.tags,metadata:a.metadata,data:{}};for await(let e of(await this.send({...n,data:{chunk:i(a.runType,r.value)}},a),yield r.value,t))"tool"!==a.runType&&"retriever"!==a.runType&&await this.send({...n,data:{chunk:i(a.runType,e)}},a),yield e}finally{s()}}else for await(let e of(yield r.value,t))yield e}async send(e,t){this._includeRun(t)&&await this.writer.write(e)}async sendEndEvent(e,t){let r=this.tappedPromises.get(e.run_id);void 0!==r?r.then(()=>{this.send(e,t)}):await this.send(e,t)}async onLLMStart(e){let t=b(e),r=void 0!==e.inputs.messages?"chat_model":"llm",a={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:r,inputs:e.inputs};this.runInfoMap.set(e.id,a);let i=`on_${r}_start`;await this.send({event:i,data:{input:e.inputs},name:t,tags:e.tags??[],run_id:e.id,metadata:e.extra?.metadata??{}},a)}async onLLMNewToken(e,t,r){let a,i;let n=this.runInfoMap.get(e.id);if(void 0===n)throw Error(`onLLMNewToken: Run ID ${e.id} not found in run map.`);if(1!==this.runInfoMap.size){if("chat_model"===n.runType)i="on_chat_model_stream",a=r?.chunk===void 0?new c.H({content:t,id:`run-${e.id}`}):r.chunk.message;else if("llm"===n.runType)i="on_llm_stream",a=r?.chunk===void 0?new y.mu({text:t}):r.chunk;else throw Error(`Unexpected run type ${n.runType}`);await this.send({event:i,data:{chunk:a},run_id:e.id,name:n.name,tags:n.tags,metadata:n.metadata},n)}}async onLLMEnd(e){let t,r;let a=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),void 0===a)throw Error(`onLLMEnd: Run ID ${e.id} not found in run map.`);let i=e.outputs?.generations;if("chat_model"===a.runType){for(let e of i??[]){if(void 0!==r)break;r=e[0]?.message}t="on_chat_model_end"}else if("llm"===a.runType)r={generations:i?.map(e=>e.map(e=>({text:e.text,generationInfo:e.generationInfo}))),llmOutput:e.outputs?.llmOutput??{}},t="on_llm_end";else throw Error(`onLLMEnd: Unexpected run type: ${a.runType}`);await this.sendEndEvent({event:t,data:{output:r,input:a.inputs},run_id:e.id,name:a.name,tags:a.tags,metadata:a.metadata},a)}async onChainStart(e){let t=b(e),r=e.run_type??"chain",a={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:e.run_type},i={};""===e.inputs.input&&1===Object.keys(e.inputs).length?(i={},a.inputs={}):void 0!==e.inputs.input?(i.input=e.inputs.input,a.inputs=e.inputs.input):(i.input=e.inputs,a.inputs=e.inputs),this.runInfoMap.set(e.id,a),await this.send({event:`on_${r}_start`,data:i,name:t,tags:e.tags??[],run_id:e.id,metadata:e.extra?.metadata??{}},a)}async onChainEnd(e){let t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),void 0===t)throw Error(`onChainEnd: Run ID ${e.id} not found in run map.`);let r=`on_${e.run_type}_end`,a=e.inputs??t.inputs??{},i={output:e.outputs?.output??e.outputs,input:a};a.input&&1===Object.keys(a).length&&(i.input=a.input,t.inputs=a.input),await this.sendEndEvent({event:r,data:i,run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata??{}},t)}async onToolStart(e){let t=b(e),r={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:"tool",inputs:e.inputs??{}};this.runInfoMap.set(e.id,r),await this.send({event:"on_tool_start",data:{input:e.inputs??{}},name:t,run_id:e.id,tags:e.tags??[],metadata:e.extra?.metadata??{}},r)}async onToolEnd(e){let t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),void 0===t)throw Error(`onToolEnd: Run ID ${e.id} not found in run map.`);if(void 0===t.inputs)throw Error(`onToolEnd: Run ID ${e.id} is a tool call, and is expected to have traced inputs.`);let r=e.outputs?.output===void 0?e.outputs:e.outputs.output;await this.sendEndEvent({event:"on_tool_end",data:{output:r,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async onRetrieverStart(e){let t=b(e),r={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:"retriever",inputs:{query:e.inputs.query}};this.runInfoMap.set(e.id,r),await this.send({event:"on_retriever_start",data:{input:{query:e.inputs.query}},name:t,tags:e.tags??[],run_id:e.id,metadata:e.extra?.metadata??{}},r)}async onRetrieverEnd(e){let t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),void 0===t)throw Error(`onRetrieverEnd: Run ID ${e.id} not found in run map.`);await this.sendEndEvent({event:"on_retriever_end",data:{output:e.outputs?.documents??e.outputs,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async handleCustomEvent(e,t,r){let a=this.runInfoMap.get(r);if(void 0===a)throw Error(`handleCustomEvent: Run ID ${r} not found in run map.`);await this.send({event:"on_custom_event",run_id:r,name:e,tags:a.tags,metadata:a.metadata,data:t},a)}async finish(){Promise.all([...this.tappedPromises.values()]).finally(()=>{this.writer.close()})}}var w=r(23931),O=r(67146),I=r(92173),k=r(65408);class E extends l.J{constructor({config:e,onStart:t,onEnd:r,onError:a}){super({_awaitHandler:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RootListenersTracer"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnStart",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnEnd",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnError",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.config=e,this.argOnStart=t,this.argOnEnd=r,this.argOnError=a}persistRun(e){return Promise.resolve()}async onRunCreate(e){!this.rootId&&(this.rootId=e.id,this.argOnStart&&await this.argOnStart(e,this.config))}async onRunUpdate(e){e.id===this.rootId&&(e.error?this.argOnError&&await this.argOnError(e,this.config):this.argOnEnd&&await this.argOnEnd(e,this.config))}}function x(e){return!!e&&e.lc_runnable}class S{constructor(e){Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.includeNames=e.includeNames,this.includeTypes=e.includeTypes,this.includeTags=e.includeTags,this.excludeNames=e.excludeNames,this.excludeTypes=e.excludeTypes,this.excludeTags=e.excludeTags}includeEvent(e,t){let r=void 0===this.includeNames&&void 0===this.includeTypes&&void 0===this.includeTags,a=e.tags??[];return void 0!==this.includeNames&&(r=r||this.includeNames.includes(e.name)),void 0!==this.includeTypes&&(r=r||this.includeTypes.includes(t)),void 0!==this.includeTags&&(r=r||a.some(e=>this.includeTags?.includes(e))),void 0!==this.excludeNames&&(r=r&&!this.excludeNames.includes(e.name)),void 0!==this.excludeTypes&&(r=r&&!this.excludeTypes.includes(t)),void 0!==this.excludeTags&&(r=r&&a.every(e=>!this.excludeTags?.includes(e))),r}}var P=r(89351);let A=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i,T=function(e){return"string"==typeof e&&A.test(e)};function j(e){return e.replace(/[^a-zA-Z-_0-9]/g,"_")}let N=["*","_","`"];async function $(e,t){let{backgroundColor:r="white"}=t??{},a=btoa(e);void 0===r||/^#(?:[0-9a-fA-F]{3}){1,2}$/.test(r)||(r=`!${r}`);let i=`https://mermaid.ink/img/${a}?bgColor=${r}`,n=await fetch(i);if(!n.ok)throw Error(`Failed to render the graph using the Mermaid.INK API.
Status code: ${n.status}
Status text: ${n.statusText}`);return await n.blob()}var R=r(11014);class C{constructor(e){Object.defineProperty(this,"nodes",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"edges",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this.nodes=e?.nodes??this.nodes,this.edges=e?.edges??this.edges}toJSON(){let e={};return Object.values(this.nodes).forEach((t,r)=>{e[t.id]=T(t.id)?r:t.id}),{nodes:Object.values(this.nodes).map(t=>({id:e[t.id],...x(t.data)?{type:"runnable",data:{id:t.data.lc_id,name:t.data.getName()}}:{type:"schema",data:{...(0,R.PF)(t.data.schema),title:t.data.name}}})),edges:this.edges.map(t=>{let r={source:e[t.source],target:e[t.target]};return void 0!==t.data&&(r.data=t.data),void 0!==t.conditional&&(r.conditional=t.conditional),r})}}addNode(e,t,r){if(void 0!==t&&void 0!==this.nodes[t])throw Error(`Node with id ${t} already exists`);let a=t??(0,n.A)(),i={id:a,data:e,name:function(e,t){if(void 0!==e&&!T(e))return e;if(!x(t))return t.name??"UnknownSchema";try{let e=t.getName();return e=e.startsWith("Runnable")?e.slice(8):e}catch(e){return t.getName()}}(t,e),metadata:r};return this.nodes[a]=i,i}removeNode(e){delete this.nodes[e.id],this.edges=this.edges.filter(t=>t.source!==e.id&&t.target!==e.id)}addEdge(e,t,r,a){if(void 0===this.nodes[e.id])throw Error(`Source node ${e.id} not in graph`);if(void 0===this.nodes[t.id])throw Error(`Target node ${t.id} not in graph`);let i={source:e.id,target:t.id,data:r,conditional:a};return this.edges.push(i),i}firstNode(){return L(this)}lastNode(){return U(this)}extend(e,t=""){let r=t;Object.values(e.nodes).map(e=>e.id).every(T)&&(r="");let a=e=>r?`${r}:${e}`:e;Object.entries(e.nodes).forEach(([e,t])=>{this.nodes[a(e)]={...t,id:a(e)}});let i=e.edges.map(e=>({...e,source:a(e.source),target:a(e.target)}));this.edges=[...this.edges,...i];let n=e.firstNode(),s=e.lastNode();return[n?{id:a(n.id),data:n.data}:void 0,s?{id:a(s.id),data:s.data}:void 0]}trimFirstNode(){let e=this.firstNode();e&&L(this,[e.id])&&this.removeNode(e)}trimLastNode(){let e=this.lastNode();e&&U(this,[e.id])&&this.removeNode(e)}reid(){let e=Object.fromEntries(Object.values(this.nodes).map(e=>[e.id,e.name])),t=new Map;Object.values(e).forEach(e=>{t.set(e,(t.get(e)||0)+1)});let r=r=>{let a=e[r];return T(r)&&1===t.get(a)?a:r};return new C({nodes:Object.fromEntries(Object.entries(this.nodes).map(([e,t])=>[r(e),{...t,id:r(e)}])),edges:this.edges.map(e=>({...e,source:r(e.source),target:r(e.target)}))})}drawMermaid(e){let{withStyles:t,curveStyle:r,nodeColors:a={default:"fill:#f2f0ff,line-height:1.2",first:"fill-opacity:0",last:"fill:#bfb6fc"},wrapLabelNWords:i}=e??{},n=this.reid(),s=n.firstNode(),o=n.lastNode();return function(e,t,r){let{firstNode:a,lastNode:i,nodeColors:n,withStyles:s=!0,curveStyle:o="linear",wrapLabelNWords:l=9}=r??{},u=s?`%%{init: {'flowchart': {'curve': '${o}'}}}%%
graph TD;
`:"graph TD;\n";if(s){let t="default",r={[t]:"{0}({1})"};for(let[n,s]of(void 0!==a&&(r[a]="{0}([{1}]):::first"),void 0!==i&&(r[i]="{0}([{1}]):::last"),Object.entries(e))){let e=s.name.split(":").pop()??"",a=N.some(t=>e.startsWith(t)&&e.endsWith(t))?`<p>${e}</p>`:e;Object.keys(s.metadata??{}).length&&(a+=`<hr/><small><em>${Object.entries(s.metadata??{}).map(([e,t])=>`${e} = ${t}`).join("\n")}</em></small>`);let i=(r[n]??r[t]).replace("{0}",j(n)).replace("{1}",a);u+=`	${i}
`}}let c={};for(let e of t){let t=e.source.split(":"),r=e.target.split(":"),a=t.filter((e,t)=>e===r[t]).join(":");c[a]||(c[a]=[]),c[a].push(e)}let d=new Set;function h(e,t){let r=1===e.length&&e[0].source===e[0].target;if(t&&!r){let e=t.split(":").pop();if(d.has(e))throw Error(`Found duplicate subgraph '${e}' -- this likely means that you're reusing a subgraph node with the same name. Please adjust your graph to have subgraph nodes with unique names.`);d.add(e),u+=`	subgraph ${e}
`}for(let t of e){let{source:e,target:r,data:a,conditional:i}=t,n="";if(void 0!==a){let e=a,t=e.split(" ");t.length>l&&(e=Array.from({length:Math.ceil(t.length/l)},(e,r)=>t.slice(r*l,(r+1)*l).join(" ")).join("&nbsp;<br>&nbsp;")),n=i?` -. &nbsp;${e}&nbsp; .-> `:` -- &nbsp;${e}&nbsp; --> `}else n=i?" -.-> ":" --\x3e ";u+=`	${j(e)}${n}${j(r)};
`}for(let e in c)e.startsWith(`${t}:`)&&e!==t&&h(c[e],e);t&&!r&&(u+="	end\n")}for(let e in h(c[""]??[],""),c)e.includes(":")||""===e||h(c[e],e);return s&&(u+=function(e){let t="";for(let[r,a]of Object.entries(e))t+=`	classDef ${r} ${a};
`;return t}(n??{})),u}(n.nodes,n.edges,{firstNode:s?.id,lastNode:o?.id,withStyles:t,curveStyle:r,nodeColors:a,wrapLabelNWords:i})}async drawMermaidPng(e){return $(this.drawMermaid(e),{backgroundColor:e?.backgroundColor})}}function L(e,t=[]){let r=new Set(e.edges.filter(e=>!t.includes(e.source)).map(e=>e.target)),a=[];for(let i of Object.values(e.nodes))t.includes(i.id)||r.has(i.id)||a.push(i);return 1===a.length?a[0]:void 0}function U(e,t=[]){let r=new Set(e.edges.filter(e=>!t.includes(e.target)).map(e=>e.source)),a=[];for(let i of Object.values(e.nodes))t.includes(i.id)||r.has(i.id)||a.push(i);return 1===a.length?a[0]:void 0}function M(e){return"object"==typeof e&&null!==e&&"function"==typeof e[Symbol.iterator]&&"function"==typeof e.next}let D=e=>null!=e&&"object"==typeof e&&"next"in e&&"function"==typeof e.next;function F(e){return"object"==typeof e&&null!==e&&"function"==typeof e[Symbol.asyncIterator]}function*z(e,t){for(;;){let{value:r,done:a}=P.Nx.runWithConfig((0,I.DY)(e),t.next.bind(t),!0);if(a)break;yield r}}async function*B(e,t){let r=t[Symbol.asyncIterator]();for(;;){let{value:a,done:i}=await P.Nx.runWithConfig((0,I.DY)(e),r.next.bind(t),!0);if(i)break;yield a}}var Z=r(28809),J=r(34497);function q(e,t){return!e||Array.isArray(e)||e instanceof Date||"object"!=typeof e?{[t]:e}:e}class G extends w.y{constructor(){super(...arguments),Object.defineProperty(this,"lc_runnable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}getName(e){let t=this.name??this.constructor.lc_name()??this.constructor.name;return e?`${t}${e}`:t}bind(e){return new W({bound:this,kwargs:e,config:{}})}map(){return new H({bound:this})}withRetry(e){return new Y({bound:this,kwargs:{},config:{},maxAttemptNumber:e?.stopAfterAttempt,...e})}withConfig(e){return new W({bound:this,config:e,kwargs:{}})}withFallbacks(e){return new ee({runnable:this,fallbacks:Array.isArray(e)?e:e.fallbacks})}_getOptionsList(e,t=0){if(Array.isArray(e)&&e.length!==t)throw Error(`Passed "options" must be an array with the same length as the inputs, but got ${e.length} options for ${t} inputs`);if(Array.isArray(e))return e.map(I.ZI);if(t>1&&!Array.isArray(e)&&e.runId){console.warn("Provided runId will be used only for the first element of the batch.");let r=Object.fromEntries(Object.entries(e).filter(([e])=>"runId"!==e));return Array.from({length:t},(t,a)=>(0,I.ZI)(0===a?e:r))}return Array.from({length:t},()=>(0,I.ZI)(e))}async batch(e,t,r){let a=this._getOptionsList(t??{},e.length),i=a[0]?.maxConcurrency??r?.maxConcurrency,n=new k.g({maxConcurrency:i,onFailedAttempt:e=>{throw e}});return Promise.all(e.map((e,t)=>n.call(async()=>{try{return await this.invoke(e,a[t])}catch(e){if(r?.returnExceptions)return e;throw e}})))}async *_streamIterator(e,t){yield this.invoke(e,t)}async stream(e,t){let r=(0,I.ZI)(t),a=new u.Tr({generator:this._streamIterator(e,r),config:r});return await a.setup,u.bO.fromAsyncGenerator(a)}_separateRunnableConfigFromCallOptions(e){let t;t=void 0===e?(0,I.ZI)(e):(0,I.ZI)({callbacks:e.callbacks,tags:e.tags,metadata:e.metadata,runName:e.runName,configurable:e.configurable,recursionLimit:e.recursionLimit,maxConcurrency:e.maxConcurrency,runId:e.runId,timeout:e.timeout,signal:e.signal});let r={...e};return delete r.callbacks,delete r.tags,delete r.metadata,delete r.runName,delete r.configurable,delete r.recursionLimit,delete r.maxConcurrency,delete r.runId,delete r.timeout,delete r.signal,[t,r]}async _callWithConfig(e,t,r){let a;let i=(0,I.ZI)(r),n=await (0,I.kJ)(i),s=await n?.handleChainStart(this.toJSON(),q(t,"input"),i.runId,i?.runType,void 0,void 0,i?.runName??this.getName());delete i.runId;try{let n=e.call(this,t,i,s);a=await (0,O.o)(n,r?.signal)}catch(e){throw await s?.handleChainError(e),e}return await s?.handleChainEnd(q(a,"output")),a}async _batchWithConfig(e,t,r,a){let i;let n=this._getOptionsList(r??{},t.length),s=await Promise.all(n.map(I.kJ)),o=await Promise.all(s.map(async(e,r)=>{let a=await e?.handleChainStart(this.toJSON(),q(t[r],"input"),n[r].runId,n[r].runType,void 0,void 0,n[r].runName??this.getName());return delete n[r].runId,a}));try{let r=e.call(this,t,n,o,a);i=await (0,O.o)(r,n?.[0]?.signal)}catch(e){throw await Promise.all(o.map(t=>t?.handleChainError(e))),e}return await Promise.all(o.map(e=>e?.handleChainEnd(q(i,"output")))),i}async *_transformStreamWithConfig(e,t,r){let a,i,n;let s=!0,o=!0,l=(0,I.ZI)(r),c=await (0,I.kJ)(l);async function*d(){for await(let t of e){if(s){if(void 0===a)a=t;else try{a=(0,u.xW)(a,t)}catch{a=void 0,s=!1}}yield t}}try{let e=await (0,u.DS)(t.bind(this),d(),async()=>c?.handleChainStart(this.toJSON(),{input:""},l.runId,l.runType,void 0,void 0,l.runName??this.getName()),r?.signal,l);delete l.runId,n=e.setup;let a=n?.handlers.find(_),s=e.output;void 0!==a&&void 0!==n&&(s=a.tapOutputIterable(n.runId,s));let h=n?.handlers.find(p);for await(let e of(void 0!==h&&void 0!==n&&(s=h.tapOutputIterable(n.runId,s)),s))if(yield e,o){if(void 0===i)i=e;else try{i=(0,u.xW)(i,e)}catch{i=void 0,o=!1}}}catch(e){throw await n?.handleChainError(e,void 0,void 0,void 0,{inputs:q(a,"input")}),e}await n?.handleChainEnd(i??{},void 0,void 0,void 0,{inputs:q(a,"input")})}getGraph(e){let t=new C,r=t.addNode({name:`${this.getName()}Input`,schema:a.z.any()}),i=t.addNode(this),n=t.addNode({name:`${this.getName()}Output`,schema:a.z.any()});return t.addEdge(r,i),t.addEdge(i,n),t}pipe(e){return new V({first:this,last:et(e)})}pick(e){return this.pipe(new ea(e))}assign(e){return this.pipe(new er(new K({steps:e})))}async *transform(e,t){let r;for await(let t of e)r=void 0===r?t:(0,u.xW)(r,t);yield*this._streamIterator(r,(0,I.ZI)(t))}async *streamLog(e,t,r){let a=new g({...r,autoClose:!1,_schemaFormat:"original"}),i=(0,I.ZI)(t);yield*this._streamLog(e,a,i)}async *_streamLog(e,t,r){let{callbacks:a}=r;if(void 0===a)r.callbacks=[t];else if(Array.isArray(a))r.callbacks=a.concat([t]);else{let e=a.copy();e.addHandler(t,!0),r.callbacks=e}let i=this.stream(e,r),n=async function(){try{for await(let e of(await i)){let r=new d({ops:[{op:"add",path:"/streamed_output/-",value:e}]});await t.writer.write(r)}}finally{await t.writer.close()}}();try{for await(let e of t)yield e}finally{await n}}streamEvents(e,t,r){let a;if("v1"===t.version)a=this._streamEventsV1(e,t,r);else if("v2"===t.version)a=this._streamEventsV2(e,t,r);else throw Error('Only versions "v1" and "v2" of the schema are currently supported.');return"text/event-stream"===t.encoding?function(e){let t=new TextEncoder,r=new ReadableStream({async start(r){for await(let a of e)r.enqueue(t.encode(`event: data
data: ${JSON.stringify(a)}

`));r.enqueue(t.encode("event: end\n\n")),r.close()}});return u.bO.fromReadableStream(r)}(a):u.bO.fromAsyncGenerator(a)}async *_streamEventsV2(e,t,r){let a;let i=new v({...r,autoClose:!1}),s=(0,I.ZI)(t),o=s.runId??(0,n.A)();s.runId=o;let l=s.callbacks;if(void 0===l)s.callbacks=[i];else if(Array.isArray(l))s.callbacks=l.concat(i);else{let e=l.copy();e.addHandler(i,!0),s.callbacks=e}let u=new AbortController,c=this,d=async function(){try{let r;t?.signal?"any"in AbortSignal?r=AbortSignal.any([u.signal,t.signal]):(r=t.signal,t.signal.addEventListener("abort",()=>{u.abort()},{once:!0})):r=u.signal;let a=await c.stream(e,{...s,signal:r});for await(let e of i.tapOutputIterable(o,a))if(u.signal.aborted)break}finally{await i.finish()}}(),h=!1;try{for await(let t of i){if(!h){t.data.input=e,h=!0,a=t.run_id,yield t;continue}t.run_id===a&&t.event.endsWith("_end")&&t.data?.input&&delete t.data.input,yield t}}finally{u.abort(),await d}}async *_streamEventsV1(e,t,r){let a;let i=!1,n=(0,I.ZI)(t),s=n.tags??[],o=n.metadata??{},l=n.runName??this.getName(),u=new g({...r,autoClose:!1,_schemaFormat:"streaming_events"}),c=new S({...r});for await(let t of this._streamLog(e,u,n)){if(void 0===(a=a?a.concat(t):h.fromRunLogPatch(t)).state)throw Error('Internal error: "streamEvents" state is missing. Please open a bug report.');if(!i){i=!0;let t={...a.state},r={run_id:t.id,event:`on_${t.type}_start`,name:l,tags:s,metadata:o,data:{input:e}};c.includeEvent(r,t.type)&&(yield r)}for(let e of[...new Set(t.ops.filter(e=>e.path.startsWith("/logs/")).map(e=>e.path.split("/")[2]))]){let t;let r={},i=a.state.logs[e];if("start"==(t=void 0===i.end_time?i.streamed_output.length>0?"stream":"start":"end"))void 0!==i.inputs&&(r.input=i.inputs);else if("end"===t)void 0!==i.inputs&&(r.input=i.inputs),r.output=i.final_output;else if("stream"===t){let e=i.streamed_output.length;if(1!==e)throw Error(`Expected exactly one chunk of streamed output, got ${e} instead. Encountered in: "${i.name}"`);r={chunk:i.streamed_output[0]},i.streamed_output=[]}yield{event:`on_${i.type}_${t}`,name:i.name,run_id:i.id,tags:i.tags,metadata:i.metadata,data:r}}let{state:r}=a;if(r.streamed_output.length>0){let e=r.streamed_output.length;if(1!==e)throw Error(`Expected exactly one chunk of streamed output, got ${e} instead. Encountered in: "${r.name}"`);let t={chunk:r.streamed_output[0]};r.streamed_output=[];let a={event:`on_${r.type}_stream`,run_id:r.id,tags:s,metadata:o,name:l,data:t};c.includeEvent(a,r.type)&&(yield a)}}let d=a?.state;if(void 0!==d){let e={event:`on_${d.type}_end`,name:l,run_id:d.id,tags:s,metadata:o,data:{output:d.final_output}};c.includeEvent(e,d.type)&&(yield e)}}static isRunnable(e){return x(e)}withListeners({onStart:e,onEnd:t,onError:r}){return new W({bound:this,config:{},configFactories:[a=>({callbacks:[new E({config:a,onStart:e,onEnd:t,onError:r})]})]})}asTool(e){return function(e,t){let r=t.name??e.getName(),i=t.description??(0,J.cg)(t.schema);return new ei((0,J.yQ)(t.schema)?{name:r,description:i,schema:a.z.object({input:a.z.string()}).transform(e=>e.input),bound:e}:{name:r,description:i,schema:t.schema,bound:e})}(this,e)}}class W extends G{static lc_name(){return"RunnableBinding"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"configFactories",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound,this.kwargs=e.kwargs,this.config=e.config,this.configFactories=e.configFactories}getName(e){return this.bound.getName(e)}async _mergeConfig(...e){let t=(0,I.SV)(this.config,...e);return(0,I.SV)(t,...this.configFactories?await Promise.all(this.configFactories.map(async e=>await e(t))):[])}bind(e){return new this.constructor({bound:this.bound,kwargs:{...this.kwargs,...e},config:this.config})}withConfig(e){return new this.constructor({bound:this.bound,kwargs:this.kwargs,config:{...this.config,...e}})}withRetry(e){return new Y({bound:this.bound,kwargs:this.kwargs,config:this.config,maxAttemptNumber:e?.stopAfterAttempt,...e})}async invoke(e,t){return this.bound.invoke(e,await this._mergeConfig((0,I.ZI)(t),this.kwargs))}async batch(e,t,r){let a=Array.isArray(t)?await Promise.all(t.map(async e=>this._mergeConfig((0,I.ZI)(e),this.kwargs))):await this._mergeConfig((0,I.ZI)(t),this.kwargs);return this.bound.batch(e,a,r)}async *_streamIterator(e,t){yield*this.bound._streamIterator(e,await this._mergeConfig((0,I.ZI)(t),this.kwargs))}async stream(e,t){return this.bound.stream(e,await this._mergeConfig((0,I.ZI)(t),this.kwargs))}async *transform(e,t){yield*this.bound.transform(e,await this._mergeConfig((0,I.ZI)(t),this.kwargs))}streamEvents(e,t,r){let a=this,i=async function*(){yield*a.bound.streamEvents(e,{...await a._mergeConfig((0,I.ZI)(t),a.kwargs),version:t.version},r)};return u.bO.fromAsyncGenerator(i())}static isRunnableBinding(e){return e.bound&&G.isRunnable(e.bound)}withListeners({onStart:e,onEnd:t,onError:r}){return new W({bound:this.bound,kwargs:this.kwargs,config:this.config,configFactories:[a=>({callbacks:[new E({config:a,onStart:e,onEnd:t,onError:r})]})]})}}class H extends G{static lc_name(){return"RunnableEach"}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound}bind(e){return new H({bound:this.bound.bind(e)})}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async _invoke(e,t,r){return this.bound.batch(e,(0,I.tn)(t,{callbacks:r?.getChild()}))}withListeners({onStart:e,onEnd:t,onError:r}){return new H({bound:this.bound.withListeners({onStart:e,onEnd:t,onError:r})})}}class Y extends W{static lc_name(){return"RunnableRetry"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"maxAttemptNumber",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:()=>{}}),this.maxAttemptNumber=e.maxAttemptNumber??this.maxAttemptNumber,this.onFailedAttempt=e.onFailedAttempt??this.onFailedAttempt}_patchConfigForRetry(e,t,r){let a=e>1?`retry:attempt:${e}`:void 0;return(0,I.tn)(t,{callbacks:r?.getChild(a)})}async _invoke(e,t,r){return i(a=>super.invoke(e,this._patchConfigForRetry(a,t,r)),{onFailedAttempt:t=>this.onFailedAttempt(t,e),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async _batch(e,t,r,a){let n={};try{await i(async i=>{let s;let o=e.map((e,t)=>t).filter(e=>void 0===n[e.toString()]||n[e.toString()]instanceof Error),l=o.map(t=>e[t]),u=o.map(e=>this._patchConfigForRetry(i,t?.[e],r?.[e])),c=await super.batch(l,u,{...a,returnExceptions:!0});for(let e=0;e<c.length;e+=1){let t=c[e],r=o[e];t instanceof Error&&void 0===s&&((s=t).input=l[e]),n[r.toString()]=t}if(s)throw s;return c},{onFailedAttempt:e=>this.onFailedAttempt(e,e.input),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}catch(e){if(a?.returnExceptions!==!0)throw e}return Object.keys(n).sort((e,t)=>parseInt(e,10)-parseInt(t,10)).map(e=>n[parseInt(e,10)])}async batch(e,t,r){return this._batchWithConfig(this._batch.bind(this),e,t,r)}}class V extends G{static lc_name(){return"RunnableSequence"}constructor(e){super(e),Object.defineProperty(this,"first",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"middle",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"last",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"omitSequenceTags",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),this.first=e.first,this.middle=e.middle??this.middle,this.last=e.last,this.name=e.name,this.omitSequenceTags=e.omitSequenceTags??this.omitSequenceTags}get steps(){return[this.first,...this.middle,this.last]}async invoke(e,t){let r;let a=(0,I.ZI)(t),i=await (0,I.kJ)(a),n=await i?.handleChainStart(this.toJSON(),q(e,"input"),a.runId,void 0,void 0,void 0,a?.runName);delete a.runId;let s=e;try{let e=[this.first,...this.middle];for(let r=0;r<e.length;r+=1){let i=e[r].invoke(s,(0,I.tn)(a,{callbacks:n?.getChild(this.omitSequenceTags?void 0:`seq:step:${r+1}`)}));s=await (0,O.o)(i,t?.signal)}if(t?.signal?.aborted)throw Error("Aborted");r=await this.last.invoke(s,(0,I.tn)(a,{callbacks:n?.getChild(this.omitSequenceTags?void 0:`seq:step:${this.steps.length}`)}))}catch(e){throw await n?.handleChainError(e),e}return await n?.handleChainEnd(q(r,"output")),r}async batch(e,t,r){let a=this._getOptionsList(t??{},e.length),i=await Promise.all(a.map(I.kJ)),n=await Promise.all(i.map(async(t,r)=>{let i=await t?.handleChainStart(this.toJSON(),q(e[r],"input"),a[r].runId,void 0,void 0,void 0,a[r].runName);return delete a[r].runId,i})),s=e;try{for(let e=0;e<this.steps.length;e+=1){let t=this.steps[e].batch(s,n.map((t,r)=>{let i=t?.getChild(this.omitSequenceTags?void 0:`seq:step:${e+1}`);return(0,I.tn)(a[r],{callbacks:i})}),r);s=await (0,O.o)(t,a[0]?.signal)}}catch(e){throw await Promise.all(n.map(t=>t?.handleChainError(e))),e}return await Promise.all(n.map(e=>e?.handleChainEnd(q(s,"output")))),s}async *_streamIterator(e,t){let r;let a=await (0,I.kJ)(t),{runId:i,...n}=t??{},s=await a?.handleChainStart(this.toJSON(),q(e,"input"),i,void 0,void 0,void 0,n?.runName),o=[this.first,...this.middle,this.last],l=!0;async function*c(){yield e}try{let e=o[0].transform(c(),(0,I.tn)(n,{callbacks:s?.getChild(this.omitSequenceTags?void 0:"seq:step:1")}));for(let t=1;t<o.length;t+=1){let r=o[t];e=await r.transform(e,(0,I.tn)(n,{callbacks:s?.getChild(this.omitSequenceTags?void 0:`seq:step:${t+1}`)}))}for await(let a of e)if(t?.signal?.throwIfAborted(),yield a,l){if(void 0===r)r=a;else try{r=(0,u.xW)(r,a)}catch(e){r=void 0,l=!1}}}catch(e){throw await s?.handleChainError(e),e}await s?.handleChainEnd(q(r,"output"))}getGraph(e){let t=new C,r=null;return this.steps.forEach((a,i)=>{let n=a.getGraph(e);0!==i&&n.trimFirstNode(),i!==this.steps.length-1&&n.trimLastNode(),t.extend(n);let s=n.firstNode();if(!s)throw Error(`Runnable ${a} has no first node`);r&&t.addEdge(r,s),r=n.lastNode()}),t}pipe(e){return new V(V.isRunnableSequence(e)?{first:this.first,middle:this.middle.concat([this.last,e.first,...e.middle]),last:e.last,name:this.name??e.name}:{first:this.first,middle:[...this.middle,this.last],last:et(e),name:this.name})}static isRunnableSequence(e){return Array.isArray(e.middle)&&G.isRunnable(e)}static from([e,...t],r){let a={};return"string"==typeof r?a.name=r:void 0!==r&&(a=r),new V({...a,first:et(e),middle:t.slice(0,-1).map(et),last:et(t[t.length-1])})}}class K extends G{static lc_name(){return"RunnableMap"}getStepsKeys(){return Object.keys(this.steps)}constructor(e){for(let[t,r]of(super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"steps",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.steps={},Object.entries(e.steps)))this.steps[t]=et(r)}static from(e){return new K({steps:e})}async invoke(e,t){let r=(0,I.ZI)(t),a=await (0,I.kJ)(r),i=await a?.handleChainStart(this.toJSON(),{input:e},r.runId,void 0,void 0,void 0,r?.runName);delete r.runId;let n={};try{let a=Object.entries(this.steps).map(async([t,a])=>{n[t]=await a.invoke(e,(0,I.tn)(r,{callbacks:i?.getChild(`map:key:${t}`)}))});await (0,O.o)(Promise.all(a),t?.signal)}catch(e){throw await i?.handleChainError(e),e}return await i?.handleChainEnd(n),n}async *_transform(e,t,r){let a={...this.steps},i=(0,u.gI)(e,Object.keys(a).length),n=new Map(Object.entries(a).map(([e,a],n)=>{let s=a.transform(i[n],(0,I.tn)(r,{callbacks:t?.getChild(`map:key:${e}`)}));return[e,s.next().then(t=>({key:e,gen:s,result:t}))]}));for(;n.size;){let e=Promise.race(n.values()),{key:t,result:a,gen:i}=await (0,O.o)(e,r?.signal);n.delete(t),a.done||(yield{[t]:a.value},n.set(t,i.next().then(e=>({key:t,gen:i,result:e}))))}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}let a=(0,I.ZI)(t),i=new u.Tr({generator:this.transform(r(),a),config:a});return await i.setup,u.bO.fromAsyncGenerator(i)}}class X extends G{constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),!(0,s.GZ)(e.func))throw Error("RunnableTraceable requires a function that is wrapped in traceable higher-order function");this.func=e.func}async invoke(e,t){let[r]=this._getOptionsList(t??{},1),a=await (0,I.kJ)(r),i=this.func((0,I.tn)(r,{callbacks:a}),e);return(0,O.o)(i,r?.signal)}async *_streamIterator(e,t){let[r]=this._getOptionsList(t??{},1),a=await this.invoke(e,t);if(F(a)){for await(let e of a)r?.signal?.throwIfAborted(),yield e;return}if(D(a)){for(;;){r?.signal?.throwIfAborted();let e=a.next();if(e.done)break;yield e.value}return}yield a}static from(e){return new X({func:e})}}class Q extends G{static lc_name(){return"RunnableLambda"}constructor(e){if((0,s.GZ)(e.func))return X.from(e.func);super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),function(e){if((0,s.GZ)(e))throw Error("RunnableLambda requires a function that is not wrapped in traceable higher-order function. This shouldn't happen.")}(e.func),this.func=e.func}static from(e){return new Q({func:e})}async _invoke(e,t,r){return new Promise((a,i)=>{let n=(0,I.tn)(t,{callbacks:r?.getChild(),recursionLimit:(t?.recursionLimit??I.p_)-1});P.Nx.runWithConfig((0,I.DY)(n),async()=>{try{let r=await this.func(e,{...n});if(r&&G.isRunnable(r)){if(t?.recursionLimit===0)throw Error("Recursion limit reached.");r=await r.invoke(e,{...n,recursionLimit:(n.recursionLimit??I.p_)-1})}else if(F(r)){let e;for await(let a of B(n,r))if(t?.signal?.throwIfAborted(),void 0===e)e=a;else try{e=(0,u.xW)(e,a)}catch(t){e=a}r=e}else if(M(r)){let e;for(let a of z(n,r))if(t?.signal?.throwIfAborted(),void 0===e)e=a;else try{e=(0,u.xW)(e,a)}catch(t){e=a}r=e}a(r)}catch(e){i(e)}})})}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async *_transform(e,t,r){let a;for await(let t of e)if(void 0===a)a=t;else try{a=(0,u.xW)(a,t)}catch(e){a=t}let i=(0,I.tn)(r,{callbacks:t?.getChild(),recursionLimit:(r?.recursionLimit??I.p_)-1}),n=await new Promise((e,t)=>{P.Nx.runWithConfig((0,I.DY)(i),async()=>{try{let t=await this.func(a,{...i,config:i});e(t)}catch(e){t(e)}})});if(n&&G.isRunnable(n)){if(r?.recursionLimit===0)throw Error("Recursion limit reached.");for await(let e of(await n.stream(a,i)))yield e}else if(F(n))for await(let e of B(i,n))r?.signal?.throwIfAborted(),yield e;else if(M(n))for(let e of z(i,n))r?.signal?.throwIfAborted(),yield e;else yield n}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}let a=(0,I.ZI)(t),i=new u.Tr({generator:this.transform(r(),a),config:a});return await i.setup,u.bO.fromAsyncGenerator(i)}}class ee extends G{static lc_name(){return"RunnableWithFallbacks"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"runnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fallbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.runnable=e.runnable,this.fallbacks=e.fallbacks}*runnables(){for(let e of(yield this.runnable,this.fallbacks))yield e}async invoke(e,t){let r=(0,I.ZI)(t),a=await (0,I.kJ)(r),{runId:i,...n}=r,s=await a?.handleChainStart(this.toJSON(),q(e,"input"),i,void 0,void 0,void 0,n?.runName),o=(0,I.tn)(n,{callbacks:s?.getChild()});return await P.Nx.runWithConfig(o,async()=>{let t;for(let a of this.runnables()){r?.signal?.throwIfAborted();try{let t=await a.invoke(e,o);return await s?.handleChainEnd(q(t,"output")),t}catch(e){void 0===t&&(t=e)}}if(void 0===t)throw Error("No error stored at end of fallback.");throw await s?.handleChainError(t),t})}async *_streamIterator(e,t){let r,a,i;let n=(0,I.ZI)(t),s=await (0,I.kJ)(n),{runId:o,...l}=n,c=await s?.handleChainStart(this.toJSON(),q(e,"input"),o,void 0,void 0,void 0,l?.runName);for(let t of this.runnables()){n?.signal?.throwIfAborted();let i=(0,I.tn)(l,{callbacks:c?.getChild()});try{let r=await t.stream(e,i);a=B(i,r);break}catch(e){void 0===r&&(r=e)}}if(void 0===a){let e=r??Error("No error stored at end of fallback.");throw await c?.handleChainError(e),e}try{for await(let e of a){yield e;try{i=void 0===i?i:(0,u.xW)(i,e)}catch(e){i=void 0}}}catch(e){throw await c?.handleChainError(e),e}await c?.handleChainEnd(q(i,"output"))}async batch(e,t,r){let a;if(r?.returnExceptions)throw Error("Not implemented.");let i=this._getOptionsList(t??{},e.length),n=await Promise.all(i.map(e=>(0,I.kJ)(e))),s=await Promise.all(n.map(async(t,r)=>{let a=await t?.handleChainStart(this.toJSON(),q(e[r],"input"),i[r].runId,void 0,void 0,void 0,i[r].runName);return delete i[r].runId,a}));for(let t of this.runnables()){i[0].signal?.throwIfAborted();try{let a=await t.batch(e,s.map((e,t)=>(0,I.tn)(i[t],{callbacks:e?.getChild()})),r);return await Promise.all(s.map((e,t)=>e?.handleChainEnd(q(a[t],"output")))),a}catch(e){void 0===a&&(a=e)}}if(!a)throw Error("No error stored at end of fallbacks.");throw await Promise.all(s.map(e=>e?.handleChainError(a))),a}}function et(e){if("function"==typeof e)return new Q({func:e});if(G.isRunnable(e))return e;if(Array.isArray(e)||"object"!=typeof e)throw Error(`Expected a Runnable, function or object.
Instead got an unsupported type.`);{let t={};for(let[r,a]of Object.entries(e))t[r]=et(a);return new K({steps:t})}}class er extends G{static lc_name(){return"RunnableAssign"}constructor(e){e instanceof K&&(e={mapper:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"mapper",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.mapper=e.mapper}async invoke(e,t){let r=await this.mapper.invoke(e,t);return{...e,...r}}async *_transform(e,t,r){let a=this.mapper.getStepsKeys(),[i,n]=(0,u.gI)(e),s=this.mapper.transform(n,(0,I.tn)(r,{callbacks:t?.getChild()})),o=s.next();for await(let e of i){if("object"!=typeof e||Array.isArray(e))throw Error(`RunnableAssign can only be used with objects as input, got ${typeof e}`);let t=Object.fromEntries(Object.entries(e).filter(([e])=>!a.includes(e)));Object.keys(t).length>0&&(yield t)}for await(let e of(yield(await o).value,s))yield e}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}let a=(0,I.ZI)(t),i=new u.Tr({generator:this.transform(r(),a),config:a});return await i.setup,u.bO.fromAsyncGenerator(i)}}class ea extends G{static lc_name(){return"RunnablePick"}constructor(e){("string"==typeof e||Array.isArray(e))&&(e={keys:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"keys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keys=e.keys}async _pick(e){if("string"==typeof this.keys)return e[this.keys];{let t=this.keys.map(t=>[t,e[t]]).filter(e=>void 0!==e[1]);return 0===t.length?void 0:Object.fromEntries(t)}}async invoke(e,t){return this._callWithConfig(this._pick.bind(this),e,t)}async *_transform(e){for await(let t of e){let e=await this._pick(t);void 0!==e&&(yield e)}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}let a=(0,I.ZI)(t),i=new u.Tr({generator:this.transform(r(),a),config:a});return await i.setup,u.bO.fromAsyncGenerator(i)}}class ei extends W{constructor(e){super({bound:V.from([Q.from(async e=>{let t;if((0,Z.Ky)(e))try{t=await (0,J.hZ)(this.schema,e.args)}catch(t){throw new Z.qe("Received tool input did not match expected schema",JSON.stringify(e.args))}else t=e;return t}).withConfig({runName:`${e.name}:parse_input`}),e.bound]).withConfig({runName:e.name}),config:e.config??{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.description=e.description,this.schema=e.schema}static lc_name(){return"RunnableToolLike"}}}}]);